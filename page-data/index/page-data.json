{"componentChunkName":"component---src-pages-index-tsx","path":"/","result":{"data":{"site":{"siteMetadata":{"title":"NoSleep Javascript Blog"}},"allMarkdownRemark":{"edges":[{"node":{"html":"<p>For the past couple of weeks I have been playing around with the idea of news\nthat are stored completely on-chain to make them uneditable and uncensorable.</p>\n<p><a href=\"https://carolus-web.vercel.app\">Carolus</a> is the result of that experimentation and I expect it to be just one of many examples\nof <a href=\"https://ethereum.org/en/developers/docs/web2-vs-web3/\">web3</a> <a href=\"https://ethereum.org/en/dapps/#what-are-dapps\">dapps</a> that are non-financial applications.</p>\n<p>At its core, Carolus is really simple: it is a place where journalists, archivers and amateurs\ncan publish news that won’t be affected by the well known problems that\ntraditional and centralized media suffer.</p>\n<p>The news piece is modeled as an <a href=\"https://eips.ethereum.org/EIPS/eip-721\">ERC-721</a> compliant NFT that can be <a href=\"https://en.wikipedia.org/wiki/Johann_Carolus\">traded in OpenSea</a>.\nOut of the box, it serves as a way to monetize content but also as a way for collectors\nto collect news that mean something for them and that they simply want to be the guardians of.</p>\n<p>Creators pay a flat fee for minting (publishing) news. Those fees go to the <strong>Carolus Treasury</strong>.</p>\n<p>Other models of storage are possible but the purest, more secure but most expensive is fully on-chain.\nTo avoid paying obscene fees I chose a <a href=\"https://ethereum.org/en/developers/docs/scaling/layer-2-rollups/\">Layer2 scaling solution</a>: <a href=\"https://en.wikipedia.org/wiki/Johann_Carolus\">Polygon</a>, which is one of the most important\nL2 currently and has a great future.</p>\n<h3 id=\"what-if-the-news-are-objectively-harmful\" style=\"position:relative;\">What if the news are <em>objectively</em> harmful?<a href=\"#what-if-the-news-are-objectively-harmful\" aria-label=\"what if the news are objectively harmful permalink\" class=\"header-anchor after\">#</a></h3>\n<blockquote>\n<p>I won’t dwell too much what this actually means in this post, let me know if you are interested in exploring this topic further.</p>\n</blockquote>\n<p>Carolus lets the users vote up or down a given news piece.\nIf the ratio of dislikes to likes is more than 10 then the news can be censured by a moderator.</p>\n<p>The exact parameters of this functionality will be something I would expect many variants will\nexist and that a decent amount of exploration and experimentation can be made.\nI choose a really simple model that would give power to the community.</p>\n<p>In this beta version the moderator will be a wallet controlled by an individual (me) but\nin future versions I see a <a href=\"https://ethereum.org/en/dao/\">DAO</a> being formed that will both have moderation roles and will\ndecide what to do with the Treasury.</p>\n<p>As this is still a beta product or an experiment even I am leaving an emergency mechanism to\nremove <em>harmful</em> content. I can only promise I will use it only to remove really bad things and never to\ncensure someones opinion. Eventually this kill switch could be removed altogether.</p>\n<h3 id=\"forking\" style=\"position:relative;\">Forking<a href=\"#forking\" aria-label=\"forking permalink\" class=\"header-anchor after\">#</a></h3>\n<p>In future iterations I plan to add a <em>forking</em> functionality.\nIf the controlling moderator (individual or DAO) starts censoring more than its fair share,\nit should be really straight forward to <em>fork</em> (copy and create a new instance) the contract,\ndeploy a new front-end and avoid the censorship altogether.</p>\n<p>This would include concrete instructions, scripts and general documentation to make this mechanism as easy as possible.</p>\n<h3 id=\"carolus-treasury\" style=\"position:relative;\">Carolus Treasury<a href=\"#carolus-treasury\" aria-label=\"carolus treasury permalink\" class=\"header-anchor after\">#</a></h3>\n<p>In this early beta project the treasury will be used to finance the development of Carolus,\nif it becomes large enough I plan to release a more comprehensive strategy to use it for the common good.</p>\n<h3 id=\"why-the-name-carolus\" style=\"position:relative;\">Why the name: Carolus?<a href=\"#why-the-name-carolus\" aria-label=\"why the name carolus permalink\" class=\"header-anchor after\">#</a></h3>\n<p><a href=\"https://en.wikipedia.org/wiki/Johann_Carolus\">Johann Carolus</a> was the publisher of the first newspaper. Carolus is probably one of the first web3 newspaper.</p>\n<h3 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h3>\n<p>All the code is open source: <a href=\"https://github.com/franleplant/carolus_contracts\">contract</a>, <a href=\"https://github.com/franleplant/carolus_api\">api</a> and <a href=\"https://github.com/franleplant/carolus_web\">client</a>.</p>\n<p><a href=\"https://carolus-web.vercel.app\">Go to Carolus</a></p>","excerpt":"For the past couple of weeks I have been playing around with the idea of news\nthat are stored completely on-chain to make them uneditable…","fields":{"slug":"/introducing-carolus/","readingTime":{"text":"3 min read"}},"frontmatter":{"title":"Introducing Carolus: decentralized, uncensorable and on-chain newspaper","date":"January 29, 2022","description":"Introducing ibridge, a tiny, typesafe, promise-based library for bidirectional and secure iframe communication.","tags":["ethereum","typescript","javascript","polygon"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p><a href=\"https://cardano.org\">Cardano’s</a> take on <a href=\"https://ethereum.org/en/dapps/#what-are-dapps\">DApps</a> is substantially different from that\nof <a href=\"https://ethereum.org/en/\">Ethereum</a>, the top DApp platform today, and by taking this\nroute Cardano achieves better correctness guaranties that aim\nto prevent costly bugs and exploits.</p>\n<p>Cardano will never have smart contracts, instead it will have\n<strong>Smart Transactions</strong>, which is a much more accurate name\nfor its DApp platform in my opinion.</p>\n<p>Cardano uses the <a href=\"https://github.com/Emurgo/Emurgo-Research/blob/master/smart-contracts/Unlocking%20The%20Potential%20Of%20The%20UTXO%20Model.md\">EUTxO</a> model which stands for <strong>Extended Unspent Transaction Output</strong>.\nThis might ring a bell because the <a href=\"https://en.wikipedia.org/wiki/Unspent_transaction_output\">UTxO</a> model is what <a href=\"https://bitcoin.org/en/\">Bitcoin</a> pioneered and to a point\n<em>extended</em> in order to allow Bitcoin’s limited scripting capabilities.\nBut Cardano takes it all the way and by <em>extending</em> the UTxO model, it achieves\nfull blown DApp platform status.</p>\n<h2 id=\"eutxo\" style=\"position:relative;\">EUTxO<a href=\"#eutxo\" aria-label=\"eutxo permalink\" class=\"header-anchor after\">#</a></h2>\n<p>The UTxO model, at a high level, is composed of <strong>transactions</strong>\nand <strong>unspent transaction outputs</strong>.</p>\n<p>Transactions or <strong>tx</strong> consume unspent outputs from previous transactions\nand produce new unspent outputs, starting from the genesis transaction.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2569d4c063c277aace2d642a459f3d99/17460/utxo.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAdhTID//xAAVEAEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAQABBQJr/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGBAAAwEBAAAAAAAAAAAAAAAAABAxEQH/2gAIAQEAAT8hrCHIsX//2gAMAwEAAgADAAAAEGTv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAICAwEAAAAAAAAAAAAAAQARITEQUXFB/9oACAEBAAE/EGnlemWjLeF1FYe4nsw+vW+P/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"utxo diagram\"\n        title=\"utxo diagram\"\n        src=\"/static/2569d4c063c277aace2d642a459f3d99/1c72d/utxo.jpg\"\n        srcset=\"/static/2569d4c063c277aace2d642a459f3d99/a80bd/utxo.jpg 148w,\n/static/2569d4c063c277aace2d642a459f3d99/1c91a/utxo.jpg 295w,\n/static/2569d4c063c277aace2d642a459f3d99/1c72d/utxo.jpg 590w,\n/static/2569d4c063c277aace2d642a459f3d99/a8a14/utxo.jpg 885w,\n/static/2569d4c063c277aace2d642a459f3d99/fbd2c/utxo.jpg 1180w,\n/static/2569d4c063c277aace2d642a459f3d99/17460/utxo.jpg 1886w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>Alice and Bob are just convenient aliases for their cryptographic Public Keys.</li>\n<li><strong>C</strong> means some coin.</li>\n<li>There are no fees in this simple example.</li>\n<li>Any address, i.e. Alice, may have multiple utxos.</li>\n</ul>\n<p>All utxos for a given account make up the available balance of said account.\nAnd all the spent outputs are the spending history of that account.\nWhen Alice sends Bob <em>5 coins</em> she simply consumes one utxo of 5 coins in her account\nand produce a new utxo of 5 coins in Bob’s account through a transaction.</p>\n<p>To know the full balance of a given account you would need to query the blockchain\nfor every utxo for that account or <em>sitting at that account</em>.</p>\n<p>From this simple explanation you can have a better understanding on why Bitcoin\ntransaction regularly have “change”, because if Alice has only a utxo with 10 coins\nand wants to send 5 coins to Bob then that <em>entire</em> utxo will be consumed by a transaction\nand two new utxos will be created, one for Bob with 5 coins and second one with Alice’s <em>change</em>:\n5 coins.</p>\n<p>The <strong>EUTxO</strong> model only adds a couple of things to enable DApps:</p>\n<h3 id=\"datum\" style=\"position:relative;\">Datum<a href=\"#datum\" aria-label=\"datum permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Utxos can contain a <code class=\"language-text\">Datum</code> which is an arbitrary piece of data that is stored on-chain.\nThis is typically used as part of your DApp’s state.\nLet’s say your DApp is a Price Oracle, then where would you store price feeds?\nYou guessed it: in the <code class=\"language-text\">Datum</code>.</p>\n<h3 id=\"script-addresses\" style=\"position:relative;\">Script addresses<a href=\"#script-addresses\" aria-label=\"script addresses permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Special script addresses are allowed. They behave pretty much like a regular address and\ncan receive and spend utxos. The script itself is a <code class=\"language-text\">Validator</code> function written in Haskell and\n<a href=\"https://github.com/input-output-hk/plutus\">Plutus</a> that runs on-chain every time someone tries to <em>spend</em> utxos sitting at the script address.\nThis is the main on-chain logic in Cardano’s DApps, it is the closest to a Ethereum’s smart contract\nbut it is radically different in scope and functionality.</p>\n<p>Scripts act as pure functions that receive the transaction where the utxo spending is happening,\nthe <code class=\"language-text\">Redeemer</code> (explained next) and the entire utxo that someone is trying to spend which contains\nany coins and Native Tokens balances together with a <code class=\"language-text\">Datum</code> if any.</p>\n<p>Scripts don’t have access to anything else, they cannot create transactions, only validate them, they\ncannot call other things on chain. These are the main differences with Ethereum’s Smart Contracts.</p>\n<blockquote>\n<p>Side note: Native Tokens are any custom made token that Cardano treats as Ada, this abstracts away\nthe contracts needed to deploy these tokens (i.e. look at the <a href=\"https://ethereum.org/en/developers/docs/standards/tokens/erc-20/\">ERC20</a> standard contract) and reduces the\nfees for operating with these tokens to the ground (compared to what a <a href=\"https://www.circle.com/en/usdc\">USDC</a> transaction can cost\nin Ethereum’s mainnet).</p>\n</blockquote>\n<h3 id=\"reedemer\" style=\"position:relative;\">Reedemer<a href=\"#reedemer\" aria-label=\"reedemer permalink\" class=\"header-anchor after\">#</a></h3>\n<p>The <code class=\"language-text\">Redeemer</code> is an arbitrary piece of data you can pass to the validator when creating a transaction\nthat spends utxos from that validator, it is a way of parametrizing the validator to allow things such as\nstate machines and different actions being performed in a DApp.</p>\n<h2 id=\"full-blown-dapps-platform\" style=\"position:relative;\">Full blown DApps platform<a href=\"#full-blown-dapps-platform\" aria-label=\"full blown dapps platform permalink\" class=\"header-anchor after\">#</a></h2>\n<p>With all these <em>extensions</em> Cardano achieves a full blown DApp platform with\nsimilar capabilities to Ethereum and others but with stronger correctness guarantees\nmaking it more difficult for developers to royally screw it up as it has been shown\n<a href=\"https://www.google.com/search?q=ethereum+dapp+exploits\">time and time again</a>.</p>\n<p>This model requires thicker clients that have more things to do than in Ethereum’s DApps,\nso you could say that Cardano DApps are heavier on the client than on the <em>server</em>,\nbut all this happens without sacrificing correctness and the dev toolkit even allows to write\nclient side code in the same language, Haskell, and with the same tools, Plutus, than the\non-chain code, making it simpler to share logic and ensure your code is correct.</p>\n<h2 id=\"pab-plutus-application-backend\" style=\"position:relative;\">PAB: Plutus Application Backend<a href=\"#pab-plutus-application-backend\" aria-label=\"pab plutus application backend permalink\" class=\"header-anchor after\">#</a></h2>\n<p>The final piece of the puzzle is the <a href=\"https://iohk.io/en/blog/posts/2021/04/13/plutus-what-you-need-to-know/\">PAB</a> which will allow DApps to run directly in the browser\nlike Ethereum DApps. The PAB will be released soon. In the mean time developers will\nneed to run backend services in order to communicate with the blockchain so\nDApps are still possible even without the PAB.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\">Conclusion<a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I am really excited about Cardano’s potential as a DApp platform, together with the EUTxO model\nand features such as Native Token that allow for very easy and cheap custom coins (like <a href=\"https://www.circle.com/en/usdc\">USDC</a> or <a href=\"https://ethereum.org/en/nft/\">NFTs</a>\nbeing treated like Ada with the same low fees) the future does seem bright for Cardano.</p>\n<blockquote>\n<h2 id=\"cardano-will-never-have-smart-contracts-it-will-have-smart-transactions-and-will-have-full-blow-support-for-dapps\" style=\"position:relative;\"><strong>Cardano will never have smart contracts, it will have Smart Transactions and will have full blow support for DApps</strong><a href=\"#cardano-will-never-have-smart-contracts-it-will-have-smart-transactions-and-will-have-full-blow-support-for-dapps\" aria-label=\"cardano will never have smart contracts it will have smart transactions and will have full blow support for dapps permalink\" class=\"header-anchor after\">#</a></h2>\n</blockquote>","excerpt":"Cardano’s take on DApps is substantially different from that\nof Ethereum, the top DApp platform today, and by taking this\nroute Cardano…","fields":{"slug":"/cardano-smart-transactions/","readingTime":{"text":"5 min read"}},"frontmatter":{"title":"Cardano will never have smart contracts","date":"August 31, 2021","description":" Let's talk about the upcoming Cardano Alonzo hard fork and what we are going to see in the future ","tags":["cardano","smart contracts","smart transactions","plutus","blockchain"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>I’ve taken part of the second cohort of the <a href=\"https://testnets.cardano.org/en/plutus-pioneer-program/\">Plutus Pioneer Program</a> where one can\nlearn how to write Smart Contracts in <a href=\"https://cardano.org/\">Cardano</a> by using <a href=\"https://github.com/input-output-hk/plutus\">Plutus</a>, set for main chain release in late 2021.</p>\n<p>Cardano’s version of Smart Contract is pretty “weird” coming from <a href=\"https://ethereum.org/en/\">Ethereum</a>,\nand I plan to write about it later but it does provide some interesting abstractions that let\nyou express common patterns rather easily, in particular we are going to be covering\nhow you can model your DApp as a state machine and how can you express said model in Plutus\npretty easily.</p>\n<p>Cardano’s Smart Contracts are written in a Haskell library called Plutus, so put up your\nfunctional programming hat and let’s get our hands dirty.</p>\n<p>Note: at the time of writing there still some wrinkles in Cardano’s smart contract platform, so\nif you are not part of the Plutus Pioneer Program you might have some difficulties running the code,\nbut hopefully it will be a nice showcase of how Cardano enables smart contracts.\nAlso, State Machines are just a higher level abstraction to write smart contracts in Cardano but\nnot at all the only way, so you are not limited to them.</p>\n<h2 id=\"quick-intro-to-plutus-concepts\" style=\"position:relative;\">Quick intro to Plutus Concepts<a href=\"#quick-intro-to-plutus-concepts\" aria-label=\"quick intro to plutus concepts permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Plutus smart contracts should be called <strong>Smart Transactions</strong> because that is all you can really do <em>on-chain</em>.</p>\n<p>From the outside, users can only generate <strong>Transactions</strong> with inputs (UTxOs or unspent transaction outputs of previous\ntransactions) and generate outputs (also UTxOs) at different public key addresses depending on the use case.</p>\n<p>These transactions are created <em>off-chain</em> and sent along with a trivial payload\ncalled the <strong>Redeemer</strong>.</p>\n<p>A transaction is only applied to the blockchain after being <em>validated</em> by <strong>Validator script</strong>\nwhich is the main thing DApp developers write and run <em>on-chain</em>.</p>\n<p>This validator script has a public key address made up of its hash and\nfunds (UTxOs) can only be spent if the transaction trying to spend them\npasses the validation, which is the business logic running <em>on-chain</em>.</p>\n<p>A UTxO contains coins or Native Tokens plus a trivial custom payload called the <code class=\"language-text\">Datum</code>,\nwhich serves as a custom application state and is central to the ability to write DApps.</p>\n<p>The main difference between user accounts and script accounts is that\nuser accounts need to sign spending transactions with their private key but\nanyone can spend from a script address if the transaction is considered valid by the\nvalidator script itself. Is a pretty interesting model.</p>\n<p>All this is part of the EUTxO model or the Extended Unspect Transaction Output which is\nthe model pioneered by Bitcoin with some extensions to allow <em>smart contracts</em>.</p>\n<p>Surprisingly this model allows pretty much all what you would expect from a smart contract platform, it is just modeled\ndifferently and does comes with trade-offs. It is similar to what <code class=\"language-text\">functional programming</code> brings to the table in terms\nof predictability, testability and simpler interfaces comparing it to imperative or object oriented programming,\nso we could say that <strong>Cardano is a platform for pure functional smart contracts</strong>.</p>\n<h2 id=\"rock-paper-scissors\" style=\"position:relative;\">Rock Paper Scissors<a href=\"#rock-paper-scissors\" aria-label=\"rock paper scissors permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We are going write the Rock Paper Scissors game but in the blockchain, I eventually will\nlike to really deploy it and add a nice UI on top of it.</p>\n<p>The model we are going to use makes the first player commit to a play but without telling exactly the\nplay by using a hash, then the second player plays, and finally the first player reveals and the “stake”\nor “bet” is distributed. There are also play deadlines and reveal deadlines to make the contract safe.</p>\n<p>Here is a complete state diagram of our game model.\nThe transitions are labeled with the <code class=\"language-text\">Redeemer</code> and its payload, constraints and checks.\nConstraints are common transaction constraints that Plutus provides abstractions for and\nchecks are anything else developers might want to check to allow or not a given state transition.\nIn our case we only use <code class=\"language-text\">checks</code> in the chase of <code class=\"language-text\">Player1RevealWin</code> and <code class=\"language-text\">Player1RevealDraw</code>, where\nwe check that effectively it is a win or a draw for Player1.\nThe state are composed of <code class=\"language-text\">Datum</code> which holds trivial data plus the staked / bet value.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d90346e03181797b40d09b9e18171b09/98d66/states.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 131.0810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHsSxNAMtFiq//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEAAQUCT//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CT//EABwQAAICAgMAAAAAAAAAAAAAAAABETEQIUFRsf/aAAgBAQABPyF9JlLbIPRTHEirY1TNQJQrwqx//9oADAMBAAIAAwAAABBAOjz/xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8QdP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EABsQAQADAQEBAQAAAAAAAAAAAAEAESExQRBR/9oACAEBAAE/EFa6KglG8BXWJlhxkWOhktT1AbPPydH17HAVEKc+n//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"State transition function\"\n        title=\"State transition function\"\n        src=\"/static/d90346e03181797b40d09b9e18171b09/1c72d/states.jpg\"\n        srcset=\"/static/d90346e03181797b40d09b9e18171b09/a80bd/states.jpg 148w,\n/static/d90346e03181797b40d09b9e18171b09/1c91a/states.jpg 295w,\n/static/d90346e03181797b40d09b9e18171b09/1c72d/states.jpg 590w,\n/static/d90346e03181797b40d09b9e18171b09/a8a14/states.jpg 885w,\n/static/d90346e03181797b40d09b9e18171b09/fbd2c/states.jpg 1180w,\n/static/d90346e03181797b40d09b9e18171b09/98d66/states.jpg 1905w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"on-chain-state-code-classlanguage-textdatumcode\" style=\"position:relative;\">On-chain state: <code class=\"language-text\">Datum</code><a href=\"#on-chain-state-code-classlanguage-textdatumcode\" aria-label=\"on chain state code classlanguage textdatumcode permalink\" class=\"header-anchor after\">#</a></h2>\n<p>As we said before, the <code class=\"language-text\">Datum</code> will be a trivial piece of data we are going to store <code class=\"language-text\">on-chain</code>.\nIn this particular case we are going to use it to store the current state of our state machine plus\nthe choices made by players.</p>\n<p><code class=\"language-text\">FinalState</code> will contain no <code class=\"language-text\">Datum</code> and no <code class=\"language-text\">value</code> (coins and Native Tokens)</p>\n<div class=\"gatsby-highlight\" data-language=\"haskell\"><pre class=\"language-haskell\"><code class=\"language-haskell\"><span class=\"token keyword\">data</span> <span class=\"token constant\">GameDatum</span> <span class=\"token operator\">=</span>\n      <span class=\"token comment\">-- at first we only store the hash of the player1's choice</span>\n      <span class=\"token constant\">State0</span> <span class=\"token constant\">ByteString</span>\n      <span class=\"token comment\">-- then we store the hash of the player1's choice plus the player2's choice</span>\n    <span class=\"token operator\">|</span> <span class=\"token constant\">State1</span> <span class=\"token constant\">ByteString</span>            <span class=\"token constant\">GameChoice<span class=\"token punctuation\">.</span>GameChoice</span>\n      <span class=\"token comment\">-- when resolving draws we store both choices unhashed</span>\n    <span class=\"token operator\">|</span> <span class=\"token constant\">State2</span> <span class=\"token constant\">GameChoice<span class=\"token punctuation\">.</span>GameChoice</span> <span class=\"token constant\">GameChoice<span class=\"token punctuation\">.</span>GameChoice</span>\n      <span class=\"token comment\">-- the final state stores nothing</span>\n    <span class=\"token operator\">|</span> <span class=\"token constant\">StateFinal</span>\n    <span class=\"token keyword\">deriving</span> <span class=\"token constant\">Prelude<span class=\"token punctuation\">.</span>Show</span></code></pre></div>\n<p><a href=\"https://github.com/franleplant/plutus-pioneer-program-fork/blob/rock-paper-scissors/code/week07/src/RPS/GameDatum.hs\">GameDatum.hs</a></p>\n<h2 id=\"transaction-validator-input-code-classlanguage-textredeemercode\" style=\"position:relative;\">Transaction validator input: <code class=\"language-text\">Redeemer</code><a href=\"#transaction-validator-input-code-classlanguage-textredeemercode\" aria-label=\"transaction validator input code classlanguage textredeemercode permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"gatsby-highlight\" data-language=\"haskell\"><pre class=\"language-haskell\"><code class=\"language-haskell\"><span class=\"token keyword\">data</span> <span class=\"token constant\">GameRedeemer</span> <span class=\"token operator\">=</span>\n        <span class=\"token constant\">Player2Play</span>       <span class=\"token constant\">GameChoice<span class=\"token punctuation\">.</span>GameChoice</span>\n      <span class=\"token operator\">|</span> <span class=\"token constant\">Player2NoRevealClaim</span>\n      <span class=\"token operator\">|</span> <span class=\"token constant\">Player1RevealWin</span>  <span class=\"token constant\">ByteString</span> <span class=\"token constant\">GameChoice<span class=\"token punctuation\">.</span>GameChoice</span>\n      <span class=\"token operator\">|</span> <span class=\"token constant\">Player1RevealDraw</span> <span class=\"token constant\">ByteString</span> <span class=\"token constant\">GameChoice<span class=\"token punctuation\">.</span>GameChoice</span>\n      <span class=\"token operator\">|</span> <span class=\"token constant\">Player2ClaimDraw</span>\n      <span class=\"token operator\">|</span> <span class=\"token constant\">Player1NoPlayClaim</span>\n    <span class=\"token keyword\">deriving</span> <span class=\"token constant\">Prelude<span class=\"token punctuation\">.</span>Show</span></code></pre></div>\n<p>These are the actions players can take to move the game state around.</p>\n<p><a href=\"https://github.com/franleplant/plutus-pioneer-program-fork/blob/rock-paper-scissors/code/week07/src/RPS/GameRedeemer.hs\">GameRedeemer.hs</a></p>\n<h2 id=\"on-chain-validator-state-machine\" style=\"position:relative;\">On-chain validator: State Machine<a href=\"#on-chain-validator-state-machine\" aria-label=\"on chain validator state machine permalink\" class=\"header-anchor after\">#</a></h2>\n<p>This is the abstraction on top of a regular validator script that Plutus provides in order\nto model the common case of a State Machine.</p>\n<p>We are only going to show one of the main happy paths, player 1 plays,\nthen player 2 plays, finally player 1 reveals and win:</p>\n<div class=\"gatsby-highlight\" data-language=\"haskell\"><pre class=\"language-haskell\"><code class=\"language-haskell\"><span class=\"token comment\">-- this are arms of a haskell's case and we are doing pattern matching.</span>\n<span class=\"token comment\">-- (State0, Player2Play) -> State1</span>\n<span class=\"token comment\">-- this represents the valid transition from State0 where Player1</span>\n<span class=\"token comment\">-- played in secret to State1 where Player2 played (not secretly)</span>\n<span class=\"token punctuation\">(</span><span class=\"token constant\">State0</span> <span class=\"token hvariable\">player1ChoiceHash</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">GameRedeemer<span class=\"token punctuation\">.</span>Player2Play</span> <span class=\"token hvariable\">player2Choice</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">staked</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">-- each player needs to stake in order to play</span>\n  <span class=\"token comment\">-- this validates that State0 has 1xStake</span>\n  <span class=\"token operator\">|</span> <span class=\"token hvariable\">lovelaces</span> <span class=\"token hvariable\">staked</span> <span class=\"token operator\">==</span> <span class=\"token hvariable\">Game<span class=\"token punctuation\">.</span>stake</span> <span class=\"token hvariable\">game</span> <span class=\"token operator\">-></span>\n      <span class=\"token keyword\">let</span> <span class=\"token hvariable\">constraints</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">Constraints<span class=\"token punctuation\">.</span>mustBeSignedBy</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">Game<span class=\"token punctuation\">.</span>player2</span> <span class=\"token hvariable\">game</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;></span>\n                        <span class=\"token hvariable\">Constraints<span class=\"token punctuation\">.</span>mustValidateIn</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">to</span> <span class=\"token operator\">$</span> <span class=\"token hvariable\">Game<span class=\"token punctuation\">.</span>playDeadline</span> <span class=\"token hvariable\">game</span><span class=\"token punctuation\">)</span>\n          <span class=\"token hvariable\">datum</span>       <span class=\"token operator\">=</span> <span class=\"token constant\">State1</span> <span class=\"token hvariable\">player1ChoiceHash</span> <span class=\"token hvariable\">player2Choice</span>\n          <span class=\"token hvariable\">stake</span>       <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">lovelaceValueOf</span> <span class=\"token operator\">$</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token hvariable\">Game<span class=\"token punctuation\">.</span>stake</span> <span class=\"token hvariable\">game</span><span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">-- we return the next state: State1 (plus its payload)</span>\n      <span class=\"token keyword\">in</span> <span class=\"token constant\">Just</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">constraints</span> <span class=\"token punctuation\">,</span> <span class=\"token constant\">State</span> <span class=\"token hvariable\">datum</span> <span class=\"token hvariable\">stake</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\">-- (State1, Player1RevealWin) -> StateFinal</span>\n<span class=\"token punctuation\">(</span><span class=\"token constant\">State1</span> <span class=\"token hvariable\">_</span> <span class=\"token hvariable\">_</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">GameRedeemer<span class=\"token punctuation\">.</span>Player1RevealWin</span> <span class=\"token hvariable\">_</span> <span class=\"token hvariable\">_</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">staked</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">-- since both player played at this stage, the amount</span>\n  <span class=\"token comment\">-- of coins staked should be 2x stake</span>\n  <span class=\"token operator\">|</span> <span class=\"token hvariable\">lovelaces</span> <span class=\"token hvariable\">staked</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token hvariable\">Game<span class=\"token punctuation\">.</span>stake</span> <span class=\"token hvariable\">game</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span>\n      <span class=\"token keyword\">let</span> <span class=\"token hvariable\">constraints</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">Constraints<span class=\"token punctuation\">.</span>mustBeSignedBy</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">Game<span class=\"token punctuation\">.</span>player1</span> <span class=\"token hvariable\">game</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;></span>\n                        <span class=\"token hvariable\">Constraints<span class=\"token punctuation\">.</span>mustValidateIn</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">to</span> <span class=\"token operator\">$</span> <span class=\"token hvariable\">Game<span class=\"token punctuation\">.</span>revealDeadline</span> <span class=\"token hvariable\">game</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;></span>\n                        <span class=\"token hvariable\">Constraints<span class=\"token punctuation\">.</span>mustPayToPubKey</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">Game<span class=\"token punctuation\">.</span>player1</span> <span class=\"token hvariable\">game</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">lovelaceValueOf</span> <span class=\"token operator\">$</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token hvariable\">Game<span class=\"token punctuation\">.</span>stake</span> <span class=\"token hvariable\">game</span><span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">-- we return the next state: StateFinal</span>\n      <span class=\"token keyword\">in</span> <span class=\"token constant\">Just</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">constraints</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">State</span> <span class=\"token constant\">StateFinal</span> <span class=\"token hvariable\">mempty</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a href=\"https://github.com/franleplant/plutus-pioneer-program-fork/blob/rock-paper-scissors/code/week07/src/RPS/Validator.hs\">Validator.hs</a></p>\n<p><code class=\"language-text\">constraints</code> are a Plutus primitive that lets you express checks for the incoming transaction,\nhave in mind that this validator runs whenever some trivial address is trying to consume one of its\nUTxOs, so in order to spend a UTxO the validator needs to agree with said action.</p>\n<p>In this case we are only allowing this particular state change to happen if the transaction\ntrying to be applied is signed by Player2 and it is done before the <code class=\"language-text\">playDeadline</code>.</p>\n<p>We return the next State defined in <code class=\"language-text\">datum</code> and we duplicate the <code class=\"language-text\">stake</code> amount of Ada\nbecause Player2 needs to <code class=\"language-text\">stake</code> or <code class=\"language-text\">bet</code> in order to participate.</p>\n<p>Additional checks can be done by implementing a <code class=\"language-text\">check</code> function, here is an\nexample of how we use it to add an extra check to the <code class=\"language-text\">Player1RevealWin</code> transition.\nWe simply check that the revealed choice that Player1 made actually wins Player2’s:</p>\n<div class=\"gatsby-highlight\" data-language=\"haskell\"><pre class=\"language-haskell\"><code class=\"language-haskell\"><span class=\"token hvariable\">check</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">State1</span> <span class=\"token hvariable\">player1ChoiceHash</span> <span class=\"token hvariable\">player2Choice</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Player1RevealWin</span> <span class=\"token hvariable\">nonce</span> <span class=\"token hvariable\">player1Choice</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">_</span> <span class=\"token operator\">=</span>\n    <span class=\"token hvariable\">traceIfFalse</span> <span class=\"token string\">\"player1 should reveal the original choice\"</span>\n      <span class=\"token punctuation\">(</span><span class=\"token hvariable\">player1ChoiceHash</span> <span class=\"token operator\">==</span> <span class=\"token hvariable\">presentedPlayer1ChoiceHash</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n    <span class=\"token hvariable\">traceIfFalse</span> <span class=\"token string\">\"player1 beats player2\"</span>\n      <span class=\"token punctuation\">(</span><span class=\"token hvariable\">GameChoice<span class=\"token punctuation\">.</span>beats</span> <span class=\"token hvariable\">player1Choice</span> <span class=\"token hvariable\">player2Choice</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">where</span>\n            <span class=\"token hvariable\">player1ChoiceString</span> <span class=\"token operator\">::</span> <span class=\"token constant\">ByteString</span>\n            <span class=\"token hvariable\">player1ChoiceString</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">case</span> <span class=\"token hvariable\">player1Choice</span> <span class=\"token keyword\">of</span>\n                <span class=\"token constant\">GameChoice<span class=\"token punctuation\">.</span>Rock</span>     <span class=\"token operator\">-></span> <span class=\"token hvariable\">rock</span>\n                <span class=\"token constant\">GameChoice<span class=\"token punctuation\">.</span>Paper</span>    <span class=\"token operator\">-></span> <span class=\"token hvariable\">paper</span>\n                <span class=\"token constant\">GameChoice<span class=\"token punctuation\">.</span>Scissors</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">scissors</span>\n\n            <span class=\"token hvariable\">presentedPlayer1ChoiceHash</span> <span class=\"token operator\">::</span> <span class=\"token constant\">ByteString</span>\n            <span class=\"token hvariable\">presentedPlayer1ChoiceHash</span> <span class=\"token operator\">=</span>  <span class=\"token hvariable\">choiceHash</span>\n                <span class=\"token keyword\">where</span>\n                    <span class=\"token hvariable\">choiceHash</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">sha2_256</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">nonce</span> <span class=\"token operator\">`concatenate`</span> <span class=\"token hvariable\">player1ChoiceString</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Note: I’ve omitted some details for clarity, check the <a href=\"https://github.com/franleplant/plutus-pioneer-program-fork/blob/rock-paper-scissors/code/week07/src/RPS/Validator.hs\">full code</a></p>\n<h2 id=\"off-chain-code\" style=\"position:relative;\">Off-chain code<a href=\"#off-chain-code\" aria-label=\"off chain code permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Plutus is heavy on the Off-chain code, but it is safe to do so because the important constraints should\nalways be implemented on the <code class=\"language-text\">validators</code>.</p>\n<p>The off-chain code, also written in Haskell and that will be later allowed to be run in the browser simply\nallows two users to play this game. The first player <em>instantiates</em> the contract by playing secretly and\nadding a stake.</p>\n<p>Player2 plays by finding an open game and playing and staking.</p>\n<p>When the deadlines are passed a winner is decided and the reward (staked) is claimed.</p>\n<p>Nothing illegal should be allowed to happen because our on-chain code (validator) should only allow\ncertain valid transactions to happen and nothing else.</p>\n<p><a href=\"https://github.com/franleplant/plutus-pioneer-program-fork/blob/rock-paper-scissors/code/week07/src/RPS.hs\">off chain code</a></p>\n<h2 id=\"outro\" style=\"position:relative;\">Outro<a href=\"#outro\" aria-label=\"outro permalink\" class=\"header-anchor after\">#</a></h2>\n<p><a href=\"https://github.com/franleplant/plutus-pioneer-program-fork/tree/rock-paper-scissors/code/week07/src\">Check the full code here</a></p>\n<p>Cardano and Plutus are really fun and interesting and there is a lot of things coming their way\nthat make me super excited about.</p>\n<p>I’m anxious about actually deploying this dummy game to the main net and add a nice UI on top of it.</p>","excerpt":"I’ve taken part of the second cohort of the Plutus Pioneer Program where one can\nlearn how to write Smart Contracts in Cardano by using…","fields":{"slug":"/cardano-smart-contract-game/","readingTime":{"text":"8 min read"}},"frontmatter":{"title":"Rock-paper-scissors game built in Cardano smart contracts","date":"August 10, 2021","description":" A quick high level overview of how you can write a state machine based smart contract in the upcoming Cardano's Plutus platform for Smart Contracts or Smart Transactions. ","tags":["haskell","cardano","plutus","blockchain","smart contracts","smart transactions","game","state machines","plutus pioneer program"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>I recently have been writing a decent amount of CSS and\none of the things I have really enjoyed is the new\n<a href=\"https://css-tricks.com/snippets/css/complete-guide-grid/\">grid layout</a>\nand specially the <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/gap\">grid gap</a>\nproperty that let’s you set the distance, sometimes\ncalled <code class=\"language-text\">gutter</code>,\nbetween the grid cells which is actually a supper common thing to do.</p>\n<blockquote>\n<p><strong>IMPORTANT</strong> the <code class=\"language-text\">gap</code> property only modifies the <strong>distance between cell items</strong>,\nand it does not affect the distance of those cell items to the edges of the grid container.</p>\n</blockquote>\n<p>It turns out that the <code class=\"language-text\">gap</code> property can also be used with\n<a href=\"https://css-tricks.com/snippets/css/a-guide-to-flexbox/\">flex layout</a>\nand it solves so many problems!</p>\n<p>But there are still some browsers that don’t support the <code class=\"language-text\">gap</code> property while\nusing the <code class=\"language-text\">flex layout</code> among which you can find <code class=\"language-text\">safari</code>,\nsee <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/gap#browser_compatibility\">compatibility table</a>,\nso below there is a really easy method to simulate the gap between flex box items.</p>\n<h2 id=\"with-flex-gap\" style=\"position:relative;\">With flex gap<a href=\"#with-flex-gap\" aria-label=\"with flex gap permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.container</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">flex-direction</span><span class=\"token punctuation\">:</span> row<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">flex-wrap</span><span class=\"token punctuation\">:</span> wrap<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/* the magic property */</span>\n  <span class=\"token property\">gap</span><span class=\"token punctuation\">:</span> 10px<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* demo only properties omitted */</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.item-a</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">flex</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* demo only properties omitted */</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You get something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/af1c6c8f4b8fb254c590438cce983f15/38116/gap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABn0lEQVQoz7WRTS8DYRSFx6pR7bSNtmM6M22Nouo7QVIJre+ipV0gsbCi8S2IBRZai1a02lhU9AeQ2LAn7PlTx71v/AWLk5w8c87Ne+dKX2+H2NmI4nR7EsfZOE6yE9jPxnC/mcTl1jSO/hiLPbPq5iIOKMOMO9zd2RjF5+supIebZVgamqG4/HDLGryyjia5BUlrPzpsJhyyj7gu5CTfbjcxb+2DTVZFljuKyxAzaoUFSPXKCmxOFXqgDarRCk034TL8SKvD6NbC8BhB+IjzN/YRrRMpdUhkOMucuzaXise7NKSX8jqi1jBmfYOYUgYwQxpTenHgjiHjHUJc6cM0MRb7NLE997jIcJY73I1au/BSWvmHgfXqqniuHgzR801oRhutE6CVR/5WbqWVTSH2ET1MKw+LDGe5owdCNMNHK2foKMUkLJIDipN+vr0FXlKT7MFiYw8dxQ+H3Ss4i307sURjhI7iEVnm3OUZtcIcpJ+PcxQv5lC9TqOSX0Ilt4TbfArPV2uo5TIokWfGKpNn9nS1KjKCU4e7xYsEvt/P8AugKA92B9dmrwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flexbox gap\"\n        title=\"flexbox gap\"\n        src=\"/static/af1c6c8f4b8fb254c590438cce983f15/fcda8/gap.png\"\n        srcset=\"/static/af1c6c8f4b8fb254c590438cce983f15/12f09/gap.png 148w,\n/static/af1c6c8f4b8fb254c590438cce983f15/e4a3f/gap.png 295w,\n/static/af1c6c8f4b8fb254c590438cce983f15/fcda8/gap.png 590w,\n/static/af1c6c8f4b8fb254c590438cce983f15/efc66/gap.png 885w,\n/static/af1c6c8f4b8fb254c590438cce983f15/c83ae/gap.png 1180w,\n/static/af1c6c8f4b8fb254c590438cce983f15/38116/gap.png 2086w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>yellow: a trivial wrapper, not involved in the actual layout.</li>\n<li>pink: the flex container, it only shows through the <code class=\"language-text\">gaps</code>.</li>\n<li>black: the flex items.</li>\n</ul>\n<h2 id=\"without-flex-gap\" style=\"position:relative;\">Without flex gap<a href=\"#without-flex-gap\" aria-label=\"without flex gap permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We can easily simulate the gap property with a slightly\nmore complicated method of giving each item half of the\nsize of gap via <code class=\"language-text\">margin</code> and offsetting the container by\ngiving it a negative margin of that same amount.\nThis is because the <code class=\"language-text\">gap</code> property only affects the distance\nbetween items and it does not affect the distance between items and\nthe edges of the flex container.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.container</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">flex-direction</span><span class=\"token punctuation\">:</span> row<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">flex-wrap</span><span class=\"token punctuation\">:</span> wrap<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/* gap replacement, part 1 */</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> -5px<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* demo only properties omitted */</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.item-b</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">flex</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/* gap replacement, part 2 */</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 5px<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* demo only properties omitted */</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2e4c2216188890abe2398db157caf33/57f7d/patch.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21621621621622%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABy0lEQVQozy2RS08aYRiFpxutgekgGeaTuQAOXhDiXWzSRo1VZARv7aIm1kRUiAVGSJtuunDdNNJoiqlxq0nRf6B/wT91fN9PFyc5eTjnHc6M8vDnBAdzOfiFddS8IuqkireK09w2fuQ3ceQVJGexZ/Z75bPM1F+4X1iTN+5bP6Fc1ErofqVDhGPQNRsGKRiKohiYwNAbF5pmIkKMFSI/SMwLjMkMZ7kjwo68cVHdgXL5vYygFoWdSMK0+2HZLnqdGLb6sshYKUScBHFXin3aGsZ6dIYycZnljh1PQqWH/fu2B+W2WcO7nhHkzSnkxARWxCTmxRga+gI+GVksinHJWew/EvP1eSxQhrPM8+Yk3Uij06hA6TSreNuTwrL5XFgivRejqFNp05iRxz8QY7HfMKZR1edkhrPc4S7f+N8o8+SK/Lt2YgCm48JykuiNxbEVnUXGHqGZ/cSTUuzTdoomZxGm+ZbkruyqIYsml+ijVHfRpWgQ9JJ1VcAI9iGg6ii+zmAw4EBTI5Kz2A8Q82hekDIRyjLnLt9oH21Debw5Rau8g3ZzH3+PS2iTzo73cFf/iiv/EOfkmbPYX/kH6NBvnGm/cO62yl/weP0LT+5ZDL19I9neAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flexbox gap without using the gap property\"\n        title=\"flexbox gap without using the gap property\"\n        src=\"/static/e2e4c2216188890abe2398db157caf33/fcda8/patch.png\"\n        srcset=\"/static/e2e4c2216188890abe2398db157caf33/12f09/patch.png 148w,\n/static/e2e4c2216188890abe2398db157caf33/e4a3f/patch.png 295w,\n/static/e2e4c2216188890abe2398db157caf33/fcda8/patch.png 590w,\n/static/e2e4c2216188890abe2398db157caf33/efc66/patch.png 885w,\n/static/e2e4c2216188890abe2398db157caf33/c83ae/patch.png 1180w,\n/static/e2e4c2216188890abe2398db157caf33/57f7d/patch.png 2088w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As you can see, the flex container will eat up some space of its\nparent, the <code class=\"language-text\">wrapper</code>, which is going to be most of the time necessary\nto render things as you would expect with <code class=\"language-text\">gap</code>.</p>\n<h2 id=\"comparing\" style=\"position:relative;\">Comparing<a href=\"#comparing\" aria-label=\"comparing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>The end result is about the same, but you might need to\nwrap it up in another container for more flexible composition.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cf490e14056360172466af8d5c275c34/8c48a/comp.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.75675675675677%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAADG0lEQVQ4y52U7U9bZRjGz1y20fa0tS+n5ZxDy0tHdJRuDNAtTtgko7QDicgChW1uGezFmCUzAupImRSiFlc2TCSYJc5sUxMSp9+MbzExZh/8YGJM/Hd+3veBGRO/8eFK7vzu6zznXM/9PMf487cq5esnqMwNsTh7ioqoPFvk07dGqc0MsyC1cpXWKzMvc1d65dmC51W+9PYg71zL88s3lzAefX6F4J4gVjhFPGRjBR3MUJKT/iy5QAuhUD1xYaqw1K1mEwO+ds9jedymPuLwlGGxWj6C8e2X14hZCdx0K06qBVcUTTVStLvodLPEU00eV1lSZ91nGbK7iYhHvbYo1ZShLpRmbfkExk8Pr3MsnKHP7uSl5CH6RMeSOS7HX+R04nl6pFau6kkeZDjRzdV4j3jaPa/yk84huurauV/px/j54ZscD+8nX99Ff7KDfPIwx+XB1+WhknXEeyAvXHu6wKuJ53gj3ut51Ku84Bzm6L4cD3RBjRy1LJz0fvn8Zi+axinIF3e6bRK50WPa0/htXuQu8aS3IzdL5BaJnNqK/PW9y/h3m8SCDURNm1jAwW8m6KvLkvW1YJpJosKiAZugWU/G30R+Xzs+8ag3IjwRdjBkKLV5Gcrfv39IbaGXtaVB1ioFUZFaZYAvFl/h7uIQq9tMdVvqjcogX0lPPVu8wMfLRarz/Tz+bgrjr0frVEsjrF6ZoDY9zup0iZXpMe5fPM/G1Bk+ElbbltafTE3yQHrqUa/y25dKvP/aKL/emcPYXJrBZ0SIhV0v1k4iWyGXXbtiVMeLsoe3bhCRvXOaMzsfSqOcw5hL7eIIxg/VBXr3HmDA7dz5sZGXHzWz3Ds/hvF9tcwLe5+hz+3Y+cG2O+gOHuAzXVAjR00HVyL/e/XST65e2/+vXsP21Uv/5+pJZN+TyJvLMwSMKNbTDcRlYct0MYPyc5Ch5PwZQjII5aqw7HVrQH4OdTkC4lGv8mS4gd3eUE5h/LG5zrvDI9w8N8HC5LioxI3JMdZLF1iZOMu81Ft83Ks/mJhkQ3rquSle5e+dLTE7OsqPt+b4B43ZIgdSzHt2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"both solutions compared\"\n        title=\"both solutions compared\"\n        src=\"/static/cf490e14056360172466af8d5c275c34/fcda8/comp.png\"\n        srcset=\"/static/cf490e14056360172466af8d5c275c34/12f09/comp.png 148w,\n/static/cf490e14056360172466af8d5c275c34/e4a3f/comp.png 295w,\n/static/cf490e14056360172466af8d5c275c34/fcda8/comp.png 590w,\n/static/cf490e14056360172466af8d5c275c34/efc66/comp.png 885w,\n/static/cf490e14056360172466af8d5c275c34/c83ae/comp.png 1180w,\n/static/cf490e14056360172466af8d5c275c34/8c48a/comp.png 2096w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Check the <a href=\"https://github.com/franleplant/css-flex-gap-patch\">example code</a>,\nlet me know if you have any questions.</p>\n<br/>","excerpt":"I recently have been writing a decent amount of CSS and\none of the things I have really enjoyed is the new\ngrid layout\nand specially the…","fields":{"slug":"/flex-gap-in-unsupported-browsers/","readingTime":{"text":"3 min read"}},"frontmatter":{"title":"How to use CSS flex gap in unsupported browsers","date":"April 23, 2021","description":"Quick post about how to use the CSS gap property with flex layout mode in browsers that still don't support it, like Safari","tags":["css","flex","gap","layout","safari"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>Stress, anxiety, panic attacks, impostor syndrome,\nobsession, sleeplessness, dreaming about code, are among\nthe mental conditions we, developers, are exposed to because,\nto put it simply, we <strong>developers are professional thinkers</strong>,\nwe are weight lifters of the mind,\nbut when you push your symbolic mind hard enough it can come\nback to you in overdrive mode and attack you like a\nhammer hitting your hand instead of the nail, or even\nlike a chainsaw chopping a finger instead of a branch.</p>\n<p>Coping with these mental issues is hard but important to have\na healthy mind, life and to be an effective, efficient and holistic developer\nand I believe that the Stoic teachings are valuable tools to manage\nour emotions and behaviours and they provide a useful framework\nto tackle any situation in our life.</p>\n<p>Let this serve as a high-level introduction to Stoicism\nand a good start towards a better life.</p>\n<blockquote>\n<p>Developers are <strong>professional thinkers</strong>,\n<strong>weight lifters of the mind</strong>.</p>\n</blockquote>\n<h2 id=\"what-is-stoicism\" style=\"position:relative;\">What is Stoicism?<a href=\"#what-is-stoicism\" aria-label=\"what is stoicism permalink\" class=\"header-anchor after\">#</a></h2>\n<p><a href=\"https://en.wikipedia.org/wiki/Stoicism\">Stoicism</a>\nis a philosophical movement that aims to help people manage and\neven reduce pain in their life by recognising, at a high level, that\nlife is just a series of events and that we are the one that\nclassify them as <strong>good</strong> or <strong>bad</strong> and that the only real control we have is in\nhow we classify or interpret those events, and how willing we are\nto accept the outcomes.</p>\n<p>Stoicism trains the mind to be more resilient to pain by understanding\nthat it is unreasonable to get sad or anxious because of things\nwe don’t have control over,\nwe can only do our best, hope for the best and react as best as we can\nto whatever outcome life has in place.</p>\n<p>As you can see these are powerful teachings and have I found them very useful\nin my life, even when things turn dark.</p>\n<p>Stoicism aims to achieve <strong>strength of character</strong>, endurance and resiliency\nin the face of hardship by separating what is in our control from\nwhat’s not.</p>\n<p>Of course Stoicism doesn’t negate free will nor the things\nwe humans can achieve by affecting life around us, but instead,\nit talks about reducing suffering in the outcomes by accepting that,\nalthough we do have control over small aspects of life, we are largely\nsubject to the randomness of the universe but that we do have a strong\ncontrol over how our hearts and minds react to the outcomes.</p>\n<p>Stoicism doesn’t also go against pursue of success or riches, it just\nstates that we shouldn’t feel attached to them so that we don’t become\nprisoners of the outcomes of those pursues, because if you are successful\nand you feel attached to your success then you become a prisoner of your success\nand you will live in fear of loosing it, same goes for money, recognition or whatever.\nAnd if you couldn’t get it in the first place you will also feel bad.\nWith this, rather common, mindset, we become prisoners of randomness.\nStoicism seeks to take control, become free, and ultimately live\na more peaceful life without so much suffering.</p>\n<blockquote>\n<p>Stoicism seeks to take control, become free, and ultimately live\na more peaceful life without so much suffering.</p>\n</blockquote>\n<p>These teachings become even more important in the 21st century, where\nwe are in constant stress, anxiety and fear even for the smallest\nthings, like not getting the new phone, not getting enough likes,\nnot having the latest clothes,\nor of not being able to go the pub on weekends.</p>\n<p>Stoicism at last seeks deep thought about the nature of reality\nand how can we interact with it in a peaceful and relaxed way,\nby doing what we can and accepting the outcomes unconditionally.</p>\n<p>The core message of Stoicism has been incorporated in many\nmodern new age “self help” books and material like the famous\nand strongly recommended <a href=\"https://amzn.to/3eftYfD\">The Power of Now by Eckhart Tolle</a>,\nand it shares some values with Buddhism and other older philosophies.</p>\n<p>By the way, many people have a strong sense that “self help” books\nand materials are <em>hippie nonsense</em> when in reality there are a lot\nof valuable takes on how to improve oneself and deal with the hard stuff\nin life, and a lot of them are modern takes of old teachings like\n<a href=\"https://amzn.to/3tCruyf\">The Bible</a>, Buddhism, et al, and that many different takes have\ngreater probability of coming through the many different personalities\nand stages in life that humans have. And of course there will be always\nnonsense out there if you really look for it.</p>\n<p>I strongly recommend <a href=\"https://amzn.to/3dyCkzO\">The Practicing Stoic by Farnsworth</a> if you\nwant a no nonsense practical introduction to Stoicism ready to be\napplied to your day to day life. The audio book is specially good.</p>\n<blockquote>\n<p><strong>Disclaimer:</strong> strictly speaking this is <strong>my</strong> interpretation of Stoicism.\nHollywood has a somewhat shallow version of a stoic person, typically in the\nform of an action blockbuster hero that doesn’t show emotion, there is so much more.</p>\n<p>Also, do not confuse Stoicism with emotional repression, Stoicism is about\nemotional management or emotional intelligence but never about repression, in fact,\nemotional repression goes against the Stoic teachings.</p>\n</blockquote>\n<h2 id=\"quotes\" style=\"position:relative;\">Quotes<a href=\"#quotes\" aria-label=\"quotes permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Let’s go over 3 quotes from each of the most important figures of Stoicism:\nSeneca, Epictetus and Marcus Aurelius.</p>\n<p>I encourage you to come back often to them and reflect on them,\nthey are mystical synthesis of knowledge that the Stoic consider\nvaluable and I entirely agree.</p>\n<h3 id=\"marcus-aurelius\" style=\"position:relative;\">Marcus Aurelius<a href=\"#marcus-aurelius\" aria-label=\"marcus aurelius permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Marcus Aurelius Antoninus 26 April 121 – 17 March 180)\nwas Roman emperor from 161 to 180 and a Stoic philosopher.\nThe name might ring a bell since it appeared in the movie “Gladiator”.\nHis thoughts were solidified in books among which the famous <a href=\"https://amzn.to/3sy2G9m\">Meditations</a>,\nis encountered.</p>\n<blockquote>\n<p>If thou art pained by any external thing, it is not this that disturbs thee,\nbut thy own judgment about it. And it is in thy power to wipe out this judgment now.</p>\n<p> </p>\n<p>Marcus Aurelius</p>\n</blockquote>\n<blockquote>\n<p>Take away your opinion, and there is taken away the complaint,\n[…] Take away the complaint, […] and the hurt is gone</p>\n<p> </p>\n<p>Marcus Aurelius</p>\n</blockquote>\n<blockquote>\n<p>What if someone despises me? Let me see to it.\nBut I will see to it that I won’t be found doing or saying anything contemptible.\nWhat if someone hates me? Let me see to that. But I will see to it that I’m kind\nand good-natured to all, and prepared to show even the hater where they went wrong.\nNot in a critical way, or to show off my patience, but genuinely and usefully.</p>\n<p> </p>\n<p>Marcus Aurelius</p>\n</blockquote>\n<h3 id=\"epictetus\" style=\"position:relative;\">Epictetus<a href=\"#epictetus\" aria-label=\"epictetus permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Epictetus (c. 55 – c. 135 AD), born a slave, was a Greek Stoic philosopher.\nThe name given by his parents, if one was given, is not known.\nThe word epiktetos in Greek simply means “acquired”.\nYou can read more about his teachings in <a href=\"https://amzn.to/3xbWPKv\">Discourses and Selected Writings</a>.</p>\n<blockquote>\n<p>In a word, neither death, nor exile, nor pain,\nnor anything of this kind is the real cause of our doing\nor not doing any action, but our inward opinions and principles.</p>\n<p> </p>\n<p>Epictetus</p>\n</blockquote>\n<blockquote>\n<p>It is difficulties that show what men are.</p>\n<p> </p>\n<p>Epictetus</p>\n</blockquote>\n<blockquote>\n<p>For it is not death or pain that is to be feared, but the fear of pain or death.</p>\n<p> </p>\n<p>Epictetus</p>\n</blockquote>\n<h3 id=\"seneca\" style=\"position:relative;\">Seneca<a href=\"#seneca\" aria-label=\"seneca permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Lucius Annaeus Seneca the Younger, 4 BC – AD 65, usually known as Seneca,\nwas a Roman Stoic philosopher, statesman, dramatist, and in one work, satirist\nfrom the Silver Age of Latin literature.\nI highly recommend <a href=\"https://amzn.to/3enJvd9\">Letters from a Stoic</a>.</p>\n<blockquote>\n<p>True happiness is to enjoy the present, without anxious dependence upon\nthe future, not to amuse ourselves with either hopes or fears but to rest satisfied\nwith what we have, which is sufficient, for he that is so, wants nothing.</p>\n<p> </p>\n<p>Seneca</p>\n</blockquote>\n<blockquote>\n<p>Throw me to the wolves and I will return leading the pack.</p>\n<p> </p>\n<p>Seneca</p>\n</blockquote>\n<blockquote>\n<p>We suffer more often in imagination than in reality.</p>\n<p> </p>\n<p>Seneca</p>\n</blockquote>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I have tried many different things to improve my self\nand be more resilient and resistant to whatever life throws at me.\nStoicism, meditations and physical exercise are the best tools\nI currently have available, I hope this little post serves as a\nreference point to developers and people going through these same problems in life.</p>\n<br/>","excerpt":"Stress, anxiety, panic attacks, impostor syndrome,\nobsession, sleeplessness, dreaming about code, are among\nthe mental conditions we…","fields":{"slug":"/stoic-developer/","readingTime":{"text":"8 min read"}},"frontmatter":{"title":"The Stoic Developer","date":"April 22, 2021","description":"Developers are high performance professional thinkers and thus we are particularly susceptible to problems of the mind. Stoicism has helped me greatly to tackle these problems and this is an attempt to help others in the same way.","tags":["stoicisim","mental health","anxiety","panic attacks","stress","neurosis"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>My blog has been long overdue for some aesthetic love.\nI went with <a href=\"https://tailwindcss.com/\">Tailwind Css</a>\nbecause I have been hearing really good things about it. This is my experience.</p>\n<p>I had a lot of fun with Tailwind, it’s refreshing not to write css\nand only care about classes, the utility approach sounds weird at first\nbut in practice works pretty good. It is also interesting to grab pre-made\nstyle primitives (that you can tweak) from a limited pool to materialise\nyour visual language and you have to\ngo out of your way in order to break it.</p>\n<p>Tailwind has awesome IDE support,\ngood tooling and composition mechanics and together with a framework like React\nyou can create awesome reusable full fledged components for your websites or web apps.</p>\n<p>Here’s a break down of the things I liked and the things I didn’t.</p>\n<h2 id=\"tailwind-pros\" style=\"position:relative;\">Tailwind Pros<a href=\"#tailwind-pros\" aria-label=\"tailwind pros permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li><strong>composition</strong> is nice and powerful, and with a decent UI lib, such as React, you can create powerful high level flexible abstractions easily, like a <code class=\"language-text\">Button</code> or an <code class=\"language-text\">Input</code>.</li>\n<li><strong>use anywhere</strong>: you can use the classes inside your markdown, in your raw html, etc; this in practice makes it really easy to share your visual language.</li>\n<li><strong>intellisense</strong> IDE intellisense support is top notch, I’ve used one of the VIM plugins out there with great success and I’ve seen that <a href=\"https://code.visualstudio.com/\">VS Code</a> support is even better.</li>\n<li><strong>js framework agnostic</strong>: in certain environments it is desired to be able to share styles across JS frameworks and technologies, imagine a big company with independent teams that don’t want to all use the same JS framework to develop their apps but do want to share the same visual language. If you use a React UI library like <a href=\"https://ant.design/\">Ant design</a> you are basically locked in with React, and it is an uphill battle to try to share only the css parts of Antd into other JS frameworks like <a href=\"https://angular.io/\">angular</a>.</li>\n<li><strong>visual language</strong>: easy to create a consistent visual language by using customizable primitives.</li>\n<li><strong>theming</strong>: built time theming is a first class citizen (run time theming is not, although it is not entirely impossible to do).</li>\n<li><strong>suitable for component libraries</strong>: assuming your reusable components (i.e. React) library only uses Tailwind classes and not custom css you can use all of the benefits of a js only, inline-all distribution strategy as the one covered in my <a href=\"https://nosleepjavascript.com/package-react-components/#tldr-how-to-package-and-publish-front-end-libraries-in-2020\">previous post</a> with all the benefits of built time theming we just covered.</li>\n<li><strong>css only</strong> framework: css has become pretty powerful with flex and grid layouts and css variables, being a css only framework makes it easy to integrate anywhere, you could even grab the generated stylesheet and drop it in a manually generated html and it would work.</li>\n</ul>\n<h2 id=\"tailwind-cons\" style=\"position:relative;\">Tailwind Cons<a href=\"#tailwind-cons\" aria-label=\"tailwind cons permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li><strong>no high level primitives</strong>: you do need to build higher level stuff from scratch like inputs, buttons, modals, etc, and certain UI components are surprisingly complex with variants, different flags for different states, etc.</li>\n<li><strong>css only</strong>: certain common things are going to require manual implementations (think anything that requires js): form input validation states, modals, etc.</li>\n<li><strong>missing variants</strong>: it is awkward to find out which variants (i.e. <code class=\"language-text\">lg:dark:hover:shadow</code>) are not already generated, you basically need to wait for compilation and see if that class has any styles attached to it. <strong>Important</strong> this has been recently solved with the <code class=\"language-text\">JIT</code> patch which is still marked as experimental as we speak, but <code class=\"language-text\">JIT</code> also removes the possibility of live editing your html to add Tailwind Css classes for a quick feedback loop (because that particular class might not have been generated and injected on the compilation process).</li>\n<li><strong>requires compilation</strong>: it uses <a href=\"https://postcss.org/\">postcss</a> to compile your css plus it inspects all your source files to only emit the css classes that your site is actually using, this means that you are going to need <code class=\"language-text\">Node.js</code> available which means that if you are using other technologies this might mean extra complexity for your apps, but it is a pretty common practice to have compilation pipelines for Front End applications so it shouldn’t be that bad.</li>\n</ul>\n<p><strong>Bonus Con</strong>: Gatsby has become super slow, it is not directly related to Tailwind but it looks like it adds to the slowness, if you have any clues how to improve on this let me know.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\">Conclusion<a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Tailwind Css is a solid solution for styling web applications at scale, it is flexible\nand powerful, has decent tooling, little surprises and it is production ready,\nI encourage you to give it a try.</p>\n<p>Now let’s go with a bonus just for you:</p>\n<h2 id=\"bonus-handling-class-names\" style=\"position:relative;\">Bonus: handling class names<a href=\"#bonus-handling-class-names\" aria-label=\"bonus handling class names permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>This is focused on React but the techniques can be applied to other UI frameworks.</p>\n</blockquote>\n<p>It is not uncommon to have a bunch of classes applied to a single element, if coupled with a framework\nsuch as React it is a good idea to abstract those elements into components but how do you handle\nthose long lists of space separated strings in a scalable way?</p>\n<p>Let’s say we have a <code class=\"language-text\">Card</code> component:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Card</span><span class=\"token punctuation\">(</span>props<span class=\"token operator\">:</span> IProps<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSX</span><span class=\"token punctuation\">.</span>Element <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span>“rounded<span class=\"token operator\">-</span>md border<span class=\"token operator\">-</span><span class=\"token number\">1</span> border<span class=\"token operator\">-</span>black dark<span class=\"token operator\">:</span>border<span class=\"token operator\">-</span>white p<span class=\"token operator\">-</span><span class=\"token number\">3</span> flex flex<span class=\"token operator\">-</span>col gap<span class=\"token operator\">-</span><span class=\"token number\">3</span> bg<span class=\"token operator\">-</span>white dark<span class=\"token operator\">:</span>bg<span class=\"token operator\">-</span>black”<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This works well because you are using the React composition model that we know and love to abstract styling, but\nthat list is still too long, and can become longer and what about if we have conditional styling?</p>\n<h3 id=\"template-strings\" style=\"position:relative;\">Template strings<a href=\"#template-strings\" aria-label=\"template strings permalink\" class=\"header-anchor after\">#</a></h3>\n<p>You can use template strings:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  class1\n  class2\n  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>props<span class=\"token punctuation\">.</span>className<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>props<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">?</span> “opacity<span class=\"token operator\">-</span><span class=\"token number\">50</span>” <span class=\"token operator\">:</span> “”<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can also use a tag function to remove unnecessary newlines and undefined:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>oneline<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  class1\n  class2\n  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>props<span class=\"token punctuation\">.</span>className<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>props<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">?</span> “opacity<span class=\"token operator\">-</span><span class=\"token number\">50</span>” <span class=\"token operator\">:</span> “”<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Check my implementation of <a href=\"https://github.com/franleplant/nosleepjavascript-blog/blob/develop/src/utils/strTag.ts\">oneline</a></p>\n<p>This strategy works well and doesn’t break IDE intellisense.</p>\n<h3 id=\"with-code-classlanguage-textclassnamescode-lib\" style=\"position:relative;\">With <code class=\"language-text\">classNames</code> lib<a href=\"#with-code-classlanguage-textclassnamescode-lib\" aria-label=\"with code classlanguage textclassnamescode lib permalink\" class=\"header-anchor after\">#</a></h3>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">classNames</span><span class=\"token punctuation\">(</span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">class1 class2</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  props<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    “opacity<span class=\"token operator\">-</span><span class=\"token number\">50</span>”<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>disabled\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>This lib is awesome but the object notation breaks IDE intellisense.</p>\n<p>There is a specialized variant of this lib called <a href=\"https://www.npmjs.com/package/tailwindcss-classnames\">tailwindcss-classnames</a>, but I don’t love the interface.</p>\n<h3 id=\"with-code-classlanguage-texttwinmacrocode-lib\" style=\"position:relative;\">With <code class=\"language-text\">twin.macro</code> lib<a href=\"#with-code-classlanguage-texttwinmacrocode-lib\" aria-label=\"with code classlanguage texttwinmacrocode lib permalink\" class=\"header-anchor after\">#</a></h3>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> Input <span class=\"token operator\">=</span> tw<span class=\"token punctuation\">.</span>input<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>tw<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">class1 class2</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> props<span class=\"token punctuation\">.</span>hasBorder <span class=\"token operator\">&amp;&amp;</span> tw<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">border-purple-500</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is similar to the styled components approach, but I find it rather verbose and the IDE support is mysterious.</p>","excerpt":"My blog has been long overdue for some aesthetic love.\nI went with Tailwind Css\nbecause I have been hearing really good things about it…","fields":{"slug":"/tailwindcss-experience/","readingTime":{"text":"6 min read"}},"frontmatter":{"title":"Rewriting the NSJS blog in Tailwind Css","date":"April 18, 2021","description":"My blog has been long overdue for some aesthetic love and I decided to give Tailwind a run for its money. This is my experience.","tags":["tailwindcss","css","postcss","styling","dark mode"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>For my entire life I have always wanted to change the world, from my early days\nwhen I fantasized about getting my parents back together to my teen years when\nI wondered about helping the poor to my present years when I dream about fixing\nwhat seems to be broken while building on top what seems to be right (as my friend\nwould say: for some definition of right).</p>\n<p>I have stood in awe looking at how companies such as <a href=\"https://www.tesla.com/\">Tesla</a>, <a href=\"https://www.spacex.com/\">Space-X</a>, <a href=\"https://www.impossiblefoods.com/\">Impossible Foods</a>,\n<a href=\"https://www.who.int/news-room/feature-stories/detail/who-can-take-the-pfizer-biontech-covid-19--vaccine?gclid=EAIaIQobChMIiemz2vDJ7gIV1NrICh2M3Q0JEAAYASAAEgIwa_D_BwE\">Pfizer</a> (and so many scientists), <a href=\"https://www.amazon.com/\">Amazon</a>, <a href=\"https://www.apple.com/\">Apple</a>, <a href=\"https://www.google.com/\">Google</a>, <a href=\"https://www.samsung.com/\">Samsung</a>, <a href=\"https://www.linuxfoundation.org/\">the Linux Foundation</a>, et al\nhave changed the world, they have built products that have profoundly impacted or will impact\nour lives, think about phones, think about the internet as we know it, think about having\nthe biggest knowledge library in the known history of human kind literally\nat your fingertips and virtually for free. Or maybe think about what Tesla and Space-X are\naiming to build, a new bread of transportation and new home for human kind.</p>\n<p>I guess you could take these achievements apart if you focus on the bad parts of our society\nwhich I don’t deny they exist, but I don’t think we can deny the net benefits and how\nhumanity will look back 20 or 50 years back at these pioneers will be highly positive.</p>\n<h2 id=\"my-current-stage-in-life\" style=\"position:relative;\">My current stage in life<a href=\"#my-current-stage-in-life\" aria-label=\"my current stage in life permalink\" class=\"header-anchor after\">#</a></h2>\n<p>And so I am at a breaking point in my life, I feel just ripe, just able to do something big,\nI want to try to change the world for the better.</p>\n<p>I have been an unofficial Tech Lead at my current company for at least two years now, and\nwhile I have seized the experience to grow technically, personally and leadership-wise there’s\na lot of overworking and overthinking involved, weekends, nights dedicated to someone else’s business,\nand my reasoning is, I do want to do something big and I am already putting the long hours, the responsibility,\nthe leadership, the stress, and so there’s little to argue against the possibility of aiming higher.</p>\n<p>I have been reading about the Startup culture that involves innovation and passion and creativity,\nI have been reading about how the process is and there’s a lot of way already paved for anybody who\nwants to do something great.</p>\n<p>I might be on the older side of the entrepreneurs but hey, I have been brought up in poor (and\ngetting poorer) Latin American country, my grandparents moved up the ladder from poor (and I mean\npoor like having 10 siblings and leaving in precarious conditions), their biggest aspirations where\nto have a steady job at a big company and a house with regular meals, the culture around me is not\nof dreamers, is about survivors (among other things),\nand so there’s little to no entrepreneur culture and that might\nexplain me being late, nevertheless I will play my odds.</p>\n<h2 id=\"startups-and-incubators\" style=\"position:relative;\">Startups and incubators<a href=\"#startups-and-incubators\" aria-label=\"startups and incubators permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I have some ideas and people to do them with floating around that I wont disclose\nat the moment for obvious reasons and I’m using extensively the documentation\nthat <a href=\"https://www.ycombinator.com/about/\">ycombinator</a> (an incubator) has online, for example the <a href=\"https://www.ycombinator.com/faq/\">faq</a>, or the\n<a href=\"https://www.ycombinator.com/howtoapply/\">how to apply</a> guide.</p>\n<p>They have a nice <a href=\"https://www.ycombinator.com/apply\">program</a> where, if you are selected, you will be able to\nget help from the experts to give form to your project and if everything goes\ncorrectly get funding, while also getting a lot of networking thanks to the extensive\nnetwork of founders they possess. This <a href=\"https://www.ycombinator.com/atyc/\">article</a> describes exactly what happens\ninside the program.</p>\n<p>It surprises me how many <a href=\"https://blog.ycombinator.com/common-misconceptions-about-applying-to-yc/\">misconceptions</a> I actually had about the whole process,\nand so I’m pretty thankful about them writing the more common ones down.</p>\n<p>There is so much to innovate over and they actually have a broad <a href=\"https://www.ycombinator.com/rfs/\">list of areas that they\nsee with a good future</a> although you need not to restrict to that list.\nAnd simply by looking at that list my head and my heart start trembling with emotion, of\neagerness to tackle those problems. At this point I am non stop thinking machine.</p>\n<p>I will be doing the <a href=\"https://www.startupschool.org\">Startup school</a> free program they provide and I would\nprobably recommend my potential co-founders to also take it.</p>\n<p>I am also reading <a href=\"https://amzn.to/3pzBkPv\">Zero to One by Peter Thiel</a> which so far has been a really good book.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>It is scary as hell to be in front of this massive uncertainty wall, I still\nask my self if <em>“am I <strong>x</strong> enough”</em>, where <strong>x</strong> might be <em>smart</em>, <em>willing</em>, <em>capable</em>,\n<em>strong</em>, <em>hard-worker</em>, and so much more.</p>\n<p>Luckily I have strong friends that are definitively co-founder material and a partner\nthat got my back.</p>\n<p>If you are interested if having updates about my journey let me know.</p>","excerpt":"For my entire life I have always wanted to change the world, from my early days\nwhen I fantasized about getting my parents back together to…","fields":{"slug":"/thinking-startup/","readingTime":{"text":"5 min read"}},"frontmatter":{"title":"Thinking about startups","date":"January 18, 2021","description":"For my entire life I've always wanted to change the world, perhaps the time is ripe for me to do just that.","tags":["y combinator","incubators","startup","entrepreneur","life"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<blockquote>\n<p>Do you dislike this statement? I do too.\nRead on.</p>\n</blockquote>\n<p>Isn’t it weird how a lot of developers maintain\nthese sort of inside jokes / memes of hating\ncertain tools and techniques like\nprogramming languages or frameworks?</p>\n<p>It is not the criticism that I find peculiar\nbut the emotional subjective response these folk\nhave toward inanimate things.\nLet’s unpack this aspect of developer culture that we see everyday everywhere.</p>\n<p>I have heard stuff like:</p>\n<ul>\n<li>Java is a verbose trash.</li>\n<li>Static Typing is extra boilerplate with no benefits.</li>\n<li>Javascript is trash.</li>\n<li>Javascript is crazy (talking about the nasty coercion rules it has).</li>\n<li>Php is the worst language ever.</li>\n<li>Only <em>newbies</em> use PHP.</li>\n<li>PHP is not a real programming language.</li>\n<li><em>Real programmers</em> use Java because it has static typing.</li>\n<li><em>Real programmers</em> use <em>X</em> (programming language, technique, etc).</li>\n<li>Dynamic typing is for newbies.</li>\n<li>Haskell is only for academic purposes.</li>\n<li>Node.js doesn’t have <em>concurrency</em></li>\n<li>Node.js is slow because it doesn’t have threads.</li>\n<li>Javascript’s <em>event-loop</em> is bad.</li>\n<li>I don’t need <a href=\"https://www.typescriptlang.org/\">Typescript</a> (static typing) because I already have <a href=\"https://eslint.org/\">eslint</a> (static analysis).</li>\n<li>and so much more.</li>\n</ul>\n<p>I have heard these at work, at open source communities\nand by speakers in conferences and although it is entirely\nfine for people to resonate and feel more comfortable with\ncertain tools and techniques I believe that is better\nto take a step back and try to think about these tools\nmore objectively, without so much emotion and with a cool head,\nif we do that then we can understand the <strong>trade offs</strong> each tool\nhas and <strong>why was it built like that</strong> and, although we might never use\nit, we will most likely understand why other people might,\nwhen we might want to consider using it\nand the reasoning behind the decisions\nthat lead to that result, which in programming are most\nlikely things we can extrapolate to other areas and\nmaintain a more rich and broad understanding of the vast programming landscape.</p>\n<p>So for example, the other day I saw this meme used for a quick laugh at mostly Javascript.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/65699931773d46d42e5c45c7c8a1b052/da104/meme.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.78378378378378%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQP/2gAMAwEAAhADEAAAAbU1cVYKOTvW6PIoLf/EABwQAAICAgMAAAAAAAAAAAAAAAECERIDIQAQMv/aAAgBAQABBQJ7TMqhMZNFgK4tI7m7b5h8FFmoHX//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAWEQADAAAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8BFf/EABwQAAICAgMAAAAAAAAAAAAAAAERABASMSFhcf/aAAgBAQAGPwJuMFe2MqM5XVamq//EABsQAQADAQEBAQAAAAAAAAAAAAEAESExQVFx/9oACAEBAAE/IXZbXyDJgj24ut98IzDQ3TKAHPJhKS8shoEw/Os1qwvUN7AAyf/aAAwDAQACAAMAAAAQ6CuA/8QAGBEBAQADAAAAAAAAAAAAAAAAAQARMXH/2gAIAQMBAT8QCdxkbt//xAAXEQEBAQEAAAAAAAAAAAAAAAABACEx/9oACAECAQE/EF1lkkcv/8QAHRABAQADAAMBAQAAAAAAAAAAAREAITFBUWGBof/aAAgBAQABPxBoNh0Ku+GJyFsSbm7mvbjP4ZLURiijdTeJfAtFfp5/coG3xyeMAAKoBwgCUKZBZaTD2ApvZ3x8xXSeuWhpmncggB6DP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"meme about dynamically vs statically typing\"\n        title=\"meme about dynamically vs statically typing\"\n        src=\"/static/65699931773d46d42e5c45c7c8a1b052/1c72d/meme.jpg\"\n        srcset=\"/static/65699931773d46d42e5c45c7c8a1b052/a80bd/meme.jpg 148w,\n/static/65699931773d46d42e5c45c7c8a1b052/1c91a/meme.jpg 295w,\n/static/65699931773d46d42e5c45c7c8a1b052/1c72d/meme.jpg 590w,\n/static/65699931773d46d42e5c45c7c8a1b052/da104/meme.jpg 809w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>And while I always enjoy a quick laugh, sometimes\nthese type of “jokes” hide a skew, subjective and\nover simplified way of looking at things.</p>\n<p>Does <a href=\"https://android.jlelse.eu/magic-lies-here-statically-typed-vs-dynamically-typed-languages-d151c7f95e2b\">dynamic typing</a> let you build programs (puzzles) <strong>faster</strong> that don’t work or are <strong>incorrect</strong>?\nDoes <a href=\"https://android.jlelse.eu/magic-lies-here-statically-typed-vs-dynamically-typed-languages-d151c7f95e2b\">static typing</a> let you build programs (puzzles) <strong>slower</strong> that do work and are <strong>correctly</strong>?\nAre Statically typed languages fundamentally better than Dynamically typed languages?</p>\n<p>Of course no!</p>\n<p>There is some nuance between the mechanisms by which different\nprogramming languages allow developers to express logic and constraints,\nand how and when they are verified and the errors are handled, one could\ngeneralize Statically Typed languages as allowing more mechanisms to express\nand verify constraints early on (mostly at build time) and\nDynamically Typed languages relying on later “out of band” constraint verifications\ni.e. like doing more automated or manual testing and by doing that they allow\nfaster times to first run.</p>\n<p>But that is a wide spectrum with a lot of nuance, not all statically typed languages\nare the same, some of them provide <a href=\"https://android.jlelse.eu/magic-lies-here-statically-typed-vs-dynamically-typed-languages-d151c7f95e2b\">weaker</a> type systems and good escape hatches,\nand some of them provide <a href=\"https://android.jlelse.eu/magic-lies-here-statically-typed-vs-dynamically-typed-languages-d151c7f95e2b\">strong</a> type systems that at least in my experience tend\nto take more time to “agree with the compiler”.</p>\n<p>After a lot of time spent in Dynamically Typed languages\nsuch as Javascript and <a href=\"https://www.python.org/\">Python</a> now I really value\na good Statically typed language and most of the time\nI do prefer them over untyped because of the capability\nof Statically verifying correctness of my program at least partially,\nbecause of the autocompletion among other things,\nthat is why now a days if I get to chose I only\nwrite <a href=\"https://www.typescriptlang.org/\">Typescript</a> and <a href=\"https://www.python.org/dev/peps/pep-0484/\">typed Python</a>.</p>\n<blockquote>\n<ul>\n<li>Are Dynamically typed languages the worst of the two every time for every use case?</li>\n<li>Are Dynamically typed languages so sloppy that they let you build weird giraffes (not achieve the desired functionality)?</li>\n</ul>\n<p>The answer is a definitive <strong>no</strong>.</p>\n</blockquote>\n<p>There are some cases where Dynamically Typed languages\nlet you express certain highly dynamic patterns\nwith much less boilerplate and more ease.\nHighly polymorphic logic might be a good example of this,\nit is much straight forward to do that in Dynamically Typed languages\nwith simple <a href=\"https://en.wikipedia.org/wiki/Duck_typing\">duck typing</a> that it is with Statically typed languages\nby using <a href=\"https://en.wikipedia.org/wiki/Generic_programming\">generics</a>, <a href=\"https://en.cppreference.com/w/cpp/language/templates\">templates</a> or other mechanisms.</p>\n<p>This <a href=\"https://instil.co/blog/static-vs-dynamic-types/#generic-programming-and-simpler-errors\">article</a> has some good illustrations of this.</p>\n<p>There is a <strong>multi dimensional space</strong>\nthat has axis such as <strong>development speed</strong>, <strong>correctness verification</strong>,\n<strong>memory safety</strong>, <strong>performance</strong>, <strong>ergonomics</strong>, etc that\nProgramming Languages need to navigate.</p>\n<p>In particular, programming languages will be better at some\nof these dimensions and worse at others,\nright now there isn’t a perfect language that maximises\nall dimensions although there has been an explosion of programming\nlanguages in the past 10 years with things such as\n<a href=\"https://golang.org/\">Go</a>, <a href=\"https://www.rust-lang.org/\">Rust</a>, <a href=\"https://docs.microsoft.com/en-us/dotnet/csharp/\">C#</a>, <a href=\"https://www.typescriptlang.org/\">Typescript</a>,\namong others that take a lot of the lessons of the past and\noverall they achieve more than previous languages,\nonly because of the iterative effect of technology.</p>\n<blockquote>\n<p>Rust maximises correctness, memory safety and performance,\nbut that makes it more difficult to understand for newcomers in general.</p>\n</blockquote>\n<p>Take Rust for example, which I really like and that has taught me a lot,\nit is a language that tries to <a href=\"https://www.rust-lang.org/\">maximise correctness, memory safety and performance</a>\nand the Rust team understands perfectly that these\nthings hurt expressiveness and development speed and\nalthough they actively try to improve the developer experience\nthey always maximise correctness, memory safety and performance first,\nand never they hurt those core values because of developer experience,\nand so Rust is widely known as a language\non the hard to learn side, verbose and that for certain highly\ndynamic cases you will end up both struggling and resorting to a variety\nof escape hatches.</p>\n<p>But in a lot of ways Rust is better than its peers (C / C++ mostly),\nit has better memory safety, a much more expressive\nType system, it provides higher level abstractions\nthat compile down to very efficient code,\nit does have a <a href=\"https://doc.rust-lang.org/rust-by-example/mod.html\">modern module system</a>\ninstead of the header file system that I do believe is outdated and verbose,\nit replaces C/C++ build config files such as <a href=\"https://github.com/torvalds/linux/blob/master/Makefile\">Makefiles</a> (and others)\nwith a standard abstraction: <a href=\"https://doc.rust-lang.org/cargo/\">cargo</a>,\nit provides a single standard mechanism for\nlibrary publishing, distribution and consumption: <code class=\"language-text\">cargo</code> and <a href=\"https://crates.io/\">crates.io</a>\ninstead of the multiple non standard ways C/C++ deal with these sort of things.</p>\n<p>But this is also not about bashing C/C++ which,\nalthough they have drawbacks as every tool out there,\nare super mature tools with mature ecosystems,\nlibraries, documentation, etc, that are hard to beat\nin a lot of senses, in fact a lot of the major mission critical\nsoftware we use currently relies heavily on them like\n<a href=\"https://github.com/openssl/openssl\">openssl</a>, <a href=\"https://github.com/torvalds/linux\">Linux</a> which is the base for <a href=\"https://github.com/aosp-mirror/kernel_common\">android</a>, to name a few.\nC++ in particular has made a lot of strives towards\ncorrectness, ergonomics and more and if you really need\nthe performance, C/C++ are conservative choices that will most likely work.</p>\n<p>And what about PHP? Have you seen it recently? It is far from\na perfect language and I personally do not resonate with it but\nit has come a long way from its very humble and chaotic beginnings.\nRecently it has added <a href=\"https://wiki.php.net/rfc/return_types\">type hints</a>, <a href=\"https://softwareengineering.stackexchange.com/questions/306749/is-php7-a-static-or-dynamic-typed-language/306755\">partial static type checking</a>,\nit has added <a href=\"https://www.php.net/manual/en/language.oop5.traits.php\">traits</a>, has <a href=\"https://www.zend.com/blog/php-7\">increased its performance</a>,\nand with modern frameworks such as <a href=\"https://laravel.com/\">Laravel</a> developers can actually write\nvery decent programs with it. And let’s not mention the amount of community\nsupport, pervasive cheap hosting and more that it has.</p>\n<h2 id=\"problem-space-framework\" style=\"position:relative;\">Problem space framework<a href=\"#problem-space-framework\" aria-label=\"problem space framework permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Let me try to list some of the important aspects I consider when trying to evaluate\nprogramming tools objectively. Again, you and your team will most likely\nuse your subjective biases to select them but I do believe it is nice to have at least\na semi structured, objective, way of evaluating tools like Programming languages</p>\n<ul>\n<li>ergonomics / dev speed / dev experience / expressiveness</li>\n<li>documentation / resources available / popularity</li>\n<li>maturity</li>\n<li>ecosystem / available libraries and their quality</li>\n<li>ecosystem / tooling such as IDEs</li>\n<li>is it actively maintained?</li>\n<li>how good is the community around it?</li>\n<li>long term status of the project</li>\n<li>performance</li>\n<li>type safety / correctness verification</li>\n<li>memory safety / memory management strategies (only for programming languages)</li>\n<li>fits my use case?</li>\n</ul>\n<p>So for example, you might like Rust because of its\nperformance, memory safety and correctness but you want\nto do <a href=\"https://amzn.to/3onjpuR\">Machine Learning</a> then you most likely\nwill need to use Python because of its <a href=\"https://amzn.to/3onjpuR\">blooming ecosystem</a>,\nand although you can statically check modern Python you will\nmost likely work with untyped codebases or examples\nand if you give it a chance you will end up understanding where it’s coming from.</p>\n<p>Another nice example is the infamous Javascript’s <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop#event_loop\">event-loop</a>.\nI’ve heard so many people bashing it, complaining about\nJs not having threads, complaining about this weird\nthing that an event loop is, but with <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\">async / await</a> and <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\">promises</a>\nyou get a very ergonomic way of expressing <a href=\"https://en.wikipedia.org/wiki/Concurrency_(computer_science)\">concurrent</a> “tasks”\nwithout resorting to manual thread managing which\nis a well known <a href=\"https://softwareengineering.stackexchange.com/questions/81003/how-to-explain-why-multi-threading-is-difficult\">hard</a> <a href=\"https://www.researchgate.net/publication/2956540_The_Problem_with_Threads\">thing</a> to do 100% correct.\nIn fact there are user level implementations of\nevent loops in <a href=\"https://www.systutorials.com/docs/linux/man/3-ev/\">C</a> and <a href=\"https://github.com/tokio-rs/tokio\">Rust</a> (and probably\nin a lot more places) where although these\nlanguages support threads they recognise that for\ncertain applications having\nan event loop is a pretty good way of managing concurrent tasks.\nAnother modern way of managing concurrent task is Go’s <a href=\"https://tour.golang.org/concurrency/1\">goroutines</a>,\nthat have a higher level api that hides the manual managing of threads.</p>\n<h2 id=\"is-javascript-the-best-programming-language-in-the-world\" style=\"position:relative;\">Is Javascript the best programming language in the world?<a href=\"#is-javascript-the-best-programming-language-in-the-world\" aria-label=\"is javascript the best programming language in the world permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I would say no, by a long shot, but does that mean\nthat it is 100% trash? Also no, by a long shot.</p>\n<blockquote>\n<p>Javascript’s closures and functions\nas a first class citizens make up\nvery expressive and powerful primitives to build complex abstractions</p>\n</blockquote>\n<p>For example, in my opinion, closures and functions as a first class\ncitizens make up very expressive and powerful primitives to build\ncomplex abstractions on top of, in fact\nthese things are inherited from the <a href=\"https://docs.racket-lang.org/reference/let.html\">lisp family</a> and are well understood tools,\nfrom the <a href=\"https://amzn.to/38iYm6W\">blooming origins</a> of Computer Science and programming languages.\nWe cannot also deny that, although\nextremely chaotic, the NPM ecosystem is a boilerplate\nof very good ideas that have shaped the way we develop\nJavascript applications.</p>\n<p>Does Javascript has bad parts? Lots!\nIn fact there’s a now mostly outdated but very\n<a href=\"https://amzn.to/38lEMqF\">popular book</a> about that.\nBut Javascript is starting to pick up the pace and\nhas made huge improvements in the past couple\nof years with native module syntax which is very good\nin my opinion (although native support is still far behind),\nnative class support that mostly works as you’d expect it,\nuser land hygienic macro system: <a href=\"https://babeljs.io/\">babel</a>,\nblooming statically typed variants such as Typescript and Flow\nand so much more make Javascript a very solid choice\nfor a lot of projects.</p>\n<p>Is it the best for all projects?\nMost likely not, but understanding its trade off\nwill give you solid fundamentals to make up a better\neducated choice of your tool.</p>\n<h2 id=\"why-do-we-love-or-hate-inanimate-things\" style=\"position:relative;\">Why do we love or hate inanimate things?<a href=\"#why-do-we-love-or-hate-inanimate-things\" aria-label=\"why do we love or hate inanimate things permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I believe that in the bottom of this discussion lies\nthe emotions and feelings we get towards tools, it happens\nin programming, it happens in woodworking, it happens generally\nin arts and craftsmanship.</p>\n<p>I think that the toxic hate you sometimes see in programming boils down\nto 1) we tend to fall in love with certain tools because of all the amazing\nthings we can accomplish with them and this love also generates hate\ntowards obvious competitors (i.e. Dynamically vs Statically typed languages);\nand 2) because of the meme quality of these tropes we as a developers maintain over time;\nthese rules of thumb that lead as to say things such as\n<em>“Statically typing is bad because Java is verbose, you better use Node.js”</em>.\nThis is sometimes referred to as <a href=\"https://en.wikipedia.org/wiki/Cargo_cult\">Cargo Cult</a></p>\n<p>So we build these sort of <em>prejudice</em> and ill informed conceptions of tools\nthat we might only understand superficially instead of objectively and holistically,\nand this is something that seems to be part of the human nature since we build\n<em>prejudice</em> for people, animals, tools, places, etc. Humans are emotional beings\nand we require a conscious effort to avoid having raw emotional subjective responses\nto everything around us, but that’s just the Engineer mind set that ends up being\nmore constructive and positive for our careers.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\">Conclusion<a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Programming is such a new and exciting but very complex discipline that the variety of solutions\nfor a given problem might be very large and it is important that we as developers develop (pun intended)\nan objective way of understanding these solutions, their trade offs and how to chose\namong them; and perhaps how to combine them and add up their strengths.\nIn end there will be always tools we enjoy using more than others\nbut that doesn’t necessarily mean that those tools are objectively\nuniversally better and the others are trash, it just that we like them,\nthey resonate with our minds or perhaps we simply\ngot more experience with them.</p>\n<p>And perhaps some day we will find out the <em>perfect programming language</em> but\nwe would still need to consider its ecosystem, support, community experience,\ndevelopers available and so many other things before adopting it to our projects.</p>\n<p>In the end, this post is just me giving a message of <strong>understanding,\nempathy and compassion for our fellow developers</strong>\nthat try to make a living in this very complex world of programming.</p>\n<hr/>\n<p>Like the content? Consider subscribing, buying me a coffee or even becoming a Patreon below.</p>","excerpt":"Do you dislike this statement? I do too.\nRead on. Isn’t it weird how a lot of developers maintain\nthese sort of inside jokes / memes of…","fields":{"slug":"/javascript-is-best/","readingTime":{"text":"12 min read"}},"frontmatter":{"title":"Javascript is the best programming language in the world","date":"January 08, 2021","description":"On the nature of love and hate for inanimate things such as programming languages and how to take a more objective stance against the vast programming landscape.","tags":["typescript","javascript","rust","java","C/C++","programming languages","reflection","toxic culture"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<h2 id=\"tldr\" style=\"position:relative;\">TLDR<a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>🎉 2020 was a great year, thank your sticking with me!</li>\n<li>\n<p>On 2021 I want to cover even more topics in the blog:</p>\n<ul>\n<li><a href=\"https://www.rust-lang.org/\">Rust</a> and <a href=\"https://webassembly.org/\">Wasm</a>: love the language and the intersection with the Javascript ecosystem.</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Machine_learning\">ML</a>/<a href=\"https://en.wikipedia.org/wiki/Artificial_intelligence\">AI</a>: there is so much stuff to do and to learn in this area.</li>\n<li>Web Technologies: I want to keep covering the tools I use daily in production.</li>\n<li>Soft Skills and Mental Health for developers: let’s be healthy together.</li>\n</ul>\n</li>\n<li>Let me know what topics are you interested in by <a href=\"https://forms.gle/8ikNVUFXEb2mT7bS7\">filling the survey</a>.</li>\n</ul>\n<h2 id=\"table-of-contents\" style=\"position:relative;\">Table of Contents<a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#tldr\">TLDR</a></li>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#a-look-back-at-2020\">A look back at 2020</a></li>\n<li><a href=\"#a-look-forward-to-2021\">A look forward to 2021</a></li>\n<li>\n<p><a href=\"#rust\">Rust</a></p>\n<ul>\n<li><a href=\"#web-assembly-and-rust\">Web Assembly and Rust</a></li>\n</ul>\n</li>\n<li><a href=\"#machine-learning-and-artificial-intelligence\">Machine Learning and Artificial Intelligence</a></li>\n<li>\n<p><a href=\"#soft-skills-and-mental-health-for-developers\">Soft skills and Mental health (for developers)</a></p>\n<ul>\n<li><a href=\"#soft-skills\">Soft skills</a></li>\n<li><a href=\"#mental-health\">Mental health</a></li>\n</ul>\n</li>\n<li><a href=\"#javascript-and-web-technologies\">Javascript and web technologies</a></li>\n<li><a href=\"#closing\">Closing</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p>2020 was a <em>weird</em> year to say the least. We were to stay in our houses\nmore than usual and that changed our lives.</p>\n<p>Besides the bug that most of you are already familiar with, 2020 was a special\nyear for me because 3 out of 4 members of my family moved abroad. This was\nplanned for 2020 but the stay-at-home situation delayed it and we had extra opportunities\nto spend time together.\nIt is not the end of the world, we are going to see each other\nand there a lot of way we are still connected but it is a massive change from having\na walking-distance between each other. They are happy and so there’s no point\nin dwelling in much else, but it was definitively a big change.</p>\n<p>Besides this small glimpse into my personal life it was a real good year for\n<strong>NoSleep Javascript</strong>. The community around it increased substantially and people\nhave been real good to me, showing support and encouragement messages.\nConsidering this is a one-man operation it has had pretty good results.\nI have also started to be more consistent with my writing\nand I believe that I improved a lot in expressing my ideas in a clear and concise way although\nI have a long way to go yet.\nIn fact this second year has ended with net positive income, nothing\nlife changing but it is still nice to see how this small operation\nnow is effectively having profits.</p>\n<blockquote>\n<p>It has been a great journey so far and I hope you stay for the ride\nwith me. We have exiting plans for the future!</p>\n</blockquote>\n<p>This post has two purposes:</p>\n<ol>\n<li>A public statement of the plans for 2021.</li>\n<li>A personal commitment to do more and never falter.</li>\n</ol>\n<p>This post might also interest you if you yourself are building an internet business\nlike this one.</p>\n<h2 id=\"a-look-back-at-2020\" style=\"position:relative;\">A look back at 2020<a href=\"#a-look-back-at-2020\" aria-label=\"a look back at 2020 permalink\" class=\"header-anchor after\">#</a></h2>\n<p>The community has grown exponentially, we are still small but\nat this pace we are going to become huge!.</p>\n<p>This is the list of the most successful posts this year:</p>\n<ol>\n<li><a href=\"https://nosleepjavascript.com/docker-essentials-for-front-end-developers/\">Essential Docker for Javascript and Front End Developers</a></li>\n<li><a href=\"https://nosleepjavascript.com/react-performance/\">React is slow, what now?</a></li>\n<li><a href=\"https://nosleepjavascript.com/bitbucket-sucks/\">Bitbucket is developer hell</a></li>\n<li><a href=\"https://nosleepjavascript.com/programming-principles/\">Secrets of a Tech Lead: Programming Principles</a></li>\n</ol>\n<p>If you haven’t checked them out be sure to do that, they have valuable content.</p>\n<h2 id=\"a-look-forward-to-2021\" style=\"position:relative;\">A look forward to 2021<a href=\"#a-look-forward-to-2021\" aria-label=\"a look forward to 2021 permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Although I work professionally as a <strong>Senior software developer</strong>\nspecialised in the Javascript ecosystem <em>and</em> as a <strong>Tech Lead</strong>,\nI’m always looking elsewhere, in fact, most of the bigger lessons\nI have learnt and which you might find in my posts are from actually\nlooking outside the Javascript ecosystem and bringing back the\nmore general knowledge back and becoming an overall better developer.</p>\n<p>The plan is for next year to include some of those technologies\ninto the blog and hopefully we can <strong>extrapolate universal\nprogramming truths</strong> into our day to day work and whatever technology\nwe use in them.</p>\n<p>Let’s cover the topics I am planning on covering next year:</p>\n<h2 id=\"rust\" style=\"position:relative;\">Rust<a href=\"#rust\" aria-label=\"rust permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>I want to talk more about <a href=\"https://www.rust-lang.org/\">Rust</a>, teaching Rust to front end developers, talking about\nWasm (Web Assembly) and simply writing more Rust just for fun.</p>\n</blockquote>\n<p>I have been a long time fun of Rust and an early tinkerer of the language, even\nbefore it reached v1 which was a very chaotic epoch.</p>\n<p>Since then Rust has consolidated as a real world programming language with revolutionary\nguarantees in a niche that has been dominated for a long time\nby arguably old and sometimes outdated languages: C and C++.</p>\n<p><strong>WARNING!</strong> I don’t have anything against C and C++, please don’t take it personally, there are a lot of things\nthose languages have brought to the table and they are super valuable and they will probably\nbe for a long long time, BUT, they have widely accepted flaws like exposing themselves easily\nto memory attacks and being highly unsafe by default, and they also have some pretty old-fashioned\nidioms such as header files instead of regular modules. The build system and package ecosystem\nis far from ideal in my humble opinion, one can say a lot of bad stuff about <a href=\"https://www.npmjs.com/\">NPM</a>\nand <a href=\"https://crates.io/\">crates.io</a> but they\nhave provided a community standard to publish and share reusable packages across all environments, something\nthat up to this day is not trivial with C and C++. I know there are solutions, but none of them are standard like\nNPM and crates.io are. Additionally, Rust’s build system: <a href=\"https://doc.rust-lang.org/cargo/\">cargo</a>,\nis a standard tool that replaces all the configurations\nyou would otherwise need to, sometimes manually, dump into makefiles\nand other configuration files of sort. Cargo is a modern solution\nfor this problem and makes the barrier of entry to Rust almost null in that respect.\nFinally, Rust acknowledges\nthat in order to be productive programmers\nneed to high level constructs such as <code class=\"language-text\">map</code>, <code class=\"language-text\">Option</code>, mutability helpers, and so much more.</p>\n<p>Rust has a lot of virtues, briefly:</p>\n<ul>\n<li>it is a low level language with high level APIs.</li>\n<li>it does a lot of help you make programs that are <em>safe</em>.</li>\n<li>the community is outstandingly good both with hard skills (technicals) and soft skills (management, communication, problem resolution).</li>\n<li>a holistic approach towards building a programming language: Rust understand that a programming language is so much more than the syntax and the compiler, it involves build systems, package repositories, installers, configuration management, good quality packages, etc.</li>\n<li>is statically typed.</li>\n</ul>\n<p>Thanks to learning Rust early I have understood, probably the hard way, a lot about Statically Typed\nlanguages, idioms, techniques, patterns, etc; which I extrapolated without much effort to Typescript\nwhen I started using it professionally. Additionally I finally\nunderstood the benefit of statically typed languages with Rust, the experience of getting\nthe compiler to help you find the problems with your program is a humbling and enlightening\nthat if you endure (sometimes it can be frustrating) it will teach you a lot.</p>\n<p>In fact, Rust is the reason I am all in on <a href=\"https://www.typescriptlang.org/\">Typescript</a> and have been for the past couple of years even when\nsome of the Javascript community still has <a href=\"https://www.java.com/en/\">Java</a> PTSD\n(and cargo cult to be honest) about what type systems look\nand how they are used. To those still reluctant about Typescript I tell you:</p>\n<blockquote>\n<p>There is <em>so</em> much more to Statically Typed languages than what Java has to offer.</p>\n</blockquote>\n<p><strong>IMPORTANT:</strong> I do not hate Java, in fact I respect it a lot, I have felt foreign when looking at production grade\nJava code, because of its natural verbosity and because of common idioms used but my experience might be biased, so I do\nkeep and open mind and I do acknowledge that Java in 2020 is a completely different beast than what Java was 2 or 3 years ago.</p>\n<h3 id=\"web-assembly-and-rust\" style=\"position:relative;\">Web Assembly and Rust<a href=\"#web-assembly-and-rust\" aria-label=\"web assembly and rust permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Rust has one of the best supports for Web Assembly and it has a whole team dedicated to it.\nWasm can have a massive impact in the Javascript ecosystem, just think of it, in both Node.js\nand front end applications we are using Javascript to build compilers, macro systems, linkers (webpack),\nlinters and a lot of code that usually is built with Statically Typed Compiled languages and one of the\nmain reasons for that is performance. Javascript is really fast and has gotten really fast in the last few years\nbut still there are things that it will be naturally slower than Statically Typed Compiled and build-time optimized\nlanguages such as Rust so it is natural to think about slowly migrating stuff like\n<a href=\"https://babeljs.io/\">Babel</a>, Typescript,\n<a href=\"https://eslint.org/\">eslint</a> and\n<a href=\"https://webpack.js.org/\">webpack</a>\nto Rust for example.</p>\n<p>Imagine reducing the times it takes to compile for your large scale production application when using webpack? Isn’t that\na big win?</p>\n<p>Well, in any case Rust has lot of tooling (although a little bit immature last time I checked) to seamlessly integrate\nWasm code into Node.js, webpack, and front end applications in general, so once this tooling is mature I expect\nthe integration to be quite easy and the only real barrier will be Rust it self. So we might as well be ahead of\nthe curve and start getting really good with Rust!</p>\n<blockquote>\n<p>Rust has a great future ahead but learning it can be frustrating depending on your background,\nand I would love to help the community with that learning path since I myself have already\nbeen there and done that.</p>\n</blockquote>\n<h2 id=\"machine-learning-and-artificial-intelligence\" style=\"position:relative;\">Machine Learning and Artificial Intelligence<a href=\"#machine-learning-and-artificial-intelligence\" aria-label=\"machine learning and artificial intelligence permalink\" class=\"header-anchor after\">#</a></h2>\n<p>ML and AI are becoming widely used techniques to solve a wide variety of problems,\nan although right now we see them in a lot of big companies as part of their main products\nI expect that while the technology advances we are going to see more and more day to day\napplications in customer support bots or a smarter searches and with things we currently\ndon’t even imagine.</p>\n<p>I do expect ML/AI to have even more impact and be life-changing in the near future as technology\nevolves and we learn more about what is possible with them.</p>\n<p>I have been reading two books this year and I am planning on finishing them and reading\nmore. A lot of the ML/AI ecosystem is based around <a href=\"https://www.python.org/\">Python</a>\nand I really enjoy working with one of the most loved and used languages in the world,\nso there’s a bonus point there too. These are the books I am currently going through:</p>\n<ul>\n<li><a href=\"https://amzn.to/3lS4A1i\">Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow: Concepts, Tools, and Techniques to Build Intelligent Systems</a></li>\n<li><a href=\"https://amzn.to/2K4nAMK\">Deep Learning with Python</a></li>\n</ul>\n<p>I would love to cover topics related to ML/AI in this blog and also to have an excuse\nto learn more about them in the way.</p>\n<h2 id=\"soft-skills-and-mental-health-for-developers\" style=\"position:relative;\">Soft skills and Mental health (for developers)<a href=\"#soft-skills-and-mental-health-for-developers\" aria-label=\"soft skills and mental health for developers permalink\" class=\"header-anchor after\">#</a></h2>\n<p>The idea of software developers being black boxed hermits that accept\ncoffee, pizza and requirements as inputs and they output working software\nis an outdated one that I believe is detrimental to us developers.</p>\n<p>On 2021 I want to break the spell and talk about Soft Skills and Mental Health for developers.</p>\n<h3 id=\"soft-skills\" style=\"position:relative;\">Soft skills<a href=\"#soft-skills\" aria-label=\"soft skills permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Developers are far from hermits, although they do need to have a good chunk of their time\navailable for coding with deep concentration and focus they also need to communicate well\nwith others, not only other developers but superiors, underlings, people from other areas\nsuch as HR, management, stakeholders, QA, graphics designers, etc.</p>\n<p>This type of communication\nrequires a lot of soft skills to be efficient, effective and productive, so we, as developers\nneed to be socially capable, we need to be able to express ideas concisely to non technical people,\nwe need to understand how technical decisions impact the business goals and vice versa, we need to\nbe emotionally intelligent to understand other people and their swinging moods, we need to be empathetical\nto other’s emotions and stages in their lives.</p>\n<blockquote>\n<p>Developers can no longer be awkward geeky people, we need to be regular people with technical skills,\nwe need to understand ourselves (see next section) and others, understand how social interactions flow\nand we can navigate this complicated space. Nothing too fancy, it is just another problem space we need\nto figure out which is something we do on a daily basis.</p>\n</blockquote>\n<p>The main idea is to write about effective communication, <a href=\"https://amzn.to/37OaEmm\">emotional intelligence</a>,\nempathy and any other soft skills\nrequired for developers while understanding that there are different people with different backgrounds that have\ndifferent experiences being socially able in the workplace.</p>\n<p>I believe that in the end this will not only impact your work life but it will also impact your personal life like\nit did to me.</p>\n<h3 id=\"mental-health\" style=\"position:relative;\">Mental health<a href=\"#mental-health\" aria-label=\"mental health permalink\" class=\"header-anchor after\">#</a></h3>\n<p>If <em>soft skills</em> refer to <strong>how we handle ourselves with other people and their emotions</strong>, Mental health\nis all about <strong>us and how we handle ourselves with and within ourselves</strong>.</p>\n<p>Developers sit down right in the junction of <a href=\"https://en.wikipedia.org/wiki/Neurosis\">neurosis</a>\n(we are over thinkers),\n<a href=\"https://www.mayoclinic.org/diseases-conditions/anxiety/symptoms-causes/syc-20350961\">anxiety</a>\n(am I going to be able to pull this off?) and\nstress (we need this work finished by tomorrow) and this situation is a severe attack\nto our mental health. Anxiety is a pervasive sickness in the modern world but combined with stress and\nthe dangerous neurosis can mutate into much worse symptoms like panic attacks and\nelevated anxiety periods.</p>\n<p>This is why before understanding other people\nwe need to understand ourselves and our emotions (<a href=\"https://amzn.to/37OaEmm\">emotional intelligence</a>),\nwe need to be <strong>observers</strong> of our own mind and have the clarity to auto regulate our selves,\nwe need to be able to say <em>“that’s enough overthinking for today, tomorrow I will be able to solve it”</em>\nand sleep with a quiet mind.</p>\n<p>These things are not only problems of developers but I believe that since our primarily\ntask is to <em>think</em> that we are particularly susceptible to these problems.</p>\n<p>Fortunately there are a lot of both old and new tools to deal with these situations\nand the society as a whole is much more comprehensive and understanding and open\nabout them than it used to be.</p>\n<p>The core idea is to be able to help others with my own experiences with this subject,\nwith feeling sad, anxious, depressed, etc. and what tools I have used to deal with them,\nand in the way acknowledging that you on the other side are not the only one with these problems.</p>\n<p>One particular subject I am super excited to talk\nabout is <a href=\"https://en.wikipedia.org/wiki/Stoicism\">stoicism</a>,\nit is philosophy and has helped me a lot to cope with these\nproblems and I believe they can help other people too.</p>\n<h2 id=\"javascript-and-web-technologies\" style=\"position:relative;\">Javascript and web technologies<a href=\"#javascript-and-web-technologies\" aria-label=\"javascript and web technologies permalink\" class=\"header-anchor after\">#</a></h2>\n<p>On 2020 I have cover a lot of topics related to Javascript and web technologies,\nmainly because that’s what I do on a day to day basis and there are a lot of things\nI need to fix and learn so there’s a constant flow of information I can share\nin the blog that comes out from my experiences in production grade applications.\nOn 2021 I want to keep my commitment with web technologies and provide free useful\ntools to the community.\nI’m also planning on launching paid courses, mentorship and consultancy products\nto expand the reaches of this humble enterprise.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>🎉 THANK YOU! 🎉</p>\n<p>Thank you so much for sticking with me and my project,\nI couldn’t be more happier and excited for the future.</p>\n<p>Let me know in the reddit discussion what are you most excited about on 2021.</p>\n<p>Or even better, <a href=\"https://forms.gle/8ikNVUFXEb2mT7bS7\">fill this survey</a>\nand let me know what are you interested in\nfor 2021.</p>\n<hr/>\n<p>Like the content? Consider subscribing, buying me a coffee or even becoming a Patreon below.</p>","excerpt":"TLDR 🎉 2020 was a great year, thank your sticking with me! On 2021 I want to cover even more topics in the blog: Rust and Wasm: love the…","fields":{"slug":"/retrospective-2020/","readingTime":{"text":"13 min read"}},"frontmatter":{"title":"NoSleep Javascript 2020 in review and plans for 2021","date":"January 02, 2021","description":"Let's talk about the amazing growth we've seen in 2020 and what plans we have for 2021. Thank you!","tags":["year in review","plans for 2021","meta","Machine Learning","Artificial Intelligence","Rust","Python","React","Typescript"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>Welcome to the interview with React-Query’s creator Tanner Linsley,\nfeel free to jump around the questions through the Table of Contents\nbelow or grab a cup of coffee and read on.</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\">Table of Contents<a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#introduction\">Introduction</a></p>\n<ul>\n<li><a href=\"#for-those-who-might-not-know-you-tell-us-about-yourself\">For those who might not know you tell us about yourself</a></li>\n<li><a href=\"#do-you-have-a-formal-education-in-computer-science-did-you-learn-about-algorithms-and-data-structures-how-important-for-developers-do-you-think-it-is-to-cover-the-basics-of-computer-science\">Do you have a formal education in computer science? Did you learn about algorithms and data structures? How important for developers do you think it is to cover the basics of computer science?</a></li>\n<li><a href=\"#how-did-you-come-up-with-the-idea-for-react-query\">How did you come up with the idea for react-query?</a></li>\n<li><a href=\"#what-tools-or-techniques-would-you-like-to-explore-next\">What tools or techniques would you like to explore next?</a></li>\n<li><a href=\"#what-do-you-think-about-react\">What do you think about React?</a></li>\n<li><a href=\"#who-influenced-the-most-your-way-of-programming-and-problem-solving-did-you-have-any-mentors-in-your-programming-career\">Who influenced the most your way of programming and problem solving? Did you have any mentors in your programming career?</a></li>\n<li><a href=\"#what-piece-of-code-has-influenced-the-most-\">What piece of code has influenced the most ?</a></li>\n<li><a href=\"#i-have-covered-my-programming-principles-in-the-past-what-are-you-programming-principles\">I have covered my programming principles in the past, what are you programming principles?</a></li>\n<li><a href=\"#do-you-think-that-code-can-have-certain-art-like-traits\">Do you think that code can have certain art-like traits?</a></li>\n<li><a href=\"#do-you-find-any-parallels-between-programming-and-other-craft-like-activities-outside-software\">Do you find any parallels between programming and other craft-like activities outside software?</a></li>\n<li><a href=\"#how-does-your-day-look-like-how-is-your-life-work-balance\">How does your day look like? How is your life-work balance?</a></li>\n<li><a href=\"#i-saw-you-are-a-proud-member-of-the-church-of-jesus-christ-of-latter-day-saints-what-can-you-tell-us-about-that\">I saw you are a proud member of “The Church of Jesus Christ of Latter-day Saints”, what can you tell us about that?</a></li>\n<li><a href=\"#what-is-faith-to-you-what-does-being-religious-mean-to-you\">What is faith to you? What does being religious mean to you?</a></li>\n<li><a href=\"#how-do-your-religious-values-and-practices-change-the-way-you-code-do-open-source-and-build-software-in-general\">How do your religious values and practices change the way you code, do open source and build software in general?</a></li>\n<li><a href=\"#how-do-you-handle-your-mental-health-how-do-you-handle-anxiety-overthinking-dreaming-about-code\">How do you handle your mental health? How do you handle anxiety, overthinking, dreaming about code?</a></li>\n<li><a href=\"#do-you-exercise\">Do you exercise?</a></li>\n<li><a href=\"#what-are-the-most-important-soft-skills-developers-should-have-ie-good-oral--written-communication-emotional-intelligence-such-as-empathy-team-working-mentoring-learning-teaching-upwards-high-level-communication-handling-anxiety-meditation-etc\">What are the most important soft skills developers should have? (i.e. good oral / written communication, emotional intelligence such as empathy, team working, mentoring, learning, teaching, upwards high level communication, handling anxiety, meditation, etc)</a></li>\n<li><a href=\"#what-is-like-to-be-a-parent-how-does-that-affect-your-programming\">What is like to be a parent? How does that affect your programming?</a></li>\n<li><a href=\"#how-do-you-feel-about-the-massive-impact-your-libraries-have-in-so-many-companies-that-use-them\">How do you feel about the massive impact your libraries have in so many companies that use them?</a></li>\n<li><a href=\"#what-do-you-like-about-the-open-source-community-how-do-you-handle-toxic-members-in-our-community\">What do you like about the open source community? How do you handle toxic members in our community?</a></li>\n<li><a href=\"#how-do-you-balance-unpaid-work-and-paid-work\">How do you balance unpaid work and paid work?</a></li>\n<li><a href=\"#free-space-for-tanner-what-would-you-like-to-say\">Free space for Tanner, what would you like to say?</a></li>\n</ul>\n</li>\n<li><a href=\"#closing\">Closing</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p>A while back ago I was seeking for something to solve\ndata fetching pains that me and my team were facing\nwhile building and maintaining about a million lines\nof mostly React code.</p>\n<p>The way we were managing data fetching was (and partially still is)\nby using Redux and manually writing actions, reducers,\nselectors, normalization, bookkeeping such as loading and error states\nand when/how to trigger those requests, which up to this day is pretty\ncommon way of doing data fetching with React.</p>\n<p>The verbosity and lack of guarantees and abstractions\nmade the process painful, developers dreaded fetching\nnew data and the PR reviews dragged because everybody\nhas their own opinion of what an action and a reducer\nshould look like in theory.</p>\n<p>We tried some other <a href=\"https://github.com/amplitude/redux-query\">Redux</a>\nbased solutions without\nmuch success because the fundamental problem is that\nRedux was not built to do data fetching, you can of\ncourse use it successfully but you there’s a lot of unfolded\ncomplexity you need to manage mostly manually.\nGranted, with <a href=\"https://redux-toolkit.js.org/\">Redux-Toolkit</a>\nand <a href=\"https://reactjs.org/docs/hooks-intro.html\">React hooks</a>\nthings look better but many of\nthe mentioned problems still stand.</p>\n<p>I have explored this in more details in a previous post:\n<a href=\"https://nosleepjavascript.com/redux-data-fetching-antipattern\">Stop using Redux for Data Fetching, use this instead</a></p>\n<p>Since I didn’t find any existing solutions,\nI started designing my own and these were\nsome of the core characteristics it had:</p>\n<ul>\n<li>No concept of the Redux state, actions and reducers, it is just a glorified smart structured Cache</li>\n<li>Data is stored by a user defined cache key</li>\n<li>Users can mutate the cache when performing HTTP mutations (i.e. PUT)</li>\n<li>No duplicated HTTP calls: components should be able to define their data dependencies and the abstraction should take care of de-duping them.</li>\n<li>Fetching new data should require minimal boilerplate</li>\n<li>Automatic bookkeeping: loading, errors, freshness of the data should all be handled automatically</li>\n<li>The interface should be similar to <a href=\"https://www.apollographql.com/docs/react/\">Apollo Client</a></li>\n</ul>\n<p>And what I have designed and was about to start coding\nended up already existing and being Tanner’s\n<a href=\"https://react-query.tanstack.com/\">react-query</a>,\na smart, small, simple, battle tested, typescript based (currently)\nlibrary of my dreams that was far beyond my original\ndesign and far beyond what I’ve probably could have made by myself.</p>\n<p>And that’s how I feel connected to Tanner,\nI like the way he writes code and I share\na lot of the same values,\nI like how he approaches open source and\nhow he always appears as a positive proactive\nindividual which is super fun to work with.</p>\n<p>And here I bring you the interview with\n<a href=\"https://github.com/tannerlinsley\">Tanner Linsley</a>,\n<em>react-query</em> creator, open source maintainer,\ndad, family man, religious man and so much more,\nlet’s get to know him:</p>\n<p><img src=\"https://avatars1.githubusercontent.com/u/5580297?s=500\" alt=\"Tanner Linsley\"></p>\n<h3 id=\"for-those-who-might-not-know-you-tell-us-about-yourself\" style=\"position:relative;\">For those who might not know you tell us about yourself<a href=\"#for-those-who-might-not-know-you-tell-us-about-yourself\" aria-label=\"for those who might not know you tell us about yourself permalink\" class=\"header-anchor after\">#</a></h3>\n<ul>\n<li>How long have you been programming?</li>\n</ul>\n<p>12 years</p>\n<ul>\n<li>Where are you from?</li>\n</ul>\n<p>Utah</p>\n<ul>\n<li>What languages and tools have you been working with?</li>\n</ul>\n<p>JS, React, HTML, CSS</p>\n<ul>\n<li>How did you learn to program?</li>\n</ul>\n<p>I learned all on my own. Trial and error and lots of Google searches.</p>\n<ul>\n<li>Did you get a technical degree?</li>\n</ul>\n<p>I partially completed degrees in Audio Engineering\nand Web Design / Development from UVU in Utah,\nbut did not complete them before entering the workforce.</p>\n<ul>\n<li>What companies have you worked on?</li>\n</ul>\n<p>I am one of three co-founders at <a href=\"https://nozzle.io/\">Nozzle.io</a>,\nwhich I have worked on for the last 7 years</p>\n<h3 id=\"do-you-have-a-formal-education-in-computer-science-did-you-learn-about-algorithms-and-data-structures-how-important-for-developers-do-you-think-it-is-to-cover-the-basics-of-computer-science\" style=\"position:relative;\">Do you have a formal education in computer science? Did you learn about algorithms and data structures? How important for developers do you think it is to cover the basics of computer science?<a href=\"#do-you-have-a-formal-education-in-computer-science-did-you-learn-about-algorithms-and-data-structures-how-important-for-developers-do-you-think-it-is-to-cover-the-basics-of-computer-science\" aria-label=\"do you have a formal education in computer science did you learn about algorithms and data structures how important for developers do you think it is to cover the basics of computer science permalink\" class=\"header-anchor after\">#</a></h3>\n<p>I do not, but I have invested the necessary\namount of effort over the years to understand\nthese very important concepts as I go.\nI think what’s important is simply learning what\nis necessary in the moment to accomplish the\ntask you have been given.\nIf that includes learning about several <strong>algorithms\nand data structures</strong>, then great!\nIf that only means learning about one of them,\nthen that’s also fine. Just keep moving forward.</p>\n<h3 id=\"how-did-you-come-up-with-the-idea-for-react-query\" style=\"position:relative;\">How did you come up with the idea for react-query?<a href=\"#how-did-you-come-up-with-the-idea-for-react-query\" aria-label=\"how did you come up with the idea for react query permalink\" class=\"header-anchor after\">#</a></h3>\n<p>The pains that inspired <a href=\"https://react-query.tanstack.com/\">React Query</a>\nwere years in the making, even before hooks.\nI was a heavy Redux user for a long time,\nbut when hooks came out, I knew they would\nserve as a great API to finally ditch Redux\nin favor of something less manual.\nI came up with the initial inspiration for\nReact Query when I saw a library called\n<a href=\"https://github.com/vadimdemedes/draqula\">Draqula</a> was released.\nIt was almost like a lightweight Apollo\nand something clicked about its patterns and style.\nI decided to draw from its patterns a bit and React Query was born.</p>\n<h3 id=\"what-tools-or-techniques-would-you-like-to-explore-next\" style=\"position:relative;\">What tools or techniques would you like to explore next?<a href=\"#what-tools-or-techniques-would-you-like-to-explore-next\" aria-label=\"what tools or techniques would you like to explore next permalink\" class=\"header-anchor after\">#</a></h3>\n<p>I would like to explore serverless technology, 3d rendering, and general framework design.</p>\n<h3 id=\"what-do-you-think-about-react\" style=\"position:relative;\">What do you think about React?<a href=\"#what-do-you-think-about-react\" aria-label=\"what do you think about react permalink\" class=\"header-anchor after\">#</a></h3>\n<p>React is fantastic. The only problem\nI see around it right now is the unknown / uncertain\ndirection the core React team may be taking.\nI really hope that the entire ecosystem will\nbe able to follow, but as of late,\n<a href=\"https://reactjs.org/docs/concurrent-mode-intro.html\">concurrent mode</a>\nhas been proving to be a difficult constraint\nfor much of the ecosystem to understand and prepare for,\nsometimes even resulting in rewrites of entire tools\nto satisfy those constraints.\nWe’ll see what happens. At the time of writing,\n<a href=\"https://reactjs.org/docs/concurrent-mode-suspense.html\">Suspense</a>\nfor data fetching is still not finalized, but I wish it would be.\nThe current APIs are just fine. I personally don’t want\nto work on React, but with the current component API,\nhooks, and suspense, I am pretty happy with where we’ve ended up.</p>\n<h3 id=\"who-influenced-the-most-your-way-of-programming-and-problem-solving-did-you-have-any-mentors-in-your-programming-career\" style=\"position:relative;\">Who influenced the most your way of programming and problem solving? Did you have any mentors in your programming career?<a href=\"#who-influenced-the-most-your-way-of-programming-and-problem-solving-did-you-have-any-mentors-in-your-programming-career\" aria-label=\"who influenced the most your way of programming and problem solving did you have any mentors in your programming career permalink\" class=\"header-anchor after\">#</a></h3>\n<p>My co founders, <em>Derek Perkins</em> and <em>Joe Bergevin</em>\nhave had a profound impact on how I think,\ndesign and reason about software engineering\nand I dare say I’ve also returned the favor\nas we’ve grown together.</p>\n<p>The only other prominent mentor I had\nearly on in my career was the, now niche-famous,\n<a href=\"https://kentcdodds.com/\">Kent C Dodds</a>.\nHe helped me set up my first testing suite\nin Angular (believe it or not) and I\nwatched him give his first lightning\ntalk at our local meetup (which is also\nthe very night I met my co founders).</p>\n<h3 id=\"what-piece-of-code-has-influenced-the-most-\" style=\"position:relative;\">What piece of code has influenced the most ?<a href=\"#what-piece-of-code-has-influenced-the-most-\" aria-label=\"what piece of code has influenced the most  permalink\" class=\"header-anchor after\">#</a></h3>\n<p><a href=\"https://preactjs.com/\">Preact</a> and\n<a href=\"https://svelte.dev/\">Svelte</a> are quite impressive,\n<a href=\"https://cloud.google.com/bigquery\">Big Query</a> by Google is truly unbelievable,\n<a href=\"https://square.github.io/crossfilter/\">CrossFilter</a> is still mind-blowing\neven though no one really uses it any longer,\n<a href=\"https://kubernetes.io/\">Kubernetes</a> is…. insane.</p>\n<h3 id=\"i-have-covered-my-programming-principles-in-the-past-what-are-you-programming-principles\" style=\"position:relative;\">I have covered my <a href=\"https://nosleepjavascript.com/programming-principles/\">programming principles</a> in the past, what are you programming principles?<a href=\"#i-have-covered-my-programming-principles-in-the-past-what-are-you-programming-principles\" aria-label=\"i have covered my programming principles in the past what are you programming principles permalink\" class=\"header-anchor after\">#</a></h3>\n<ul>\n<li>Ergonomic</li>\n<li>Simple</li>\n<li>Forgiving</li>\n<li>Customizable</li>\n<li>Flexible</li>\n</ul>\n<h3 id=\"do-you-think-that-code-can-have-certain-art-like-traits\" style=\"position:relative;\">Do you think that code can have certain art-like traits?<a href=\"#do-you-think-that-code-can-have-certain-art-like-traits\" aria-label=\"do you think that code can have certain art like traits permalink\" class=\"header-anchor after\">#</a></h3>\n<p>It’s definitely an expression of creativity, but it’s more\nlike designing a custom tool. So in the same way\nI admire the design of say the <a href=\"https://www.kregtool.com\">Kreg Jig</a>\n(a woodworking tool), I can also admire the design\nof a tool. Not because it is beautiful or clean,\nbut because of the new abilities it gives me.</p>\n<h3 id=\"do-you-find-any-parallels-between-programming-and-other-craft-like-activities-outside-software\" style=\"position:relative;\">Do you find any parallels between programming and other craft-like activities outside software?<a href=\"#do-you-find-any-parallels-between-programming-and-other-craft-like-activities-outside-software\" aria-label=\"do you find any parallels between programming and other craft like activities outside software permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Wood working. I think both involve creative problem solving.</p>\n<blockquote>\n<p>franleplant’s note: I have been planing on writing about the many\nparallels I see between woodworking and programming but\nI’ve never finished finding the right way to put it,\nin fact I have like 5 or 6 written and audio drafts of it,\nlet me know if you are interested in my exploring this parallel\nin future posts.</p>\n</blockquote>\n<h3 id=\"how-does-your-day-look-like-how-is-your-life-work-balance\" style=\"position:relative;\">How does your day look like? How is your life-work balance?<a href=\"#how-does-your-day-look-like-how-is-your-life-work-balance\" aria-label=\"how does your day look like how is your life work balance permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Pre pandemic:</p>\n<ul>\n<li>Up at 5</li>\n<li>Train at 5:30</li>\n<li>Study and day prep</li>\n<li>At work at 6:30</li>\n<li>Startup (Nozzle) and interleaved OSS</li>\n<li>On the train at 4:30</li>\n<li>Home at 5:45</li>\n<li>Family Time</li>\n<li>Family asleep at 10</li>\n<li>Passion work until 11</li>\n<li>Sleep</li>\n</ul>\n<p>Post Pandemic:</p>\n<ul>\n<li>Up at 7</li>\n<li>Breakfast, study and day prep</li>\n<li>Desk at 8</li>\n<li>Startup (Nozzle) and interleaved OSS</li>\n<li>Lunch around 12 with the family</li>\n<li>Stop work at 5</li>\n<li>Family Time</li>\n<li>Family asleep at 10</li>\n<li>Passion work until 12/1</li>\n<li>Sleep</li>\n</ul>\n<p>I feel like I have a pretty awesome balance\nbecause my family is happy, my work is doing well, and I feel fulfilled.</p>\n<h3 id=\"i-saw-you-are-a-proud-member-of-the-church-of-jesus-christ-of-latter-day-saints-what-can-you-tell-us-about-that\" style=\"position:relative;\">I saw you are a proud member of “The Church of Jesus Christ of Latter-day Saints”, what can you tell us about that?<a href=\"#i-saw-you-are-a-proud-member-of-the-church-of-jesus-christ-of-latter-day-saints-what-can-you-tell-us-about-that\" aria-label=\"i saw you are a proud member of the church of jesus christ of latter day saints what can you tell us about that permalink\" class=\"header-anchor after\">#</a></h3>\n<p>I was raised in a religious family and I am very\ngrateful for it. I was faced with my own decision\nin my youth to either follow or reject what I had\ngrown up learning about and after losing my father\nearly on in life and finding peace through Christ\nand the teachings of his gospel through the\n<a href=\"https://www.churchofjesuschrist.org/\">Church of Jesus Christ of Latter Day Saints</a>,\nI decided I wanted to serve a full-time mission for\n2 years and share that same gospel with others.\nI served as official missionary and representative\nof Christ, spending anywhere between 6 weeks and 6\nmonths in various cities and towns across the\nstate of Santa Catarina in Brazil. It was life\nchanging and I was super grateful to be able to serve\nthe people there. I learned to love thousands of people\nthere as I would my family and aided them in coming to\nknow the gospel of Christ, developing faith in him,\nrepenting and witnessing a true change in their hearts\nand countenance, being baptized and receiving the gift\nof the Holy Ghost. I was even blessed to see many of\nthose individuals grow closer as families and eventually\nbe sealed for eternity as a heavenly family unit in one\nof Christ’s holy temples. All of this strengthened my\npersonal testimony as well that the Bible and Book of Mormon\nare inspired works of truth, that Christ lived,\nwas resurrected, and still guides his church today\nthrough Prophets and Apostles, preparing the world for his second coming.</p>\n<h3 id=\"what-is-faith-to-you-what-does-being-religious-mean-to-you\" style=\"position:relative;\">What is faith to you? What does being religious mean to you?<a href=\"#what-is-faith-to-you-what-does-being-religious-mean-to-you\" aria-label=\"what is faith to you what does being religious mean to you permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Faith is the hope and belief of things that we cannot\nor will not see, but feel are true. Faith is what\nkeeps me positive and helps me maintain my relationship\nwith Christ, in whom my faith is based. Being religious\nto me simply means allowing God to prevail in your life.\nIf you have a desire to do the things he would have you do,\nyou are definitely being “religious”. It means continuously\nrepenting and trying to be better to ourselves,\nour family, Christ and our Heavenly Father.</p>\n<h3 id=\"how-do-your-religious-values-and-practices-change-the-way-you-code-do-open-source-and-build-software-in-general\" style=\"position:relative;\">How do your religious values and practices change the way you code, do open source and build software in general?<a href=\"#how-do-your-religious-values-and-practices-change-the-way-you-code-do-open-source-and-build-software-in-general\" aria-label=\"how do your religious values and practices change the way you code do open source and build software in general permalink\" class=\"header-anchor after\">#</a></h3>\n<p>I believe in charity, the true love of Christ\nand this helps me every day to give more\nfreely of my time to help others, to be\nunderstanding and patient, even when others are not.</p>\n<h3 id=\"how-do-you-handle-your-mental-health-how-do-you-handle-anxiety-overthinking-dreaming-about-code\" style=\"position:relative;\">How do you handle your mental health? How do you handle anxiety, overthinking, dreaming about code?<a href=\"#how-do-you-handle-your-mental-health-how-do-you-handle-anxiety-overthinking-dreaming-about-code\" aria-label=\"how do you handle your mental health how do you handle anxiety overthinking dreaming about code permalink\" class=\"header-anchor after\">#</a></h3>\n<p>I recognize that it’s okay to burnout every now and then.\nIf you see it coming, you can prepare and recover more quickly.\nI don’t tend to overthink, but I do stress about non-programming\nthings, mostly around my family’s general well-being and relationships.</p>\n<h3 id=\"do-you-exercise\" style=\"position:relative;\">Do you exercise?<a href=\"#do-you-exercise\" aria-label=\"do you exercise permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Nope. I’ll pay for that later, I’m 100% sure.</p>\n<h3 id=\"what-are-the-most-important-soft-skills-developers-should-have-ie-good-oral--written-communication-emotional-intelligence-such-as-empathy-team-working-mentoring-learning-teaching-upwards-high-level-communication-handling-anxiety-meditation-etc\" style=\"position:relative;\">What are the most important soft skills developers should have? (i.e. good oral / written communication, emotional intelligence such as empathy, team working, mentoring, learning, teaching, upwards high level communication, handling anxiety, meditation, etc)<a href=\"#what-are-the-most-important-soft-skills-developers-should-have-ie-good-oral--written-communication-emotional-intelligence-such-as-empathy-team-working-mentoring-learning-teaching-upwards-high-level-communication-handling-anxiety-meditation-etc\" aria-label=\"what are the most important soft skills developers should have ie good oral  written communication emotional intelligence such as empathy team working mentoring learning teaching upwards high level communication handling anxiety meditation etc permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Yes. 😂</p>\n<h3 id=\"what-is-like-to-be-a-parent-how-does-that-affect-your-programming\" style=\"position:relative;\">What is like to be a parent? How does that affect your programming?<a href=\"#what-is-like-to-be-a-parent-how-does-that-affect-your-programming\" aria-label=\"what is like to be a parent how does that affect your programming permalink\" class=\"header-anchor after\">#</a></h3>\n<p>It’s harder to find as much time as I used to, but it\nforces me to prioritize more, learn faster, and ultimately\nget the same amount or more done as I did before.\ny children also serve as a wonderful inspiration\nand motivation for doing my best.</p>\n<h3 id=\"how-do-you-feel-about-the-massive-impact-your-libraries-have-in-so-many-companies-that-use-them\" style=\"position:relative;\">How do you feel about the massive impact your libraries have in so many companies that use them?<a href=\"#how-do-you-feel-about-the-massive-impact-your-libraries-have-in-so-many-companies-that-use-them\" aria-label=\"how do you feel about the massive impact your libraries have in so many companies that use them permalink\" class=\"header-anchor after\">#</a></h3>\n<p>I’m happy that they are able to use them.\nI wish I had something to show for it though.\nI do have a few sponsors who have graciously\ndecided to do just that. Thank you\n<a href=\"https://github.com/sponsors/tannerlinsley#sponsors\">sponsors</a>!\nBut it’s hard to see so many fortune 500\ncompanies use your stuff and never even\nreally say thanks. I realize that’s the risk\nyou run with open source software, so I don’t beat myself up about it.</p>\n<h3 id=\"what-do-you-like-about-the-open-source-community-how-do-you-handle-toxic-members-in-our-community\" style=\"position:relative;\">What do you like about the open source community? How do you handle toxic members in our community?<a href=\"#what-do-you-like-about-the-open-source-community-how-do-you-handle-toxic-members-in-our-community\" aria-label=\"what do you like about the open source community how do you handle toxic members in our community permalink\" class=\"header-anchor after\">#</a></h3>\n<p>The open source community is fun! I mostly enjoy talking\nand interacting with other maintainers or people who are\nequally as stressed or invested as I am. The other people\nI love talking with are the genuine fans and helpers\nwho aren’t necessarily massive impact generators by themselves,\nbut through their comments and small contributions,\nthey collectively help so much. Toxic members are not\nwelcome in my projects or communities. I have no trouble\nenforcing a code of conduct and bringing down the\nhammer when action needs to be taken. It can be hard,\nbut I feel it’s important to do this with a loving\nattitude as well and welcome those individuals\nback when they have had a change of heart.</p>\n<h3 id=\"how-do-you-balance-unpaid-work-and-paid-work\" style=\"position:relative;\">How do you balance unpaid work and paid work?<a href=\"#how-do-you-balance-unpaid-work-and-paid-work\" aria-label=\"how do you balance unpaid work and paid work permalink\" class=\"header-anchor after\">#</a></h3>\n<p>I have a startup that sustains most of my\nliving expenses. It was hard to get there through.\nWe had zero-to-little money for a very long time,\nbut are now doing well. As long as it’s mutually\nbeneficial to my work, I spend a bit of time on\nopen source. It then powers our own software,\nmakes it better, markets our company (usually as a sponsor)\nand also gives me more visibility, which I will ultimately\nuse to further my startups reach (or other projects in the future).</p>\n<h3 id=\"free-space-for-tanner-what-would-you-like-to-say\" style=\"position:relative;\">Free space for Tanner, what would you like to say?<a href=\"#free-space-for-tanner-what-would-you-like-to-say\" aria-label=\"free space for tanner what would you like to say permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Become a <a href=\"https://github.com/sponsors/tannerlinsley#sponsors\">sponsor on Github</a>\nor better yet <strong>convince your boss/company to become a sponsor!</strong>\nIf every user of my library donated $1 a month,\nI could build so much more and it would ensure\nthat my libraries stay free and up to date forever.</p>\n<p>Buy my <a href=\"https://learn.tanstack.com/\">React Query Essentials</a> course!</p>\n<p>Tell your marketing/SEO team to use <a href=\"https://nozzle.io/\">Nozzle.io</a>.\nI’ll give them a personal trial and make it worth their while!</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Wow! What a treat! Thank you so much Tanner for spending time talking with\nme, it is awesome to get to know someone that you have so much things in common\non the other side of the continent.</p>\n<p>Make sure you support Tanner’s work as well as this blog for more content like this,\nand let me know if you’d like more interviews like this in future posts.</p>","excerpt":"Welcome to the interview with React-Query’s creator Tanner Linsley,\nfeel free to jump around the questions through the Table of Contents…","fields":{"slug":"/interview-tanner-linsley/","readingTime":{"text":"13 min read"}},"frontmatter":{"title":"Interview with React Query's creator: Tanner Linsley","date":"December 18, 2020","description":"It is a pleasure to bring you a interview with Tanner Linsley, React Query creator, open source maintainer, dad, family man, religious man and so much more, let’s get to know him and see what he has to say about programming, open source and so much more.","tags":["react","react-query","redux","data-fetching","cache","react hooks"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<h2 id=\"tldr\" style=\"position:relative;\">TLDR<a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>I forked <a href=\"https://github.com/dollarshaveclub/postmate\">postmate</a> and called it <code class=\"language-text\">ibridge</code>.</li>\n<li>It uses <a href=\"https://www.typescriptlang.org/\">Typescript</a> and has cool features regarding type safety.</li>\n<li>I improved the semantics of <code class=\"language-text\">iparent.get</code>.</li>\n<li>I made the code simpler.</li>\n<li>I made both <code class=\"language-text\">ibridge.Parent</code> and <code class=\"language-text\">ibridge.Child</code> be Event Emitters for better composition.</li>\n<li>It has worked super fine!</li>\n</ul>\n<div style=\"text-align: center; margin-top: 60px;\">\n  <img src=\"https://raw.githubusercontent.com/twitter/twemoji/master/assets/svg/1f309.svg\" width=\"200\" alt=\"ibridge logo\">\n  <h3 style=\"text-align: center;\">ibridge</h3>\n  <p style=\"text-align: center; margin-top: -15px;\">\n    <small>logo by <a href=\"https://twemoji.twitter.com\">twemoji</a></small>\n  </p>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I have recently published <a href=\"https://www.npmjs.com/package/ibridge\">ibridge</a>, a tiny, typesafe, promise-based library\nfor bidirectional and secure <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe\">iframe</a> communication.</p>\n<ul>\n<li><a href=\"https://www.npmjs.com/package/ibridge\">npm</a></li>\n<li><a href=\"https://github.com/franleplant/ibridge\">repo</a></li>\n</ul>\n<h2 id=\"what-is-ibridge\" style=\"position:relative;\">What is ibridge<a href=\"#what-is-ibridge\" aria-label=\"what is ibridge permalink\" class=\"header-anchor after\">#</a></h2>\n<p>ibridge let’s you</p>\n<ul>\n<li>Retrieve data from the child to the parent.</li>\n<li>Implement complex communication flows between parent and child iframes.</li>\n<li>Pre establish a communication flow via a simple <strong>handshake</strong> <em>protocol</em>.</li>\n</ul>\n<h2 id=\"how-it-works\" style=\"position:relative;\">How it works<a href=\"#how-it-works\" aria-label=\"how it works permalink\" class=\"header-anchor after\">#</a></h2>\n<p><img src=\"/f146223321c4c8bcd11065864ede9b00/ibridge.svg\" alt=\"ibridge high level flow diagram\"></p>\n<ul>\n<li>ibridge is an abstraction on top of <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage\">postMessage</a>.</li>\n<li>Exposes <code class=\"language-text\">ibridge.Parent</code> and <code class=\"language-text\">ibridge.Child</code>, used by the parent and child document respectively.</li>\n<li>In here we call their instances <code class=\"language-text\">iparent</code> and <code class=\"language-text\">ichild</code> respectively.</li>\n<li>Both <code class=\"language-text\">Parent</code> and <code class=\"language-text\">Child</code> are <strong>event emitters</strong> implemented via <a href=\"https://www.npmjs.com/package/emittery\">Emittery</a>.</li>\n<li>Security is handled entirely by native <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors\">CSP headers</a>.</li>\n<li>At the initial phase it performs a <strong>handshake</strong> in which the Parent sends a special message to the child and waits for a special response.</li>\n</ul>\n<h3 id=\"remote-function-calls-from-parent-to-child-the-most-common-flow\" style=\"position:relative;\">Remote function calls from Parent to Child (the most common flow)<a href=\"#remote-function-calls-from-parent-to-child-the-most-common-flow\" aria-label=\"remote function calls from parent to child the most common flow permalink\" class=\"header-anchor after\">#</a></h3>\n<p>The Child is able to define a <code class=\"language-text\">Model</code> which is made off all the functions that\n<strong>live in the Child</strong> that can be called remotely by the Parent.</p>\n<p><code class=\"language-text\">Model</code> can be a trivially deeply nested object, and each Model function\ncan by sync or async, returning a resolved or rejected <code class=\"language-text\">Promise</code> that will be\nautomatically sent back to the Parent without any surprises. Return\nvalues and arguments can be anything that can serializable, plus, return\nvalues can be any <code class=\"language-text\">Promise</code> to a serializable value. Let’s see an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> resolvedValue <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> iparent<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"blog.analytics.getPageViews\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"page1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"page2\"</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>rejectedValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// handle errors</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Internally this means an event flow like the following:</p>\n<p><strong>1)</strong> parent to child</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">sendToChild</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span>\n  modelPath<span class=\"token operator\">:</span> <span class=\"token string\">\"blog.analytics.getPageViews\"</span><span class=\"token punctuation\">,</span>\n  arguments<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"page1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"page2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>2)</strong> child to parent</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> model<span class=\"token punctuation\">.</span>blog<span class=\"token punctuation\">.</span>analytics<span class=\"token punctuation\">.</span><span class=\"token function\">getPageViews</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"page1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"page2\"</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">sendToParent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token string\">\"GET-RESOLVE\"</span><span class=\"token punctuation\">,</span>\n    value<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sendToParent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token string\">\"GET-REJECT\"</span><span class=\"token punctuation\">,</span>\n    error<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This makes for a pretty standard and easy to understand model,\nthis thing that seems so intuitive was one of the main reasons\nI departed from the original implementation in <a href=\"https://github.com/dollarshaveclub/postmate\">postmate</a>, more on this later.</p>\n<p>If it feels natural or even dumb then I have succeeded.</p>\n<h3 id=\"free-form-communication\" style=\"position:relative;\">Free form communication<a href=\"#free-form-communication\" aria-label=\"free form communication permalink\" class=\"header-anchor after\">#</a></h3>\n<p>ibrigde also lets you build more complex bidirectional flows via high level events</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// Send events to the child</span>\niparent<span class=\"token punctuation\">.</span><span class=\"token function\">emitToChild</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> value<span class=\"token operator\">:</span> <span class=\"token string\">\"i am father\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// listen to events from the child</span>\niparent<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pong\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// listen to events from the parent</span>\nichild<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// send message to the parent</span>\n  ichild<span class=\"token punctuation\">.</span><span class=\"token function\">emitToParent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pong\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> value<span class=\"token operator\">:</span> <span class=\"token string\">\"i am child\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Internally ibridge has a single event listener for <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage\">postMessage</a> (the Dispatcher) in both\nthe Parent and the Child that will listen to valid ibridge messages\nand dispatch them as <a href=\"https://www.npmjs.com/package/emittery\">Emittery</a> events. This allows you to use higher level\nevent emitters abstractions such as <code class=\"language-text\">once</code>, <code class=\"language-text\">off</code>, <code class=\"language-text\">onAny</code>, etc.</p>\n<p>Fun fact, ibridge uses also <code class=\"language-text\">Emittery</code> for the handshake mechanism.</p>\n<h2 id=\"why-ibridge-was-created\" style=\"position:relative;\">Why ibridge was created<a href=\"#why-ibridge-was-created\" aria-label=\"why ibridge was created permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I have been designing and implementing an <code class=\"language-text\">sdk</code> to provide\nconsumers (other companies and services) to use our platform\n(let’s call it <strong>Platform A</strong>) from outside our own controlled domains.</p>\n<p>For different circumstances and limitations I can’t really state publicly\nwe ended up choosing an iframe based solution so that consumers (parent document)\ncould interact through high level abstract APIs with our platform (child document).</p>\n<p>This is similar to what other providers already do like Patreon (see link at the bottom),\nTwitter embedded tweets (see tweet below), etc.\nThis bypasses certain cross domain limitations by using an embedded document.</p>\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">React is slow, what now? <a href=\"https://t.co/y8cfBxFrEY\">https://t.co/y8cfBxFrEY</a></p>&mdash; franleplant (@franleplant) <a href=\"https://twitter.com/franleplant/status/1334960068392005638?ref_src=twsrc%5Etfw\">December 4, 2020</a></blockquote>\n<blockquote>\n<p><strong>DANGER ALERT</strong> iframes are a delicate topic since there are a lot of security\nconcerns present. Make sure you allow your page to be rendered inside an iframe\nby controlling the <code class=\"language-text\">Content-Security-Policy</code> HTTP header. Read <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors\">more in MDN</a>,\nand be sure to understand how the browser security model works related to iframes fully\nbefore launching to production.</p>\n</blockquote>\n<p>Since most of the work in building such <code class=\"language-text\">sdk</code> lies on building a good\nhigher level communication protocol between <code class=\"language-text\">parent</code> and <code class=\"language-text\">child</code> we started\nby using an already existing solution called <a href=\"https://github.com/dollarshaveclub/postmate\">postmate</a>, and it worked\nwell until it didn’t anymore. We tried hacking around it\nbut in the end the implementation was far too noisy because of some\ncore problems in <code class=\"language-text\">postmate</code>, that’s why I decided to fork it.</p>\n<h2 id=\"why-postmate-was-not-enough\" style=\"position:relative;\">Why Postmate was not enough<a href=\"#why-postmate-was-not-enough\" aria-label=\"why postmate was not enough permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I created <a href=\"https://github.com/dollarshaveclub/postmate/issues/211\">an issue</a> in Postmate’s repo to see if we can unify efforts eventually.</p>\n<p>These are the problems I found with Postmate that made me fork it:</p>\n<h3 id=\"wrong-semantics-for-code-classlanguage-textiparentgetcode\" style=\"position:relative;\">Wrong semantics for <code class=\"language-text\">iparent.get</code><a href=\"#wrong-semantics-for-code-classlanguage-textiparentgetcode\" aria-label=\"wrong semantics for code classlanguage textiparentgetcode permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Postmate doesn’t have good semantics for <code class=\"language-text\">.get</code>, in fact, if you call a child model\nthrough Postmate’s <code class=\"language-text\">.get</code> and that model throws then you won’t receive a failing promise in the\nparent, in fact that’s one of the main things we had to hack around internally and other’s have opened\n<a href=\"https://github.com/dollarshaveclub/postmate/issues/94\">issues and hacked around too</a>.</p>\n<p>One of our main use cases, and when you think about it, it’s probably the main use case for a lot of\nusers; was and is to remotely call functions that live in the child and get the resolved or rejected values\nwith that same semantics in the Parent so we can report back to the parent’s consumer.</p>\n<blockquote>\n<p><strong>ibridge</strong> gives better semantics to <code class=\"language-text\">.get</code> by making it a deconstructed remote function call that handles\nreturn values and errors thrown in ways that feel natural, hiding the underlying mechanisms completely.</p>\n</blockquote>\n<h3 id=\"wrong-semantics-and-name-for-code-classlanguage-textiparentcallcode\" style=\"position:relative;\">Wrong semantics and name for <code class=\"language-text\">iparent.call</code><a href=\"#wrong-semantics-and-name-for-code-classlanguage-textiparentcallcode\" aria-label=\"wrong semantics and name for code classlanguage textiparentcallcode permalink\" class=\"header-anchor after\">#</a></h3>\n<p>On first read one might think that <code class=\"language-text\">iparent.call</code> is the main way of remote calling model functions\nin the child from the parent but is actually not, it just a way of <strong>calling model functions\njust for the side effects</strong>.</p>\n<p>This makes no sense, we already can cover that with <code class=\"language-text\">.get</code>, if the consumer doesn’t care\nabout the model’s return function then it simply can be omitted. This is exactly how\nwe handle function calls in regular programs. If we do not care about their return value\nwe just call them for their side effects with the same mechanism we call them when we do care\nabout their return values <em>or errors</em>.</p>\n<p>Another use case for <code class=\"language-text\">.call</code> can be simply <strong>emitting events</strong> to the child, but it doesn’t have\na good name to reflect that and being strictly related to child model functions not always\nfits the flow users have in mind.</p>\n<blockquote>\n<p><strong>ibridge</strong> doesn’t have <code class=\"language-text\">.call</code> and instead you simply can <code class=\"language-text\">iparent.emitToParent</code> and we also provide\nthe opposite: <code class=\"language-text\">ichild.emitToChild</code> and everything is abstracted by relying on <code class=\"language-text\">Emittery</code> as much as possible.</p>\n</blockquote>\n<h3 id=\"the-model-implementation-is-just-too-simplistic\" style=\"position:relative;\">The Model implementation is just too simplistic<a href=\"#the-model-implementation-is-just-too-simplistic\" aria-label=\"the model implementation is just too simplistic permalink\" class=\"header-anchor after\">#</a></h3>\n<p>We very early found ourselves hoping to be able to call deeply nested Model functions\nbut found that postmate only accepted model keys, this means that\nyou need to collapse all your model functions into a single shallow object.</p>\n<p>This is too simplistic and prevents users from building more complex\nmodel structures.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">iparent<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"blogPostsGetPageViews\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// child model</span>\n<span class=\"token keyword\">const</span> model <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">blogPostsGetPageViews</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/*...*/</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p><strong>ibridge</strong> allows <code class=\"language-text\">.get</code> to accept a lodash’s <code class=\"language-text\">path</code> to the model, by relying on <a href=\"https://lodash.com/docs/4.17.15#get\">lodash.get</a>.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">iparent<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"blog.posts.getPageViews\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// child model</span>\n<span class=\"token keyword\">const</span> model <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  blog<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    posts<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">getPageViews</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/*...*/</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"model-context\" style=\"position:relative;\">Model context<a href=\"#model-context\" aria-label=\"model context permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Another thing we find ourselves wanting was the capability of providing a simple\nModel context that could be accessible to all model functions should they need to.</p>\n<p>With Postmate you need to roll out your own implementation, but there’s a really easy\nway of providing a simple context implementation without letting the user roll\nout their own implementation.</p>\n<blockquote>\n<p><code class=\"language-text\">ibridge</code> provides an easy way of passing <code class=\"language-text\">context</code> to all Model functions.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">myModel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span> IContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// accessible via this</span>\n  <span class=\"token keyword\">return</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"debugging\" style=\"position:relative;\">Debugging<a href=\"#debugging\" aria-label=\"debugging permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Postmate used a simplistic approach based on an <code class=\"language-text\">env</code> variable and a bunch of <code class=\"language-text\">if</code> statements.\nThis wasn’t ideal since it didn’t work always as expected, required bundler configuration, and the handling was way to manual.</p>\n<blockquote>\n<p><code class=\"language-text\">ibridge</code> uses <a href=\"https://www.npmjs.com/package/debug\">debug</a> for a more structured way of configuring and outputting debug / logs.\nCheck the docs for more information.</p>\n</blockquote>\n<p>Example of enabling verbose output.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// you might need to do this in the child document too</span>\n<span class=\"token comment\">// check the `storage` dev tools tab.</span>\n\nlocalStorage<span class=\"token punctuation\">.</span>debug <span class=\"token operator\">=</span> <span class=\"token string\">\"ibridge:*\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This will output a <em>lot</em> of information that should make it really easy to debug the workings\nof any consumer of the lib and the lib it self.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.43243243243244%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAChUlEQVQ4y32UZ3LbQBSDdZLYYdleWJakClVt3/9ICHapZDIZRz+eqJHETwAelrsmalTngGaKMP0Vpluh+jOaLqGyElVVoa5qNE1TRrQt2hezU07BzRo6dbDpC3Z4wE6fcNMBzigYa6GtQSsFhBBo87wCtlTYnj3ETOD4BUOgm75wuD5wuX5iXT8QlgPVEtS8VleAkTbOP98wSgczfhbbOq7o0hXD/oFoRzg/YBgHpJSwLAuClBvgG7UFeKreMagM/Nhy5KjuDBtO8KaDsh1MSLBxRpSqWP/fFOD6nhVa2r0zwxvnDk2g8XsEYSB1gFIWir/NKl4CnWyRVI1gN8vWL/C6g4sj+mGi/R7CxgLUT5uizVa/X86u7g3e7xH1vn8uher6FTGdkZihmU9oXYBUHNtDuQGN5yLb5gXw0aE+PIHjDSqdePOExiSYOBGeCGUTpIFQeSz/wPGqqPgfoDYSrmffoucybtDhwOsFw3zBdLijj3van6Ei4dy2LkuiUkul7GcjnxE8N74LdYPj2xt6wYxyZcK+QH1/QpyuhB2plrCwYJyOzDcUpdpYBM97mu0U5Y7mU7QTPClisRBD2BTGE1Q4op8u2J/uLDmBYWR2iTMWZYrd1FTrfQ9D6957/qku9nd1Z/Dj3qHax60uBG5dvLA6KwILno4PyHGBMAOkn58ujsy142cEur+Ani+zqBD5hfkNZAdHZjgf7+g8q1MUJUQ+MKzmzdpBmgzLkOaP5ZKhy0BZb8B8UqgqlzpON0zHL7i0QsalZNjxvadtobhA6zHGAJszfFaoZFjx4fB2DajmnOG92MwZhnQpKm3aHmeKp0a6hdteNxd0kz9TdLBfeE0BNcX9Avzv5ab6o9F4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"example debug output\"\n        title=\"example debug output\"\n        src=\"/static/5536f32ca293c6e29f763d29acc360a1/fcda8/logs.png\"\n        srcset=\"/static/5536f32ca293c6e29f763d29acc360a1/12f09/logs.png 148w,\n/static/5536f32ca293c6e29f763d29acc360a1/e4a3f/logs.png 295w,\n/static/5536f32ca293c6e29f763d29acc360a1/fcda8/logs.png 590w,\n/static/5536f32ca293c6e29f763d29acc360a1/efc66/logs.png 885w,\n/static/5536f32ca293c6e29f763d29acc360a1/c83ae/logs.png 1180w,\n/static/5536f32ca293c6e29f763d29acc360a1/161ec/logs.png 1840w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"typescript\" style=\"position:relative;\">Typescript<a href=\"#typescript\" aria-label=\"typescript permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Finally ibridge uses Typescript, this let us express certain things\nsuch as that the Child is generic for <code class=\"language-text\">TModel</code> and <code class=\"language-text\">TContext</code> and so\nyou can have better validations in terms of type safety.</p>\n<p>Additionally I am a big fan of Typescript and the guarantees it provides so\nI basically do nothing without Typescript.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Postmate is a great library that was in need for a little bit of love.\nI am open to unifying efforts with the Postmate team so that we can\nhave a single version of this library with all the benefits that <strong>ibridge</strong>\nbrings to the table.</p>\n<p>I will also try to give <strong>ibridge</strong> more support, if you are interested\nin helping me maintain it let me know!</p>\n<hr/>\n<p>Like the content? Consider subscribing, buying me a coffee or even becoming a Patreon below.</p>","excerpt":"TLDR I forked postmate and called it . It uses Typescript and has cool features regarding type safety. I improved the semantics of . I made…","fields":{"slug":"/ibridge/","readingTime":{"text":"9 min read"}},"frontmatter":{"title":"Breaking the iframe frontier: ibridge","date":"December 11, 2020","description":"Introducing ibridge, a tiny, typesafe, promise-based library for bidirectional and secure iframe communication.","tags":["ibridge","typescript","javascript","iframe","postMessage","event emitter","Emittery","jsdom"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<h2 id=\"tldr-the-gist\" style=\"position:relative;\">TLDR: the gist<a href=\"#tldr-the-gist\" aria-label=\"tldr the gist permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>Measure performance! If you don’t measure it’s the same as doing nothing.</li>\n<li>You can optimize your React performance by improving <strong>what</strong> (🤔) and <strong>which</strong> (🧙) components render.</li>\n<li>\n<p>🧙 To improve <strong>which</strong> component renders you can use</p>\n<ul>\n<li><code class=\"language-text\">React.memo</code></li>\n<li><code class=\"language-text\">useCallback</code></li>\n<li><code class=\"language-text\">useMemo</code></li>\n<li>Make sure your props have stable references</li>\n<li>Virtualization</li>\n</ul>\n</li>\n<li>\n<p>🤔 To improve <strong>what</strong> components render you should</p>\n<ul>\n<li>identify the slow components</li>\n<li>simplify, use more efficient abstractions, make smaller trees, etc</li>\n</ul>\n</li>\n</ul>\n<p>If this got your attention read on:</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\">Table of Contents<a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#tldr-the-gist\">TLDR: the gist</a></li>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li>\n<p><a href=\"#io-performance-problems-in-react\">io performance problems in React</a></p>\n<ul>\n<li><a href=\"#potential-solutions\">Potential solutions</a></li>\n</ul>\n</li>\n<li><a href=\"#cpu-performance-problems-in-react\">CPU performance problems in React</a></li>\n<li><a href=\"#react-render-and-commit-phase\">React render and commit phase</a></li>\n<li>\n<p><a href=\"#measuring\">Measuring</a></p>\n<ul>\n<li><a href=\"#chrome-dev-tools-performance-tab\">Chrome dev tool’s Performance tab</a></li>\n<li><a href=\"#react-dev-tools-performance-tab\">React dev tool’s Performance tab</a></li>\n<li><a href=\"#measuring-1\">Measuring</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#general-solutions-to-cpu-bound-problems-in-react-applications\">General solutions to cpu-bound problems in React applications</a></p>\n<ul>\n<li><a href=\"#-improving-what-components-render\">🤔 Improving <em>what</em> components render</a></li>\n<li>\n<p><a href=\"#%F0%9F%A7%99-improving-which-components-render\">🧙 Improving <em>which</em> components render</a></p>\n<ul>\n<li><a href=\"#virtualization\">Virtualization</a></li>\n<li>\n<p><a href=\"#props-optimization\">Props Optimization</a></p>\n<ul>\n<li><a href=\"#reactmemo\"><code class=\"language-text\">React.memo</code></a></li>\n<li><a href=\"#fake-prop-changes-usecallback\">Fake prop changes: <code class=\"language-text\">useCallback</code></a></li>\n<li><a href=\"#fake-prop-changes-usememo\">Fake prop changes: <code class=\"language-text\">useMemo</code></a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#summary\">Summary</a></p>\n<ul>\n<li><a href=\"#props-changed\">Props changed</a></li>\n<li><a href=\"#parent-rendered\">Parent rendered</a></li>\n<li><a href=\"#hooks-changed-state-context\">Hooks changed (state, context)</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#closing\">Closing</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p>In general computer programs can be:</p>\n<ul>\n<li><strong>io-bound</strong>: spend most of their time making inputs and outputs</li>\n<li><strong>cpu-bound</strong>: spend most of their time making calculations</li>\n</ul>\n<p>And how do these translate into Front End apps and in particular React apps?</p>\n<h2 id=\"io-performance-problems-in-react\" style=\"position:relative;\">io performance problems in React<a href=\"#io-performance-problems-in-react\" aria-label=\"io performance problems in react permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>Browser apps can be <strong>io-bounded</strong> mostly in terms of asynchronous http calls.</li>\n<li>a poor management of these network requests can slow down your app</li>\n</ul>\n<h3 id=\"potential-solutions\" style=\"position:relative;\">Potential solutions<a href=\"#potential-solutions\" aria-label=\"potential solutions permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Although this will not be the focus of this post let’s quickly cover some\nimportant areas where solutions and improvements might be found for io-bound\nproblems:</p>\n<ul>\n<li>lazy load as much as you can.</li>\n<li>careful with the initial load of assets and also backend requests.</li>\n<li>reduce the amount of times you load highly static stuff (select options, configurations, etc)</li>\n<li>debounce the amount of times you make certain requests.</li>\n<li>parallelize request as much as possible via <code class=\"language-text\">Promise.all</code>.</li>\n<li>make your critical BE endpoints more efficient (i.e. by tweaking DB accesses and such).</li>\n</ul>\n<h2 id=\"cpu-performance-problems-in-react\" style=\"position:relative;\">CPU performance problems in React<a href=\"#cpu-performance-problems-in-react\" aria-label=\"cpu performance problems in react permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>This is going to be the main focus of this post.</p>\n</blockquote>\n<p>Before talking about performance we need to define it in a more concrete way:</p>\n<ul>\n<li>browser apps are <a href=\"https://stackoverflow.com/questions/30932870/why-doesnt-javascript-get-its-own-thread-in-common-browsers\">single thread</a> programs for the most part.</li>\n<li>scripting, i.e. Javascript, DOM rendering, event handling, etc; all run in the same thread.</li>\n<li>if a Javascript module is slow it can block the main thread.</li>\n<li>if the main thread is blocked then the UI will seem unresponsive (<strong>fps</strong> will drop).</li>\n<li>unresponsive UIs are one of the worst offenders in terms of <strong>User Experience</strong>.</li>\n</ul>\n<p>This all boils down to the concept of <code class=\"language-text\">fps</code> or <strong>Frames Per Second</strong>.\nResponsive UIs will deliver a minimum of 30 fps or more ideally 60 fps, this means\nthat every frame of your app, even the more demanding code paths, should compute in <strong>30 ms or less</strong>.</p>\n<blockquote>\n<p>If your Javascript is slow it might cause “frames to be dropped” which means\ncomputing a frame in more than 30 ms.</p>\n</blockquote>\n<p>To fully understand how this applies to React we need to understand how React works\nand what React’s <strong>render and commit phase</strong> are but in short we can say that:</p>\n<blockquote>\n<p>If a React component update is triggered then the <strong>entire sub tree needs to be\nrendered in less than 30ms</strong>.</p>\n</blockquote>\n<p>This becomes specially problematic when you have complex and long component structures\nsuch as Tables, Trees and Lists and in which sometimes (for example the first time) you will\nneed to re render large parts of them.</p>\n<blockquote>\n<p><strong>Summary:</strong> we should figure out which expensive interactions are dropping frames,\nmeasure them to confirm and fix them.</p>\n</blockquote>\n<h2 id=\"react-render-and-commit-phase\" style=\"position:relative;\">React render and commit phase<a href=\"#react-render-and-commit-phase\" aria-label=\"react render and commit phase permalink\" class=\"header-anchor after\">#</a></h2>\n<p>React works (at a high level) in two phases</p>\n<p><strong>Render phase:</strong></p>\n<ul>\n<li>Happens when a component updates i.e. props or hooks changed.</li>\n<li>React traverses the component sub tree rendering each child and computing the virtual DOM (VDOM) sub tree.</li>\n<li>Only the “dirty” sub tree needs to be recomputed i.e. the updated component parents might not need to be re rendered.</li>\n<li>This phase is proportional to the size of the sub tree being rendered.</li>\n<li>This phase is also proportional to how expensive it is to compute each child component.</li>\n<li>We can give React hints to make this process more efficient i.e. <code class=\"language-text\">React.memo</code>.</li>\n</ul>\n<p><strong>Commit phase:</strong></p>\n<ul>\n<li>The render phase outputs a new virtual DOM of the entire UI.</li>\n<li>In the commit phase Reacts compares the new tree with the previous one (VDOM diffing).</li>\n<li>React calculates the minimum DOM mutations needed to reflect the new VDOM tree.</li>\n<li>React mutates the DOM.</li>\n<li>Your UI is now updated.</li>\n<li>This phase is pretty efficient by default.</li>\n</ul>\n<p>This whole process needs to happen in less than 30 or 16 ms (30 fps and 60 fps respectively) for your UI to be considered\nresponsive, as you can see there’s a lot of work and that work is proportional to the size of your app.</p>\n<p>We will explore ways to make mostly the <strong>Render phase</strong> more efficient but first let’s discuss\nhow to measure and how to find out what are the slow parts of our app and how bad they are.</p>\n<h2 id=\"measuring\" style=\"position:relative;\">Measuring<a href=\"#measuring\" aria-label=\"measuring permalink\" class=\"header-anchor after\">#</a></h2>\n<p>In 2020 we have pretty solid tools for measuring browser side performance, these\nare the ones I use the most:</p>\n<ul>\n<li>Chrome dev tool’s Performance tab.</li>\n<li>React dev tool’s Performance tab.</li>\n</ul>\n<h3 id=\"chrome-dev-tools-performance-tab\" style=\"position:relative;\">Chrome dev tool’s Performance tab<a href=\"#chrome-dev-tools-performance-tab\" aria-label=\"chrome dev tools performance tab permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This is the most comprehensive tool, it is useful for any browser application,\nit measures frames per second, records stack traces, identifies slow / hot parts of your code,\nand much more. The main UI is the <a href=\"http://www.brendangregg.com/flamegraphs.html\">flame chart</a>.</p>\n<p>Here’s a <a href=\"https://reactjs.org/docs/optimizing-performance.html#profiling-components-with-the-chrome-performance-tab\">good doc</a>\nof Chrome’s Performance Tab applied to React.</p>\n<h3 id=\"react-dev-tools-performance-tab\" style=\"position:relative;\">React dev tool’s Performance tab<a href=\"#react-dev-tools-performance-tab\" aria-label=\"react dev tools performance tab permalink\" class=\"header-anchor after\">#</a></h3>\n<p>You need to install the <a href=\"https://reactjs.org/blog/2019/08/15/new-react-devtools.html\">React dev tool extension</a> in your browser.</p>\n<p>It specializes the information in the Chrome dev tool’s Performance tab to\nReact. You can see the different <strong>commit phases</strong> and the Javascript code that was run in its respective\n<strong>render phase</strong> through a <strong>flame chart</strong>.</p>\n<p>Through this tool you can easily find out:</p>\n<ul>\n<li>when a component re renders</li>\n<li>what props changed</li>\n<li>what hooks changed i.e. state, context, etc.</li>\n</ul>\n<p>Check the <a href=\"https://reactjs.org/blog/2018/09/10/introducing-the-react-profiler.html\">introductory post</a> for more information.</p>\n<h3 id=\"measuring-1\" style=\"position:relative;\">Measuring<a href=\"#measuring-1\" aria-label=\"measuring 1 permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This is the <strong>methodology</strong> I like to use when measuring front end applications:</p>\n<ul>\n<li><strong>identify the problem</strong>: identify page interactions that make the UI feel unresponsive.</li>\n<li><strong>create a hypothesis</strong>: optionally, we might have some ideas where the problem might be.</li>\n<li><strong>measure</strong>: verify the problem by measuring and looking at important metrics such as <strong>fps</strong>.</li>\n<li><strong>measure</strong>: identify problematic pieces of code, optionally: validate your hypothesis.</li>\n<li><strong>create a solution</strong>: apply a solution based off the previous steps</li>\n<li><strong>measure the solution</strong>: validate that the problem has been resolved or alleviated by looking at the important metrics.</li>\n</ul>\n<blockquote>\n<p>If you optimize something without measuring then you are practically doing nothing.</p>\n</blockquote>\n<p>There might be cases where the problem is super obvious and I won’t tell you that going straight\nto fixing it is naturally bad, but most of the problems are not obvious and measuring will be\ncornerstone of the performance improvement process.</p>\n<p>Additionally, if you measure you can later tell your users, stakeholders and more importantly your <strong>boss\nthat you have improved the performance of a given area of your app by x%</strong> which is always a good\nway of communicating upwards what we accomplish inside the rabbit hole.</p>\n<h2 id=\"general-solutions-to-cpu-bound-problems-in-react-applications\" style=\"position:relative;\">General solutions to cpu-bound problems in React applications<a href=\"#general-solutions-to-cpu-bound-problems-in-react-applications\" aria-label=\"general solutions to cpu bound problems in react applications permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Now that we have measured and identified the problematic areas let’s cover\npotential solutions.</p>\n<blockquote>\n<p>You can optimize your React performance by\nimproving <strong>what</strong> components render and\n<strong>which</strong> components render.</p>\n</blockquote>\n<h3 id=\"-improving-what-components-render\" style=\"position:relative;\">🤔 Improving <em>what</em> components render<a href=\"#-improving-what-components-render\" aria-label=\" improving what components render permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Identifying the slow parts of our React app will usually\npoint out to some particular components that are slow to render\n(or that have too many instances in a single page, more on this in the <strong>which</strong> section).</p>\n<p>There might be a number of reasons those components are slow, including:</p>\n<ul>\n<li>they do blocking calculations</li>\n<li>they render large trees</li>\n<li>they use expensive / non efficient libraries</li>\n</ul>\n<p>Most of these boil down to improving how fast your components render,\nsometimes critical components cannot rely on too complicated libraries\nand so you need to go back to basic and roll your own simpler implementation.</p>\n<p>I have experienced something like this when using <a href=\"https://formik.org/\">Formik</a> (which I love)\nor should I say abusing Formik on several cells of every single row of a complex table.</p>\n<p>You can go a long way making your components more efficient but eventually you will need\nto focus on <strong>which</strong> components render:</p>\n<h3 id=\"🧙-improving-which-components-render\" style=\"position:relative;\">🧙 Improving <em>which</em> components render<a href=\"#%F0%9F%A7%99-improving-which-components-render\" aria-label=\"🧙 improving which components render permalink\" class=\"header-anchor after\">#</a></h3>\n<p>There are two broad categories where we can improve this aspect:</p>\n<ul>\n<li>Virtualization</li>\n<li>Prop optimization</li>\n</ul>\n<h4 id=\"virtualization\" style=\"position:relative;\">Virtualization<a href=\"#virtualization\" aria-label=\"virtualization permalink\" class=\"header-anchor after\">#</a></h4>\n<p>It means <strong>only render what is visible in the viewport</strong>, i.e. only render the\ntable rows that the user can see or the list items the user can see.</p>\n<p>This is great because it can be applied to complex UIs without going through the <strong>what</strong> step,\nalthough I recommend it; and modern libraries tend to have decent support for virtualizing\nyour tables and lists. A good example of this is <a href=\"https://github.com/bvaughn/react-virtualized\">react-virtualized</a>.</p>\n<blockquote>\n<p>Virtualizing means that we <strong>reduce the amount of components React needs to render in a given frame</strong>.</p>\n</blockquote>\n<h4 id=\"props-optimization\" style=\"position:relative;\">Props Optimization<a href=\"#props-optimization\" aria-label=\"props optimization permalink\" class=\"header-anchor after\">#</a></h4>\n<p>React tries to make your components look like pure functions but still will try to render\nmore times than it should.</p>\n<h5 id=\"code-classlanguage-textreactmemocode\" style=\"position:relative;\"><code class=\"language-text\">React.memo</code><a href=\"#code-classlanguage-textreactmemocode\" aria-label=\"code classlanguage textreactmemocode permalink\" class=\"header-anchor after\">#</a></h5>\n<p>Most components in React can be <strong>memoized</strong>, which means that they do not have internal side effects\nor depend on any external side effects so that we can guarantee than <strong>with the same props the component\nwill return the same tree</strong> (hooks, state and context are still respected though).</p>\n<p>For that we can use <a href=\"https://reactjs.org/docs/react-api.html#reactmemo\">React.memo</a>.\nThis tells React to skip re rendering these memoized components if their\nprops didn’t change.</p>\n<h5 id=\"fake-prop-changes-code-classlanguage-textusecallbackcode\" style=\"position:relative;\">Fake prop changes: <code class=\"language-text\">useCallback</code><a href=\"#fake-prop-changes-code-classlanguage-textusecallbackcode\" aria-label=\"fake prop changes code classlanguage textusecallbackcode permalink\" class=\"header-anchor after\">#</a></h5>\n<p>Additionally we have the problem of <strong>fake prop changes</strong> which means that although\nthe content of a given prop didn’t change, the reference did. The most classic example\nof this is the event handler one:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>input onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onChange<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">onChange</code> callback, although semantically and content wise will be the same on every render, will be\nbe stored in a completely separate memory direction so React will detect it as different from the previous one.</p>\n<p>This is related to how <code class=\"language-text\">React.memo</code> does shallow comparison by default (although there’s no good way of\ndeeply comparing functions in Javascript AFAIK).</p>\n<p>An easy fix for this is to use <code class=\"language-text\">useCallback</code> which was designed exactly for this:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> onChange <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>input onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onChange<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5 id=\"fake-prop-changes-code-classlanguage-textusememocode\" style=\"position:relative;\">Fake prop changes: <code class=\"language-text\">useMemo</code><a href=\"#fake-prop-changes-code-classlanguage-textusememocode\" aria-label=\"fake prop changes code classlanguage textusememocode permalink\" class=\"header-anchor after\">#</a></h5>\n<p>A similar problem can rise when building complex data structures and not memoizing them\ncorrectly before passing them as props.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rows <span class=\"token operator\">=</span> data\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>bySearchCriteria<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span>bySortOrder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Table data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>rows<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This means that on every render we are re creating the <code class=\"language-text\">rows</code> array, and although\nthe content might not change, the shallow compare with the previous version will mark\nit as different. To solve this React provides <code class=\"language-text\">useMemo</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rows <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> data<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>bySearchCriteria<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span>bySortOrder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>deps<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Table data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>rows<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This will ensure rows are only recalculated when the dependencies change (most likely props or state).</p>\n<p>You can also customize the way <code class=\"language-text\">React.memo</code> compares current vs previous props but be aware that this\ncalculation should be fast since it is effectively part of the <strong>Render phase</strong> and you probably\ndon’t want to perform trivially nested deep comparisons on every render.</p>\n<h3 id=\"summary\" style=\"position:relative;\">Summary<a href=\"#summary\" aria-label=\"summary permalink\" class=\"header-anchor after\">#</a></h3>\n<p>The React profile is really good at telling you why a given component rendered out of\nthe three main options. Let’s cover each option and potential paths of improvements</p>\n<h4 id=\"props-changed\" style=\"position:relative;\">Props changed<a href=\"#props-changed\" aria-label=\"props changed permalink\" class=\"header-anchor after\">#</a></h4>\n<p>How it looks in the React dev tool:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 374px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43f3e9b7af652229f54cc30dd90a81de/52dba/propsChanged.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADCUlEQVQ4y6WS32tTdxTA718iQ9km6gZWRRDZ9GUw2JOlRWYRRNCKe9+DsgfxQdwP6hxjlDEs2tKt0bRWG02bYH8YU2vSm3tvYmaa/krSJO3Nz5smbbV+dm5qrXtwL3v4cL7nx/d8z/meo3zh6KZNV7ke0fk5HBI02gyVn0IBflSfCYH/5AeJuaYFueAf42DnDZTzXjfFQoEXU1PMJ5PMzs+RWVxkeaXGyss1amurwtp7qYp/ff0V8UKeI392onwzPkZMktx09HD5+6vcEnm9vZ2/E/NYr9fJSeL86soWa/8mJzZLHtbzJkfvO1HOuO5RrFaJpVKE43FiyQTh6WmmRJ/NZpnJZERm6nKL9NtzPJ1mwTTRJeZIZwdK67BHEi6TyOXIlEuki0UWKxbJfF5s5ltS0lJKvmahuIF9trHjzHIZI7fE0T4HyrkRL2m5MDQ2SrfTiefxGE91jcGREfzqJF23HQyOjtDvduPov8ujJ09ImEsUpdXCGyrSsiE5Pu/tQbk40MNyrUpagpLSSt4qkxHnklRhlgpkzCxW1SIrFdi2fKVMWeJXeU1BOslJV/YA49kUre1XUK4FvUzPTPPLb79y49ZNRv0+XINu2v/4nTt3++jq7qKvv5eJyQC99/px9DrpkDinVHv/4QPmFpKsSoUJc4FLjjaU7/7qwJSKJkMqWtjAP/GUcPQ5o77HGNEImqERkj19MRVDla8YfzZR9wXkO2ZlgKVlixVZnXhyjtYr36J83XIay7KIy4T9/nEMw0DTNBKJBLquo6pqXQ+HwwSDQaLRKKVSiVgsJnadSCTCjGyFrhvs3X8Y5eSps+RkwvZl+8LQ0BBuGUAoFCIg+vDwMB6PB5fLxcDAAIFAgIysi8/nw+v1ShH++mORyHP2HfwM5fiJU1QqlfqrdqVlWQEbW9+0bfo3ZV5WxY6xfUVZs1qtxqQaYu8BqfDThkMcazrBseaWDdnUsoHojc1vzmJvbN6S79ptmo6f5MuvGvl49z6Uj3Y1sG3HbrZt/z/s4oMPP2Hnnv38A1tXgPLnneP5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"props changed in react dev tool\"\n        title=\"props changed in react dev tool\"\n        src=\"/static/43f3e9b7af652229f54cc30dd90a81de/52dba/propsChanged.png\"\n        srcset=\"/static/43f3e9b7af652229f54cc30dd90a81de/12f09/propsChanged.png 148w,\n/static/43f3e9b7af652229f54cc30dd90a81de/e4a3f/propsChanged.png 295w,\n/static/43f3e9b7af652229f54cc30dd90a81de/52dba/propsChanged.png 374w\"\n        sizes=\"(max-width: 374px) 100vw, 374px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Did they really? Are they <code class=\"language-text\">fake prop changes</code>? Use <code class=\"language-text\">useCallback</code> and <code class=\"language-text\">useMemo</code>.</p>\n<h4 id=\"parent-rendered\" style=\"position:relative;\">Parent rendered<a href=\"#parent-rendered\" aria-label=\"parent rendered permalink\" class=\"header-anchor after\">#</a></h4>\n<p>How it looks in the React dev tool:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 468px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebb58cb61db4a6c158db12d038b954d3/90372/parentRendered.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACTklEQVQoz2WRS28SYRSG+TkmmphUIzv9DU2MG9SaWBN/hZvGhYkbF9YL2jbQiFxqoAQSLAFLGC7DZYACM9zvhXIZrhpdmNfzfQXbpIsn55w3Z86853ya1+Y3kLLfcBg5hFX0wB11wBFx4mvIBU/CBV/cjlj6AEfCF9gFG/b9B3AKVvgFI9yCGU7fHmr+F2gGtyDur0PzdluPVCoDKSEhGo4glUwREvLZHI5/HOPouxe5rIzRUMVitsB8OseMs+BxTtpk9gu///zFA90zGvjuIyKRMAxGI3Z2d2F3ODgutxsWqxVmsxkOqmu1GrrdLjqdDjqnp8QyUt1utzAZq3i0sckG6rFYLNDt9aCOxxgOhzzvdnsYjVRO7+wMzWYLjUYTjeZV6vU6VFXFww1yuP3+E+r090AgAEEQIEkSEokE0uk0fD4fRFHkzZPJ5D+svsxoNOKmdI83zweyVZLJJEqlErLZLCqVChRFQS6X41q73Uar1SKXTR7ZFgPGYMDp9/uYz+fnAz/od+D1emEwGODxeGCxWOCm+61uFwwGYbPZeG0ymRCPxzGbzbjT6XTKGY8n+HnhUE+3aSCTOUGhUODI5K5cLqNarUKWZULhukIwx+yBCsUi34Dp+Xyeu+Y31H/eI9t9hMNhWjuBcCjEX/0kk+HrR6NR7lIUo4jFRH5Tdo6Vzr5jt2cDnzx9Ds3Wy1f0Sg3k8jL9idwo5IRgrpjG82UtL/M85cqyb9VbKBSxfl8HzfWbWtzS3sPanbsUCYo8v1RfQXvRs3ZJv3bjNv4BK9jG8ma+sMUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"parent rendered in react dev tool\"\n        title=\"parent rendered in react dev tool\"\n        src=\"/static/ebb58cb61db4a6c158db12d038b954d3/90372/parentRendered.png\"\n        srcset=\"/static/ebb58cb61db4a6c158db12d038b954d3/12f09/parentRendered.png 148w,\n/static/ebb58cb61db4a6c158db12d038b954d3/e4a3f/parentRendered.png 295w,\n/static/ebb58cb61db4a6c158db12d038b954d3/90372/parentRendered.png 468w\"\n        sizes=\"(max-width: 468px) 100vw, 468px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Use <code class=\"language-text\">React.memo</code> to memoize your <em>pure</em> components.</p>\n<h4 id=\"hooks-changed-state-context\" style=\"position:relative;\">Hooks changed (state, context)<a href=\"#hooks-changed-state-context\" aria-label=\"hooks changed state context permalink\" class=\"header-anchor after\">#</a></h4>\n<p>How it looks in the React dev tool:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 349px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/58291fd55b3efef9880d05555b493555/e9bf8/hooksChanged.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADOUlEQVQ4yz2TSVNiZxSG7y+K6VV+Qf+KZJOqVCqbpJNlFtl0NmbXlUHjlATQFpBuZXKIKIiidjPY0opdoqAyc5mVUeTJ+W5MqDp1xu/lnPOeq3268Btfvp7ju9UFvnFbDHnmnRdt5plHtMfyaD/mHvXXElO5b6VWvVUYCkt78ucUzrMT9NsmpV6HskhObL3fJX/XotRtUxn0KLZvjVhBtKqpDQcUO3ekqzplqVcYCksbcy4RqpQJ7gZZeOXgpchGwG+Iw+ViMxhkdWvLEBVb928TODhgyeXk4ChG437A/WhEsFRAYWmfzE0QvE5zfnnBxOwMcxaz8XDeZmPZ68VitWJeXMS1vsYfFgu25dfYV5b5eXJSgPcptZq02m12rlIoLO0z6wSRzCW1ZoOySEUK8hWdUr1miC6x6m3rf7vcqBuiYjm9TPL6Cr1aIZpNobC0z1dmieZSNAQop5coyE70Zo267Kogq8hLLFPMG7lSvUq2XBRdodpq0JJdtvodBsN7Yrk0Ckt7OvOCvVSSxNkZDqeTZY8bX3CHd4lT1rZ87L45ZNb0lxH37+1il5Gdq14C+yGavS66NNIb9NlPX/B0+gXaR45F/PksHVlutl6n0mlT7XYoSqHevjMkp8aXEVXsv7zybx+G1ASs3e/jz2VQWNrHVjOhcgGbkPB8fJx5u529SIRfp6eZnJvFKWTMmEyYhJgd6faVx2PUvHQ4+GXqd5bcbg4ODwlKUwpLG5sRtmSxmXyOqIz5Nn5MTPSRyKGcxfnNNYnUJeF4nA9XaU6SSaKnJ4Tfxw2Wjz6cUZfOA3IpCkt74rQbI7dklItCnvNshqtyidN0ioKwmhUGE2JfSi5dKpIqFkgIsBq9BzSEkL6MHhAMhaWNmefYFvSbXJa3J+/lgH24/94wDncvGuHN8Tu8vk3DX5HxzTarjO0mJX9Qe9xlW76k7RvpULC0L6aek8inUb/BcMgDI4ajB9H/+uokhhIbid/t9egKAcruC4l9IaTb7xlvj5OnfDXzI9r3i+OYdhx4o35cYR+hmJtY3MVaeB1nZAtPeJNAbI21yAYu8b0RH4GjdSMWiXs4TngJiW/zmfnB/hP/AF6+rkYiwmm4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hooks changed in react dev tool\"\n        title=\"hooks changed in react dev tool\"\n        src=\"/static/58291fd55b3efef9880d05555b493555/e9bf8/hooksChanged.png\"\n        srcset=\"/static/58291fd55b3efef9880d05555b493555/12f09/hooksChanged.png 148w,\n/static/58291fd55b3efef9880d05555b493555/e4a3f/hooksChanged.png 295w,\n/static/58291fd55b3efef9880d05555b493555/e9bf8/hooksChanged.png 349w\"\n        sizes=\"(max-width: 349px) 100vw, 349px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Nothing too obvious to do here. Try to validate that the hook that\nchanged makes sense. Perhaps a bad context provider is faking out\nchanges the same way as <code class=\"language-text\">fake prop changes</code> might appear.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>By now you should feel pretty confident in your skills to identify and improve\nPerformance problems in React. Of course <em>theory</em> and <em>practice</em> are different beasts\nbut your problem wont be far away from the ones we’ve covered, perhaps you will have to\ndeal with library updates, or components out of your control but that’s life!</p>\n<hr/>\n<p>Like the content? Consider subscribing, buying me a coffee or even becoming a Patreon below.</p>","excerpt":"TLDR: the gist Measure performance! If you don’t measure it’s the same as doing nothing. You can optimize your React performance by…","fields":{"slug":"/react-performance/","readingTime":{"text":"11 min read"}},"frontmatter":{"title":"React is slow, what now?","date":"December 04, 2020","description":"We study React applications performance from the ground up, the processes involved, the tools to measure and identify slow parts, the important metrics to take in account, how these impact the UX and the various ways there are available to make applications super fast and smooth. Grab a cup of coffee and enjoy the ride.","tags":["React","Javascript","Typescript","props","state","chrome dev tools","react dev tools"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>Let’s talk about one of the core guiding principles I use as a\ndeveloper and as a Tech Lead\nwhen designing solutions and architectures, when programming\nand when reviewing others code, which I find\nmyself doing more and more as I move forward in my career.</p>\n<p>These sort of principles are of the family of <a href=\"https://amzn.to/33fhxf6\">Ray Dalio’s principles</a>\nbut applied to programming, I might write a book about it eventually, who knows.</p>\n<p>These have have a massive impact in my career as a programmer and have\nenabled me to get a more holistic approach to designing software that\nultimately were one of the main reasons I was able to get a Tech Lead job.</p>\n<p>With these principles in mind I have a <strong>technical compass</strong>\nthat helps me navigate all the decision making I need to do\nall the time; ranging from the high level architectural to the low\nlevel naming, function structures, etc.</p>\n<p>So I present to you one of the most important principles guiding my work:</p>\n<h2 id=\"clarity-then-simplicity-then-consistency\" style=\"position:relative;\">Clarity then Simplicity then Consistency<a href=\"#clarity-then-simplicity-then-consistency\" aria-label=\"clarity then simplicity then consistency permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Let’s unpack it a little bit, every word counts.</p>\n<p>Disclaimers:</p>\n<ol>\n<li>The program first and foremost <strong>needs to work</strong>, needs to do what it was intended to,\nneeds to serve its purpose, then and only then we can start worrying about these principles.</li>\n<li>There is a great deal of <strong>subjectivity</strong> in these principles,\nwe really don’t want to forget about that, but, once you have worked in enough projects\nyou start realizing that programs have a community and a culture around it, be that\nan <strong>open source community</strong> or the <strong>tech culture of the company</strong> inside which the software\nis developed. In this context these principles, such as <strong>Clarity</strong>, will\nhave its own concrete meanings. It also is important to reflect on what it means\nto be clear for a given context and propose potential improvements if possible, which will\nbe also highly subjective. The important conclusion is, yes, these things are subjective, but\nwe do not develop software in a vacuum and so <strong>they will have more concrete meanings in the\ncontext where we develop software.</strong></li>\n</ol>\n<h2 id=\"clarity\" style=\"position:relative;\">Clarity<a href=\"#clarity\" aria-label=\"clarity permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Programming can be thought of as a way of expressing ideas in a formal language,\nin that sense we could even go as far as thinking <strong>programming as a weird form of art\nor even poetry</strong>, there are always those pieces of code that touch our hearts, and\nso long as we have the main goal of software in mind: solving problems, I believe\nis fine to take this idea of beauty in.</p>\n<p>Code is created with two main purposes:</p>\n<ol>\n<li>to tell machines what do,</li>\n<li>to communicate ideas with other people.</li>\n</ol>\n<p>If we don’t express our <strong>ideas correctly</strong> the machine will yield at us, and\nif we don’t express the <strong>right ideas</strong> then other forms of validations should yield at us i.e. unit tests.</p>\n<p>The second part is the one where <strong>Clarity</strong> becomes important.</p>\n<blockquote>\n<p><strong>Code should be easy to understand by our team mates.</strong></p>\n</blockquote>\n<p>Code should be as easy to understand as possible for our team mates\nand humans in general, that’s in fact the <strong>main purpose of programming languages</strong>,\nto go closer to humans and abstract away the machine language.</p>\n<p>How to improve <strong>Clarity</strong>:</p>\n<ul>\n<li>identify and use the main <strong>concepts</strong> in your domain i.e. <code class=\"language-text\">nodes</code>, <code class=\"language-text\">users</code>, <code class=\"language-text\">cars</code>, <code class=\"language-text\">contracts</code>, <code class=\"language-text\">unverifiedUser</code>.</li>\n<li>naming is important, take your time finding the right names.</li>\n<li>are you sure about that one liner? Maybe break it into multiple lines?</li>\n<li>read your code entirely after “finishing it” i.e. <strong>review your own PRs</strong>.</li>\n<li>identify hard to understand sections</li>\n<li>ask: how can I make them better?</li>\n<li>if you can then do that</li>\n<li>if you cannot then comment the complexity away</li>\n</ul>\n<p>Sometimes some piece of code might be reflecting something inherently\ndifficult to understand, so there’s no easy way out of that and so\nyou should add comments to those sections.</p>\n<p><strong>Concepts are a fundamental idea in programming</strong>, we never deal with\nsome variable or some function, we deal with <strong>semantic concepts</strong> and\noperations that have strong meanings in the <strong>domain</strong> we are working.\nA good program will use strong concepts and thus will have good\nnaming across the board. <strong>Make sure you get the concepts right</strong>.</p>\n<p>Modern software development might involve millions of lines of code, across\nmultiple programming languages, covering complex business rules, we really\ndon’t want to make this already complicated artifact anymore and so\n<strong>Clarity becomes a tool for managing complexity</strong>.</p>\n<p>An example, I see a lot of newbie programmers abuse the indexing operation in a tight chain.</p>\n<p>Let’s say we have a contrived data structure as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">IUsersColors</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>userId<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span>hex<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In my experience, new programmers tend to do:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// access the \"i\" favourite color hex</span>\n<span class=\"token function\">setColor</span><span class=\"token punctuation\">(</span>usersColors<span class=\"token punctuation\">[</span>userId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>But i found the following more clear albeit longer.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> selectedUserColors <span class=\"token operator\">=</span> usersColors<span class=\"token punctuation\">[</span>userId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> color <span class=\"token operator\">=</span> selectedUserColors<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> colorHex <span class=\"token operator\">=</span> color<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setColor</span><span class=\"token punctuation\">(</span>colorHex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is my <strong>subjective</strong> judging of the code, perhaps\nin your context and for you and your team mates the\nfirst case is clearer. Not one example\nis wrong, but the point is that given our context,\nwe should go for the clearest solution.</p>\n<h2 id=\"simplicity\" style=\"position:relative;\">Simplicity<a href=\"#simplicity\" aria-label=\"simplicity permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Note how we say Clarity <strong>then</strong> Simplicity.\nThis means that <strong>Clarity</strong> is our first goal and our second\ngoal is <strong>Simplicity</strong> but by maximising <strong>Simplicity</strong> we should\nnever hurt <strong>Clarity</strong>.</p>\n<p><strong>Simplicity</strong> is related to the <a href=\"https://en.wikipedia.org/wiki/KISS_principle\">KISS</a> principle (Keep it simple stupid).\nWe should avoid adding more complexity to our code without good reasons.\nAlways <strong>start with the simplest solution that solves the problem</strong> and then add complexity\nonly and when needed.</p>\n<p>Feel free to use your subjective judgement to look in the future and find a balance\nbetween the current iteration’s simplicity and what you will probably need in the future.</p>\n<p>We must account for subjectivity,\ncontext and experience but always keeping in mind the question:\n<strong>Can I make this solution simpler?</strong>.</p>\n<p>It is not going to hurt you, in fact,\nif the answer is “no, because of reasons a, b and c” then you will feel more\ncomfortable and assertive about the code you are making.</p>\n<p>To achieve <strong>Simplicity</strong>:</p>\n<ul>\n<li>Always start from a base case of the <strong>simplest solution</strong>, you might want to implement it or not.</li>\n<li>write code with <strong>Simplicity</strong> in mind, always choose the <strong>simplest solution</strong> and complicate when needed.</li>\n<li>combine the <strong>Simplicity</strong> mind set with your experience and find balance between the two.</li>\n<li>review the results: is this the simplest implementation?</li>\n<li>add fixes if necessary, document if the complexity cannot be controlled.</li>\n</ul>\n<h2 id=\"consistency\" style=\"position:relative;\">Consistency<a href=\"#consistency\" aria-label=\"consistency permalink\" class=\"header-anchor after\">#</a></h2>\n<p>And finally we have <strong>Consistency</strong>.</p>\n<p>We should never for the sake of <strong>Consistency</strong> sacrifice Clarity or Simplicity.\nI have seen a lot of PRs where the reason for doing things in this\nunclear or complicated way was simply because other parts of the codebase were\ndoing it like so. I completely disagree with this reasoning.</p>\n<p>Code and tools and our understanding of them evolve constantly, that thing\nyou are trying to be consistent against might using some older idioms or tools\nthat have been superseded by others and that can be expressed clearer and simpler.</p>\n<p>It is also unreasonable, even more with larger codebases, to expect an entire codebase\nto move to these new idioms and tools at once, because that’s not how software evolves,\nwe write software piece by piece, little by little, so differences between newer and older\nparts are fine, track the old parts, add <code class=\"language-text\">TODO</code> and do them eventually.</p>\n<p><strong>Consistency</strong> is desired because <strong>humans are good with familiar patterns</strong> so\nthis contributes in how easy to navigate and understand your codebase is, for newcomers\nand old timers alike.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\">Conclusion<a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"header-anchor after\">#</a></h2>\n<p>There are no magical recipes for achieving these goals\nand the result of maximising these qualities might look\ndifferent depending on the team, tech culture, language, etc;\nnevertheless we should strive to achieve some sort of success\nmaximising them. Why?</p>\n<blockquote>\n<p><strong>Because clear, simple and consistent code is easy to understand</strong></p>\n</blockquote>\n<p>And if your codebase is easier to understand then:</p>\n<ul>\n<li><strong>we can spot errors and bugs more easy and fix them</strong></li>\n<li><strong>we can change or add new features with more ease</strong></li>\n<li>more generally, <strong>we can maintain our codebase more easily</strong></li>\n<li><strong>faster and easier developer on-boarding</strong></li>\n</ul>\n<p>And this all translates into <strong>faster product delivery times</strong> for your company\nplus in the way we probably would’ve\ncreate some pretty amazing and beautiful pieces of code. Everybody wins.</p>\n<p>What are your principles regarding programming? What compass do\nyou use in your everyday decision making? Let me know!.</p>\n<hr/>\n<p>Like the content? Consider subscribing, buying me a coffee or even becoming a Patreon below.</p>","excerpt":"Let’s talk about one of the core guiding principles I use as a\ndeveloper and as a Tech Lead\nwhen designing solutions and architectures, when…","fields":{"slug":"/programming-principles/","readingTime":{"text":"8 min read"}},"frontmatter":{"title":"Secrets of a Tech Lead: Programming Principles","date":"November 27, 2020","description":" Let's cover the main programming principles I have developed. They act as a Technical Compass that help me navigate all the decision I have to make constantly; ranging from the high level architectural to the low level naming, function structures, etc. ","tags":["Tech Lead","Architect","Principles","clarity","simplicity","consistency","reading code"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>I consider PR reviews as one of the fundamental and most important\ntools developers have to collaborate. We use it daily to submit changes and\nto get important feedback from peers and more experienced developers.</p>\n<p>And so, <strong>it should be targeted to software developers and not to managers</strong>.</p>\n<p>Let’s cover some of the daily tortures of dealing with <a href=\"https://bitbucket.org/\">Bitbucket</a>, which\nI unfortunately need to deal with.</p>\n<h2 id=\"copying-code-from-the-pr-changes-into-a-comment\" style=\"position:relative;\">Copying code from the PR changes into a comment<a href=\"#copying-code-from-the-pr-changes-into-a-comment\" aria-label=\"copying code from the pr changes into a comment permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>Hey friend, how about you implement this piece of functionality in this other way?</p>\n</blockquote>\n<p>This common and healthy workflow is <strong>fundamentally broken</strong> in BB because\nyou cannot copy code from the body of the PR into a comment without getting\na lot more than what you clearly selected.</p>\n<p><img src=\"/460408cff29803e91776376bae5605ad/copypastev3.gif\" alt=\"Copying and pasting code from PR changes is broken\"></p>\n<h2 id=\"are-you-sure-you-want-to-discard-actually-not-your-comments\" style=\"position:relative;\">Are you sure you want to discard (actually not) your comments?<a href=\"#are-you-sure-you-want-to-discard-actually-not-your-comments\" aria-label=\"are you sure you want to discard actually not your comments permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Trying to click anywhere else when writing a comment like for example\nexpanding to see more code will result in an alert that states\nthat your comment changes will be removed which is already super annoying.\nBut if you even do not care about discarding your comment and you go ahead\nand click on discard the comment isn’t really discarded! So it is completely misleading.</p>\n<p>This is BB not caring about the amount of time developers throw into detailed\ncode reviews.</p>\n<p><img src=\"/7a16dbe4130224ea56472f85903a24f7/commentclick.gif\" alt=\"Are you sure you want to discard (actually not) your comments?\"></p>\n<h2 id=\"what-you-see-may-be-what-you-get-horrible-markdown-support\" style=\"position:relative;\">What You See May Be What You Get: horrible markdown support<a href=\"#what-you-see-may-be-what-you-get-horrible-markdown-support\" aria-label=\"what you see may be what you get horrible markdown support permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Markdown is a tool aimed for technical folks, it is minimal but gets\nthe job done without any distractions, it is <em>not</em> <a href=\"https://en.wikipedia.org/wiki/WYSIWYG\">WYSIWYG</a> (what you see is what you get)\nby design and partially for simplicity.</p>\n<p>BB takes the worse of all worlds: horrible “standard” markdown support\nthat varies across places and combine it with a <a href=\"https://en.wikipedia.org/wiki/WYSIWYG\">WYSIWYG</a> editor.\nThis creates really weird\nuse cases we will cover below.</p>\n<p>Other technical tools, such as <a href=\"https://github.com/\">Github</a>, understand how important decent markdown\nsupport is and they use it to empower developers.\nThey do build visual tools on top of markdown but without combining them\ninto a monster broken implementation.</p>\n<p>Let’s see some specially frustrating cases</p>\n<h3 id=\"selecting-a-code-block-language\" style=\"position:relative;\">Selecting a code block language<a href=\"#selecting-a-code-block-language\" aria-label=\"selecting a code block language permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Instead of using the standard <strong>”```typescript”</strong> they include a visual\nSelect. Guess what, professional developers don’t need this help at all, and\nnewbies can search the web once and forget about this.</p>\n<p>Think about ergonomics, with regular markdown you do everything with the keyboard,\nwith the BB inferno you first need to type the three backward ticks and then grab the\nmouse and select your language and then click back on the code block.</p>\n<p>This is a really poor understanding of your user’s UX!</p>\n<p><img src=\"/e7b45f374d83485074abc0f93fc73afb/mdlang.gif\" alt=\"selecting code block language\"></p>\n<h3 id=\"smart-dumb-markdown-hybrid-support\" style=\"position:relative;\">Smart (dumb) markdown hybrid support<a href=\"#smart-dumb-markdown-hybrid-support\" aria-label=\"smart dumb markdown hybrid support permalink\" class=\"header-anchor after\">#</a></h3>\n<p>The <a href=\"https://en.wikipedia.org/wiki/WYSIWYG\">WYSIWYG</a> <a href=\"https://guides.github.com/features/mastering-markdown/\">markdown</a> hybrid implementation produces stuff like this</p>\n<p><img src=\"/e0371b316a1ee15020dc166396db9c4c/format.gif\" alt=\"format\"></p>\n<h3 id=\"list-items-without-an-empty-line\" style=\"position:relative;\">List items without an empty line<a href=\"#list-items-without-an-empty-line\" aria-label=\"list items without an empty line permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This cannot happen in the comment textbox unless you force it to, but\nit can happen in the PR description textbox and it can also happen when you\nwrite the markdown in a <em>regular</em> text editor / IDE i.e. when committing code\nvia git, when writing the README, etc.</p>\n<p>If you don’t leave an empty line before a list then it won’t get transformed correctly:</p>\n<p><img src=\"/c8e58d30c452b643bf40ea77f00b21d0/lists.gif\" alt=\"markdown lists\"></p>\n<h2 id=\"performance-of-the-text-box\" style=\"position:relative;\">Performance of the text box<a href=\"#performance-of-the-text-box\" aria-label=\"performance of the text box permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I have a pretty good and modern computer but most of the time\nI experience heavy lags when writing a simple text only comment in <a href=\"https://bitbucket.org/\">BB</a>.</p>\n<p>I suspect this is related to the horrible <a href=\"https://en.wikipedia.org/wiki/WYSIWYG\">WYSIWYG</a> implementation,\nwhich we have just heavily broken down above.</p>\n<h2 id=\"doesnt-work-on-large-prs\" style=\"position:relative;\">Doesn’t work on large PRs<a href=\"#doesnt-work-on-large-prs\" aria-label=\"doesnt work on large prs permalink\" class=\"header-anchor after\">#</a></h2>\n<p>When a PR is a large (I know, I know, large PRs should not happen, but unfortunately sometimes they do)\nBB will choose either</p>\n<ol>\n<li>consuming a lot of resources</li>\n<li>not displaying the entire PR</li>\n</ol>\n<p>In either case the UX ends up being bad.</p>\n<p>In case <strong>1.</strong> you will get a lot of RAM being consumed and\nmost likely the scrolling and the interaction with the page\nwill be even more slow and awkward.</p>\n<p>In case <strong>2.</strong> you need to click file by file to inspect a PR, which isn’t better IMO.</p>\n<h2 id=\"bitbucket-is-jira-applied-to-git\" style=\"position:relative;\">Bitbucket is Jira applied to git<a href=\"#bitbucket-is-jira-applied-to-git\" aria-label=\"bitbucket is jira applied to git permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I’ve seen that the described behaviors tend to be cross\ncutting problems across the <a href=\"https://www.atlassian.com/\">Atlassian</a> suite, <a href=\"https://www.atlassian.com/software/jira\">Jira</a> has similar\nproblems and <a href=\"https://confluence.atlassian.com/alldoc/atlassian-documentation-32243719.html\">Confluence</a> is horrible, they are generally\nreally slow and clunky and unresponsive and text editing tends to be a pain.</p>\n<h2 id=\"understanding-your-product\" style=\"position:relative;\">Understanding your product<a href=\"#understanding-your-product\" aria-label=\"understanding your product permalink\" class=\"header-anchor after\">#</a></h2>\n<p>PRs are one of the core use cases of <a href=\"https://bitbucket.org/\">BB</a> as a product,\nthey are what have arguably made <a href=\"https://github.com/\">Github</a> the beacon that it is now.</p>\n<p>There are a few things your PR experience needs to provide at the base level</p>\n<ul>\n<li>PR title, description and inline comments.</li>\n<li>Every text box needs to support plain markdown and maybe mentioning other people (tagging).</li>\n<li>If you want to add markdown shortcuts make them <em>insert markdown</em> and <strong>not</strong> actually applying style.</li>\n<li>Good diffing visualization (which BB does well IMO).</li>\n<li>It is all about the code!</li>\n<li>Copying code from the diff needs to work as expected.</li>\n<li>Markdown code blocks (code snippets) are a fundamental feature of all your text boxes.</li>\n<li>Either provide a really good experience inside your code blocks or do nothing.</li>\n<li>Your app needs to be simple, small, fast and stable in time.</li>\n<li>Some PRs are open for long periods of time, make sure your app is stable!.</li>\n</ul>\n<p>These are one the core features a good PR UI needs to provide, if anything,\nthese need to be the best of the best.</p>\n<p>BB seems to have prioritized being “cute” or “pretty” (is it?) instead of being functional.</p>\n<h2 id=\"solutions\" style=\"position:relative;\">Solutions<a href=\"#solutions\" aria-label=\"solutions permalink\" class=\"header-anchor after\">#</a></h2>\n<p><a href=\"https://bitbucket.org/\">Bitbucket</a> is a developer centric platform, use developer centric tools,\nuse plain old text inputs with good markdown support, add as little as possible\non top of that, make the experience of writing comments, PR descriptions,\ncode snippets as easy, simple and fast as possible.</p>\n<p>Don’t leak stuff from <a href=\"https://www.atlassian.com/software/jira\">Jira</a> and <a href=\"https://confluence.atlassian.com/alldoc/atlassian-documentation-32243719.html\">Confluence</a> to <a href=\"https://bitbucket.org/\">Bitbucket</a>, they have different\naudience.</p>\n<p>And if you have time… make sure <em>every</em> text input in your system has a plain text\nmode, where either you interpret it as good old markdown or as unformatted text, either\nis much better than what you have now.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Liked the content? Consider subscribing, buying me coffee or even becoming a Patreon below.</p>","excerpt":"I consider PR reviews as one of the fundamental and most important\ntools developers have to collaborate. We use it daily to submit changes…","fields":{"slug":"/bitbucket-sucks/","readingTime":{"text":"6 min read"}},"frontmatter":{"title":"Bitbucket is developer hell","date":"November 20, 2020","description":"Bitbucket sucks for developers because it was made for managers","tags":["Bitbucket","Github","markdown","git","PR","Pull Request","code review"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>For the longest time it has been an idiom in <a href=\"https://reactjs.org/\">React</a> applications to\nperform data fetching through <a href=\"https://redux.js.org/\">Redux</a>, this approach has always\nhave problems in its efficiency and effectiveness but modern tools and techniques\nhave showed us better ways. Let’s together\nexplore what better alternatives the ecosystem has to offer, but\nfirst let’s quickly cover what’s Redux and how it is typically used\nto fetch data.</p>\n<p>Redux is a global state management system mostly associated with\nReact applications that is great for managing global app state and\nthe states transitions in a predictable way but when dealing with\napplication data fetching requirements it can become a problem:</p>\n<h2 id=\"the-typical-data-fetching-in-redux\" style=\"position:relative;\">The typical data fetching in Redux<a href=\"#the-typical-data-fetching-in-redux\" aria-label=\"the typical data fetching in redux permalink\" class=\"header-anchor after\">#</a></h2>\n<p>This is a very simplistic way to data fetch to Redux,\nit is probably not production ready and has unresolved problems.</p>\n<div class=\"gatsby-code-title code-block-title\">post.action.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">LOADING_START</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">LOADING_END</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">FETCH_ERROR</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">UPDATE</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./post.reducer\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loadingStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token constant\">LOADING_START</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loadingEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token constant\">LOADING_END</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchError</span><span class=\"token punctuation\">(</span>error<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token constant\">FETCH_ERROR</span><span class=\"token punctuation\">,</span> payload<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>post<span class=\"token operator\">:</span> IPost<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token constant\">FETCH_ERROR</span><span class=\"token punctuation\">,</span> payload<span class=\"token operator\">:</span> post <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// this requires redux-thunk</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getPost</span><span class=\"token punctuation\">(</span>postId<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>dispatch<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">loadingStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">getPost</span><span class=\"token punctuation\">(</span>postId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetchError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">loadingEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title code-block-title\">post.reducer.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">LOADING_START</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"posts/LOADING_START\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">LOADING_END</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"posts/LOADING_END\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">FETCH_ERROR</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"posts/FETCH_ERROR\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">UPDATE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"posts/UPDATE\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> initialState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  loading<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  error<span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n  data<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IState</span> <span class=\"token punctuation\">{</span>\n  loading<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n  error<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  data<span class=\"token operator\">:</span> IPost <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">postReducer</span><span class=\"token punctuation\">(</span>\n  prevState<span class=\"token operator\">:</span> IPostState <span class=\"token operator\">=</span> initialState<span class=\"token punctuation\">,</span>\n  action<span class=\"token operator\">:</span> IAction<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> IPostState <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">LOADING_START</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>prevState<span class=\"token punctuation\">,</span> loading<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">LOADING_END</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>prevState<span class=\"token punctuation\">,</span> loading<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">FETCH_ERROR</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> error <span class=\"token operator\">=</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>prevState<span class=\"token punctuation\">,</span> error <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">UPDATE</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> action<span class=\"token punctuation\">.</span>payload <span class=\"token keyword\">as</span> IPost<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> postId <span class=\"token operator\">=</span> post<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>prevState<span class=\"token punctuation\">,</span> data<span class=\"token operator\">:</span> post <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> prevState<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title code-block-title\">root.reducer.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> post <span class=\"token keyword\">from</span> <span class=\"token string\">\"./post.reducer\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">combineReducers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> post <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And finally you can use it</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// fetch data when the component mounts</span>\n  <span class=\"token function\">onComponentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">getPost</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>postId<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// or</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>postId<span class=\"token punctuation\">,</span> getPost<span class=\"token punctuation\">,</span> post<span class=\"token punctuation\">,</span> loading<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">getPost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">mapStateToProps</span><span class=\"token punctuation\">(</span>appState<span class=\"token operator\">:</span> IAppState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// reading the result of the data being fetched,</span>\n  <span class=\"token comment\">// but who asked for it? do I need to do it?</span>\n  <span class=\"token comment\">// did someone already did it?</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> post<span class=\"token punctuation\">,</span> loading<span class=\"token punctuation\">,</span> error <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> appState<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> post<span class=\"token punctuation\">,</span> loading<span class=\"token punctuation\">,</span> error <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">mapDispatchToProps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// this will be called and will trigger the http call,</span>\n  <span class=\"token comment\">// let's hope that `MyComponent` does it and does it correctly,</span>\n  <span class=\"token comment\">// i.e. in onComponentDidMount AND onComponentDidUpdate</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> getPost<span class=\"token operator\">:</span> actions<span class=\"token punctuation\">.</span>getPost <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>\n  mapStateToProps<span class=\"token punctuation\">,</span>\n  mapDispatchToProps\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>MyComponent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"data-fetching-with-redux-is-too-complicated\" style=\"position:relative;\">Data fetching with Redux is too complicated<a href=\"#data-fetching-with-redux-is-too-complicated\" aria-label=\"data fetching with redux is too complicated permalink\" class=\"header-anchor after\">#</a></h2>\n<p>The current implementation has the following problems</p>\n<ul>\n<li>it is way too verbose (hooks and libraries might make it better)</li>\n<li>is that the right semantics for my actions?</li>\n<li>is that the right structure and naming for my actions?</li>\n<li>is that the right file structure? Official Redux docs once upon a time opposed to the “ducks” approach but now they seem to <a href=\"https://redux.js.org/style-guide/style-guide#structure-files-as-feature-folders-or-ducks\">be strongly recommending it</a></li>\n<li>should I use switch or some other way of casing?</li>\n<li>should I normalize?</li>\n<li>is the state shape correct?</li>\n<li>are my meta flags correct?</li>\n<li>how would I manage multiple posts being fetched at the same time? (hint: you need to change your state shape and do more stuff)</li>\n<li>should I use <a href=\"https://github.com/immerjs/immer\">immer</a> (which I love BTW) or similar?</li>\n<li>should I use <a href=\"https://redux-toolkit.js.org\">redux-toolkit</a>?</li>\n<li>should I use <a href=\"https://redux-saga.js.org/\">sagas</a>? (which is even more verbose and complex BTW).</li>\n<li>where are the selectors?</li>\n<li>how do I make my team code consistently across the multiple action/reducers that we will need to write?</li>\n<li>what happens if more than one component triggers the same data fetching action? Do I need to dedup http calls manually?</li>\n<li>do I need to make all my data fetching actions at the root of my app? (in big enough apps this causes a bad decoupling between the data requirements of your components and your components).</li>\n<li>what about if my app is too big and I want to more granularly define what data fetching requirements a medium level component needs to have?</li>\n<li>when does this fetched data expires? how do I clean it up?</li>\n</ul>\n<p>All these are somewhat open problems that you and your team need to\nfix in the life cycle of your app development. It is really hard\nto structure this 100% correctly.</p>\n<p>And finally, these things illustrate <strong>the crazy amount of decisions, considerations and\ncode a developer needs to make in order to fetch a simple post</strong>.</p>\n<blockquote>\n<p><strong>Simple and common tasks should have simple solutions.</strong></p>\n</blockquote>\n<h2 id=\"the-usage-problem\" style=\"position:relative;\">The usage problem<a href=\"#the-usage-problem\" aria-label=\"the usage problem permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Let’s say we already figured out how to do all the boilerplate,\nwe still have to deal with the usage problem: <strong>the decoupling of the triggering of http calls\n(the action) and the reading of the result (the state)</strong> as seen in above.</p>\n<p>What you really are trying to express is something like the following,\nnotice how in a single place we have the triggering of the http side effect\nand the reading of the result and the meta data.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> result<span class=\"token punctuation\">,</span> loading<span class=\"token punctuation\">,</span> error <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">getPost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// UI</span></code></pre></div>\n<div style=\"font-size: 25px; margin-top: 40px; margin-bottom: 40px;\">\n<p><strong>Decoupling things that are naturally tightly coupled is as bad as tightly coupling things that shouldn’t be.</strong></p>\n</div>\n<p>By using <code class=\"language-text\">redux</code> hooks it can, partially, get better.</p>\n<h2 id=\"redux-forces-both-data-fetching-and-mutations-to-be-imperative\" style=\"position:relative;\">Redux forces both data fetching and mutations to be imperative<a href=\"#redux-forces-both-data-fetching-and-mutations-to-be-imperative\" aria-label=\"redux forces both data fetching and mutations to be imperative permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Data fetching (when you retrieve data) is usually reactive in a React applications,\nmeaning that a prop will change, a component will render and an associated side effect\nof fetching new data should be triggered. Mutations, like saving a form are typically\nimperative. <strong>Redux forces both data fetching and mutations to be imperative</strong>.</p>\n<h2 id=\"the-library-problem\" style=\"position:relative;\">The library problem<a href=\"#the-library-problem\" aria-label=\"the library problem permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Any library that relies on Redux makes its integration surface bigger.\nLib consumers now need setup Redux and set it up the way the library expects it\nto be with the appropriate reducers and middlewares it needs to work.</p>\n<p>The alternative that we will explore are much more straight forward to encapsulate\nat the library level.</p>\n<h2 id=\"what-is-data-fetching\" style=\"position:relative;\">What is data fetching?<a href=\"#what-is-data-fetching\" aria-label=\"what is data fetching permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Let’s take a step back and analyse what we really want\nof our data fetching layer:</p>\n<ul>\n<li>dedup http calls; any “smart” component that needs data to be fetched should be able to declare it without fearing it might cause duplicated http calls.</li>\n<li>meta flags: loading, error, last fetched, etc.</li>\n<li>\n<p>updating or invalidating the <em>state</em> when necessary, example:</p>\n<ul>\n<li>when data is too old</li>\n<li>when you mutate the data in the server and you need to reflect that</li>\n</ul>\n</li>\n<li>reactivity (when a prop changes new data will be fetched if necessary).</li>\n<li>medium term response storing, reading <em>and</em> writing or updating.</li>\n<li>heavy abstraction, simplicity and a really easy to use interface.</li>\n</ul>\n<p>These things have been a staple of <a href=\"https://graphql.org/\">GraphQL</a> clients\nsuch as <a href=\"https://www.apollographql.com/\">Apollo</a> for quite some time now.</p>\n<h2 id=\"just-a-cache\" style=\"position:relative;\">Just a cache<a href=\"#just-a-cache\" aria-label=\"just a cache permalink\" class=\"header-anchor after\">#</a></h2>\n<p>When you think about it what you really want is a\n<strong>cache layer</strong> for your http requests that will simply maintain\na key value store for your data, where the <strong>key will identify\nthe <em>resource</em> and the value will be the resource plus its metadata:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> cache <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'posts/124'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* the post */</span><span class=\"token punctuation\">}</span>\n    meta<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>loading<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">,</span> lastFetched<span class=\"token punctuation\">,</span> keepAlive<span class=\"token punctuation\">,</span> etc<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token string\">'posts/456'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* the post */</span><span class=\"token punctuation\">}</span>\n    meta<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>loading<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">,</span> lastFetched<span class=\"token punctuation\">,</span> keepAlive<span class=\"token punctuation\">,</span> etc<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token string\">'users/barry@white.com'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* the user */</span><span class=\"token punctuation\">}</span>\n    meta<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>loading<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">,</span> lastFetched<span class=\"token punctuation\">,</span> keepAlive<span class=\"token punctuation\">,</span> etc<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And this data structure will have the appropriate functionality on top of\nit to:</p>\n<ul>\n<li>fetch the data and store it the right key</li>\n<li>update other cache keys after a successful data fetch (i.e. after fetching multiple posts we update the individual post cache)</li>\n<li>update cache after a mutation (i.e. saving a post form)</li>\n<li>cache time: how long I want to keep this data?</li>\n<li>stale time: how long I will consider this data <em>fresh</em>?</li>\n<li>automatically managing meta flags.</li>\n</ul>\n<h2 id=\"forget-about\" style=\"position:relative;\">Forget about<a href=\"#forget-about\" aria-label=\"forget about permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>state shape (it is just a key value store of responses)</li>\n<li>no normalization (it is just a cache)</li>\n<li>data fetching meta state like loading, error, etc</li>\n<li>actions</li>\n<li>reducers</li>\n<li>thunks</li>\n<li>imperative data fetching <code class=\"language-text\">onComponentDidMount</code></li>\n</ul>\n<h2 id=\"do-this-instead\" style=\"position:relative;\">Do this instead!<a href=\"#do-this-instead\" aria-label=\"do this instead permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Enter <a href=\"https://react-query.tanstack.com/\">react-query</a>.</p>\n<blockquote>\n<p>There is one alternative built on top of Redux called <a href=\"https://amplitude.github.io/redux-query/\">redux-query</a>.\nI’ve used it extensively and although it is an improvement over pure Redux,\nsome of the core problems that we covered remained.</p>\n</blockquote>\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">removing redux after switching to react-query like <a href=\"https://t.co/JyDl8UMCHl\">pic.twitter.com/JyDl8UMCHl</a></p>&mdash; @brumm (@funkensturm) <a href=\"https://twitter.com/funkensturm/status/1321760646803968002?ref_src=twsrc%5Etfw\">October 29, 2020</a></blockquote>\n<p><code class=\"language-text\">react-query</code> is a really nice new library that builds on the things\nwe have previously discussed, solves all the problems, is\nrelatively simple and easy to understand\nand will reduce the amount of code you need to write\nfor data fetching by an absurd amount, all the previous code gets replaced by this:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useGetPost</span><span class=\"token punctuation\">(</span>postId<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> QueryResult<span class=\"token operator\">&lt;</span>IPost<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token generic-function\"><span class=\"token function\">userQuery</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>IPost<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">posts/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>postId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    queryFn<span class=\"token operator\">:</span> api<span class=\"token punctuation\">.</span>getPost<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And its usage</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> postId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> post<span class=\"token punctuation\">,</span> isLoading<span class=\"token punctuation\">,</span> error <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useGetPost</span><span class=\"token punctuation\">(</span>\n    postId\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This covers what we did in Redux and more, as you can see it requires\na considerable less amount of code.</p>\n<p><strong>this is production ready!</strong></p>\n<p><code class=\"language-text\">redux-query</code> deals with a cache of responses instead of the Redux state,\nbut can do most of the same things if necessary i.e. updating the state, it just\nhave a different semantic and a much less verbose interface.</p>\n<p>There are some new problems with react-query that mostly rise from its\nreactive interface like dependent queries et al but if you know how to deal\nwith react you will know how to deal with that, and in my production experience\nthey tend to be the exception and not the rule.</p>\n<h2 id=\"tldr-try-react-query\" style=\"position:relative;\">TLDR: try react-query<a href=\"#tldr-try-react-query\" aria-label=\"tldr try react query permalink\" class=\"header-anchor after\">#</a></h2>\n<p>The programming world is an ever evolving technical landscape where\nthe community grows and learns new tips and tricks from experience,\nRedux has a historical significance and it is still suitable for certain\nscenarios but modern tools have provided better ways of doing some of the\nthings we typically used to do with Redux, data fetching is one of them.</p>\n<p>This new data fetching paradigm is mostly possible because of this\ncrazy idea the react team had: react-hooks. I agree they are\n<em>weird</em> but the new things we can build with them and the composition\nmodels they enable is really great, and I expect more awesome\nand unexpected tools like react-query to come in the near future\nas we develop our understanding of hooks.</p>\n<p>Enjoyed the ride? Consider subscribing to our awesome newsletter\nand become part of the family and consider donating and supporting my work.</p>\n<p>Cheers!</p>","excerpt":"For the longest time it has been an idiom in React applications to\nperform data fetching through Redux, this approach has always\nhave…","fields":{"slug":"/redux-data-fetching-antipattern/","readingTime":{"text":"10 min read"}},"frontmatter":{"title":"Stop using Redux for Data Fetching, use this instead","date":"November 10, 2020","description":"Modern tools and technique have superseded using Redux for data fetching, providing a more effective and efficient solution to this problem, reducing the amount of code and decisions we need to make in order to fetch data which is common, day to day, task in modern app development.","tags":["TypeScript","Javascript","React","react-query","redux","redux-toolkit","data fetching","reactive data flow"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAeVfO1SSRP8A/8QAGhAAAQUBAAAAAAAAAAAAAAAAAQACAxExIf/aAAgBAQABBQJuyA3SGHriv//EABYRAQEBAAAAAAAAAAAAAAAAABEQIf/aAAgBAwEBPwFwn//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAIDAQAAAAAAAAAAAAAAAAARARAxIf/aAAgBAQAGPwLGdhUza//EABoQAQADAAMAAAAAAAAAAAAAAAEAESEQMWH/2gAIAQEAAT8hZnswJS7KljgCwU+rFs//2gAMAwEAAgADAAAAECcP/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/EB7j/8QAFhEAAwAAAAAAAAAAAAAAAAAAEBEh/9oACAECAQE/EFR//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBUf/aAAgBAQABPxAAQXQ9gT9YFF73Iqq4qXw1URC8NDExbmT/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jest\"\n        title=\"jest\"\n        src=\"/static/01d3ca0bdad871ffff120730c040bf17/1c72d/img.jpg\"\n        srcset=\"/static/01d3ca0bdad871ffff120730c040bf17/a80bd/img.jpg 148w,\n/static/01d3ca0bdad871ffff120730c040bf17/1c91a/img.jpg 295w,\n/static/01d3ca0bdad871ffff120730c040bf17/1c72d/img.jpg 590w,\n/static/01d3ca0bdad871ffff120730c040bf17/a8a14/img.jpg 885w,\n/static/01d3ca0bdad871ffff120730c040bf17/fbd2c/img.jpg 1180w,\n/static/01d3ca0bdad871ffff120730c040bf17/92903/img.jpg 3435w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<div style=\"text-align: center; margin-bottom: 40px;\">\n<span>Photo by <a href=\"https://unsplash.com/@fernanddecanne\">Fernand De Canne</a> on <a href=\"https://unsplash.com/s/photos/clown\">Unsplash</a></span>\n</div>\n<h2 id=\"why-i-love-jest-and-why-should-consider-it-for-your-next-project\" style=\"position:relative;\">Why I love Jest and why should consider it for your next project.<a href=\"#why-i-love-jest-and-why-should-consider-it-for-your-next-project\" aria-label=\"why i love jest and why should consider it for your next project permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Jest is a full-blown, batteries included, ready to rock, testing framework that\nhas similarities with mocha and other testing frameworks but with a much\nmore integrated experience, making it very easy to have a production\nready unit test setup out of the box with very little effort.</p>\n<p>Let’s cover some of the things I love about Jest,\nif you are interested in my unit testing mindset and philosophy\nand an illustrative story check it at the <a href=\"#bonus-my-unit-test-mind-set\">end of this article</a>.</p>\n<h2 id=\"1-less-verbose-than-similar-frameworks\" style=\"position:relative;\">1. Less verbose than similar frameworks<a href=\"#1-less-verbose-than-similar-frameworks\" aria-label=\"1 less verbose than similar frameworks permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>Simple tests can be terse</li>\n<li>Assertion library is always available</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my function\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>You can omit a top level describe when using the BDD interface</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should do something'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Tests should be expressive but abstract, the less code\nthe better, Jest helps with this.</p>\n<p>In a lot of cases, if you structure your code a certain way,\nusing one or two <code class=\"language-text\">test</code> per unit will be more than enough.</p>\n<h2 id=\"2-jest-replaces-sinon-for-the-most-part\" style=\"position:relative;\">2. Jest replaces sinon for the most part<a href=\"#2-jest-replaces-sinon-for-the-most-part\" aria-label=\"2 jest replaces sinon for the most part permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>need to mock / spy / stub pieces of code? use the global <code class=\"language-text\">jest.fn()</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jest mocks\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> mockSpyStub <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">mockSpyStub</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jest is love\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockSpyStub<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jest is love\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Check the <a href=\"https://jestjs.io/docs/en/mock-functions\">docs</a></p>\n<h2 id=\"3-jest-comes-with-an-assertion-library\" style=\"position:relative;\">3: Jest comes with an assertion library<a href=\"#3-jest-comes-with-an-assertion-library\" aria-label=\"3 jest comes with an assertion library permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>Comes already installed, integrated and globally available in all tests</li>\n<li>Covers a wide range of assertions / matchers.</li>\n<li>Good typescript support</li>\n<li>Perfect integration with Jest mocks / stubs / spys <code class=\"language-text\">jest.fn()</code>j</li>\n<li>Nice diff reporting tool</li>\n</ul>\n<p>Check all the <a href=\"https://jestjs.io/docs/en/expect\">included assertions here</a>.</p>\n<h2 id=\"4-jest-comes-with-code-coverage-integration\" style=\"position:relative;\">4. Jest comes with code coverage integration<a href=\"#4-jest-comes-with-code-coverage-integration\" aria-label=\"4 jest comes with code coverage integration permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>Uses <a href=\"https://istanbul.js.org/\">instanbul</a> under the hood</li>\n<li>Flip a simple switch to enable it with little extra config</li>\n<li>Good <a href=\"https://jestjs.io/docs/en/cli.html#--coverageboolean\">official documentation</a></li>\n<li>Ready to rock</li>\n</ul>\n<blockquote>\n<p><em>Note</em> Actually I just checked mocha’s official documentation and it\nredirects to Wallaby.js which is great but it is a paid tool, instead\nof linking to <code class=\"language-text\">nyc</code> (instanbul) and how to integrate with that.</p>\n</blockquote>\n<h2 id=\"5-jest-has-out-of-the-box-module-mocking\" style=\"position:relative;\">5. Jest has out of the box module mocking<a href=\"#5-jest-has-out-of-the-box-module-mocking\" aria-label=\"5 jest has out of the box module mocking permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Jest has an awesome module mocking story:</p>\n<ul>\n<li>Out of the box support with little config</li>\n<li>Works with CommonJS and native ES6 modules</li>\n<li>Works well with local modules and <code class=\"language-text\">node_modules</code></li>\n<li>Simple and terse interface</li>\n<li>Enables well known practices of unit testing and mocking thoroughly.</li>\n<li>Enables effective, efficient and terse unit tests of complex pieces of code.</li>\n</ul>\n<blockquote>\n<p>Little implementation detail: Jest achieves\nthis partially by running tests inside an isolated <a href=\"https://nodejs.org/api/vm.html\">Nodejs vm</a>\nwhich gives jest complete control of the test environment.</p>\n</blockquote>\n<p>Let’s cover some really useful patterns I have been using a lot lately:</p>\n<ul>\n<li>es6 modules: default export mock</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> myLib <span class=\"token keyword\">from</span> <span class=\"token string\">\"my-lib\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// now myLib is a mock</span>\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my-lib\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// configure a mock return value, you</span>\n<span class=\"token punctuation\">(</span>myLib <span class=\"token keyword\">as</span> jest<span class=\"token punctuation\">.</span>Mock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">\"test value\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>es6 modules: member mock</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> member <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"my-lib\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// now myLib is a mock</span>\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my-lib\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// configure a mock return value, you</span>\n<span class=\"token punctuation\">(</span>member <span class=\"token keyword\">as</span> jest<span class=\"token punctuation\">.</span>Mock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">\"test value\"</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>There are <a href=\"https://github.com/jhnns/rewire\">libs</a>\nout there that provide similar strategies but\nthey often fall short, or do not support ES6 modules,\nor are simply too complicated because they\ndo not have the level of control over how the code is being run\nlike Jest does.</p>\n<p>Check the official <a href=\"https://jestjs.io/docs/en/es6-class-mocks\">docs</a>.</p>\n<h2 id=\"6-jest-has-first-class-support-for-babel-and-typescript\" style=\"position:relative;\">6. Jest has first class support for Babel and Typescript<a href=\"#6-jest-has-first-class-support-for-babel-and-typescript\" aria-label=\"6 jest has first class support for babel and typescript permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Easy to integrate with <a href=\"https://www.typescriptlang.org/\">Typescript</a>\neither by using <a href=\"https://babeljs.io/\">Babel</a>\nor by using <a href=\"https://github.com/kulshekhar/ts-jest\">ts-jest</a>.</p>\n<p>If your codebase already uses typescript through Babel\nthen jest will automatically use that config and you won’t\nneed to do anything else.</p>\n<h2 id=\"7-jest-test-runner-interface-is-awesome\" style=\"position:relative;\">7. Jest test runner interface is awesome<a href=\"#7-jest-test-runner-interface-is-awesome\" aria-label=\"7 jest test runner interface is awesome permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Watch mode, interactive mode, filtering, Jest has you covered.</p>\n<p>Read more <a href=\"https://jestjs.io/docs/en/cli\">here</a>.</p>\n<p>This is a really nice trick I use a lot to focus\nonly on particular tests at a time: reg exp filtering</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># runs all the tests</span>\njest\n\n<span class=\"token comment\"># runs only the tests that fit this patterns</span>\njest pattern\njest myFunction\njest myFunc*</code></pre></div>\n<p>Something similar can be done in the interactive watch mode.</p>\n<h2 id=\"bonus-my-unit-test-mind-set\" style=\"position:relative;\">Bonus: My unit test mind set<a href=\"#bonus-my-unit-test-mind-set\" aria-label=\"bonus my unit test mind set permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>test in the most simple and minimalistic way</li>\n<li>do real unit tests, mocking everything else</li>\n<li>test only the high impact code</li>\n</ul>\n<p>In most of the cases I don’t see the value of being obsessed\nwith 100% coverage, because sometimes testing two\nerror handling lines inside a unhappy path branch might require\na whole lot of code.</p>\n<p>There are cases where a 100% coverage might be adequate\nor needed but in most high level business apps there’s really\nno need and the cost of keeping the coverage to 100% is really high.\nIn most cases I try to implement a Pareto approach, do the\nminimum thing with the highest impact which typically translates\ninto 80% code coverage and ignoring glue code files.</p>\n<p>Unit tests files is still code that you need to maintain so it should\nbe treated as close to regular code as possible and it should be as simple\nand as readable and maintainable as possible.</p>\n<h3 id=\"story-time-how-not-to-unit-test\" style=\"position:relative;\">Story time: how not to unit test<a href=\"#story-time-how-not-to-unit-test\" aria-label=\"story time how not to unit test permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Some random day I was cursing at my screen and my partner\nasked me why I was so mad and since she’s not a technical person\nI came up with this analogy on the fly to explain what was the problem\nand also how I would solve it.\nI believe this illustrates really well my unit test mindset:</p>\n<p>Let’s say we are building a wall lamp that would typically be used inside your house.\nThe guys who tested this lamp (unit testing) did the unthinkable: they\nbuild a testing house, with foundations, wall framing, ceiling, windows, doors, hardwood floors,\nwater pipes, heating system, insulation and a working power grid; they then proceeded\nto install the lamp that they were testing, and finally flipped the right wall switch to see if\nit worked.</p>\n<p>How I would have done it differently? I would just reveal the contacts and give them\npower by the simplest possible means (without risking my life), like for example:\nwiring them to a circuit with power!</p>\n<p>My partner hugged me and left feeling sorry for me.</p>\n<p>The point of this story is to emphasize that we need to have a clear\nmind set when unit testing our code, we need to ensure that we are testing an isolated unit,\nthat we are testing it in the simplest way that can provide the verifications we\nlook for, nothing more.</p>\n<p>Which brings up my coding mindset: <strong>clarity then simplicity then consistency</strong>\nwhich I will most likely be talking about in a follow up post.</p>\n<p>So remember: <strong>do not build a house around the lamp you want to test, simply connect it\nto a cable with power and be done with it.</strong></p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>As you can see, there’s a lot to love about Jest.</p>\n<p>Jest can be considered a composition of a bunch of libraries into a\nnice tight package that works out of the box:</p>\n<p><a href=\"https://mochajs.org/\">jest</a> =\n<a href=\"https://mochajs.org/\">mocha</a> +\n<a href=\"https://www.chaijs.com/\">chai</a> +\n<a href=\"https://github.com/power-assert-js/power-assert\">power-assert</a> +\n<a href=\"https://sinonjs.org/\">sinon</a> +\n<a href=\"https://github.com/jhnns/rewire\">rewire</a> +\n<a href=\"https://istanbul.js.org/\">instanbul</a> +\nmore</p>\n<p>I encourage you to consider it for your next project, it works well for\nNodejs and Browser projects, it works well with plain old Javascript or ES6+ or Typescript,\nand it has really nice integrations with <a href=\"https://reactjs.org/\">React.js</a>.</p>\n<p>Liked the content? Consider supporting us below.</p>\n<p>Want to know more? Consider joining our mailing list below.</p>","excerpt":"Why I love Jest and why should consider it for your next project. Jest is a full-blown, batteries included, ready to rock, testing framework…","fields":{"slug":"/why-i-love-jest/","readingTime":{"text":"7 min read"}},"frontmatter":{"title":"Jest makes unit testing fun again","date":"November 04, 2020","description":"Why I love Jest and why you should consider it for your next project.","tags":["jest","typescript","javascript","unit testing","mock","Node.js","mocha","React.js","jsdom"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<h2 id=\"table-of-contents\" style=\"position:relative;\">Table of Contents<a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#so-what-is-openid-connect\">So what is OpenId Connect?</a></li>\n<li><a href=\"#thats-fine-but-why-should-i-care\">That’s fine, but why should I care?</a></li>\n<li>\n<p><a href=\"#show-me-the-code\">Show me the code!</a></p>\n<ul>\n<li><a href=\"#a-note-on-tooling\">A note on tooling</a></li>\n<li><a href=\"#step-1-what-are-we-building\">Step 1: What are we building?</a></li>\n<li><a href=\"#step-2-initializing\">Step 2: Initializing</a></li>\n<li><a href=\"#step-3-log-in\">Step 3: Log In</a></li>\n<li><a href=\"#step-4-persistent-session\">Step 4: Persistent Session</a></li>\n<li><a href=\"#step-5-log-out\">Step 5: Log Out</a></li>\n<li><a href=\"#step-6-putting-it-all-together\">Step 6: Putting it all together</a></li>\n<li><a href=\"#step-7-single-sign-on\">Step 7: Single Sign On</a></li>\n</ul>\n</li>\n<li><a href=\"#bonus-the-complete-sequence-diagram-of-oidc-authentication\">Bonus: the complete sequence diagram of oidc authentication</a></li>\n<li><a href=\"#bonus-what-are-the-access-refresh-and-id-tokens\">Bonus: what are the access, refresh and id tokens?</a></li>\n<li><a href=\"#exercise-1\">Exercise 1</a></li>\n<li><a href=\"#closing\">Closing</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Let’s build the basic boilerplate for an OpenId Connect based Authentication mechanism\nfor our Node.js / Typescript app that supports SSO (Single Sign On experience) out of the box\nand that will fit very well with a microservice architecture with no statefulness added.</p>\n<p>This sort of setup is great for microservice architectures because</p>\n<ul>\n<li>it provides clear authentication (and authorization) interfaces based on industries best practices</li>\n<li>it works well with self contained auth tokens that can be used for communications across microservices</li>\n<li>it requires no extra stateful layers (such as session databases)</li>\n<li>it can be easily expanded to make up a Single Sign on experience across multiple apps and even across companies.</li>\n</ul>\n<h2 id=\"so-what-is-openid-connect\" style=\"position:relative;\">So what is OpenId Connect?<a href=\"#so-what-is-openid-connect\" aria-label=\"so what is openid connect permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>OpenId Connect (a.k.a oidc) is an <em>interoperable authentication protocol</em> based on the OAuth 2.0 family of specifications.</p>\n<p><a href=\"https://openid.net/connect/faq/\">src</a></p>\n</blockquote>\n<p>The line between OpenId and OAuth is blurry in practice and in learning material in the web the concepts\nare sometimes a mix and match of both.</p>\n<p>I like to think of OpenId and OAuth as a set of specifications that\ndefine standard APIs for Authentication and Authorization, respectively.</p>\n<blockquote>\n<p>OpenID Connect lets developers authenticate their users across websites and\napps without having to own and manage password files. For the app builder,\nit provides a secure verifiable, answer to the question:\n“What is the identity of the person currently using the browser or native app that is connected to me?”</p>\n<p><a href=\"https://openid.net/connect/faq/\">src</a></p>\n</blockquote>\n<p>This has enabled 3rd party Authentication providers and the always present “Log In with X”\nyou see around the web, such Auth providers include Google (the one we use in the example code),\nAuth0, Microsoft, Okta, among many others. <a href=\"https://openid.net/certification/\">See certified providers here</a></p>\n<p>Additionally, OpenId Connect can be used in enterprise settings like shared Auth and Identity provider\nacross many apps (think about Microsoft active directory, or Okta’s service)\nproviding a Single Sign On experience; and also as a way of structuring a microservice\narchitecture with multiple “clients” (OAuth lingo for applications that interact with the Auth Server).</p>\n<p>If you want to go down the rabbit hole and learn more check these resources out</p>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=996OiexHze0\">Nate Barbettini’s OAuth and OpenId in plain English</a></li>\n<li><a href=\"https://developer.okta.com/blog/2019/10/21/illustrated-guide-to-oauth-and-oidc\">Okta’s Ilustrated Guide to Oauth and OpenId Connect</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc6749\">IEEE OAuth 2.0 RFC</a> (it is dense but has all the details)</li>\n</ul>\n<p>Here is a nice illustration of one of the most common ways of Authenticating with\nOAuth 2.0 and OpenId Connect: the authorization code flow</p>\n<p><img src=\"/46184ddba11a21c92840104b5eab19a9/flow1.svg\" alt=\"OAuth OpenId high level flow diagram\"></p>\n<blockquote>\n<p>Source: heavily inspired by this <a href=\"https://www.youtube.com/watch?v=996OiexHze0\">Nate Barbettini’s presentation</a></p>\n</blockquote>\n<h2 id=\"thats-fine-but-why-should-i-care\" style=\"position:relative;\">That’s fine, but why should I care?<a href=\"#thats-fine-but-why-should-i-care\" aria-label=\"thats fine but why should i care permalink\" class=\"header-anchor after\">#</a></h2>\n<p>OAuth 2.0 and oidc have become ever present in the modern application development landscape and\nalthough the tooling is really good and hides a lot of details chances are that you will still require\na decent high level understanding of what you are doing.</p>\n<p>This applies both to already existing applications and to the practice of designing and creating new\napplications with modern architectures such as microservice oriented one.</p>\n<p>I will try to find the sweet spot between comprehensive and high level coverage, let’s hope\nI can achieve it.</p>\n<h2 id=\"show-me-the-code\" style=\"position:relative;\">Show me the code!<a href=\"#show-me-the-code\" aria-label=\"show me the code permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Let’s build a simple application that uses OAuth 2.0 and oidc. The idea is to show</p>\n<ul>\n<li>how to use 3rd party Auth and Identity providers</li>\n<li>how to integrate those mechanisms with something familiar to the web platform: session cookies!</li>\n<li>how to easily manage sessions in the Request-Response web app cycle (no libs here!)</li>\n<li>how the session can be structured to be self contained for a stateless session management</li>\n<li>security implications</li>\n<li>how this application can be used to achieve SSO (single sign on experience across multiple apps)</li>\n</ul>\n<p>You can check the full code <a href=\"https://github.com/franleplant/sso-with-openid\">here</a>.</p>\n<h3 id=\"a-note-on-tooling\" style=\"position:relative;\">A note on tooling<a href=\"#a-note-on-tooling\" aria-label=\"a note on tooling permalink\" class=\"header-anchor after\">#</a></h3>\n<p>I have found a nice certified NodeJs library called <a href=\"https://github.com/panva/node-openid-client\">openid-client</a>, it is a nice library with\ndecent Typescript support that makes it very easy to integrate Identity providers.</p>\n<p>Another really cool thing about OpenId Connect is the concept of <a href=\"https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata\">Discovery</a> which\nbasically means that although there are a bunch of parameters involved in setting up a proper\noidc flow like multiple urls, encryption algorithms, public keys to verify tokens, etc;\nyou really just need to use one url and, if the client library you are using supports it, the client will\nuse this Discovery mechanism to look for a <a href=\"https://developers.google.com/identity/protocols/oauth2/openid-connect#discovery\">Discovery Document</a> that contains all the necessary parameters\nand you are good to go!. <code class=\"language-text\">openid-client</code> supports this!.</p>\n<h3 id=\"step-1-what-are-we-building\" style=\"position:relative;\">Step 1: What are we building?<a href=\"#step-1-what-are-we-building\" aria-label=\"step 1 what are we building permalink\" class=\"header-anchor after\">#</a></h3>\n<p>We are going to use a top-down approach, so first we are going to cover how the app\nworks at the business logic level and in later steps we are going to cover\nthe “lib” side of things where we implement the proper express middleware, session management,\ncookie storage, etc.</p>\n<p>The app is really simple, it has two content routes</p>\n<ul>\n<li><code class=\"language-text\">/</code> or the home where we show the “login” button and it is public.</li>\n<li><code class=\"language-text\">/private</code> were we display some information about the currently logged in user. If there is no user logged in we simply display an error.</li>\n</ul>\n<p>Here are some pictures:</p>\n<style>\n.screen-img img {\n  border: 3px solid #CCC;\n}\n</style>\n<div class=\"screen-img\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a206f12438f888385b39a4f2b0273f22/91f10/screen1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.486486486486484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABKklEQVQoz62OyU7CABRF+x0ODGllbIFYZhnERBADMiiIgrLQhQvZ4x+6d01MjIlxgVhaTTSkx7Ybcau+l5Pc+/Jyc4WiL8hByU+oIKFEVArFHSp7NXbL+1SrdZKpLTbVFGo8TSqdI5HMEgjKiBsB3B4Rl9vLyqqLtXUPHq+EoISjKLJCICyjJjLELTLZArn8NvlCyQmLxlSCoQhhOUbI+veKPkTJj2SFRmJ2iRLpVNbyQYTe6YBur89R54T+YEir3aHT7Vn6nMHZ0Lof02i2rcZVypVvavUGzdYhF5dXjMc3jK5Hlu8gPEyeuLud8Hj/jPGmo8915g5zNG3uaF3XMQzjB/bNRtM0ptMXZrNXxwuLT5OP9wXmgn8ZAUxHmPaaf0dYNk7wkv7NfAHwA6HMtsDrswAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Initial public screen with login link\"\n        title=\"Initial public screen with login link\"\n        src=\"/static/a206f12438f888385b39a4f2b0273f22/fcda8/screen1.png\"\n        srcset=\"/static/a206f12438f888385b39a4f2b0273f22/12f09/screen1.png 148w,\n/static/a206f12438f888385b39a4f2b0273f22/e4a3f/screen1.png 295w,\n/static/a206f12438f888385b39a4f2b0273f22/fcda8/screen1.png 590w,\n/static/a206f12438f888385b39a4f2b0273f22/efc66/screen1.png 885w,\n/static/a206f12438f888385b39a4f2b0273f22/91f10/screen1.png 992w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9613b16e4e1c9d8bcd95bda6862bff04/0f7d5/screen2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 108.1081081081081%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAADm0lEQVQ4y52UW28bRRTHV7zDJyi0NM2lTQNpkzQpubVxGse5VC0SICFe+gBI8Gl4QMA7EgJU8VS1VaUWwu0BpSWpL0lvib12GttZ73pv3vXuzp9zxnG7MqGVGOm3Z+bM7Jkz58wcJXniBJKz3egaeROLyQVcuvweps8lMDU1g+T8ImYSSSRm5zExeQ5Dw2MYHjmL3r5+HOvuw+EjXXjj8FEcev2IhMfK6YFBvD04gOMDJzEzm8T0+QsYG5vAmdFxMjyLd8anMEnGR0l3emgUg6eG0d1zHEe7etB1rBcDb52ijUYlPb39UBaXL2MuuYSFhYtYvviu9OTC3DxSqSWSKaQWlrG0fInWpJBIzMl53mTkzFmMT0zj/Q8+xCeffk58Jk+iPN7MIpvbIHLIZnNSptMZPHz0CMViiShKVLVFe9yeK6gq8vm8hMdKKEJ4fhONRgMNz4NHWLaNZhDg/zRFCPGieRGTURz6L6LGH8Rky2AcbgF5p+s6HMeBbdvCdV0wPGZJOvi+39qpw6MDDfLxOY4bm5tiff0+x9bPZDLlv9fWKul0urK6ulrWqLXtiVaT/ysdSg5cYJpmUC6XA0qCt7OzA8MwflWo0dxrxKvEK8QIrXfjBuMxFPvuS2Wz2ZTHYizL5kTdJfUgxWiS1kyQHCL5EeHFY/3MwygM0fQ9g/rfkfJ7kswPxLfEvfZi3q8zPI7rirppwqUwsYoNhur2E/yxcvvuz3dWeKy4AZQGJSyQG0Yf7zvA3oTPESxlwizTFJ7XaB3ZDyEM00FFMzWniS8tD18TXxHfEF84vvjT9SMQESE68SjqbIOl1yQPSnTQTdUUubyO3HYNaw92cW+jhPuPK1h/uIss6Uo6hFqLUDwAVXsOjxXdgagYPnZrDfFUc4NixQpKVbsF9UkfaVYEzQrFf4A9k2UE3ZExEi97TfHXchCxNa0s00X26K7VUavp4IxpWk32JbrBc4Ln63VTrtNIX93bg24YvEZUqlWZZZkU/hj1Op5sbSFfKGDn6S628wVsbVMFKaiCLnfI43Qme+XGzVuHVn77vf/2nV/6frz6UzcVkQe27dBG9aj9FKXBkO4hv9+4bPWpFoWR4D61v4hrxM19rhPWvy72S6rNszjGL3P8n3hxaL8UWUHovYLesJR0BKnjchT7h0tWSBUnJH1IBYT7co76ohGPoWVZKJcrMgl7FOwqBZnfcKdHLHlTDgEb4M1Z1y5p3P4B1uUI60DGan0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Authenticating with the oidc provider\"\n        title=\"Authenticating with the oidc provider\"\n        src=\"/static/9613b16e4e1c9d8bcd95bda6862bff04/fcda8/screen2.png\"\n        srcset=\"/static/9613b16e4e1c9d8bcd95bda6862bff04/12f09/screen2.png 148w,\n/static/9613b16e4e1c9d8bcd95bda6862bff04/e4a3f/screen2.png 295w,\n/static/9613b16e4e1c9d8bcd95bda6862bff04/fcda8/screen2.png 590w,\n/static/9613b16e4e1c9d8bcd95bda6862bff04/efc66/screen2.png 885w,\n/static/9613b16e4e1c9d8bcd95bda6862bff04/0f7d5/screen2.png 993w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/38ecb057c330665f2189718f37b62f20/0f7d5/screen3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACFUlEQVQoz52S0W4SQRSG9z2qQgtYWmEBhdIu7VIWCm0BGyKJNkavvFBvrBc+hKnBxGh8Ak24qr6DF4WCwZqYeFWTIstCIgki7LK78zsDtKm1JdGTfHt2zsx+ZyazXHTaifiyHY6gDR4+gCVRQjyxjmhsFWvraSQSSUSkFXh9AcwFQ/AHFuCcccHucMJiteGSZQoTFyyYuGiFlY45r8sLnndhxu1GYC5EEbAgiAgthiGGJQghkYoEuPmr8Hj9mL3Cwzppx+SUAzb7NFy8D4KwhPl5AY7Ls+A2MlkkUxmSSmdwI3uLSNG4HltZ1VPpjQHhZUkXw5FBDi2Kus/nN675g4RJIpEY2bx9F1uPHuPh/Qf0ZElwlUoFhUIBn/b3ye5uAXt7JZTLZRSLRZRKZdRqNTSbTShKA40GZfSuKAqpKwpkWcZhtYpq9TvYmGu1WmzSZB+12+0DXde3u91uTlXVnKZpOQBHPKc8pbyhmBgGwangmEiu1w25MRB+oDUnxUPhGZrW53s9lacNvLSRgzbcNIcBChnlYzhmPfj6BW9fPSO6YQzbEvIHR7VT8VdhsEP2aCuHZGf7CX52frFFBu1kUAGzH+cTmCdk5Ezh65cvyPXkGnbevSejRWS4KXJmHiv8XPmIe3du0l8mi3w+D61jQv72A31VP++oY4OjFzG4+oZSh6ap6HX6aCkd6H3j/4TjJv9VxuI3lzUMlUViVrgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Back to our private route in our app\"\n        title=\"Back to our private route in our app\"\n        src=\"/static/38ecb057c330665f2189718f37b62f20/fcda8/screen3.png\"\n        srcset=\"/static/38ecb057c330665f2189718f37b62f20/12f09/screen3.png 148w,\n/static/38ecb057c330665f2189718f37b62f20/e4a3f/screen3.png 295w,\n/static/38ecb057c330665f2189718f37b62f20/fcda8/screen3.png 590w,\n/static/38ecb057c330665f2189718f37b62f20/efc66/screen3.png 885w,\n/static/38ecb057c330665f2189718f37b62f20/0f7d5/screen3.png 993w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</div>\n<p>There are at least two additional routes that have to do with the OAuth flow\nthat we will cover later.</p>\n<p>This is the <code class=\"language-text\">index.ts</code> that makes up the high level app implementation, think of this\nas a mix of the boilerplate plus the two domain / business specific routes.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Necessary for express to parse the cookies into a nice</span>\n<span class=\"token comment\">// higher level object</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">cookieParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// initialises the Issuer and the Client</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">.</span>initialize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Deals with the user session</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Adds the OAuth / OpenId necessary routes.</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">.</span><span class=\"token function\">routes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// use the pre configured view engine</span>\n  <span class=\"token comment\">// to render the index.mustache file</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/private\"</span><span class=\"token punctuation\">,</span> auth<span class=\"token punctuation\">.</span>requireAuth<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// This is the main high level hook for the user</span>\n  <span class=\"token comment\">// session, we will be building this later</span>\n  <span class=\"token keyword\">const</span> claims <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>session<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>tokenSet<span class=\"token punctuation\">.</span><span class=\"token function\">claims</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// render private.mustache and interpolate</span>\n  <span class=\"token comment\">// the following data</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"private\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    email<span class=\"token operator\">:</span> claims<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">,</span>\n    picture<span class=\"token operator\">:</span> claims<span class=\"token punctuation\">.</span>picture<span class=\"token punctuation\">,</span>\n    name<span class=\"token operator\">:</span> claims<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Express started on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Next we will cover more details (descending into the details).</p>\n<h3 id=\"step-2-initializing\" style=\"position:relative;\">Step 2: Initializing<a href=\"#step-2-initializing\" aria-label=\"step 2 initializing permalink\" class=\"header-anchor after\">#</a></h3>\n<p>First we need to initialize the <a href=\"https://github.com/panva/node-openid-client\">openid-client</a>\nIssuer (the one that discovers all the publicly available OpenId configuration) and later the Client\n(the one that we will use to make all the underlying HTTP calls).\nWe will abstract this step into a middleware and save the instances into the <code class=\"language-text\">req.app</code> object\nsince these things need to be instantiated once per app.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>\n  req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span>\n  res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span>\n  next<span class=\"token operator\">:</span> NextFunction\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>authIssuer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> googleIssuer <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Issuer<span class=\"token punctuation\">.</span><span class=\"token function\">discover</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"https://accounts.google.com\"</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">googleIssuer</span><span class=\"token punctuation\">.</span><span class=\"token function\">Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    client_id<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">OAUTH_CLIENT_ID</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n    client_secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">OAUTH_CLIENT_SECRET</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n    redirect_uris<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getDomain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/auth/callback</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    response_types<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"code\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  req<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>authIssuer <span class=\"token operator\">=</span> googleIssuer<span class=\"token punctuation\">;</span>\n  req<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>authClient <span class=\"token operator\">=</span> client<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Note: <code class=\"language-text\">getDomain</code> is a thin helper that returns exactly this <code class=\"language-text\">http://${process.env.HOST}:${process.env.PORT}</code>.</p>\n<h3 id=\"step-3-log-in\" style=\"position:relative;\">Step 3: Log In<a href=\"#step-3-log-in\" aria-label=\"step 3 log in permalink\" class=\"header-anchor after\">#</a></h3>\n<p>We have a nice comprehensive sequence diagram of the all the HTTP redirects and\ninteractions that make up the complete OAuth / OpenId Connect authorization code flow\nbelow in a <a href=\"#bonus-the-complete-sequence-diagram-of-oidc-authentication\">bonus section</a></p>\n<p>In this step we are going to build the two endpoints necessary for this type of auth flow:</p>\n<ol>\n<li>Auth entry point: Create a route that redirects to the right oidc provider authentication page and that kicks starts the whole auth flow, in our case we simply called it: <code class=\"language-text\">/auth/login</code> but you can use whatever you like.</li>\n<li>Callback: Create a route that the oidc provider will redirect back from the auth page with the auth code that we will later exchange for the proper access, id and refresh tokens. In our case we simply called it <code class=\"language-text\">/auth/callback</code> but again it can be whatever you want it to be.</li>\n</ol>\n<p>We also encapsulated these routes into a nice middleware that we called <code class=\"language-text\">auth.routes</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// Auth entry point.</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/auth/login\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Check the full code to see a</span>\n  <span class=\"token comment\">// concrete implementation of this</span>\n  <span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token function\">calcState</span><span class=\"token punctuation\">(</span>extraContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// calculate the url where we want to redirect to</span>\n  <span class=\"token keyword\">const</span> authUrl <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>authClient<span class=\"token punctuation\">.</span><span class=\"token function\">authorizationUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    scope<span class=\"token operator\">:</span> <span class=\"token string\">\"openid email profile\"</span><span class=\"token punctuation\">,</span>\n    state<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">setAuthStateCookie</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span>authUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Callback</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/auth/callback\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>authClient<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// extract all the necessary query params</span>\n  <span class=\"token comment\">// like the authorization code.</span>\n  <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">callbackParams</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// read the state cookie</span>\n  <span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token function\">getAuthStateCookie</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// exchange the authorization code for the access,</span>\n  <span class=\"token comment\">// refresh and id token, this is what makes up the</span>\n  <span class=\"token comment\">// main `Back channel` communication, it is considered</span>\n  <span class=\"token comment\">// more secure and will include client_id and client_secret.</span>\n  <span class=\"token keyword\">const</span> tokenSet <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getDomain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/auth/callback</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    params<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// The lib will compare the state that the</span>\n    <span class=\"token comment\">// identity provider passes as params</span>\n    <span class=\"token comment\">// with the one we stored in the cookies.</span>\n    <span class=\"token punctuation\">{</span> state <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// We can fetch the userinfo (basic identity attributes)</span>\n  <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">userinfo</span><span class=\"token punctuation\">(</span>tokenSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Set the session cookie,</span>\n  <span class=\"token comment\">// we could also set req.session but</span>\n  <span class=\"token comment\">// since we are returning immediately is not</span>\n  <span class=\"token comment\">// a must</span>\n  <span class=\"token keyword\">const</span> sessionCookie <span class=\"token operator\">=</span> <span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tokenSet<span class=\"token punctuation\">,</span> user <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setSessionCookie</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> sessionCookie<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Notes:</p>\n<ul>\n<li>check the <a href=\"https://github.com/franleplant/sso-with-openid\">complete code</a> to see how to implement logout and a back-to-original-route mechanism</li>\n</ul>\n<p>As you can see the <em>Auth entry point</em> is a very simple sync redirect to the Identity provider’s login,\nthe library is doing a lot of the work for us but the <code class=\"language-text\">authUrl</code> will contain the <code class=\"language-text\">client_id</code>,\nthe callback url <code class=\"language-text\">http://host:port/auth/callback</code> in our case, required <code class=\"language-text\">scopes</code>, etc.\nThis is also what we call the “Front channel” and it is considered not entirely secure, that is why\nwe are not sending the client secret at this stage, remember that this happens all in the browser via\nHTTP redirects.</p>\n<p>The <em>Callback</em> will be redirected from a successful login with the Identity provider and\nwill exchange the authorization code for the tokens (check inline comments).\nThis is the step where we more commonly deal with persistent sessions, notice that\nthe Identity Provider doesn’t deal with this and that’s something we need to deal with ourselves.</p>\n<p>Check the <code class=\"language-text\">state</code> parameter, this acts as a sort of <a href=\"https://en.wikipedia.org/wiki/Cross-site_request_forgery\">XSRF a.k.a. CSRF a.k.a. csurf</a> token that we can use to\nprevent XSRF attacks but also to store <em>state</em> across the OAuth flow. See exercise at the bottom for more info.\nCheck the <a href=\"https://github.com/franleplant/sso-with-openid\">full code</a> for a concrete but very simple working implementation.</p>\n<p>We are going to use a very simple self contained stateless strategy here, we will cover it in more details\nin the next section but at a high level what we are doing is setting a persistent cookie (the session cookie)\nthat will travel in all requests from the browser to our local server and that we will use to identify\nusers that already identified themselves.</p>\n<h3 id=\"step-4-persistent-session\" style=\"position:relative;\">Step 4: Persistent Session<a href=\"#step-4-persistent-session\" aria-label=\"step 4 persistent session permalink\" class=\"header-anchor after\">#</a></h3>\n<p>There are several ways of handling sessions but in most cases\nit all boils down to persisting a session across requests and\nidentifying requests with one or zero sessions, meaning, identifying the\nalready authenticated and identified users that are making requests to our app or simply\nacknowledging that there is no previously authenticated user.</p>\n<p>Sessions are most commonly persisted in the form of a long lived cookie in the browsers and\ntheir content might be a session id that is mapped to the session object in a database\nserver side which is the stateful solution; or the content might be the entire self contained session object,\nwhich is the stateless solution, this is a simpler approach that will work for us\nand that has its merits in the microservice architecture.</p>\n<blockquote>\n<p>Why do we care about stateless vs stateful? Having a self contained cookie means that we can\nknow certain facts about the authenticated users without having to either interact with a database\nor another service. Stateless is desired as much as possible because it is easy to horizontally scale\ni.e. adding more instances of the app running in other nodes in our cluster, whereas scaling stateful\nservices is another whole challenge (think about master slave relationship between databases,\nreplication, backup, consistency considerations, etc).\nThe typical solution for a stateful session is to store a simple session id in the browser and then associate\nthat id in a key value database such as <a href=\"https://redis.io/\">redis</a></p>\n</blockquote>\n<p><strong>When do we write the session cookie?</strong></p>\n<p>We write it at two main steps:</p>\n<ul>\n<li>after login in</li>\n<li>after refreshing the auth tokens (not necessary in a stateful session schema)</li>\n</ul>\n<p>We also clear it in two main steps:</p>\n<ul>\n<li>after logout</li>\n<li>after trying to refresh a token and the refresh token has expired.</li>\n</ul>\n<p><strong>And when do we read the session cookie? And what do we do with it?</strong></p>\n<p>This where the fun begins. We read the session cookie <em>on every request</em>,\nand if we find one then we are going to parse it into a session object or instance\nand store it in the <code class=\"language-text\">req</code> object, this fits super fine because the parsed, hydrated session\nobject only applies on a particular request, the next request might belong to another user or even\nto a non authenticated user.</p>\n<p>Why do we need to parse it? Basically, we will store it as string in the cookie and when\nwe read the cookie we are going to parse it back to an object, this is a very simple approach, more\ncommonly you will store the session as a base64 encoded json object to save space and later you will\nparse it into an instance of a class so that you can cache some results and provide certain useful methods\nto the rest of the app. In our case we simply reuse the <code class=\"language-text\">TokenSet</code> class with useful methods that\nthe <a href=\"https://github.com/panva/node-openid-client\">openid-client</a> lib provides.</p>\n<p>This is a nice illustration of the flow you will soon see in code:</p>\n<style>\n.flow2 img {\n max-width: 500px;\n}\n\n.flow2 p {\ntext-align: center;\n\n}\n</style>\n<div class=\"flow2\">\n<p><img src=\"/5ddf56d912b9307f2c486659a827916a/flow2.svg\" alt=\"Session Middleware flow diagram\"></p>\n</div>\n<p>Enough talk, let’s code:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">session</span><span class=\"token punctuation\">(</span>\n  req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span>\n  res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span>\n  next<span class=\"token operator\">:</span> NextFunction\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> sessionCookie <span class=\"token operator\">=</span> <span class=\"token function\">getSessionCookie</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// If there is no session cookie it means there is no</span>\n  <span class=\"token comment\">// authenticated user associated with this request,</span>\n  <span class=\"token comment\">// no further work needed.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sessionCookie<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>authClient<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Parse the cookie into a TokenSet instance</span>\n  <span class=\"token keyword\">const</span> session <span class=\"token operator\">=</span> <span class=\"token function\">deserialize</span><span class=\"token punctuation\">(</span>sessionCookie<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Refresh the tokens if necessary</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">.</span>tokenSet<span class=\"token punctuation\">.</span><span class=\"token function\">expired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> refreshedTokenSet <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span>\n        session<span class=\"token punctuation\">.</span>tokenSet\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      session<span class=\"token punctuation\">.</span>tokenSet <span class=\"token operator\">=</span> refreshedTokenSet<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// set the cookie with the refreshed tokens</span>\n      <span class=\"token function\">setSessionCookie</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> <span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// this can throw when the refresh</span>\n      <span class=\"token comment\">// token has expired,</span>\n      <span class=\"token comment\">// logout completely when that happens</span>\n      <span class=\"token function\">clearSessionCookie</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// We also verify that the tokens inside the cookie are valid</span>\n  <span class=\"token comment\">// with public keys mechanisms covered by the JWT spec.</span>\n  <span class=\"token comment\">// This is unfortunately a private method of the lib, but basically</span>\n  <span class=\"token comment\">// it grabs the id_token and decodes it as JWT with a public key</span>\n  <span class=\"token comment\">// that we got as part as the discovery process, if this succeeds it means</span>\n  <span class=\"token comment\">// that the token inside the cookie is a token that has been crated by our</span>\n  <span class=\"token comment\">// identity provided and thus it is secure and fine and we can trust it.</span>\n  <span class=\"token keyword\">const</span> validate <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>validateIdToken <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">,</span> session<span class=\"token punctuation\">.</span>tokenSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bad token signature found in auth cookie\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bad Token in Auth Cookie!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// After all that work the only thing remaining is</span>\n  <span class=\"token comment\">// to store the valid session object into req.session</span>\n  <span class=\"token comment\">// for the rest of the app to use.</span>\n  req<span class=\"token punctuation\">.</span>session <span class=\"token operator\">=</span> session<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>What might the rest of the app do with <code class=\"language-text\">req.session</code>?\nJust to give some ideas:</p>\n<ul>\n<li>check if there is a user logged in (i.e. only allowing to view certain content to authenticated users)</li>\n<li>display information about the logged in user, such as menu icons etc</li>\n<li>fetch data associated with a user to a database or another service</li>\n<li>check user permissions and create a more complex allow list of routes</li>\n<li>many many more things.</li>\n</ul>\n<p>The main point of this middleware (which is inspired by prior work such as\n<a href=\"https://www.npmjs.com/package/express-session\">express-session</a> and <a href=\"http://www.passportjs.org/\">Passport.js</a>) is to abstract all the logic of\nparsing the session cookie, refreshing if necessary and hydrating the <code class=\"language-text\">req.session</code> object\nin a single place, the rest of the app can rely on that being there and that nothing else will\nneed to be done there.</p>\n<p>We also have a nice example middleware that prevents non authenticated users to access\ncertain routes:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">requireAuth</span><span class=\"token punctuation\">(</span>\n  req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span>\n  res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span>\n  next<span class=\"token operator\">:</span> NextFunction\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> session <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unauthenticated\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Of course this will only work if the <code class=\"language-text\">session</code> middleware runs first in the middleware chain\nand this runs later, that is why it is important that your session middleware to be run as early as possible,\nat least before your routes definitions.</p>\n<h3 id=\"step-5-log-out\" style=\"position:relative;\">Step 5: Log Out<a href=\"#step-5-log-out\" aria-label=\"step 5 log out permalink\" class=\"header-anchor after\">#</a></h3>\n<p>In here you have two options:</p>\n<ul>\n<li>Logging out of just your app</li>\n<li>Logging out entirely out of the identity provider</li>\n</ul>\n<p>We are going to use the first approach:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/auth/logout\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>authClient<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> tokenSet <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>session<span class=\"token operator\">?.</span>tokenSet<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Make sure the access token we got from the identity provider</span>\n  <span class=\"token comment\">// gets revoked, this is for security reasons</span>\n  <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">revoke</span><span class=\"token punctuation\">(</span>tokenSet<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>access_token<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Clean up session cookies</span>\n  <span class=\"token function\">clearSessionCookie</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"step-6-putting-it-all-together\" style=\"position:relative;\">Step 6: Putting it all together<a href=\"#step-6-putting-it-all-together\" aria-label=\"step 6 putting it all together permalink\" class=\"header-anchor after\">#</a></h3>\n<p>With a little bit of express experience we can encapsulate all the previous logic\ninto nice middlewares and leave the rest of the app to deal with domain / business logic.</p>\n<p>We put all the authentication related code in the <code class=\"language-text\">auth</code> directory, and the high level api is\nmade up of middlewares. You can use middleware factories for more complex use cases (functions that accept\noptions and return middlewares, and yes, the router <em>is</em> a middleware).</p>\n<h3 id=\"step-7-single-sign-on\" style=\"position:relative;\">Step 7: Single Sign On<a href=\"#step-7-single-sign-on\" aria-label=\"step 7 single sign on permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Single Sign On (SSO) means that if you are already authenticated with one app using the same\nOpenId Identity Provider then you will be almost automatically authenticated we other apps.</p>\n<p>We have set a nice example in the repo, check instructions to see it in action <a href=\"https://github.com/franleplant/sso-with-openid\">here</a>.</p>\n<p>How does it work?</p>\n<ul>\n<li>the Session cookie is completely independent in each app (see the domain note on the repo’s README).</li>\n<li>If you already logged in with app1 then when you try to login with app2 then you won’t need to introduce your credentials and the OAuth flow will happen without you (the user) needing to do anything, that is why I say it is almost automatic.</li>\n</ul>\n<h2 id=\"bonus-the-complete-sequence-diagram-of-oidc-authentication\" style=\"position:relative;\">Bonus: the complete sequence diagram of oidc authentication<a href=\"#bonus-the-complete-sequence-diagram-of-oidc-authentication\" aria-label=\"bonus the complete sequence diagram of oidc authentication permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Most of the time you will see this sequence diagram simplified, but I wanted\nto show you in full details all the steps and http redirects there are inside this\ntransaction, most of the time you won’t need to worry about these but I think\nit is a nice exercise to have it detailed fully like this:</p>\n<p><img src=\"/be05b5e82862d20b8aa6cde5ca810ca4/flow3.svg\" alt=\"OAuth OpenId authorization code flow sequence diagram\"></p>\n<h2 id=\"bonus-what-are-the-access-refresh-and-id-tokens\" style=\"position:relative;\">Bonus: what are the access, refresh and id tokens?<a href=\"#bonus-what-are-the-access-refresh-and-id-tokens\" aria-label=\"bonus what are the access refresh and id tokens permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Each identity provider might use them differently but these are\nsome of the core ideas behind each of them</p>\n<ul>\n<li><em>access token</em>: an opaque value with a short expiration that the identity server uses to identify a user (think of it as a portable session id)</li>\n<li><em>refresh token</em>: another opaque value with a longer expiration that it is used to refresh the access token and the id token. Long lived sessions are typically handled by this two step process to give more control to identity providers.</li>\n<li><em>id token</em>: this is what OpendId Connect adds, this is a self contained jwt that contains claims (attributes) about the identity of the currently logged in user. This is what makes sense the most to use inside your own system to check the identity of the user. You can cryptographically verify its validity and it will contain minimal information such as the <code class=\"language-text\">sub</code> id (the subject id or the user id), the email, the names, etc.</li>\n</ul>\n<h2 id=\"exercise-1\" style=\"position:relative;\">Exercise 1<a href=\"#exercise-1\" aria-label=\"exercise 1 permalink\" class=\"header-anchor after\">#</a></h2>\n<p>How would you implement a “back to” functionality?</p>\n<p>Let’s say that you originally tried to access <code class=\"language-text\">/private/route/1</code> but you weren’t authenticated yet\nso we redirected you to <code class=\"language-text\">/auth/login</code>.\nAfter going through all the auth flow we would like for the app to redirect automatically back\nto <code class=\"language-text\">/private/route/1</code>.</p>\n<details>\n  <summary>Show me the answer</summary>\n<p>See answer <a href=\"https://github.com/franleplant/sso-with-openid/blob/master/src/auth/routes.ts#L31-L43\">here</a>. A couple of notes:</p>\n<ul>\n<li>you basically store a <code class=\"language-text\">backTo</code> param in the state and in the cookie</li>\n<li>you can store more stuff in the <code class=\"language-text\">state</code></li>\n<li>we need it also in the cookie to prevent XSRF.</li>\n<li>Check the <a href=\"https://tools.ietf.org/html/draft-bradley-oauth-jwt-encoded-state-00\">IETF standard</a> and read more <a href=\"https://auth0.com/docs/protocols/state-parameters\">here</a></li>\n</ul>\n</details>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Did you like the content? Consider sharing it in your social circle and subscribing\nto receive awesome exclusive content right into your email box.</p>","excerpt":"Table of Contents Introduction So what is OpenId Connect? That’s fine, but why should I care? Show me the code! A note on tooling Step…","fields":{"slug":"/openid-oauth-authentication-for-nodejs/","readingTime":{"text":"19 min read"}},"frontmatter":{"title":"Authenticating your Node.js app with Google as an OpenId Connect Provider","date":"October 23, 2020","description":"Let's build the basic boilerplate for OpenId Connect based authencation with Google as Identity provider, persistent session cookies, express middleware in Typescript and Node.js","tags":["TypeScript","Javascript","Nodejs","express","OpenId Connect","oidc","OAuth 2.0","middleware","Single Sign On","microservice"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>This is going to be a quick post about solving the\ngreat old question: <em>“how to create route namespaces with Express”</em>.</p>\n<p><a href=\"#the-complete-example\">Show me the answer</a></p>\n<p>This isn’t at all an advanced technique but we have either very old\nposts talking about how to do it the old way; or we have libraries to\ndo it or; we have the Express documentation which rather\n<em>inexpressive</em> if you pardon a pun.</p>\n<p>First of all, the Express docs are purely API docs, they tend to not\ncover too much real world scenarios or “recipes” as some call them.</p>\n<p>This is specially hard on newcomers that might not have all the\nnecessary http, frameworks, nodejs, express idiosyncracy context\nin their heads yet.</p>\n<p>So, the closest thing we have to an answer in the Express docs are <a href=\"https://expressjs.com/en/4x/api.html#app.use\">here</a>,\nand say in a very tiny place:</p>\n<blockquote>\n<p>Since router and app implement the middleware interface, you can use them as you would any other middleware function.</p>\n</blockquote>\n<p>And later goes to actually show the closest thing to an example that\nyou will see in the docs:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">mw1</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">mw2</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> r1 <span class=\"token operator\">=</span> express<span class=\"token punctuation\">.</span><span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nr1<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> r2 <span class=\"token operator\">=</span> express<span class=\"token punctuation\">.</span><span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nr2<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> subApp <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsubApp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>mw1<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>mw2<span class=\"token punctuation\">,</span> r1<span class=\"token punctuation\">,</span> r2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> subApp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, this is rather blunt and inexpressive and it is using\nquite old javascript.</p>\n<p>The answer is actually right here but you will never\nfind it just by googling: <em>“how to create namespaces in express”</em> or\nany other variant.</p>\n<h2 id=\"the-answer\" style=\"position:relative;\">The Answer<a href=\"#the-answer\" aria-label=\"the answer permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Although we’ve seen the answer in a very <em>expressive</em> way in the\nExpress docs, here we present it a little bit more unpacked, explained and\nwith actual real world usage in mind.</p>\n<p>One typical scenario where you would want namespacing is for example\nwhen you create a Rest api that has all its rest sources under the <code class=\"language-text\">/api</code>.</p>\n<p>So for example you would have</p>\n<ul>\n<li><code class=\"language-text\">/api/dog/</code> -> get all dogs</li>\n<li><code class=\"language-text\">/api/dog/123</code> -> get dog with id 123</li>\n<li><code class=\"language-text\">/api/cat/</code> -> get all cats</li>\n<li><code class=\"language-text\">/api/cat/123</code> -> get cat with id 123</li>\n</ul>\n<p>This is nice way of structuring your application since you might have routes\nthat are not particularly Rest resources that might go some other place.</p>\n<p>Or you might even be working on an app that also servers files and html routes,\nwhich is very common when building monolithical apps or simply smaller apps that\ndon’t require any other fancy micro-servicing.</p>\n<h3 id=\"enter-code-classlanguage-textroutercode\" style=\"position:relative;\">Enter <code class=\"language-text\">Router</code><a href=\"#enter-code-classlanguage-textroutercode\" aria-label=\"enter code classlanguage textroutercode permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Express <code class=\"language-text\">Router</code> is great way of grouping related route handlers and\nto break your app in smaller more manageable pieces.</p>\n<p>In particular, the router is great to express a single Rest Resource,\ni.e. a dog, a cat, a person, a document, etc.</p>\n<p>A common pattern to express this is the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">dogController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Router <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dog\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"get all dogs\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dog/:dogId\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">get dog with id </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>dogId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> router<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice that this is function, and that is because you typically would want to pass\nparameters when your app becomes larger, such as some configuration, contextual data,\nshared methods, etc.</p>\n<p>Right now this router isn’t <em>mounted</em> anywhere, which means that the express app\nis not serving it, so to serve it you can do the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">dogController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>At this point you will have the router mounted and if you\nmake the request you will get a response:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> http://localhost:3000/api/dog\n<span class=\"token operator\">></span> get all dogs</code></pre></div>\n<p>So how about if you need to add another controller?</p>\n<h3 id=\"how-to-create-namespaces-with-express\" style=\"position:relative;\">How to create namespaces with Express<a href=\"#how-to-create-namespaces-with-express\" aria-label=\"how to create namespaces with express permalink\" class=\"header-anchor after\">#</a></h3>\n<p>If you have followed here you will for sure\nknow the exact answer and it is the following</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token function\">dogController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">catController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>So, the end interface is rather nice, you can add\nor remove routers inside this <code class=\"language-text\">api</code> namespace by\nadding or removing controllers to the array (which\nare middleware if you didn’t know)</p>\n<p>Let’s test it out</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> http://localhost:3000/api/dog\n<span class=\"token operator\">></span> get all dogs\n\n$ $ <span class=\"token function\">curl</span> http://localhost:3000/api/dog/123\n<span class=\"token operator\">></span> get dog with <span class=\"token function\">id</span> <span class=\"token number\">123</span>\n\n$ <span class=\"token function\">curl</span> http://localhost:3000/api/cat/123\n<span class=\"token operator\">></span> get <span class=\"token function\">cat</span> with <span class=\"token function\">id</span> <span class=\"token number\">123</span>\n\n$ <span class=\"token function\">curl</span> http://localhost:3000/api/cat\n<span class=\"token operator\">></span> get all cats\n\n<span class=\"token comment\"># Other routes still work</span>\n$ http://localhost:3000/\n<span class=\"token operator\">></span> Hello World<span class=\"token operator\">!</span></code></pre></div>\n<h2 id=\"the-complete-example\" style=\"position:relative;\">The complete example<a href=\"#the-complete-example\" aria-label=\"the complete example permalink\" class=\"header-anchor after\">#</a></h2>\n<p>How to create route namespaces in express TLDR:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> express<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Router <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Fake Rest Controller for Dog resource</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">dogController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Router <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dog\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"get all dogs\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dog/:dogId\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">get dog with id </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>dogId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> router<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Fake Rest Controller for Cat resource</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">catController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Router <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/cat\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"get all cats\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/cat/:catId\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">get cat with id </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>catId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> router<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Create the api namespace and assign</span>\n<span class=\"token comment\">// any amount of routers</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token function\">dogController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">catController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Example app listening at http://localhost:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Download the code <a href=\"TODO%20REPO\">here</a>.</p>\n<p>I hope this post will ease your way into the NodeJS / Express world\nand will serve as reference in the future.</p>","excerpt":"This is going to be a quick post about solving the\ngreat old question: “how to create route namespaces with Express”. Show me the answer…","fields":{"slug":"/express-route-namespace/","readingTime":{"text":"5 min read"}},"frontmatter":{"title":"How to create route namespaces with Express","date":"August 07, 2020","description":"Let's quickly cover how to create namespaces in Express.js, something that is not so evident in the official docs and is farily common.","tags":["Javascript","Typescript","NodeJs","Express","Namespace","Router"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<p>Whether you are working on an open source library or an internal private library you\nshould master the art of <em>CHANGELOG</em>.</p>\n<p>This is a fundamental not-coding part of maintaining\nlibraries and enables consumers to understand what they can expect when moving\nfrom version to version.</p>\n<p>This is a great resource to share with your teammates inside your company so\nhopefully you can all have a common ground when maintaining internal libraries.</p>\n<h2 id=\"tldr-how-to-write-a-changelog\" style=\"position:relative;\">TLDR: How to write a CHANGELOG<a href=\"#tldr-how-to-write-a-changelog\" aria-label=\"tldr how to write a changelog permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Keep in mind:</p>\n<ul>\n<li>your primary audience are <em>humans that consume your library</em>, think of them when writing the CHANGELOG.</li>\n<li>it is sorted by last entry first (descending order)</li>\n<li>each entry has a date and a version number</li>\n<li>follow Semver</li>\n<li>\n<p>each entry should answer:</p>\n<ul>\n<li>what was added, changed, deprecated, removed, fixed, etc</li>\n<li>are there any breaking changes?</li>\n<li>Nice to have: any dependencies updates (dependencies are becoming more and more complicated so documenting any important changes here might give your consumers clues about any unexpected behaviours)</li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://keepachangelog.com/en/0.3.0/\">Keep a CHANGELOG</a> is a great standard you can follow,\nmake sure to read their docs thoroughly but here is an example following their suggested\nformat.</p>\n<p>Have in mind that this is a template, not all subsections <code class=\"language-text\">###</code> need to be added.\n<code class=\"language-text\">Component X</code> refers to software component, probably identify it by its directory path\nor by its name or by any non-abiguous id that is obvious to consumers.\n<code class=\"language-text\">**BREAKING**</code> needs to be added to any changes introduced that are not backwards compatible,\nmake sure to follow Semver (see next section).</p>\n<div class=\"gatsby-code-title code-block-title\">CHANGELOG.md</div>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token title important\"><span class=\"token punctuation\">##</span> [Unrelease]</span>\n\nAll changes that will be added in the next version\n\n<span class=\"token title important\"><span class=\"token punctuation\">##</span> [1.0.0] - 2020-05-04</span>\n\n<span class=\"token title important\"><span class=\"token punctuation\">###</span> Added</span>\n\n<span class=\"token list punctuation\">-</span> New feature A in component B\n<span class=\"token list punctuation\">-</span> ...\n\n<span class=\"token title important\"><span class=\"token punctuation\">###</span> Changed</span>\n\n<span class=\"token list punctuation\">-</span> <span class=\"token bold\"><span class=\"token punctuation\">**</span><span class=\"token content\">BREAKING</span><span class=\"token punctuation\">**</span></span> Component C now does thing D\n<span class=\"token list punctuation\">-</span> ...\n\n<span class=\"token title important\"><span class=\"token punctuation\">###</span> Removed</span>\n\n<span class=\"token list punctuation\">-</span> <span class=\"token bold\"><span class=\"token punctuation\">**</span><span class=\"token content\">BREAKING</span><span class=\"token punctuation\">**</span></span> Component E has been removed\n\n<span class=\"token title important\"><span class=\"token punctuation\">###</span> Deprecated</span>\n\n<span class=\"token list punctuation\">-</span> Component F has been depreacted and will be removed in next major release\n\n<span class=\"token title important\"><span class=\"token punctuation\">###</span> Fixed</span>\n\n<span class=\"token list punctuation\">-</span> Component G now handles scenario X correctly by doing thing Y\n\n<span class=\"token title important\"><span class=\"token punctuation\">###</span> Security</span>\n\n<span class=\"token list punctuation\">-</span> Security vulnerability in Component H has been fixed (Probably add more details.)</code></pre></div>\n<h2 id=\"real-world-scenarios\" style=\"position:relative;\">Real world scenarios<a href=\"#real-world-scenarios\" aria-label=\"real world scenarios permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li><a href=\"https://github.com/facebook/react/blob/master/CHANGELOG.md\">React</a></li>\n<li><a href=\"https://github.com/olivierlacan/metaself/blob/master/bower_components/momentjs/CHANGELOG.md\">Moment.js</a></li>\n<li><a href=\"https://github.com/facebook/jest/blob/master/CHANGELOG.md\">Jest</a></li>\n</ul>\n<h2 id=\"follow-semver\" style=\"position:relative;\">Follow <a href=\"https://semver.org/\">Semver</a><a href=\"#follow-semver\" aria-label=\"follow semver permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Unless you have very strong reasons and opinions for not\nfollowing Semver I suggest you follow it. It is a great\nstandard tool used across a variety of ecosystems with\nclear semantics and documentation.</p>\n<p>From <a href=\"https://semver.org\">https://semver.org</a></p>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\">Given a version number MAJOR.MINOR.PATCH, increment the:\n\nMAJOR version when you make incompatible API changes,\nMINOR version when you add functionality in a backwards compatible manner, and\nPATCH version when you make backwards compatible bug fixes.\n\nAdditional labels for pre-release and build metadata are available as extensions to the MAJOR.MINOR.PATCH format.</code></pre></div>\n<p>The combination of properly implemented Semver and properly\nimplemented CHANGELOG is a very powerful solution for maintaining\nlibraries.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>For mid to large sized companies it is very common to\nmaintain internal libraries (i.e. npm packages for Javascript\napplications), so it is of the outmost importance that\nwe manage them correctly since, although the audience is reduced,\nthey behave very close to the Open Source model.</p>\n<p>Most of the things we go through this post have been observed\nfrom the Open Source world, which brings me to a bonus conclusion:\n<strong><em>You can use the Open Source model as a role model for your company’s internal ecosystem</em></strong></p>\n<p>You can explore this concept in the following recommended book:</p>\n<p><a href=\"https://amzn.to/2SKqg3v\">The Cathedral &#x26; the Bazaar</a></p>\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=B0026OR3LM&asins=B0026OR3LM&linkId=a31f250867360780f8710bb9d8475b67&show_border=true&link_opens_in_new_window=true\"></iframe>\n<div id=\"amzn-assoc-ad-388ed262-d0bf-4cf6-8458-5b5d84d8a3cd\"></div><script async src=\"https://z-na.associates-amazon.com/onetag/v2?MarketPlace=US&instanceId=388ed262-d0bf-4cf6-8458-5b5d84d8a3cd\"></script>","excerpt":"Whether you are working on an open source library or an internal private library you\nshould master the art of CHANGELOG. This is a…","fields":{"slug":"/how-to-write-changelogs/","readingTime":{"text":"3 min read"}},"frontmatter":{"title":"How to write CHANGELOGs","date":"May 07, 2020","description":"Whether you are working on an open source library or an internal private library you should master the art of CHANGELOG. This is a fundamental not-code part of maintaining libraries and enables consumers to understand what they can expect when moving from version to version.","tags":["Open Source","NodeJS","library","NPM","Javascript","Typescript","package","private npm registry"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p><a href=\"https://www.gatsbyjs.org/starters/gatsbyjs/gatsby-starter-blog/\">gatsby-starter-blog</a> comes with out of the box support for a single author blog.\nBut what happens when you want to support multiple authors writing in your blog?</p>\n<p>Gatsby actually makes it very easy to do so but for people getting started with Gatsby\nit might be a bit of challenge putting all the parts together.</p>\n<p>This post hopes to show how to solve this problem holistically.</p>\n<p>This blog is actually a real life implementation of the multi author blog. Check our <a href=\"https://github.com/franleplant/nosleepjavascript-blog\">source</a>!</p>\n<h2 id=\"setting-multiple-author-support\" style=\"position:relative;\">Setting multiple author support<a href=\"#setting-multiple-author-support\" aria-label=\"setting multiple author support permalink\" class=\"header-anchor after\">#</a></h2>\n<p>The highest level interface that authors writing posts will use will\nstill be the <a href=\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\">frontmatter</a> yaml on top of each post’s markdown file.</p>\n<p>By specifying an <em>author id</em>, we are going to be able\nto retrieve the rest of the author data we have stored in our codebase.</p>\n<div class=\"gatsby-code-title code-block-title\">content/blog/my-post/index.md</div>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token front-matter-block\"><span class=\"token punctuation\">---</span>\n<span class=\"token font-matter yaml language-yaml\">title: My Post!\nauthor: author1</span>\n<span class=\"token punctuation\">---</span></span></code></pre></div>\n<p>For this to work we need to setup Gatsby to:</p>\n<ol>\n<li>use the filesystem as a valid source of data. In this case we used <code class=\"language-text\">src/data</code> but it can be anything you like.</li>\n<li>use a yaml transformer because we will store our authors data inside a yaml but you could use JSON or any other format.</li>\n<li>map frontmatter’s <code class=\"language-text\">author</code> attribute to <code class=\"language-text\">src/data/author.yaml</code>.</li>\n</ol>\n<div class=\"gatsby-code-title code-block-title\">gatsby-config.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token operator\">...</span>otherPlugins<span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 1. use src/data as a data source</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-source-filesystem</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        path<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/src/data</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        name<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">data</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 2. enable yaml support</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-yaml</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  mapping<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 3. map author to author.yaml</span>\n    <span class=\"token string\">\"MarkdownRemark.frontmatter.author\"</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">AuthorYaml</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You will probably need to install the necessary dependencies: <code class=\"language-text\">yarn add gatsby-source-filesystem gatsby-transformer-yaml</code>.</p>\n<p><a href=\"https://www.gatsbyjs.org/docs/gatsby-config/#plugins\">Check Gatsby config docs</a></p>\n<p><strong>Important:</strong> frontmatter’s <code class=\"language-text\">author</code> will need to match an <code class=\"language-text\">id</code> attribute in your <code class=\"language-text\">author.yaml</code>, since that is\nwhat the mapping uses as a sort of primary key.</p>\n<p>Now lets show how the <code class=\"language-text\">author.yaml</code> looks.</p>\n<div class=\"gatsby-code-title code-block-title\">src/data/author.yaml</div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> author1\n  <span class=\"token key atrule\">bio</span><span class=\"token punctuation\">:</span> I am Author 1\n  <span class=\"token key atrule\">profilepicture</span><span class=\"token punctuation\">:</span> ../../content/assets/author1.png\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> author2\n  <span class=\"token key atrule\">bio</span><span class=\"token punctuation\">:</span> I am Author 2\n  <span class=\"token key atrule\">profilepicture</span><span class=\"token punctuation\">:</span> ../../content/assets/author2.png</code></pre></div>\n<p>At this point Gatsby will automatically provide the entire\nAuthor data via the GraphQL interface,\nin your post template.</p>\n<p>Notice that it will return the data for the author you\nspecified in the post’s frontmatter, and of course, each\npost can have a different author.</p>\n<p>Let’s check how the post template can use the <code class=\"language-text\">author</code> data now:</p>\n<div class=\"gatsby-code-title code-block-title\">src/templates/blog-post.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query BlogPostBySlug($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      excerpt(pruneLength: 160)\n      html\n      frontmatter {\n        title\n        author {\n          id\n          bio\n          profilepicture {\n            childImageSharp {\n              fluid {\n                ...GatsbyImageSharpFluid\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Inside your post component you will be able to access all author data:</p>\n<div class=\"gatsby-code-title code-block-title\">src/templates/blog-post.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">BlogPostTemplate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    id<span class=\"token punctuation\">,</span>\n    bio<span class=\"token punctuation\">,</span>\n    profilepicture<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>markdownRemark<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>author<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"bonus-author-profile-picture\" style=\"position:relative;\">Bonus: Author profile picture<a href=\"#bonus-author-profile-picture\" aria-label=\"bonus author profile picture permalink\" class=\"header-anchor after\">#</a></h3>\n<p>If you look at the previous snippets you will notice we used the <code class=\"language-text\">profilepicture</code> to\nsupport author’s profile pictures. Notice how in the GraphQL query that we showed before we used the\n<code class=\"language-text\">childImageSharp</code> query to enable image optimization, something that the Gatbsy Starter blog\ndoes by default in the mono-author mode.</p>\n<p>By using this <code class=\"language-text\">childImageSharp</code> and any of the other queries of <a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">gatsby-image</a> you can\ntransform dynamically loaded images via the expected GraphQL interface with ease.</p>\n<h2 id=\"how-to-use-all-authors\" style=\"position:relative;\">How to use all authors<a href=\"#how-to-use-all-authors\" aria-label=\"how to use all authors permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We’ve only covered the automagical way of mapping a frontmatter\nattribute to a filesystem database i.e. <code class=\"language-text\">author.yaml</code>.</p>\n<p>But what happens when you want all the authors, lets say for a list of\nauthors in your page or a shared <a href=\"https://nosleepjavascript.com/about/\">about</a> page?</p>\n<p>Gatsby also has you covered with this by using the plugins we setup before.\nGatsby will automatically provide a way of reading the entire <code class=\"language-text\">author.yaml</code> as follows:</p>\n<div class=\"gatsby-code-title code-block-title\">src/pages/about.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    allAuthorYaml {\n      nodes {\n        id\n        bio\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Notice how <code class=\"language-text\">author.yaml</code> is mapped to <code class=\"language-text\">allAuthorYaml</code>, that name transformation\nis significant and you should be carefully with it.</p>\n<p>If unsure you can always go to the GraphQL explored that Gatsby provides by\ndefault and play around with the available queries.</p>\n<p>At this point your page component will be provided with an array of authors:</p>\n<div class=\"gatsby-code-title code-block-title\">src/pages/about.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">About</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// this is an array of authors</span>\n  <span class=\"token keyword\">const</span> authors <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span>allAuthorYaml<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"bonus-run-time-multi-author-support-through-graphql\" style=\"position:relative;\">Bonus: Run-Time multi author support through GraphQL<a href=\"#bonus-run-time-multi-author-support-through-graphql\" aria-label=\"bonus run time multi author support through graphql permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Notice that this setup also enables you do an ad-hoc manual implementation\nof the multi-author support.\nI will probably not recommend it for this use case but it is a possibility if you\nencounter a use case that might benefit from it. Notice that by using this you don’t need\nto statically know the author id like we did in the <code class=\"language-text\">blog-post.js</code> before, you can\ndo it entirely dynamically by simply passing react props.</p>\n<div class=\"gatsby-code-title code-block-title\">src/pages/Author.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Author</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> authorId <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span>author<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> authors <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span>allAuthorYaml<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// manually search for the selected author</span>\n  <span class=\"token keyword\">const</span> myAuthor <span class=\"token operator\">=</span> authors<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> authorId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>Author Bio<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>myAuthor<span class=\"token punctuation\">.</span>bio<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    allAuthorYaml {\n      nodes {\n        id\n        bio\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And you can use it like:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>Author author<span class=\"token operator\">=</span><span class=\"token string\">\"author1\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p>This can be extrapolated to a lot of other use cases.</p>\n<h3 id=\"bonus-run-time-multi-author-support-through-importing-files\" style=\"position:relative;\">Bonus: Run-Time multi author support through importing files<a href=\"#bonus-run-time-multi-author-support-through-importing-files\" aria-label=\"bonus run time multi author support through importing files permalink\" class=\"header-anchor after\">#</a></h3>\n<p>And if everything else fails you can always simply import the yaml (or any other format) directly\nfrom your components and display the data however you like.</p>\n<p>The main drawback is that you don’t have some useful image transformations\nand some other GraphQL-only APIs but there might be very good use cases for this approach\naside from supporting multiple authors:</p>\n<div class=\"gatsby-code-title code-block-title\">src/components/Author.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> authors <span class=\"token keyword\">from</span> <span class=\"token string\">\"../data/author.yaml\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Author</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> authorId <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span>author<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// manually search for the selected author</span>\n  <span class=\"token keyword\">const</span> myAuthor <span class=\"token operator\">=</span> authors<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> authorId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>Author Bio<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>myAuthor<span class=\"token punctuation\">.</span>bio<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I hope that I have eased the entry barrier for a multi author blog with Gatbsy,\nand taught some extra techniques in the way.</p>\n</br>\n</br>\n<p>Want to become a Javascript expert? This is nice place to start:</p>\n</br>\n</br>\n<div class=\"flex flex-row gap-2\">\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=B084BNMN7T&asins=B084BNMN7T&linkId=8b137e903d39f2ffe9d05b679af42508&show_border=true&link_opens_in_new_window=true\"></iframe>\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=B08634PZ3N&asins=B08634PZ3N&linkId=41b1c21effffe8f07f6a3f9556d010b2&show_border=true&link_opens_in_new_window=true\"></iframe>\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=1491904151&asins=1491904151&linkId=1cf3fa04463aad92be6c68fd69a0c964&show_border=true&link_opens_in_new_window=true\"></iframe>\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=1491904224&asins=1491904224&linkId=6deb74eba04d6d6f64eda93686b39beb&show_border=true&link_opens_in_new_window=true\"></iframe>\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=1491904240&asins=1491904240&linkId=3022a1bcff37fcf599ba8b9ddcd8517f&show_border=true&link_opens_in_new_window=true\"></iframe>\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=1491904194&asins=1491904194&linkId=879d759323b3c457b665eeb431537dab&show_border=true&link_opens_in_new_window=true\"></iframe>\n <div id=\"amzn-assoc-ad-388ed262-d0bf-4cf6-8458-5b5d84d8a3cd\"></div><script async src=\"https://z-na.associates-amazon.com/onetag/v2?MarketPlace=US&instanceId=388ed262-d0bf-4cf6-8458-5b5d84d8a3cd\"></script>\n</div>","excerpt":"Introduction gatsby-starter-blog comes with out of the box support for a single author blog.\nBut what happens when you want to support…","fields":{"slug":"/gatsby-multi-author/","readingTime":{"text":"6 min read"}},"frontmatter":{"title":"How to support multiple authors in Gatsby.js","date":"April 27, 2020","description":"Gatsby Starter Blog doesn't support multiple authors by default. Let's fix that! And in the Journey we will uncover how to use the file system as source of dynamic data","tags":["GatsbyJs","Javascript","react","filesystem","yaml","blog","GraphQL"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<h2 id=\"intro\" style=\"position:relative;\">Intro<a href=\"#intro\" aria-label=\"intro permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Whether you are working on a fin tech startup or you want to start investing or\nyou simply are curious about the world of investing and finance this post will be for you.\nWe will lay out a roadmap to learn the basics and beyond that resembles the path I’ve taken myself.</p>\n<p>This roadmap will be structured as a series of books you can read to become\nfinancially literate and start taking control of your investing decisions.</p>\n<h2 id=\"disclaimer\" style=\"position:relative;\">Disclaimer<a href=\"#disclaimer\" aria-label=\"disclaimer permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Of course this post does not constitute financial advice and\nyou should seek professional help before\ndoing any serious investing.</p>\n<p>Unless the world ends tomorrow and most of the concepts behind money, wealth,\njobs and socio-economics\nare completely changed then you will probably\nneed to take control of these aspects of your life eventually,\nso let this serve as an introductory step towards a better life!</p>\n<h2 id=\"prerequisites\" style=\"position:relative;\">Prerequisites<a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Since this post is targeted towards developers\nI assume you have some basic understanding of math.\nI will cover which parts of the suggested roadmap\nrequire explicit knowledge of somewhat advance calculus\nand statistics but I can already tell you that that content will be mostly optional,\nbut I do believe that at least understanding\nthe complexity behind all these financial instruments is important.</p>\n<p>As always when learning something new, you should have patience, an open mind and thirst for knowledge.</p>\n<p>Lets being!</p>\n<h2 id=\"step-1-the-millionaire-next-door\" style=\"position:relative;\">Step 1: <a href=\"https://amzn.to/34uubpM\">The Millionaire Next Door</a><a href=\"#step-1-the-millionaire-next-door\" aria-label=\"step 1 the millionaire next door permalink\" class=\"header-anchor after\">#</a></h2>\n<div style=\" display: flex; flex-direction: row; align-items: center; justify-content: center; margin: 40px; \">\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=1630762504&asins=1630762504&linkId=e43609509ccb3f00bd3db34f24e83cd0&show_border=true&link_opens_in_new_window=true\"></iframe>\n</div>\n<p>Suggested formats: Digital, Paper and great as audiobook</p>\n<p>Although this book is not strictly about finance nor investing, it does cover an aspect of\nhow most of the rich people in USA build their wealth, maintain it and live with it.</p>\n<p>I assume that you are interested at least partially in building\nand maintaining wealth\nfor you and your family and that is why you want to learn to invest,\nif you don’t then you can probably skip this step.</p>\n<p>What I really like about this book is that it grounds down the expectation of how it actually\nis being wealthy. We have a very weird and incorrect understanding of what being wealthy means\nthanks to TV, Movies and now Social Media and, spoiler alert, most of the Millionaires in United States\nare hard working men and women that live frugally, are great savers and live well below their means and\nwith the extra cash they can commit to long term conservative investments, generating\nlong term wealth.</p>\n<p>So yes, being wealthy usually does not mean having tons of super expensive cars, good looking human partners,\nsail boats in the Mediterranean, mansions and careless expending. These in fact are roads towards being\npoor actually in most cases and are only part of the <a href=\"https://en.wikipedia.org/wiki/Collective_unconscious\">Collective unconscious</a>.</p>\n<p>I recommend reading this book because it talks a lot about building wealth and saving, activities that\nare super important as a foundational steps towards investing.</p>\n<h2 id=\"step-2-a-random-walk-down-wall-street\" style=\"position:relative;\">Step 2: <a href=\"https://amzn.to/2Xr4MMo\">A Random Walk Down Wall Street</a><a href=\"#step-2-a-random-walk-down-wall-street\" aria-label=\"step 2 a random walk down wall street permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Suggested formats: Digital, Paper and great as audiobook</p>\n<div style=\" display: flex; flex-direction: row; align-items: center; justify-content: center; margin: 40px; \">\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=B07DP6YGVX&asins=B07DP6YGVX&linkId=bc08a819966a9eaf0536b7e4f3cf860a&show_border=true&link_opens_in_new_window=true\"></iframe>\n</div>\n<p>This is a good and short book that covers a wide variety of financial instruments and\ninvestment techniques and concludes that most of the time the typical retail investor (i.e. you and me) is\nbetter off following a simple technique called: buy and hold of conservative instruments\nsuch as equities, bonds and <a href=\"https://www.investopedia.com/terms/e/etf.asp\">ETFs</a>.</p>\n<p>It gives a good and quick rundown of important concepts such as <a href=\"https://www.investopedia.com/terms/v/valueinvesting.asp\">Value Investing</a>,\n<a href=\"https://www.investopedia.com/terms/f/fundamentalanalysis.asp\">Fundamental Analysis</a>, <a href=\"https://www.investopedia.com/terms/t/technicalanalysis.asp\">Technical Analysis</a>,\nETFs, Equities (stocks), government bonds, corporate bonds,\n<a href=\"https://www.investopedia.com/terms/m/modernportfoliotheory.asp\">Modern Portfolio Theory</a>, <a href=\"https://www.investopedia.com/terms/b/behavioraleconomics.asp\">Behavioral economics</a>\netc.</p>\n<p>So after reading this books you will have a proper\nholistic knowledge of the investment world and perhaps it will serve you\nto identify your own path down this rabbit hole.\nPerhaps you become interested in Technical Analysis or\nperhaps you want to know more about Value Investing like the legend Warren Buffet.</p>\n<h2 id=\"step-3-the-intelligent-investor\" style=\"position:relative;\">Step 3: <a href=\"https://amzn.to/2VeUOuE\">The intelligent investor</a><a href=\"#step-3-the-intelligent-investor\" aria-label=\"step 3 the intelligent investor permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Suggested formats: Digital, Paper and great as audiobook</p>\n<div style=\" display: flex; flex-direction: row; align-items: center; justify-content: center; margin: 40px; \">\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=B000FC12C8&asins=B000FC12C8&linkId=1dddce3db872bd9042014a241b7150c8&show_border=true&link_opens_in_new_window=true\"></iframe>\n</div>\n<p>I got to this book because it is well recommended by a lot\nof blogs and forums and it is actually recommended\nby <a href=\"https://www.cnbc.com/2017/02/02/billionaire-warren-buffett-discusses-the-book-that-changed-his-life.html\">Warren Buffet himself</a>.</p>\n<p>It is a rather long book that talks about in details\nabout the “Buy and Hold” investing strategy and\nthe benefits of it and how it fits perfectly the retail investor.\nThis book also introduces the concept\nof <a href=\"https://www.investopedia.com/terms/d/dollarcostaveraging.asp\">Dollar Cost Average</a>, a technique that will\nhelp you invest consistently while averaging the prices that\nyou pay for instruments, easing any low and high peaks\nyou might encounter in the road (the main benefit is easing the high\npeaks of course).</p>\n<h2 id=\"step-4-mits-finance-theory-i-and-principles-of-corporate-finance\" style=\"position:relative;\">Step 4: <a href=\"https://www.youtube.com/playlist?list=PLUl4u3cNGP63B2lDhyKOsImI7FjCf6eDW\">MIT’s Finance Theory I</a> and <a href=\"https://amzn.to/2RumRW8\">Principles of Corporate Finance</a><a href=\"#step-4-mits-finance-theory-i-and-principles-of-corporate-finance\" aria-label=\"step 4 mits finance theory i and principles of corporate finance permalink\" class=\"header-anchor after\">#</a></h2>\n<div style=\" display: flex; flex-direction: row; align-items: center; justify-content: center; margin: 40px; \">\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=1260565556&asins=1260565556&linkId=9e8cfcfe7f6924577ec7badac09765e2&show_border=true&link_opens_in_new_window=true\"></iframe>\n</div>\n<p>Suggested formats: Paper and, as a second option, Digital</p>\n<p>This is the step where you become a pro.</p>\n<p>The good old MIT has the generosity of making publicly\navailable a lot of top notch courses, along with\ntheir syllabus, exercises and any other associated material.\nThese constitute one of the best learning resources\nthat I’ve encounter in several areas of knowledge\nlike computer science, math and, what we are here today, finance.</p>\n<p>In particular this course has three key aspects that make\nit an invaluable learning resource in the path of\nfinancial literacy:</p>\n<ul>\n<li>The content covers a wide variety of topics that together constitute the fundamental of the modern financial world.</li>\n<li>The instructor Andrew Lo does an amazing job covering the material and relating it to real world scenarios.</li>\n<li>The course is from the Fall of 2008, right in the middle of one of the worst US and world financial crisis in the last 100 years: the <a href=\"https://en.wikipedia.org/wiki/Financial_crisis_of_2007%E2%80%9308\">2008 Great Financial Crisis</a>. And a lot of the material covered is directly related to what was happening then. In fact, there is a particularly good session where Andre Lo teaches about how a pool of investments can be structured and resold via the “Trench” technique. And the abuse and misuse of this techniques is one of the main culprits of the financial crisis.</li>\n</ul>\n<p>We conclude then that this course is well timed, complete and overall amazing for all levels.</p>\n<p>You might get lost here or there when they go to calculating the price of futures and options when they start\nusing second derivatives and infinite series expansions but with the proper patience you can come to either\nunderstand it or simply mark it as “TODO” (developer slang for <em>that which remains to be done</em>).</p>\n<p>Additionally this course follows very closely the material\ncovered in the book <em>“Principles of Corporate Finance”</em>\nfrom <em>“Richard Brealey, Stewart Myers, Franklin Allen”</em>\nwhich I believe is a great book overall.</p>\n<p>You can easily opt for just one of these resources or\nwork them together since they complement each other so much.</p>\n<p>These last two resources actually cover probably more than you want to know but they are a very good\nresource if you really want to know some of the nitty-gritty details behind all this complex instruments.</p>\n<p>A specially useful section is the one where they cover the <a href=\"https://www.investopedia.com/terms/m/modernportfoliotheory.asp\">Modern Portfolio theory</a>, after you learn this you will\nunderstand one of the most important aspects of being a successfully investor:\n<a href=\"https://www.investopedia.com/terms/d/diversification.asp\">Diversification</a>.</p>\n<h2 id=\"a-note-on-crypto\" style=\"position:relative;\">A note on crypto<a href=\"#a-note-on-crypto\" aria-label=\"a note on crypto permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Some of the material here does translate to the crypto world. In fact, at the time of writing this article there are\ntons of innovative projects trying to build a lot of the traditional financial instruments into crypto. In fact we already\nhave futures, options and some other instruments being either available or in development.</p>\n<p>If you are working on a Fin Tech that works on top of the\nEthereum network you will probably already know most of these\nthings but otherwise you will probably want to at least understand the basics.</p>\n<p>On the topic of Crypto I cannot recommend enough <a href=\"https://amzn.to/34w4AwF\">The Bitcoin Standard</a>.\nIt runs down on the essence of money and how bitcoin fits in as a potentially revolutionary\nstore of value.</p>\n<div style=\" display: flex; flex-direction: row; align-items: center; justify-content: center; margin: 40px; \">\n<iframe style=\"width:120px;height:240px;\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" frameborder=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=franleplant-20&language=en_US&marketplace=amazon&region=US&placement=B07D81VLQH&asins=B07D81VLQH&linkId=97e066bb279bd2557bc906757f449091&show_border=true&link_opens_in_new_window=true\"></iframe>\n</div>\n<p>Suggested Formats: Digital, Paper and great as Audiobook</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>I wrote this post because this is a question I actually get quite often and I decided to sit down and\nwrite it so that I can reference to it later.</p>\n<p>All these books have affected me profoundly and I cannot recommend them enough.\nAll the books linked have affiliate links that help support this blog.</p>\n <div id=\"amzn-assoc-ad-388ed262-d0bf-4cf6-8458-5b5d84d8a3cd\"></div><script async src=\"https://z-na.associates-amazon.com/onetag/v2?MarketPlace=US&instanceId=388ed262-d0bf-4cf6-8458-5b5d84d8a3cd\"></script>","excerpt":"Intro Whether you are working on a fin tech startup or you want to start investing or\nyou simply are curious about the world of investing…","fields":{"slug":"/finance-essentials-for-developers/","readingTime":{"text":"8 min read"}},"frontmatter":{"title":"Essential Investing and Finance for developers","date":"April 20, 2020","description":"Whether you are working on a fin tech startup or you want to start investing or you simply are curious about the world of investing and finance this post will be for you. We will layout a roadmap to learn the basics and beyond that resembles the path I’ve taken myself.","tags":["investing","finance","ETF","financial instruments","options","futures","stocks","portfolio","wealth","fintech"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<h2 id=\"table-of-contents\" style=\"position:relative;\">Table of Contents<a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#tech-requirements\">Tech requirements</a></li>\n<li>\n<p><a href=\"#starting-out\">Starting out</a></p>\n<ul>\n<li><a href=\"#project-setup\">Project setup</a></li>\n</ul>\n</li>\n<li><a href=\"#game-code\">Game Code</a></li>\n<li><a href=\"#the-game-loop\">The game loop</a></li>\n<li><a href=\"#input\">Input</a></li>\n<li>\n<p><a href=\"#rendering-concepts\">Rendering concepts</a></p>\n<ul>\n<li><a href=\"#note-about-coordinates\">Note about coordinates</a></li>\n</ul>\n</li>\n<li><a href=\"#main-gameplay-loop\">Main gameplay loop</a></li>\n<li>\n<p><a href=\"#creating-the-character\">Creating the character</a></p>\n<ul>\n<li><a href=\"#updating-the-world-with-delta\">Updating the world with <code class=\"language-text\">delta</code></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#obstacles\">Obstacles</a></p>\n<ul>\n<li><a href=\"#shouldplaceworldobject\">ShouldPlaceWorldObject()</a></li>\n<li><a href=\"#getscorenextobstacle\">GetScoreNextObstacle()</a></li>\n<li><a href=\"#addobject\">AddObject()</a></li>\n</ul>\n</li>\n<li><a href=\"#collisions\">Collisions</a></li>\n<li><a href=\"#finishing-touches\">Finishing touches</a></li>\n<li><a href=\"#closing\">Closing</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p>If you are like me and are looking into getting out of Google’s ecosystem, chances are that you switched (or are thinking on switching) from Chrome to another browser. In doing so, you will be getting rid of one of the cheekiest features in any browser: The <a href=\"https://elgoog.im/t-rex/\">dinosaur game</a>.</p>\n<p>I thought we could take this chance to learn a little bit about web-based game development and create a small clone of the game.</p>\n<p>You can play the <a href=\"https://ignacioamigo.github.io/dinogame/bin/index.html\">finished game here</a> and <a href=\"https://github.com/IgnacioAmigo/dinogame\">review the code here</a>. Keep in mind that the code is much more commented on this article since it’s meant to be as explicit and educating as possible. Here’s what it looks like if you don’t feel like clicking the above link:</p>\n<div style=\"overflow: hidden;\">\n  <iframe  frameborder=\"0\" src=\"https://ignacioamigo.github.io/dinogame/bin/index.html\" width=\"900\" height=\"225\"></iframe>\n</div>\nLet's dive in!\n<h2 id=\"scope\" style=\"position:relative;\">Scope<a href=\"#scope\" aria-label=\"scope permalink\" class=\"header-anchor after\">#</a></h2>\n<p>It’s very easy to overshoot when scoping any piece of software, especially when you can clearly see many ways in which your software can be expanded which is the case for pretty much any kind of game (power-ups, sound effects, types of entities, etc.). In these kinds of contexts, (over-)engineering the code to be prepared for future implementations seems like the correct way to go.</p>\n<p>In this case, however, we have a pretty clear idea of what we want our game to look like: It’s a simple infinite runner, where a couple of obstacles spawn from time to time and the score is directly based on how much time we can succesfully avoid them.</p>\n<p>It will be hard, but let’s try to keep the code and program simple and pragmatic. There’s value in making the code work more systematically but we are looking into low-friction implementation since we want this to work as an introduction to a couple of ideas and technologies.\nFurthermore, since we are learning some of these technologies, I’ll try to be as explicit as possible while exploring some of their defining features (in general though, I would recommend diving deeper in each of the concepts).</p>\n<h2 id=\"tech-requirements\" style=\"position:relative;\">Tech requirements<a href=\"#tech-requirements\" aria-label=\"tech requirements permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Keeping the scope in mind, let’s try to deduce and compress what we need from a technology perspective:</p>\n<ul>\n<li>We want the game to run on the browser, which pretty much inevitably means we are going to use either Javascript, or something that ends up turning into Javascript.</li>\n<li>We have to do game-specific tasks such as render images and process input. Luckily the browser gives us good support for both of them through things like WebGL and Javascript’s input system respectively.</li>\n<li>We would also like it to be as responsive as possible since it makes for a better user experience.</li>\n</ul>\n<p>Note that we don’t really need brazing fast graphic drawing for this since the game will not render thousands of objects at once, so using WebGL is probably overkill. However, it’s a good way to get into the topic and so we’ll take the chance to do it that way. WebGL is fairly complicated to work with from scratch, so after doing a bit of research I have decided we can use <a href=\"https://www.pixijs.com/\">PixiJS</a> to render stuff.\nPixiJS is a pretty simple but powerful Javascript engine to render 2D sprites. It runs over WebGL (which in turn means we are using hardware acceleration to render stuff). This will all help us get some of the cumbersome stuff out of the way so that we can focus on writing code directly related to the game itself.</p>\n<p>I think it would also be a good idea to go a step further and try to use it with Typescript to get some of that sweet, sweet type-checking.</p>\n<h2 id=\"starting-out\" style=\"position:relative;\">Starting out<a href=\"#starting-out\" aria-label=\"starting out permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We are going to use a starter template, which will solve some of these issues for us. Specifically, the starter is the following: <a href=\"https://github.com/llorenspujol/parcel-pixijs-quickstarter\">https://github.com/llorenspujol/parcel-pixijs-quickstarter</a>. It includes <a href=\"https://parceljs.org/\">Parcel</a>, <a href=\"https://www.pixijs.com/\">PixiJS</a> and <a href=\"https://www.typescriptlang.org/\">TypeScript</a>. We could set it up by hand but since it’s not really the point of the post, we’ll use the template. PixiJS started shipping with Type information since version 5, which is the one being included in the starter template. This means we don’t have to import extra packages to be able to type-check PixiJS code.</p>\n<p>Note that the only real requirement for this is Node and NPM.</p>\n<h3 id=\"project-setup\" style=\"position:relative;\">Project setup<a href=\"#project-setup\" aria-label=\"project setup permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Let’s go ahead and clone the template repo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git clone --depth 1 https://github.com/llorenspujol/parcel-pixijs-quickstarter.git DinoGame</code></pre></div>\n<p>Immediately, on our <strong>DinoGame</strong> folder we’ll have a starting project app that combines TypeScript and PixiJS (and already includes the type information), bundled with Parcel which also provides some nifty features such as hot module reloading. At this point it’s a good idea to run <code class=\"language-text\">npm install</code> to install all the package dependencies that are defined as standard node dependencies.</p>\n<p>We can actually go ahead and run the application by doing <code class=\"language-text\">npm run start</code>, which kicks off the build process and hosts the app on <code class=\"language-text\">https://localhost:1234/</code>. You’ll see a cute animation of a character that looks like Bomberman.</p>\n<p>Let’s review the code a little bit. The two TypeScript files that are important are the following: <code class=\"language-text\">main.ts</code>, on the root directory, and <code class=\"language-text\">src\\app.ts</code></p>\n<p><code class=\"language-text\">main.ts</code> is a simple file that imports from <code class=\"language-text\">app.ts</code> and creates a GameApp object by passing an HTML element, a number for screen width, and one for screen height. I want to make a low-res kind of game so I’ll drop down the resolution to <em>300x75</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> GameApp <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./app/app\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> myGame <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GameApp</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">75</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Finally, we have <code class=\"language-text\">/assets/loader.js</code>, which is where the creator of the template left some code that loads the game assets. Let’s modify it to suit our needs:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> ghost <span class=\"token keyword\">from</span> <span class=\"token string\">\"./images/ghost/*.png\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> cloud <span class=\"token keyword\">from</span> <span class=\"token string\">\"./images/cloud/*.png\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> obstacle1 <span class=\"token keyword\">from</span> <span class=\"token string\">\"./images/obstacle1/*.png\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> obstacle2 <span class=\"token keyword\">from</span> <span class=\"token string\">\"./images/obstacle2/*.png\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">PIXI</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"pixi.js\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> spriteNames <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  ghost<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>ghost<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  obstacleGrave<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>obstacle1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  obstaclePumpkin<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>obstacle2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  cloud<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>cloud<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">GetSprite</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">PIXI</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">AnimatedSprite</span><span class=\"token punctuation\">(</span>\n    spriteNames<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Texture<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The above code is fundamentally using the <a href=\"https://parceljs.org/module_resolution.html\"><em>wildcard import</em> feature from Parcel</a> to import an arbitrary number of image paths for each of the <code class=\"language-text\">import</code> statements (specifically, the number of images in each of the directories) which we can easily extract with <code class=\"language-text\">Object.values()</code>. We will end up with objects that look a little bit like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">ghost <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  image1<span class=\"token operator\">:</span> pathToImage1<span class=\"token punctuation\">,</span>\n  image2<span class=\"token operator\">:</span> pathToImage2<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// so when you Object.values</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>ghost<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  pathToImage1<span class=\"token punctuation\">,</span> pathToImage2<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>We are now able to call <code class=\"language-text\">GetSprite()</code> from <code class=\"language-text\">app.ts</code> with one of the four values (specifically, the keys of <code class=\"language-text\">spriteNames</code>). The code essentially gets the files from each of the subdirectories and creates a texture from them.</p>\n<p>This is mostly an implementation detail and you can forget about it as long as you recall that the loading happens on that file and really, all we are doing is loading files in an easy way for PixiJS to be able to render them.</p>\n<p>We could do something more strict/expandable here but for now this will work well for us, and is a low amount of code to maintain.</p>\n<p><strong>Note</strong>: The code above assumes you have your assets in the specified folders! I’d suggest copying them from the repository.</p>\n<h2 id=\"game-code\" style=\"position:relative;\">Game Code<a href=\"#game-code\" aria-label=\"game code permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Once the assets are out of the way, we can focus our efforts on the game code. Recall that this resides in <code class=\"language-text\">src\\app.ts</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GameApp</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> app<span class=\"token operator\">:</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Application<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    parent<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">,</span>\n    width<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>\n    height<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">PIXI</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Application</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      width<span class=\"token punctuation\">,</span>\n      height<span class=\"token punctuation\">,</span>\n      backgroundColor<span class=\"token operator\">:</span> <span class=\"token number\">0x000000</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// init Pixi loader</span>\n    <span class=\"token keyword\">let</span> loader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">PIXI</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Loader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Add user player assets</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Player to load\"</span><span class=\"token punctuation\">,</span> playerFrames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>playerFrames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      loader<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>playerFrames<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Load assets</span>\n    loader<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">onAssetsLoaded</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The constructor simply creates a new <code class=\"language-text\">PIXI.Application</code> and sets the <code class=\"language-text\">app</code> field. After that, it creates a <a href=\"https://pixijs.download/dev/docs/PIXI.Loader.html\"><code class=\"language-text\">PIXI.Loader</code></a> which is used to load assets (there’s one by default so it’s not really necessary to create one), and loads some files.</p>\n<p>If you run the game after changing the resolution, you’ll see it looks a little bit weird. As I said, I want to create a low-res game with a pixelated look, so for our first modifications we’ll set some fields in the <code class=\"language-text\">PIXI.Application</code> object that we created.</p>\n<p>This part is not very fun or interesting to discuss but needs to be done, so feel free to skip it or read without much attention. In short, I’m setting a white background (<code class=\"language-text\">0xFFFFFF</code> in hex), setting the scaling resolution to 3 (which makes it so that the game is low resolution but scaled on our browser), and telling PixiJS how we want the scaled pixels to look like. I also went ahead and removed a portion of code that loads the default assets so that we can start out clean:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GameApp</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> app<span class=\"token operator\">:</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Application<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    parent<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">,</span>\n    width<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>\n    height<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">PIXI</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Application</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      width<span class=\"token punctuation\">,</span>\n      height<span class=\"token punctuation\">,</span>\n      backgroundColor<span class=\"token operator\">:</span> <span class=\"token number\">0xffffff</span><span class=\"token punctuation\">,</span>\n      antialias<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      resolution<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// this scaling mode makes it so that scaled pixels are the</span>\n    <span class=\"token comment\">// same as the nearest neighbor, making it blocky as we want it</span>\n    <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>settings<span class=\"token punctuation\">.</span><span class=\"token constant\">SCALE_MODE</span> <span class=\"token operator\">=</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SCALE_MODES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NEAREST</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"the-game-loop\" style=\"position:relative;\">The game loop<a href=\"#the-game-loop\" aria-label=\"the game loop permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We have completed the setup of the game, so it’s time to start writing the game loop. The game loop is, at a high level, the main flow control tool of most modern games. It usually looks something like this in abstract terms (order is really not very relevant):</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">InitialSetup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// game loop:</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">ProcessInputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">UpdateWorld</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">RenderWorld</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice that since we are using specific tools to make this (the browser, PixiJS) we won’t really implement all steps here but it’s important to keep in mind that we usually want to handle them in some way or another.</p>\n<p>Each iteration of this loop is usually called a frame, and most games run at 30 or 60 FPS (or frames per second). This means a single frame should take around 33 or 16 miliseconds respectively.</p>\n<p>PixiJS handles setting the framerate to be the same as our screen sync rate, so we don’t have to worry much about it. As we’ll see, we can handle simulating our game in variable framerate by knowing how much time passed between the previous frame and the current one. This does not mean it’s really the most appropriate solution (in fact, a lot of times you’ll want to <a href=\"https://gafferongames.com/post/fix_your_timestep/\">fix your frametime</a>).</p>\n<h2 id=\"input\" style=\"position:relative;\">Input<a href=\"#input\" aria-label=\"input permalink\" class=\"header-anchor after\">#</a></h2>\n<p>This is the first step of the high-level game loop I described above. How will we handle this? Luckily for us, Javascript/the browser has a pretty robust input system of which we can take advantage of to know when the user presses a key so we won’t have to put much effort for this to work.</p>\n<p>Let’s say we want our player to jump with the <em>Spacebar</em> key. We can implement this easily by having a <code class=\"language-text\">PressedSpace</code> boolean value that we reset at the end of every frame, once we updated our world (so it is not <code class=\"language-text\">true</code> forever).</p>\n<h2 id=\"rendering-concepts\" style=\"position:relative;\">Rendering concepts<a href=\"#rendering-concepts\" aria-label=\"rendering concepts permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Before diving into the fun part (the gameplay code!), let’s see how we will handle the rendering part of our game, which is PixiJS’s main function.\nWhen we create the main object (of class <a href=\"https://pixijs.download/dev/docs/PIXI.Application.html\"><code class=\"language-text\">PIXI.Application</code></a>), we’ll have access to an object called the <a href=\"https://pixijs.download/dev/docs/PIXI.Application.html#stage\"><code class=\"language-text\">stage</code></a> (of class <a href=\"https://pixijs.download/dev/docs/PIXI.Container.html\"><code class=\"language-text\">PIXI.Container</code></a>), which is where we can tell Pixi what objects we want to have drawn. You can think of it as a list (or more generally, a collection) of objects to display. After loading an image, we can do this with a single line of code:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">let</span> sprite <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">PIXI</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Sprite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nStage<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>obstacle<span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You can learn more about it on PixiJS’s documentation articles (I’d recommend at least glossing over them since it always helps to be familiarized with official documentation).</p>\n<p>Any object (text, lines, sprites) can be displayed this way. Since our use is pretty limited, there’s not really much more to say about this system, but it has a lot more useful functions which I recommend exploring.</p>\n<h3 id=\"note-about-coordinates\" style=\"position:relative;\">Note about coordinates<a href=\"#note-about-coordinates\" aria-label=\"note about coordinates permalink\" class=\"header-anchor after\">#</a></h3>\n<p>PixiJS uses a coordinate system that comprises the 2 usual suspects: The X coordinate, and the Y coordinate. However, it is important to keep in mind that the (0,0) coordinate is on the <strong>top left</strong>, and <strong>the X coordinate increases to the right</strong>, whereas <strong>the Y component increases as we go down on the screen</strong>. This is the most common coordinate system in game development tools so we’ll leave it as it is, but as you can imagine there are things you can do to translate and modify the system as desired.</p>\n<h2 id=\"main-gameplay-loop\" style=\"position:relative;\">Main gameplay loop<a href=\"#main-gameplay-loop\" aria-label=\"main gameplay loop permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We’ve seen what the gameplay loop looks like in general terms, but how do we implement the main update function (ie: <code class=\"language-text\">UpdateWorld()</code>)? The answer is pretty simple, the <code class=\"language-text\">PIXI.Application</code> object that we created contains a field called <code class=\"language-text\">ticker</code> of type <a href=\"https://pixijs.download/dev/docs/PIXI.Ticker.html\"><code class=\"language-text\">PIXI.Ticker</code></a>, which lets us register different tickers that will run on each animation frame (for example, 60 times per second). After its execution, the frame is rendered (that is,the objects we set on the <code class=\"language-text\">stage</code>).</p>\n<p>This rendering process can be done at hand by <a href=\"https://pixijs.download/dev/docs/PIXI.Ticker.html#.shared\">getting the renderer object and calling <code class=\"language-text\">render()</code></a>, but we will avoid this and let PixiJS do it automatically after running the ticker. This way, we are essentially coupling the <code class=\"language-text\">UpdateWorld()</code> and <code class=\"language-text\">RenderWorld()</code> of our abstract game loop, which will work just fine for our needs.</p>\n<p>Let’s create a set of static methods and fields where we will group our game logic in our <code class=\"language-text\">GameApp</code> class. We know we want to know if the player is in a game over state, and what score they are achieving, so we’ll define fields for those values.</p>\n<p>Regarding methods, for now we’ll have one method for setup and one for the world updates, which we will implement through the PixiJS ticker:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GameApp</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> GameOver<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">static</span> PressedSpace<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">static</span> Score<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    parent<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">,</span>\n    width<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>\n    height<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// code we added in the previous section goes here</span>\n\n    <span class=\"token comment\">// register the event for key presses</span>\n    window<span class=\"token punctuation\">.</span>onkeydown <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ev<span class=\"token operator\">:</span> KeyboardEvent<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      GameApp<span class=\"token punctuation\">.</span>PressedSpace <span class=\"token operator\">=</span> ev<span class=\"token punctuation\">.</span>key <span class=\"token operator\">==</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    Game<span class=\"token punctuation\">.</span><span class=\"token function\">SetupGame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// this is the ticker that runs once per frame, let's call our Update() function</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>ticker<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>delta<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      Game<span class=\"token punctuation\">.</span><span class=\"token function\">Update</span><span class=\"token punctuation\">(</span>delta<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token function\">SetupGame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// initial setup of the game state</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token function\">Update</span><span class=\"token punctuation\">(</span>delta<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// simulate game, update entities and world</span>\n\n    <span class=\"token comment\">// frame is ending, so let's set PressedSpace back to false</span>\n    <span class=\"token comment\">// so that it is the default on the next frame</span>\n    GameApp<span class=\"token punctuation\">.</span>PressedSpace <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <a href=\"https://pixijs.download/dev/docs/PIXI.Ticker.html#deltaTime\"><code class=\"language-text\">delta</code></a> parameter is passed on to the ticker and is how much time (<strong>in milliseconds</strong>) passed between the previous frame and the current one, so that we can use it to simulate our entities. It will be explained better in the next section so don’t worry for now.</p>\n<h2 id=\"creating-the-character\" style=\"position:relative;\">Creating the character<a href=\"#creating-the-character\" aria-label=\"creating the character permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We now have a little skeleton of code to fill in. Let’s start by drawing the character whose assets we loaded previously.</p>\n<p>PixiJS has two classes called <a href=\"https://pixijs.download/dev/docs/PIXI.Sprite.html\"><code class=\"language-text\">PIXI.Sprite</code></a> and <a href=\"https://pixijs.download/dev/docs/PIXI.AnimatedSprite.html\"><code class=\"language-text\">PIXI.AnimatedSprite</code></a> to draw either static sprites (i.e: images) or animations, respectively. So let us create a Player class that contains an AnimatedSprite that we can draw on screen:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Player</span> <span class=\"token punctuation\">{</span>\n  sprite<span class=\"token operator\">:</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>AnimatedSprite<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite <span class=\"token operator\">=</span> <span class=\"token function\">GetSprite</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ghost\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> Game<span class=\"token punctuation\">.</span>GroundPosition<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>animationSpeed <span class=\"token operator\">=</span> <span class=\"token number\">0.05</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Game<span class=\"token punctuation\">.</span>Stage<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We can now create a <code class=\"language-text\">Player</code> object and immediately see the character on screen animating, at the bottom left. If we go a little bit further, we can probably imagine that we need to update the object every frame, so we can go ahead and create an <code class=\"language-text\">Update()</code> method that handles the character jumping (recall that we were saving whether the player had pressed Space). Since we will be updating the player from <code class=\"language-text\">GameApp.Update(delta)</code> it makes sense that the <em>Update</em> method for our character takes this as an argument as well.</p>\n<p>We know we want our character to jump with Spacebar, so we are actually at the point where we can implement this as well. I’ll be defining a couple of fields on the <code class=\"language-text\">Player</code> class for this:</p>\n<ul>\n<li><code class=\"language-text\">Airborne</code>: Boolean value that determines whether the customer is in the air. We need this to know if we have to accelerate the character downwards, and whether the character can jump.</li>\n<li><code class=\"language-text\">VerticalSpeed</code>: Gravity accelerates our character downward, which in turn means it increases the vertical speed linearly (i.e: a specific amount per frame/time unit).</li>\n</ul>\n<h3 id=\"updating-the-world-with-code-classlanguage-textdeltacode\" style=\"position:relative;\">Updating the world with <code class=\"language-text\">delta</code><a href=\"#updating-the-world-with-code-classlanguage-textdeltacode\" aria-label=\"updating the world with code classlanguage textdeltacode permalink\" class=\"header-anchor after\">#</a></h3>\n<p>As mentioned before, the <code class=\"language-text\">delta</code> parameter that we are getting from the ticker and passing on to our <code class=\"language-text\">Update()</code> method contains, in miliseconds, how much time passed between the previous frame and this one. Why is that value useful to us? Well, if we don’t know how much time passed between one frame and the next one, we can’t proportionally simulate the world. Usually, if we fix the framerate, we can simulate for a specific amount of frametime (so, if we want our game to run at 60 FPS, we would divide 1000 ms by 60 frames, which gives us 16.6 ms/frame), but in reality we can’t rely on that being the real time that passed between two frames (there is a lot of variance introduced by the OS, the browser, the user, etc.).</p>\n<p>This way, if we want a value to increase by a rate of <code class=\"language-text\">X per second</code> depending on how much time passed, we need to adjust for how much time passed in the frame. If half a second passed between a frame and the next one, the amount by which we increase would be equal to <code class=\"language-text\">0.5 seconds</code> times <code class=\"language-text\">X per second</code>. This is the pattern that we will use to increment values that are tied to time (for example: user score, player speed, etc.).</p>\n<p>Keeping all this in mind, you might already get the sense of what the update code is going to look like, but to spell it out: If our character not airborne and the player pressed space, let’s set the VerticalSpeed to a negative value so our little character goes up. If the character is airborne, we need to accelerate it downward by adding up a constant value to the vertical speed. To make sure he doesn’t go downward eternally, let’s check against a <code class=\"language-text\">GroundPosition</code> (defined on <code class=\"language-text\">GameApp</code> since it will depend on the view’s height) so that we know when we are not airborne anymore (and when we can set the speed to 0). Finally, let’s make our character move by changing the sprite’s Y position:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">public</span> <span class=\"token function\">Update</span><span class=\"token punctuation\">(</span>delta<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>y <span class=\"token operator\">>=</span> GameApp<span class=\"token punctuation\">.</span>GroundPosition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// if downward acceleration brought us to the ground,</span>\n    <span class=\"token comment\">// stop and set airborne to false</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> GameApp<span class=\"token punctuation\">.</span>GroundPosition<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>verticalSpeed <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>airborne <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>airborne<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// if we are in the air, accelerate downward</span>\n    <span class=\"token comment\">// by increasing the velocity by a constant value</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>verticalSpeed <span class=\"token operator\">+=</span> delta<span class=\"token operator\">*</span> <span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>GameApp<span class=\"token punctuation\">.</span>PressedSpace <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>airborne<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// jump!</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>airborne <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>verticalSpeed <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// remember the delta update!</span>\n  <span class=\"token comment\">// the position will change in accordance to</span>\n  <span class=\"token comment\">// how much time passed and the character's speed</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>y <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>verticalSpeed <span class=\"token operator\">*</span> delta<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So far, we can create a <code class=\"language-text\">Player</code> object on <code class=\"language-text\">GameApp.SetupGame()</code> and have it update on the <code class=\"language-text\">GameApp.Update()</code> method. The character will stand on the bottom left side of the window and jump when we press Spacebar as it animates slowly. You might be wondering when we are going to make the character move: The answer is we don’t! We’ll move obstacles towards the character.</p>\n<h2 id=\"obstacles\" style=\"position:relative;\">Obstacles<a href=\"#obstacles\" aria-label=\"obstacles permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We have a character that jumps, so a good next point to explore is obstacles that scroll horizontally to the left. We want to have an arbitrary number of obstacles coming at the player, leaving some space for it to react accordingly.</p>\n<p>Since we are doing scrolling obstacles, we can also make our code so that it includes aesthetic objects such as clouds. We can differentiate those with objects that the character can bump into by having a boolean member called <code class=\"language-text\">solid</code>. We can even make them scroll a little bit slower so that we have some sort of <a href=\"https://en.wikipedia.org/wiki/Parallax_scrolling\">parallax scrolling</a>. For this, let’s define a base scroll speed on <code class=\"language-text\">GameApp</code> and subtract one from it if the world object is not solid.\nLastly, let’s add a modifier to the speed of the obstacles so that they move a little bit faster as the score increases:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GameApp</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> ScrollSpeed <span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ScrollingObject</span> <span class=\"token punctuation\">{</span>\n  sprite<span class=\"token operator\">:</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Sprite<span class=\"token punctuation\">;</span>\n  solid <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>spriteName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> isSolid<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite <span class=\"token operator\">=</span>  <span class=\"token function\">GetSprite</span><span class=\"token punctuation\">(</span>spriteName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> GameApp<span class=\"token punctuation\">.</span>Width<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> GameApp<span class=\"token punctuation\">.</span>GroundPosition<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>anchor<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>solid <span class=\"token operator\">=</span> isSolid<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">Update</span><span class=\"token punctuation\">(</span>delta<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> baseScrollSpeed <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>solid<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> GameApp<span class=\"token punctuation\">.</span>ScrollSpeed <span class=\"token operator\">:</span> GameApp<span class=\"token punctuation\">.</span>ScrollSpeed<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// modifier for speed depending on score so that it gets more difficult</span>\n      <span class=\"token keyword\">let</span> scrollSpeed <span class=\"token operator\">=</span> baseScrollSpeed <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>GameApp<span class=\"token punctuation\">.</span>Score<span class=\"token operator\">/</span><span class=\"token number\">15.0</span> <span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// move to the left, watch out!</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-=</span> delta <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>scrollSpeed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Right now we can create multiple obstacle objects and have them update on the main game loop. We mentioned before that we wanted to prepare our game for an arbitrary number of objects, how can we achieve this? One way would be to create a list of <code class=\"language-text\">WorldObject</code>s and insert there all the objects that we want.</p>\n<p>At this point, however, we actually have 2 types of objects that interact with the world: <code class=\"language-text\">Player</code> and <code class=\"language-text\">ScrollingObject</code>. But it makes sense for us to coalesce all instances in one list of objects to loop over. If we were to go in an <a href=\"https://en.wikipedia.org/wiki/Object-oriented_programming\">object-oriented</a> direction, we could create a class hierarchy that perhaps could make both our classes inherit from a common one that had all the shared functionality and data. Another good approach would be to create an interface that enforced the methods/fields that they both share. However, since we are using TypeScript and it has a <a href=\"https://www.typescriptlang.org/docs/handbook/advanced-types.html#union-types\">very powerful type system</a>, we can try to implement one of the more frictionless options by creating a Union type and an alias for it. It’s easy to combine our smaller primitives this way for now given the way our code looks like. Remember, we are trying to go for low cost solutions for our little project.</p>\n<p>So let’s go ahead and implement all this on our <code class=\"language-text\">GameApp</code> class.:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// creating an alias for our Union type that we can use</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">WorldObjects</span> <span class=\"token operator\">=</span> Player <span class=\"token operator\">|</span> ScrollingObject<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GameApp</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> app<span class=\"token operator\">:</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Application<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">static</span> PressedSpace<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">static</span> Stage<span class=\"token operator\">:</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Container<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">static</span> ActiveEntities<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>WorldObjects<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">static</span> GameOver<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">static</span> ScrollSpeed<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ground position, given by screen height</span>\n  <span class=\"token keyword\">static</span> GroundPosition<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// width of game screen, given by screen width</span>\n  <span class=\"token keyword\">static</span> Width<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// score of current run</span>\n  <span class=\"token keyword\">static</span> Score<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// max score achieved in session</span>\n  <span class=\"token keyword\">static</span> MaxScore<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// next score in which we should place an obstacle</span>\n  <span class=\"token keyword\">static</span> ScoreNextObstacle<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Objects whose types are of this Union type (<code class=\"language-text\">Player | ScrollingObject</code>) have accessible members that are defined both on our Player and on ScrollingObject types. As seen above, I created a new static member called <code class=\"language-text\">ActiveEntities</code> which is an array of <code class=\"language-text\">WorldObject</code>s. We now have to change <code class=\"language-text\">GameApp.Update()</code> to loop over this array.</p>\n<p>But before that, you might have noticed as well that I created a couple more variables for tracking score stuff. This will allow us to do a couple of things:</p>\n<ul>\n<li>Keep score for the current run</li>\n<li>Save the maximum score achieved in a session</li>\n<li>Know when the next obstacle should spawn (each time we create one, we set the score at which the next one should appear)</li>\n</ul>\n<p>To keep the code simple for now, everytime we spawn an obstacle we’ll spawn a cloud for aesthetics. There’s no real reason why we couldn’t add a more random element to these decorations later, but for now this will keep the code easier to study/describe.</p>\n<p>A quick note regarding object spawns: As you might have seen in the assets definitions, we have two different kinds of obstacles in addition to the cloud sprite. Once we decide it’s time to spawn a new obstacle, we need to choose which one we want to spawn. The pumpkin is a little more difficult to overcome because of the sprite’s dimensions, so we can do something like generating a random number that falls between zero and one uniformly, and decide to spawn a pumpkin only if the number is higher than 0.75. This way, we are essentially giving the pumpkin a 25% chance of spawning, and a 75% chance to the grave.</p>\n<p>Keeping that in mind, let’s see what our current game update looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">static</span> <span class=\"token function\">Update</span><span class=\"token punctuation\">(</span>delta<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// if we haven't lost yet let's update everything,</span>\n  <span class=\"token comment\">// otherwise wait for spacebar press to restart game</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>GameApp<span class=\"token punctuation\">.</span>GameOver<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// loop over object list</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> currentEntity <span class=\"token keyword\">of</span> GameApp<span class=\"token punctuation\">.</span>ActiveEntities<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// update entity</span>\n      currentEntity<span class=\"token punctuation\">.</span><span class=\"token function\">Update</span><span class=\"token punctuation\">(</span>delta<span class=\"token punctuation\">,</span>GameApp<span class=\"token punctuation\">.</span>ActiveEntities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// current score update!</span>\n    GameApp<span class=\"token punctuation\">.</span>Score <span class=\"token operator\">+=</span> delta <span class=\"token operator\">*</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">6</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// update the max score if necessary</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>GameApp<span class=\"token punctuation\">.</span>Score <span class=\"token operator\">></span> GameApp<span class=\"token punctuation\">.</span>MaxScore<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> GameApp<span class=\"token punctuation\">.</span>MaxScore <span class=\"token operator\">=</span> GameApp<span class=\"token punctuation\">.</span>Score<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>GameApp<span class=\"token punctuation\">.</span><span class=\"token function\">ShouldPlaceWorldObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      GameApp<span class=\"token punctuation\">.</span><span class=\"token function\">AddObject</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.75</span> <span class=\"token operator\">?</span>\n        <span class=\"token string\">\"obstacleGrave\"</span> <span class=\"token operator\">:</span>\n        <span class=\"token string\">\"obstaclePumpkin\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token boolean\">true</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      GameApp<span class=\"token punctuation\">.</span><span class=\"token function\">AddObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cloud\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ScoreNextObstacle <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetScoreNextObstacle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>GameApp<span class=\"token punctuation\">.</span>PressedSpace<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetupGame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  GameApp<span class=\"token punctuation\">.</span>PressedSpace <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There’s some code I defined there which has not been written out yet, however it felt like something that could be deferred, since meaning can be extracted out of what you can read above anyway.</p>\n<p>Let’s see how we can go ahead and define the implementation of the definitions written above.</p>\n<h3 id=\"shouldplaceworldobject\" style=\"position:relative;\">ShouldPlaceWorldObject()<a href=\"#shouldplaceworldobject\" aria-label=\"shouldplaceworldobject permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This one’s an easy one. We said we had <code class=\"language-text\">ScoreNextObstacle</code> defined for us to know when it was time to spawn a new obstacle, so let’s define the check:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">static</span> <span class=\"token function\">ShouldPlaceWorldObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Score <span class=\"token operator\">>=</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ScoreNextObstacle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"getscorenextobstacle\" style=\"position:relative;\">GetScoreNextObstacle()<a href=\"#getscorenextobstacle\" aria-label=\"getscorenextobstacle permalink\" class=\"header-anchor after\">#</a></h3>\n<p>In the scoping section, we mentioned briefly that we wanted the game to spawn obstacles <em>from time to time</em> (if you played Chrome’s dinosaur game, you know they appear randomly). There’s a level of uncertainty in that statement that we can resolve by getting random values for the next time for an object to appear:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">static</span> <span class=\"token function\">GetScoreNextObstacle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// let's have a minimum distance so objects don't appear next to each other</span>\n  <span class=\"token keyword\">let</span> minimumDistance <span class=\"token operator\">=</span> <span class=\"token number\">25</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// we can define a level of difficulty to make it harder as we go on (limit is 5)</span>\n  <span class=\"token keyword\">let</span> difficulty <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Score <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// define the random value based on values above</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>difficulty <span class=\"token operator\">*</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> minimumDistance<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"addobject\" style=\"position:relative;\">AddObject()<a href=\"#addobject\" aria-label=\"addobject permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Since we are using this method to generalize adding decorations (i.e: non-solid objects) and obstacles, we let the caller decide which height (or Y position) it should be spawned at, but the X position should always be set as the game’s width (at the right limit of the screen).\nThe other thing we need to keep in mind is that if we want the object to update, we need to add it to the list of <code class=\"language-text\">ActiveEntities</code> so that the game keeps track of it (and to PixiJS’s Stage object).</p>\n<p>So the method would look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token function\">AddObject</span><span class=\"token punctuation\">(</span>spriteName<span class=\"token operator\">:</span> <span class=\"token keyword\">keyof</span> Sprites<span class=\"token punctuation\">,</span> height<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> isSolid<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> obstacle <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ScrollingObject</span><span class=\"token punctuation\">(</span>spriteName<span class=\"token punctuation\">,</span> GameApp<span class=\"token punctuation\">.</span>Width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">,</span> isSolid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  GameApp<span class=\"token punctuation\">.</span>ActiveEntities<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>obstacle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  GameApp<span class=\"token punctuation\">.</span>Stage<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>obstacle<span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"collisions\" style=\"position:relative;\">Collisions<a href=\"#collisions\" aria-label=\"collisions permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We are at the point where our game feels pretty playable, we can run it and jump over objects. A “small” problem that you might have noticed, however, is that we cannot really bump into objects and lose the game, so we’ll have to find a solution for that.</p>\n<p>Our sprites are loaded as 2D textures that fit inside a box which has a specific width and height. PixiJS gives us access to these values (and the current X and Y positions) through a rectangle structure, accessible through <code class=\"language-text\">PIXI.Sprite.getBounds()</code>. Imagine we have 2 rectangles of which we know these 4 values (i.e: X position, Y position, width and height), how can we tell if they are overlapping/colliding? One way of answering is by inversion (<em>When do they <strong>not</strong> collide?</em>):</p>\n<ul>\n<li>\n<p>If the the first rectangle’s X position starts after the second rectangle’s X extension ends, then they are definitely not colliding because of the orthogonal properties of the X and Y axes.</p>\n<ul>\n<li>This also applies the other way around (if the second rectangle’s X position starts after the first one’s X extension ends they don’t collide)</li>\n</ul>\n</li>\n<li>\n<p>If the the first rectangle’s Y position starts after the second rectangle’s Y extension ends, the same applies.</p>\n<ul>\n<li>And the other way around.</li>\n</ul>\n</li>\n</ul>\n<p>Since we know when they are <strong>not</strong> colliding, we can negate that and get the result.</p>\n<p><strong>The above can be a little confusing</strong>, so looking at code might help. Let’s define a <code class=\"language-text\">CollidesWidth()</code> method on our <code class=\"language-text\">Player</code> class. Each of the four lines in the return statement refers to each of the cases stated above:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> <span class=\"token function\">CollidesWith</span><span class=\"token punctuation\">(</span>otherSprite<span class=\"token operator\">:</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Sprite<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// player's rectangle</span>\n  <span class=\"token keyword\">let</span> ab <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">.</span><span class=\"token function\">getBounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// sprite we are checking against</span>\n  <span class=\"token keyword\">let</span> bb <span class=\"token operator\">=</span> otherSprite<span class=\"token punctuation\">.</span><span class=\"token function\">getBounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span>  <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>ab<span class=\"token punctuation\">.</span>x <span class=\"token operator\">></span> bb<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> bb<span class=\"token punctuation\">.</span>width <span class=\"token operator\">||</span>\n          ab<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> ab<span class=\"token punctuation\">.</span>width <span class=\"token operator\">&lt;</span> bb<span class=\"token punctuation\">.</span>x <span class=\"token operator\">||</span>\n          ab<span class=\"token punctuation\">.</span>y <span class=\"token operator\">+</span> ab<span class=\"token punctuation\">.</span>height <span class=\"token operator\">&lt;</span> bb<span class=\"token punctuation\">.</span>y <span class=\"token operator\">||</span>\n          ab<span class=\"token punctuation\">.</span>y <span class=\"token operator\">></span> bb<span class=\"token punctuation\">.</span>y <span class=\"token operator\">+</span> bb<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Since we have a way of checking for 1:1 collisions on <code class=\"language-text\">Player</code>, we’ll need to modify the <code class=\"language-text\">Update()</code> method to check if it’s colliding against any of all the solid <code class=\"language-text\">ActiveEntities</code>.</p>\n<p>Let’s add this at the end of the method:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> currentEntity <span class=\"token keyword\">of</span> GameApp<span class=\"token punctuation\">.</span>ActiveEntities<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n    currentEntity<span class=\"token punctuation\">.</span>solid <span class=\"token operator\">&amp;&amp;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">collidesWith</span><span class=\"token punctuation\">(</span>currentEntity<span class=\"token punctuation\">.</span>sprite<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    GameApp<span class=\"token punctuation\">.</span>GameOver <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"finishing-touches\" style=\"position:relative;\">Finishing touches<a href=\"#finishing-touches\" aria-label=\"finishing touches permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We are saving what the max and current score are, but we have not been displaying it so far. Luckily it’s pretty easy to such thing in PixiJS. All we need to do is define a <a href=\"https://pixijs.download/dev/docs/PIXI.Text.html\"><code class=\"language-text\">PIXI.Text</code></a> object, add it to the stage and adjust it as we need. Let’s do it on our <code class=\"language-text\">GameApp</code> class:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GameApp</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> ScoreText<span class=\"token operator\">:</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Text <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">PIXI</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Score: \"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    fontSize<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n    fill<span class=\"token operator\">:</span> <span class=\"token string\">\"#aaff\"</span><span class=\"token punctuation\">,</span>\n    align<span class=\"token operator\">:</span> <span class=\"token string\">\"center\"</span><span class=\"token punctuation\">,</span>\n    stroke<span class=\"token operator\">:</span> <span class=\"token string\">\"#aaaaaa\"</span><span class=\"token punctuation\">,</span>\n    strokeThickness<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>ticker<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>delta <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  GameApp<span class=\"token punctuation\">.</span><span class=\"token function\">Update</span><span class=\"token punctuation\">(</span>delta<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// if we didn't lose, display score and max score,</span>\n  <span class=\"token comment\">// otherwise show a \"game over\" prompt</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>GameApp<span class=\"token punctuation\">.</span>GameOver<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    GameApp<span class=\"token punctuation\">.</span>ScoreText<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span>\n      <span class=\"token string\">\"Score: \"</span> <span class=\"token operator\">+</span>\n      Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span>GameApp<span class=\"token punctuation\">.</span>Score<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">\" - Max Score: \"</span> <span class=\"token operator\">+</span>\n      Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span>GameApp<span class=\"token punctuation\">.</span>MaxScore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    GameApp<span class=\"token punctuation\">.</span>ScoreText<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span>\n      <span class=\"token string\">\"Game over! You scored \"</span> <span class=\"token operator\">+</span>\n      Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span>GameApp<span class=\"token punctuation\">.</span>Score<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">\". Max Score: \"</span> <span class=\"token operator\">+</span>\n      Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span>GameApp<span class=\"token punctuation\">.</span>MaxScore<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">\". Press spacebar to restart.\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>There are some other finishing touches and optimizations that I added to the code, feel free to review them on the repo (and ask away if you think I can help!).</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Since it involves many subsystems, there are many, many ways to approach game development in general, and we only just barely scraped the surface of it.</p>\n<p>Hopefully this served as a good starting point which you can build upon. TypeScript and PixiJS are both very useful tools that made this very easy, but keep in mind that they are very powerful. There are a number of optimizations and features in terms of code and runtime that could be done and I would suggest exploring to improve your craft: Improve assets loading code by adding compile-time checks (such as for assets names), add different kinds of obstacles, make the character fall faster if the player presses the down arrow key, recycle/pool objects so that there aren’t many allocations, the possibilities are endless!</p>","excerpt":"Table of Contents Introduction Scope Tech requirements Starting out Project setup Game Code The game loop Input Rendering concepts Note…","fields":{"slug":"/intro-to-gamedev/","readingTime":{"text":"27 min read"}},"frontmatter":{"title":"Intro to game development with Typescript","date":"April 13, 2020","description":"Creating a game is easier than ever with all the tools that we have available. This article will hopefully ease you into game development, reviewing both general concepts and specific implementations with the help of robust technologies such as TypeScript and PixiJS by creating a small clone of a pretty well-known game!","tags":["gamedev","WebGL","PixiJS","TypeScript","rendering"],"author":{"id":"nacho","bio":"Software Engineer with a passion on system and software architecture. Other loves include music and video games (and their development).","twitter":"ignacioamigo","github":"https://github.com/IgnacioAmigo","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAB2HAAAdhwGP5fFlAAAEaklEQVQ4yw3SaVMTBxgH8P0UdahHmc50xmq1QMImm2vZzbnZK7vZIyQQQsJhGsCghDOEBDVRK6MiIHKJWpyhqKjFtoCEIyFcSUACxenY9qt0Z34vnplnnnn+L/6AQ6REkXH7AnzgDh5eM/Ufm6KHht4c2p1BOtO6jrS2PaUJravb1qHrq8prqwpJaxJsXZEAbjcn8oTXzdS6cGd1FR+I052vyL4kligY48eGWFYf3UH7tpHINtyb0YUz2vCmtietkXSngVisqz10NdYfbm6pdwqWKtHsFK2CaBcau11tQ/TdHDZwgt3OWRI5U3zPeGvPEM9Kg8RwKwtEY22xWKg30tHTHaQoBCf17mrmqr+m1oFV2uCqhmbuzhr9+D965F9q+B/bo8/Mg0PswQl2/zN+/xhgBY2rxsLYkTof53JROIkGfqqZnhoeHRmI9Fz1VJE8h/lvTbjj886uscbuh5HbQ5Hh18HpvGviCyA61d56xtfI6dCLFhxiGLQj5L8Rax8fG5yaehzuaYuGryWirb1dIQhhzLj4dHz0/dzztYWXd9+fADZWWe0xxhM9NxNdtXWMGVM11Itej4226nwCcSMS6o92BIMN9+5ESd5jZTzzr2aWfp9f/TA793EXIGkVxYAOl669o/Hh4M/hSKvoMDA84jCp9sbi9/tbEzc7g02+0LW6poC3qSWYXHy/sfxu6be57OYSgBEKKwmyAsTYy/wBbnBwoNbH6i2l5ReKE17RyZtbWyq9Hq7SQfq8HMdhv85MnhzuLC68OsqnAWelmWKkS6VdUNsFRUMj5fd71Vr1uTNFdjNy/vwFRK9geY2dMzMsSrOw6MCGHt1+Mzfz99EuUF/HW6xlUnKaVQiCyskrS0pL1GoYRfUmo1kBQiYTSjEqKZ3BDJI0TLOIldR6fY6HDxKAz8swNi3LKlkeImxyzFz+1amir8+clstBCFKXg0olWCZwsAUvtzEaAlcLTIWDw6RGCA4K4HiVIOpYWsPaIbsAgsrLJaUXi78tlslBpEKPYSZZ2SU7DTO0giCUOAFZLQqOgHkSFWx6AKdkHAe6pVbyMMPJIa28AlWfKz5broC0OgTRqSkC51ikkoIqKS1mKTdZZEZTiRa+XAH/CFBMGUHIBFov0EoML6VpWKODcYIkadpTW3u9rcNTJdotMt4oZw1lJFpiRS4RllLMClagMuDtu9ln02PTk6OjI/dcnmo5pEKM5tfz75aWl1/8MrOysvHi2eT1QHVfV1NfZ1PwirO5wem/4hIFc3NLDbB/sJfL7+b3c8d/FT4VPmE0+92FH968/fBk7InRrH80/KRQOMrntySFw+xmOnmwv51Krbx8+XR29gVwcJD/c/GPZPJjZmtzcmr84qXvT589fffewMTk+DfFp3ojkVwut7+/lU6t7O6kMpm1QiGXzW5++XJU2E8BmUxydXVxZ3tD2nE8W3SmqKbGEY12jYyO8iKfSCTW1j/u7qWknxsbK2vry1tb6wsLb7J7qZnnQ/8DVjLu7TBBpHoAAAAASUVORK5CYII=","aspectRatio":1.0582010582010581,"src":"/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/ee604/nacho-profile.png","srcSet":"/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/69585/nacho-profile.png 200w,\n/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/497c6/nacho-profile.png 400w,\n/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/ee604/nacho-profile.png 800w,\n/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/f3583/nacho-profile.png 1200w,\n/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/756c3/nacho-profile.png 1396w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}}},{"node":{"html":"<p>Jump to the <a href=\"#essential-commands\">commands sections</a></p>\n<h2 id=\"what-is-docker\" style=\"position:relative;\">What is docker?<a href=\"#what-is-docker\" aria-label=\"what is docker permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>Docker is an open platform for developing, shipping, and running applications.</p>\n<p><a href=\"https://docs.docker.com/engine/docker-overview/\">source</a></p>\n</blockquote>\n<p><a href=\"https://www.docker.com/\">Docker</a> lets you encapsulate your application along with all its\nsystem dependencies into a single executable\nthat can be shipped predictably into servers or clusters; or\nas development environment for other developers using different\nOperating Systems.</p>\n<p>If you are familiar with Virtual Machines (such as <a href=\"https://www.virtualbox.org\">Virtual Box</a>) or <a href=\"https://www.vagrantup.com\">Vagrant</a>\nthen you should feel comfortable enough with Docker.</p>\n<p>With Docker you can easily create something very similar to a headless virtual machine.\nYou can install system dependencies, configure networks and ports, setup databases,\nfetch your code and start your app with a simple configuration file i.e. <em>Dockerfile</em>.</p>\n<p>Today it’s very common for <a href=\"https://en.wikipedia.org/wiki/Infrastructure_as_a_service\">IaaS</a> and <a href=\"https://en.wikipedia.org/wiki/Platform_as_a_service\">PaaS</a> providers to provide first\nclass support for Docker containers.\nExamples of these providers are <a href=\"https://cloud.google.com/compute\">Google Cloud Compute Engine</a>,\n<a href=\"https://azure.microsoft.com/en-us/\">Microsoft Azure</a> and <a href=\"https://aws.amazon.com\">Amazon AWS</a> among others.\nYou can use <a href=\"https://kubernetes.io/\">Kubernetes</a> to manage a cluster composed of dozens\nof Docker containers in these providers and scale easily\nso long as you can afford it.</p>\n<p>Lets take a simple Nodejs / Front End application, what does it need to run?</p>\n<ul>\n<li>\n<p>System Dependencies:</p>\n<ul>\n<li>An adequate linux distribution.</li>\n<li><a href=\"https://nodejs.org/en/\">NodeJs</a>, <a href=\"https://www.npmjs.com/\">NPM</a>, <a href=\"https://yarnpkg.com/\">Yarn</a>.</li>\n<li><a href=\"https://gcc.gnu.org/\">gcc</a> and the required native dependencies to install native NodeJs dependencies (such as <code class=\"language-text\">node-sass</code>).</li>\n</ul>\n</li>\n<li>\n<p>System configurations:</p>\n<ul>\n<li>npm/yarn repositories.</li>\n<li>OS networks, users, groups, etc.</li>\n<li>System optimizations such as removing any OS components not needed for running your app.</li>\n</ul>\n</li>\n<li>\n<p>build/run steps:</p>\n<ul>\n<li>fetching your app’s code</li>\n<li>installing dependencies (i.e. via <code class=\"language-text\">yarn install</code> or <code class=\"language-text\">npm install</code>)</li>\n<li>building (if necessary)</li>\n<li>starting your app</li>\n</ul>\n</li>\n</ul>\n<p>We will a cover an example of this later.</p>\n<p>Docker lets you express all these necessary steps that make\nup a single deliverable application.</p>\n<p>The way you express these necessary steps is a <strong>Dockerfile</strong>\nand the result of <em>building</em> your <em>Dockerfile</em>\nis an <strong>Image</strong> that can be instantiated and executed, this executable\nis called a <strong>Container</strong>.</p>\n<h2 id=\"what-is-an-image\" style=\"position:relative;\">What is an image?<a href=\"#what-is-an-image\" aria-label=\"what is an image permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>An image is a read-only template with instructions for creating a Docker container.</p>\n<p><a href=\"https://docs.docker.com/engine/docker-overview/\">source</a></p>\n</blockquote>\n<p>You use a <em>Dockerfile</em> to define an <em>image</em>.</p>\n<p>Your <em>Dockerfile</em> is an ordered list of steps necessary to\nrun your app. Each line will generate an intermediate <em>image</em> that\nDocker will cache for performance reasons, so the order of your\nsteps is important.</p>\n<p>This is a rather minimal but typical <em>Dockerfile</em> for a NodeJs app:</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># This is our base community provided image,</span>\n<span class=\"token comment\"># with some minimal distribution of linux</span>\n<span class=\"token comment\"># that comes with NodeJs v10 (and npm) already installed</span>\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:12</span>\n\n<span class=\"token comment\"># Use this directory _inside_ your Docker container</span>\n<span class=\"token comment\"># as the base directory of all the next actions</span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /usr/src/app</span>\n\n<span class=\"token comment\"># Copy your app's code from the host (your computer) to the container.</span>\n<span class=\"token comment\"># This assumes a typical setup in which the Dockerfile</span>\n<span class=\"token comment\"># is in the root of your project</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> package.json ./</span>\n\n<span class=\"token comment\"># Install dependencies</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install</span>\n\n<span class=\"token comment\"># Copy the rest of your App's source files</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . .</span>\n\n<span class=\"token comment\"># Tell Docker that your app will be working in the port 8080</span>\n<span class=\"token comment\"># so we should open it up to the outside</span>\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 8080</span>\n\n<span class=\"token comment\"># Run your app.</span>\n<span class=\"token comment\"># CMD signals Docker that this is the thing that we want to run,</span>\n<span class=\"token comment\"># if this executable fails then the whole container will exit.</span>\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [ <span class=\"token string\">\"node\"</span>, <span class=\"token string\">\"server.js\"</span> ]</span></code></pre></div>\n<p>Notice how we install dependencies before copying the App’s code, this assumes\nthat the dependencies will change less frequently that the App code so Docker might\nbe able to use the already cached intermediate <em>image</em> up to that point.</p>\n<p>Building <em>images</em> means processing the list of instructions and sort of <em>render</em> the final <em>image</em>\nso that it is ready to be instantiated into a running <em>container</em>.</p>\n<p><strong>IMPORTANT</strong>: <strong>Images</strong> are just instructions, when you run them you turn them into <strong>Containers</strong>.</p>\n<h2 id=\"what-is-a-container\" style=\"position:relative;\">What is a container?<a href=\"#what-is-a-container\" aria-label=\"what is a container permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>A container is a runnable instance of an image.</p>\n<p><a href=\"https://docs.docker.com/engine/docker-overview/\">source</a></p>\n</blockquote>\n<p>After you built your final <em>image</em> you can then instantiate it into an executable,\nthis executable is called a <em>container</em> and it is treated\nby your host OS as just another process.</p>\n<p>Take a moment to think about the big leap of the final statement,\nthis means that by using Docker you have encapsulated an\nentire Operating System (OS), dependencies, configurations,\nstartup commands, etc into a single runnable process in your\nhost Operating System. Nice, right?</p>\n<h2 id=\"image-vs-container-an-analogy\" style=\"position:relative;\">Image vs Container: an analogy<a href=\"#image-vs-container-an-analogy\" aria-label=\"image vs container an analogy permalink\" class=\"header-anchor after\">#</a></h2>\n<p>You can think of an <em>image</em> as a traditional Object Oriented Programming (OOP) Class,\nand a <em>container</em> as an instance.\nYou can have multiple running instances of an image\n(that is usually how you scale your app inside a cluster), with\nslightly different parameters (Environment Variables mostly).</p>\n<p><code class=\"language-text\">Images</code> can inherit from other <code class=\"language-text\">images</code> to compose them in useful and meaningful ways.</p>\n<h2 id=\"docker-repositories-docker-hub\" style=\"position:relative;\">Docker repositories (Docker Hub)<a href=\"#docker-repositories-docker-hub\" aria-label=\"docker repositories docker hub permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>Docker Hub repositories allow you share container images with your team, customers, or the Docker community at large.</p>\n<p><a href=\"https://docs.docker.com/docker-hub/repos/\">source</a></p>\n</blockquote>\n<p>Docker Hub is an analogue solution to things such as NPM to distribute NodeJs packages,\n<a href=\"https://doc.rust-lang.org/cargo/\">Cargo</a> to distribute <a href=\"https://www.rust-lang.org/\">Rust</a> crates (pieces of code), <a href=\"https://maven.apache.org/\">Maven</a> to distribute <a href=\"https://en.wikipedia.org/wiki/Java_(software_platform)\">Java</a> Jars (pieces of code), etc.</p>\n<p>Docker hub also has the concept of <a href=\"https://docs.docker.com/registry/deploying/\">registry</a> similar to NPM where you can use\nthe default Docker hub registry or your company’s own.\nThe default <a href=\"https://www.docker.com/products/docker-hub\">Docker hub registry</a> is where most of the base images, such as NodeJs,\nNginx, Java, etc live.</p>\n<p>In the <code class=\"language-text\">Dockerfile</code> we dissected before, the first line is <code class=\"language-text\">FROM node:12</code> and\ntells docker to use the base image <code class=\"language-text\">node:12</code> (NodeJs version 12) that is stored\nin a Docker hub registry, by default it will use Docker’s registry.</p>\n<p>The first time you try to build this image you will notice that Docker\ndownloads the base image and store it in cache.</p>\n<p>We cover the basic commands in the next section.</p>\n<h2 id=\"essential-commands\" style=\"position:relative;\">Essential commands<a href=\"#essential-commands\" aria-label=\"essential commands permalink\" class=\"header-anchor after\">#</a></h2>\n<p>This assumes you have docker installed in your system (Linux or Macos)</p>\n<h3 id=\"building\" style=\"position:relative;\">Building<a href=\"#building\" aria-label=\"building permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Build your docker image (from a <em>Dockerfile</em> in the current directory).\nDocker will output the <code class=\"language-text\">Image Id</code> if everything goes well. This will be used\nto instantiate the <em>image</em> later.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker build <span class=\"token builtin class-name\">.</span>\n<span class=\"token comment\"># equivalent to</span>\ndocker build ./Dockerfile</code></pre></div>\n</br>\n<p>Use <code class=\"language-text\">tags</code> to easily reference the built image, this replaced the need to use <code class=\"language-text\">Image Id</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker build -t mySuperApp <span class=\"token builtin class-name\">.</span></code></pre></div>\n</br>\n<p>Force docker to re-build your <code class=\"language-text\">image</code>. Typically this is used when you changed something\nin your Dockerfile, or the base image has changed.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker build --no-cache <span class=\"token builtin class-name\">.</span></code></pre></div>\n</br>\n<p>Check the built images in your system</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker image <span class=\"token function\">ls</span></code></pre></div>\n</br>\n<p>All the build commands output the docker <code class=\"language-text\">Image id</code> which is something you can use when\ninstantiating them into <code class=\"language-text\">containers</code>, but using a <code class=\"language-text\">tag</code> is a much more human friendly way.</p>\n<h3 id=\"docker-hub\" style=\"position:relative;\">Docker hub<a href=\"#docker-hub\" aria-label=\"docker hub permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Push your most recently built image to docker hub using the tag as identifier.\nTags can have a complex form to keep track of versions and such.\nSome common patterns are:</p>\n<ul>\n<li><code class=\"language-text\">name-of-my-app:LATEST</code>: the latest version of your app, will keep changing as new versions come.</li>\n<li><code class=\"language-text\">name-of-my-app:VERSION</code>: a given version of your app.</li>\n<li><code class=\"language-text\">nodejs:10</code>: the base NodeJs v10 image.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker push <span class=\"token variable\">$TAG</span></code></pre></div>\n</br>\n<h3 id=\"running\" style=\"position:relative;\">Running<a href=\"#running\" aria-label=\"running permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Instantiate an <code class=\"language-text\">image</code> either by <code class=\"language-text\">Image Id</code> or by <code class=\"language-text\">tag</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker run <span class=\"token variable\">$IMAGE_ID</span>\n\ndocker run <span class=\"token variable\">$TAG</span></code></pre></div>\n</br>\n<h3 id=\"debugging\" style=\"position:relative;\">Debugging<a href=\"#debugging\" aria-label=\"debugging permalink\" class=\"header-anchor after\">#</a></h3>\n<p>These commands are very useful for debugging your container, image or\nApplication.</p>\n<p>Instantiate the <code class=\"language-text\">image</code> into a <code class=\"language-text\">container</code> and replace the <code class=\"language-text\">CMD</code> in the <em>Dockerfile</em> for\nan interactive shell you can play around with. This is particularly useful when your app\nfails to start, you can ssh into the container and manually start the app or make some debugging.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker run -ti <span class=\"token variable\">$IMAGEID_OR_TAG</span> <span class=\"token function\">bash</span></code></pre></div>\n</br>\n<p>Run a <code class=\"language-text\">container</code> that uses your host’s (your machine) App directory and files.\nThis allows you to use your regular development tools such as IDEs or Text Editors\nto edit your <code class=\"language-text\">container</code>’s files in place. This is particularly useful when debugging\nyour App running inside a container.\n<code class=\"language-text\">$PWD</code> is your process working directory or the directory you are currently located in your shell instance,\nin this case we assume is your App’s root directory.\nYour container <code class=\"language-text\">WORKDIR</code> should be the one you set in your <em>Dockerfile</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker run -ti -v <span class=\"token environment constant\">$PWD</span>:your-container-workdir <span class=\"token variable\">$IMAGEID_OR_TAG</span> <span class=\"token function\">bash</span></code></pre></div>\n<p><strong>Note</strong> if you get an error about <code class=\"language-text\">bash</code> not being found then try using <code class=\"language-text\">/bin/bash</code></p>\n</br>\n<p>SSH into an already running container.\nUseful for debugging a partially running <code class=\"language-text\">container</code> or <code class=\"language-text\">app</code> or\nfor tweaking some details of your <code class=\"language-text\">container</code> or <code class=\"language-text\">app</code>.\nMost of the time I use the previous ones since I find them more useful.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker <span class=\"token builtin class-name\">exec</span> -ti <span class=\"token variable\">$CONTAINER_ID</span> /bin/bash</code></pre></div>\n</br>\n<h3 id=\"managing\" style=\"position:relative;\">Managing<a href=\"#managing\" aria-label=\"managing permalink\" class=\"header-anchor after\">#</a></h3>\n<p>What are the current running <code class=\"language-text\">containers</code>?</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker <span class=\"token function\">ps</span></code></pre></div>\n</br>\n<p>Kill a running <code class=\"language-text\">container</code> (get the <code class=\"language-text\">$CONTAINER_ID</code> from the above output).</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker <span class=\"token function\">kill</span> <span class=\"token variable\">$CONTAINER_ID</span></code></pre></div>\n</br>\n<p>Check a <code class=\"language-text\">container</code>’s logs.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker logs <span class=\"token variable\">$CONTAINER_ID</span></code></pre></div>\n</br>\n<p>Inspect a <code class=\"language-text\">container</code> (debug information about volumes, networks, ports, etc about a given container).\nIn this case we get the <code class=\"language-text\">container</code>’s IP Address.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker inspect <span class=\"token punctuation\">\\</span>\n  --format<span class=\"token operator\">=</span><span class=\"token string\">'{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token variable\">$CONTAINER_ID</span></code></pre></div>\n</br>\n<p>Check the <a href=\"https://docs.docker.com/engine/reference/commandline/inspect/\">docs</a> for a more complete coverage.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>This is the basic knowledge I think every Front End developer should have as a minimum,\ngiven the fact that Docker has such a wide adoption. The commands are commands I use\non a daily basis in my day job.</p>\n<p>Even if you are not a Front End developer but simply new to this technology I think\nyou will be able to take value (and pride) from learning the basics.</p>\n<p>There is a lot to learn about Docker and you can base your whole career specializing\non Docker and its parent discipline: DevOps.</p>","excerpt":"Jump to the commands sections What is docker? Docker is an open platform for developing, shipping, and running applications. source Docker…","fields":{"slug":"/docker-essentials-for-front-end-developers/","readingTime":{"text":"9 min read"}},"frontmatter":{"title":"Essential Docker for Javascript and Front End Developers","date":"March 10, 2020","description":"Docker has become a widely used technology and chances are you are going to have to deal with it eventually, at least superficially, in your Front End career. Let's cover the basic concepts and day to day useful commands you will likely use when dealing with Docker.","tags":["Docker","Dockerfile","Javascript","front end developers","NodeJs","Express","Cloud Computing","Clusters","Kubernetes","AWS","Azure","Google Compute Engine"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<h2 id=\"table-of-contents\" style=\"position:relative;\">Table of Contents<a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#introduction-how-to-share-react-components-between-applications\">Introduction: How to share React Components between Applications?</a></li>\n<li>\n<p><a href=\"#to-inline-or-not-to-inline\">To Inline or not to Inline</a></p>\n<ul>\n<li><a href=\"#not-inline\">Not-Inline</a></li>\n<li><a href=\"#inline\">Inline</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#theming\">Theming</a></p>\n<ul>\n<li><a href=\"#regular-css-class-names\">Regular CSS Class Names</a></li>\n<li><a href=\"#css-theme-variables\">CSS Theme variables</a></li>\n<li><a href=\"#inline-css-through-css-in-js\">Inline CSS (through CSS-in-JS)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#tldr-how-to-package-and-publish-front-end-libraries-in-2020\">TLDR: How to package and publish Front End libraries in 2020</a></p>\n<ul>\n<li><a href=\"#using-create-react-library\">Using create-react-library</a></li>\n</ul>\n</li>\n<li><a href=\"#closing\">Closing</a></li>\n<li>\n<p><a href=\"#appendix-1-how-to-use-peer-dependencies\">Appendix 1: How to use Peer Dependencies</a></p>\n<ul>\n<li><a href=\"#what-are-peer-dependencies\">What are Peer Dependencies?</a></li>\n<li><a href=\"#how-do-i-mark-a-dependency-as-a-peer-dependency\">How do I mark a dependency as a Peer Dependency?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#appendix-2-active-vs-passive-compilation\">Appendix 2: Active vs Passive compilation</a></p>\n<ul>\n<li><a href=\"#passive-compilation\">Passive Compilation</a></li>\n<li><a href=\"#active-compilation\">Active Compilation</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"introduction-how-to-share-react-components-between-applications\" style=\"position:relative;\">Introduction: How to share React Components between Applications?<a href=\"#introduction-how-to-share-react-components-between-applications\" aria-label=\"introduction how to share react components between applications permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>Check <a href=\"#tldr-how-to-package-and-publish-front-end-libraries-in-2020\">TLDR</a> if you don’t want all the\ndetails and just want the recommended solution.</p>\n</blockquote>\n<p>There are diverse situation in which we want to create an NPM package that contains\na <a href=\"https://reactjs.org/\">React</a> Component with CSS and images.</p>\n<p>This situation is particularly common inside companies that want to share components,\nand pieces of code in general, between apps usually inside a private NPM repository, but\nit also applies when authoring Open Source software like a single Component package such as a Date Picker\nor a Multi Select and also when authoring Component Libraries or UI Frameworks like <a href=\"https://react-bootstrap.github.io/\">React Bootstrap</a>,\n<a href=\"https://ant.design/\">Ant Design</a>, <a href=\"https://babeljs.io/\">Semantic UI</a>, <a href=\"https://material-ui.com/\">Material UI</a>, etc (more on these later).</p>\n<p>This problem might seem simple enough but it turns out that it has a lot of nuances and trade-offs.</p>\n<p>The main challenge in packaging a <a href=\"https://reactjs.org/\">React</a> Component is surprisingly not Javascript,\nbut all the Assets that might be related to that component such as CSS, Images, SVGs and fonts.\nThese assets are directly related to our Javascript code via some of the following statements:</p>\n<ul>\n<li><code class=\"language-text\">imports image from './image.{png,jpg,svg}'</code> in Javascript</li>\n<li><code class=\"language-text\">import classNames from './styles.{css,scss,less)'</code> in Javascript</li>\n<li><code class=\"language-text\">url(image.{png,jpg,svg})</code> in CSS</li>\n<li><code class=\"language-text\">font-family and @import</code> in CSS</li>\n</ul>\n<p><a href=\"https://webpack.js.org/\">Webpack</a> can understand all these dependency statements via <em>loaders</em> and completely\nanalyse the cross-language and cross-file-type dependency graph, which for a very simple\ncomponent might look something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">            --> styles.css --> otherImage.svg\nMyComponent --> image.svg</code></pre></div>\n<p>It turns out that there are a lot of schemes for representing this graph in a Packaged NPM module,\neach with its own trade-offs. Analysing each alternative is the main purpose of this post.</p>\n<p>Unfortunately in early 2020 there is still no universal standard way of <em>packaging a Front End</em> module with all\nits assets, but a lot of progress has been made and there are actually lots of promising solutions.</p>\n<p>We are going to explore how this problem is tackled in the wild by studying\neach technique and providing examples of real world, production-ready libraries that\nuse them and in the end of this post we are going\nto recommend a particular solution to this problem based of my experience.</p>\n<p>Additionally we are going to explore how each of these packaging schemes enable\ndifferent <strong>Theming</strong> schemes and, at the end, recommend one (<em>Theming</em> is a way of modifying the\nstyles of a set of components to fit your use case i.e. changing the buttons colors in a\nUI framework such as Bootstrap to fit your company’s graphics design spec).</p>\n<p>Most of this post is also applicable to any piece of Front End Javascript code that is related\nto CSS, images, etc, such as <a href=\"https://angular.io/\">Angular</a> Components / Directives, <a href=\"https://vuejs.org/\">Vue</a> Components, etc.</p>\n<h2 id=\"to-inline-or-not-to-inline\" style=\"position:relative;\">To Inline or not to Inline<a href=\"#to-inline-or-not-to-inline\" aria-label=\"to inline or not to inline permalink\" class=\"header-anchor after\">#</a></h2>\n<p>In the context of Front End assets, inlining means to bake those assets directly\ninto the Javascript code (bundle) generated by our bundlers or compilers such as Webpack or <a href=\"https://babeljs.io/\">Babel</a>.</p>\n<p>CSS can be inlined without any third party library by using the <code class=\"language-text\">style</code> HTML attribute,\nbut this has some limitations such as not being able to use pseudo selectors like <code class=\"language-text\">:hover</code>\nand media queries so, to enable all these regular CSS features\na third party <strong>CSS-in-JS</strong> library is recommended such as <a href=\"https://emotion.sh/docs/introduction\">Emotion</a>\nor <a href=\"https://www.styled-components.com/\">Styled-components</a> (more on this later).</p>\n<p>Images can be inlined by Webpack’s <a href=\"https://webpack.js.org/loaders/url-loader/\">url-loader</a> in the form of <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs\">Data URL</a> with Base64 encoding.\nSVG can be inlined by turning an <code class=\"language-text\">.svg</code> file into a <a href=\"https://reactjs.org/\">React</a> Component (An SVG file is just a regular HTML tree)\nor by using Webpack’s <a href=\"https://github.com/webpack-contrib/svg-inline-loader\">inline-svg-loader</a></p>\n<p>For a deeper exploration of how to deal with <code class=\"language-text\">svg</code> in React checkout this <a href=\"https://medium.com/@rossbulat/working-with-svgs-in-react-d09d1602a219\">post</a></p>\n<p>The main advantage of inlining is that after you bundle all your code base you end up with\na single Javascript file that contains all the dependencies it needs to run, even CSS and Images.</p>\n<p>This makes it <em>very</em> easy to package and publish to <a href=\"https://www.npmjs.com/\">NPM</a> and it makes very easy\nfor <strong>Component Consumers</strong> to <em>use</em> your module.</p>\n<p>Using <strong>CSS-in-JS</strong> libraries like <a href=\"https://emotion.sh/docs/introduction\">Emotion</a> or <a href=\"https://www.styled-components.com/\">Styled-components</a> makes up for a very\nnice <strong>Run-Time</strong> <strong>Theming</strong> API. Since everything is Javascript, your Themes are regular Javascript\nobject that can be composed or broken down into parts as any other regular JS object,\nand these can be altered at Run-Time, Themes can be composed, and they provide\na much simpler strategy than Build-Time CSS generated Themes like <a href=\"https://react-bootstrap.github.io/\">Bootstrap</a> or <a href=\"https://ant.design/\">Ant Design</a>.\n<a href=\"https://material-ui.com/\">Material UI React</a> uses a Run-Time Theme via a custom <strong>CSS-in-JS</strong> solution.</p>\n<p>Inlining is particularly useful for Component libraries or even UI Frameworks because\nthey tend to be mostly CSS heavy and with a couple of SVGs at most, both of which are efficiently\ninlined.</p>\n<p>Images are a bit more problematic because they are inlined in <a href=\"https://medium.com/snapp-mobile/dont-use-base64-encoded-images-on-mobile-13ddeac89d7c\">Base64</a> making them 30% bigger.</p>\n<p>In my experience, most Component Libraries do not tend to use an overabundance\nof images and if they do they usually are rather small.</p>\n<p>Most high resolution images are dynamic content that is usually dealt by\nApplications and not libraries, although libraries can render images, they do not\nship with those images since they are <em>Content</em> provided by APIs\nor static files in the App.</p>\n<p>The main drawback of inlining is that you turn multiple files that can\nbe fetched in parallel by the browser to a single larger file that cannot,\nthis will become more noticeable in larger code bases such as big Component Libraries\nor Applications.</p>\n<p>If you have a big enough library of components you might be able to break it\ninto independent chunks that can be dynamically imported by Applications,\nallowing more parallelism.\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\">Dynamic imports</a> is a new Javascript feature that lets you express a dynamically loaded\ndependency that will be <em>fetched</em> and <em>interpreted</em> only when needed if needed at all.\nThis feature allows bigger and complex applications to reduce the initial load time by\nloading only what is necessary for the particular portion of the app that the user is interacting with.\nThis is actually not a super far fetched solution since dynamic imports\nare becoming <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\">widely available</a> and Webpack has been making good\nprogress towards an easier configuration for multiple chunks.</p>\n<h3 id=\"not-inline\" style=\"position:relative;\">Not-Inline<a href=\"#not-inline\" aria-label=\"not inline permalink\" class=\"header-anchor after\">#</a></h3>\n<h4 id=\"as-component-authors\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors\" aria-label=\"as component authors permalink\" class=\"header-anchor after\">#</a></h4>\n<p>The configuration is pretty standard and you can use\nalready made solutions such as <a href=\"https://www.npmjs.com/package/create-react-library\">create-react-library</a>.</p>\n<p>You will end up with a bundle made of different files.</p>\n<p>A typical output might look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/dist\n  - bundle.js\n  - bundle.css\n  images/\n    - dog.jpg</code></pre></div>\n<p>This is what you as an Author would publish to <a href=\"https://www.npmjs.com/\">NPM</a>.</p>\n<p><code class=\"language-text\">bundle.css</code> will use the image by doing <code class=\"language-text\">url(./images/dog.jpg)</code>, so\nboth files need to be served on the following URLs</p>\n<ul>\n<li><code class=\"language-text\">yourSite.com/public/bundle.css</code></li>\n<li><code class=\"language-text\">yourSite.com/public/images/dog.jpg</code></li>\n</ul>\n<p><code class=\"language-text\">public</code> can be any path with a trivial length, the important part is\nthat they are both served from <a href=\"https://stackoverflow.com/questions/940451/using-relative-url-in-css-file-what-location-is-it-relative-to\">the same path</a></p>\n<p>Aside from properly documenting how the files inside your package\nrelate to each other there is not much else you can do.</p>\n<p>You can also use this strategy by allowing access to your module via a CDN\n(<em>Content Delivery Network</em> use to load Javascript, CSS, etc from specialized servers, checkout <a href=\"https://unpkg.com/\">UNPKG</a>),\nby which <em>Component Consumers</em> can simply reference the module.</p>\n<h4 id=\"as-component-consumers\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers\" aria-label=\"as component consumers permalink\" class=\"header-anchor after\">#</a></h4>\n<p>This is where this approach has a hard time providing a good Consumer experience.</p>\n<p>Consumers need to:</p>\n<ul>\n<li><code class=\"language-text\">import module from 'module'</code> for Javascript, in every file that uses the module</li>\n<li>\n<p>Import the CSS by using either:</p>\n<ul>\n<li>A bundler like Webpack:</li>\n<li><code class=\"language-text\">import \"module.css\"</code> only once in your Application</li>\n<li>HTML link:</li>\n<li><code class=\"language-text\">cp ./node_modules/module/module.css ./public/images/dog.jpg</code>: copy the CSS file to your public directory</li>\n<li><code class=\"language-text\">&lt;link type=\"text/css\" rel=\"stylesheet\" href=\"public/module.css\"></code>: load the CSS in your page.</li>\n</ul>\n</li>\n<li>\n<p>Serve images at the path the module’s CSS and/or Javascript files expect them, in this case at <code class=\"language-text\">./images/dog.jpg</code></p>\n<ul>\n<li><code class=\"language-text\">cp ./node_modules/module/images/dog.jpg ./public/images/dog.jpg</code></li>\n<li>Serve <code class=\"language-text\">public/images/dog.jpg</code> by properly configuring your Application</li>\n</ul>\n</li>\n</ul>\n<p>We assume that <code class=\"language-text\">public</code> is your App’s public directory from where you serve your\nstatic files and assets, for convenience the directory is called <code class=\"language-text\">public</code> and the\nURL path is also called <code class=\"language-text\">public</code>.</p>\n<p>Notice how to <em>Consume</em> a simple module you need to do a lot of steps and\nwhile there are tools to automate the process such as <a href=\"https://webpack.js.org/\">Webpack</a>, <a href=\"https://gruntjs.com/\">Grunt</a>, <a href=\"https://gulpjs.com/\">Gulp</a>\nor a package like <a href=\"https://www.npmjs.com/package/npm-assets\">npm-assets</a>, the overall experience is not optimal.</p>\n<p>An obvious additional problem is potential <em>name conflicts</em>,\nfor example if two libraries need to serve <code class=\"language-text\">images/dog.jpg</code>.</p>\n<p><em>Component Authors</em> might make the module available via a CDN and that might\nremove the need to fiddle around with CSS and Images but you will need to\naccess the library via a <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Global_object\">Browser Global</a> like the good old days, and by doing this\nyou are removing the possibility of bundling optimizations such as <a href=\"https://webpack.js.org/guides/tree-shaking/\">Tree Shaking</a> that\nwill become more and more common in the future.</p>\n<h3 id=\"inline\" style=\"position:relative;\">Inline<a href=\"#inline\" aria-label=\"inline permalink\" class=\"header-anchor after\">#</a></h3>\n<h4 id=\"as-component-authors-1\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-1\" aria-label=\"as component authors 1 permalink\" class=\"header-anchor after\">#</a></h4>\n<p>The Webpack configuration is about the same as with <strong>Not-inline</strong> and\nis actually not that hard and a working example\nwill be provided at the end of this post.</p>\n<p>You also will be able to use <a href=\"https://www.npmjs.com/package/create-react-library\">create-react-library</a> since it <a href=\"https://github.com/transitive-bullshit/create-react-library/issues/46\">inlines by default</a>.</p>\n<p>The key Webpack configuration is the inclusion of <a href=\"https://webpack.js.org/loaders/url-loader/\">url-loader</a> to\ninline images and files right into the final Javascript bundle.</p>\n<p>If you use <strong>CSS-in-JS</strong> libraries such as <a href=\"https://emotion.sh/docs/introduction\">Emotion</a> or <a href=\"https://www.styled-components.com/\">Styled-components</a> then\nyou will be able to use all the CSS features, plus compose them via Javascript and the\n<strong>Theming</strong> experience will be awesome.\nYou can easily create a Run-Time default Theme and provide\nhooks for <em>Component Consumers</em> to easily change it at Run-Time.</p>\n<p>For larger Component Libraries you will have a greater experience with writing\nand maintaining CSS. You will avoid completely some CSS exclusive problems such as:</p>\n<ul>\n<li>Global Scope and rule collisions.</li>\n<li>Specificity (inline-styles have maximum specificity, <strong>CSS-in-JS</strong> libraries simulate this).</li>\n<li>Style composition. I believe that regular Javascript object composition is better than CSS cascading global composition model, plus you can create a custom system that fits your team and your business logic (remember, it’s regular Javascript). You can easily publish your Themes as private NPM packages internally to shared them among Applications.</li>\n</ul>\n<p>While regular inline-styles will go a long way, you will most likely\nneed features that inline-styles do not provide and that regular CSS do such\nas pseudo selectors like <code class=\"language-text\">:hover</code> and media queries.\nTo solve this problem and provide better Developer Experience overall is that\n<strong>CSS-in-JS</strong> exists.</p>\n<p>I recommend going for <a href=\"https://emotion.sh/docs/introduction\">Emotion</a> or <a href=\"https://www.styled-components.com/\">Styled-components</a> since they\nare very mature and feature rich, have\ngood documentation and an active community.</p>\n<h4 id=\"as-component-consumers-1\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-1\" aria-label=\"as component consumers 1 permalink\" class=\"header-anchor after\">#</a></h4>\n<p>Here is where the <strong>Inline</strong> approach <em>shines</em>.\nTo use a module with all its styles and assets such as images\nyou simply need to write a single line of code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> module <span class=\"token keyword\">from</span> <span class=\"token string\">\"module\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That is all!</p>\n<p>If you want to import the module dynamically (to parallelize and defer its loading\nin the client) the experience is very similar:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Inside some function or component</span>\n<span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"module\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If you have Webpack configured correctly to create chunks that can be\ndynamically loaded, this is called <code class=\"language-text\">Code Splitting</code>, then <code class=\"language-text\">module</code>\nwill be an independent file lazy loaded, only when it is needed.</p>\n<p>Latest version of Webpack make this configuration almost trivial,\ncheck out their <a href=\"https://webpack.js.org/guides/code-splitting/\">docs</a>.</p>\n<p>This approach also works with the <em>Classic Way</em> of using dependencies via Browser Globals.</p>\n<h2 id=\"theming\" style=\"position:relative;\">Theming<a href=\"#theming\" aria-label=\"theming permalink\" class=\"header-anchor after\">#</a></h2>\n<p>For Component Libraries or UI Frameworks <strong>Theming</strong> is a <em>must</em>. They need to provide a way\nfor Component Consumers to change the default look of the components to fit\ntheir brand or their business.</p>\n<p>Let’s inspect different strategies of providing Theming and Customization hooks.</p>\n<h3 id=\"regular-css-class-names\" style=\"position:relative;\">Regular CSS Class Names<a href=\"#regular-css-class-names\" aria-label=\"regular css class names permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This approach works great for single or few component libraries but falls\nvery short for larger Component Libraries or UI Frameworks.</p>\n<p>The basic premise is that Consumers use well defined CSS class names\nto alter the Component’s looks.</p>\n<p>This approach works only at <strong>Run-Time</strong>.</p>\n<h4 id=\"as-component-author\" style=\"position:relative;\">As Component Author<a href=\"#as-component-author\" aria-label=\"as component author permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>You write regular CSS Classes (without CSS modules) and you relate them to your components via\n<code class=\"language-text\">className</code>.</li>\n<li>You can use LESS or SASS or any other CSS preprocessor.</li>\n<li>You should use Class Names naming conventions such as <a href=\"http://getbem.com/introduction/\">BEM</a> or <a href=\"http://smacss.com/\">SMACSS</a> among others.</li>\n<li>You <strong>cannot</strong> use CSS Modules since they generate pseudo random Class Names that cannot be used consistently by Consumers to customize or theme your components.</li>\n<li>You structure your classes carefully to allow Component Consumers to Theme or Customize your components styles by overriding some of those classes.</li>\n</ul>\n<h4 id=\"as-component-consumer\" style=\"position:relative;\">As Component Consumer<a href=\"#as-component-consumer\" aria-label=\"as component consumer permalink\" class=\"header-anchor after\">#</a></h4>\n<p>You use the Component Author provided class names to alter the component’s looks.</p>\n<h3 id=\"css-theme-variables\" style=\"position:relative;\">CSS Theme variables<a href=\"#css-theme-variables\" aria-label=\"css theme variables permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This approach is much more robust. The main premise is that Component Authors\nuse a set of well defined CSS, LESS or SASS variables to derive the rest of the styles.\nThese variables conform the Theme. Component Consumers can alter these variables\nto generate different looking themes.</p>\n<p>Examples of these are</p>\n<ul>\n<li><a href=\"https://ant.design/\">AntDesing</a></li>\n<li><a href=\"https://react-bootstrap.github.io/\">Bootstrap</a></li>\n<li><a href=\"https://react.semantic-ui.com/\">Semantic-UI</a></li>\n</ul>\n<p>This approach works only at <strong>Build-Time</strong> and <strong>may require a build system</strong>,\ndepending on whether you use CSS variables and target only supported browsers or\nyou use SASS, LESS or a transpiled version of CSS variables (i.e. using <a href=\"https://www.npmjs.com/package/postcss-css-variables\">this PostCss plugin</a>)</p>\n<h4 id=\"as-component-authors-2\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-2\" aria-label=\"as component authors 2 permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>Carefully abstract the core theme variables and derive the rest of the styles from it.</li>\n<li>Provides a build system or build system integration documentation for Component Consumers to alter theme variables and compile new stylesheets.</li>\n<li>Works with or without CSS Modules.</li>\n</ul>\n<h4 id=\"as-component-consumers-2\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-2\" aria-label=\"as component consumers 2 permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>\n<p>You will need to either:</p>\n<ul>\n<li>build an out of band StyleSheet with the Component Author’s provided build system ala Bootstrap or Ant Design.</li>\n<li>integrate Component’s Author build system into yours and build it in-band with the rest of your app.</li>\n</ul>\n</li>\n<li>Run-Time build is not possible and you must work around it.</li>\n</ul>\n<p><strong>Note</strong></p>\n<p><em>Out of band</em> and <em>in band</em> are terms I got from signal processing theory and in this case I’m using it to\ndescribe whether you build the StyleSheet in a separate build process and codebase (out of band)\nor you integrate the necessary build configurations into your own build process and codebase (in band).</p>\n<h3 id=\"inline-css-through-css-in-js\" style=\"position:relative;\">Inline CSS (through CSS-in-JS)<a href=\"#inline-css-through-css-in-js\" aria-label=\"inline css through css in js permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This approach uses Core Theme Variables defined at Run-Time and\npassed through Javascript to components to alter their looks.</p>\n<p>It works well with the <strong>Inline</strong> Paradigm</p>\n<p>This approach works at <strong>Run-Time</strong> and does not require a build system.</p>\n<h4 id=\"as-component-authors-3\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-3\" aria-label=\"as component authors 3 permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>Carefully abstract the core theme variables and derive the rest of the styles from it.</li>\n<li>Use CSS-in-JS libraries such as Emotion or styled-components.</li>\n<li>Use those libraries to provide theming hooks to Component Consumers.</li>\n</ul>\n<h4 id=\"as-component-consumers-3\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-3\" aria-label=\"as component consumers 3 permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>You must use the same CSS-in-JS libraries that the Component Author used.</li>\n<li>You simply define regular Javascript objects with core theme variables and pass them to Components.</li>\n</ul>\n<h2 id=\"tldr-how-to-package-and-publish-front-end-libraries-in-2020\" style=\"position:relative;\">TLDR: How to package and publish Front End libraries in 2020<a href=\"#tldr-how-to-package-and-publish-front-end-libraries-in-2020\" aria-label=\"tldr how to package and publish front end libraries in 2020 permalink\" class=\"header-anchor after\">#</a></h2>\n<p>This is my ideal setup for packaging and publishing\nFront End libraries such as React Components in 2020.</p>\n<p>This approach uses an Inline, Actively Compiled (see Appendix 2), Run-Time Theming model,\nthat uses the following technologies:</p>\n<ul>\n<li>React as the main component framework</li>\n<li>CSS-in-JS via Emotion</li>\n<li>Inline CSS via <strong>CSS-in-JS</strong> and the rest of the assets are inlined via Webpack’s <code class=\"language-text\">url-loader</code></li>\n<li>Webpack as the bundler</li>\n</ul>\n<p>Check the full <a href=\"https://github.com/franleplant/inline-react-package-example\">working source here</a></p>\n<p>To publish it to NPM:</p>\n<ul>\n<li>make sure you have the <code class=\"language-text\">package.json#main</code> file pointing to the output of your compilation, in this case <code class=\"language-text\">dist/index.js</code></li>\n<li>run <code class=\"language-text\">npm version patch | minor | major</code> to bump the version in <code class=\"language-text\">package.json</code> and create git tags</li>\n<li>run <code class=\"language-text\">npm publish</code></li>\n</ul>\n<p>Make sure you publish to the right NPM repository before doing it as most of the time\ncompanies do not want private packages to be publicly available by mistake.\nRead more <a href=\"https://docs.npmjs.com/misc/registry\">here</a></p>\n<p><strong>Webpack configuration</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This is where we define the Inline magic.</span>\n<span class=\"token comment\">// This loader will turn all .svg, .jpg and .png files</span>\n<span class=\"token comment\">// into something that can be inlined in the final bundle</span>\n<span class=\"token keyword\">const</span> fileRules <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.(svg|jpg|png)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n  use<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      loader<span class=\"token operator\">:</span> <span class=\"token string\">\"url-loader\"</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// All files no matter what size</span>\n        limit<span class=\"token operator\">:</span> <span class=\"token number\">Infinity</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Pretty standard babel configurations for modern react apps</span>\n<span class=\"token keyword\">const</span> jsRules <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.jsx?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n  exclude<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">node_modules</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n  use<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    loader<span class=\"token operator\">:</span> <span class=\"token string\">\"babel-loader\"</span><span class=\"token punctuation\">,</span>\n    options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      presets<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"@babel/preset-react\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token operator\">:</span> <span class=\"token string\">\"./src/index.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// Will defer minifaction to Applications bundler</span>\n  mode<span class=\"token operator\">:</span> <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    filename<span class=\"token operator\">:</span> <span class=\"token string\">\"index.js\"</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"dist\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    libraryTarget<span class=\"token operator\">:</span> <span class=\"token string\">\"umd\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// Manually tell webpack about our \"peerDependencies\"</span>\n  <span class=\"token comment\">// that should not be included in the final bundle and</span>\n  <span class=\"token comment\">// will be provided by the Component Consumer, like an Application</span>\n  externals<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"react-dom\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"@emotion/core\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"@emotion/styled\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"emotion-theming\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  module<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>jsRules<span class=\"token punctuation\">,</span> fileRules<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Example Component with CSS-in-JS, inline assets and Theming</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> styled <span class=\"token keyword\">from</span> <span class=\"token string\">\"@emotion/styled\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ThemeProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"emotion-theming\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> dog1 <span class=\"token keyword\">from</span> <span class=\"token string\">\"./dog.jpg\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> dog2 <span class=\"token keyword\">from</span> <span class=\"token string\">\"./dog2.jpg\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> defaultTheme <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  colors<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    primary<span class=\"token operator\">:</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use regular CSS features through CSS-in-JS</span>\n<span class=\"token comment\">// instrumented by Emotion</span>\n<span class=\"token keyword\">const</span> Container <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  margin: 10px;\n  padding: 10px;\n  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);\n  &amp; > div {\n    margin: 10px;\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> Name <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>span<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  font-weight: bold;\n  color: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> props<span class=\"token punctuation\">.</span>theme<span class=\"token punctuation\">.</span>colors<span class=\"token punctuation\">.</span>primary<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use the image from CSS-in-JS</span>\n<span class=\"token keyword\">const</span> Dog2 <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  background: center / contain no-repeat url(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dog2<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">);\n  width: 100px;\n  height: 100px;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use the image from Javascript code</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Dog1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>dog1<span class=\"token punctuation\">}</span> width<span class=\"token operator\">=</span><span class=\"token string\">\"100\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ThemeProvider\n      theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ancestorTheme <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"theme\"</span><span class=\"token punctuation\">,</span> ancestorTheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>defaultTheme<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>ancestorTheme <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Container<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n          Im MyComponent<span class=\"token punctuation\">,</span> hi <span class=\"token operator\">&lt;</span>Name<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Name<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> and\n          my color comes from a theme\n          <span class=\"token operator\">&lt;</span>br <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          Here are some pictures <span class=\"token keyword\">of</span> dogs\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n\n        <span class=\"token operator\">&lt;</span>Dog1 <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Dog2 <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Container<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeProvider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Component Consumer</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// In _real_ applications you would use it like this</span>\n<span class=\"token keyword\">import</span> MyComponent <span class=\"token keyword\">from</span> <span class=\"token string\">\"my-lib\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Theming API!</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ThemeProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"emotion-theming\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> appTheme <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  colors<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    primary<span class=\"token operator\">:</span> <span class=\"token string\">\"green\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>We are using MyComponent<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>\n        It was Actively Compiled and now we can use it from\n        a Create React App Application\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token comment\">/* App defined theme at runtime */</span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span>ThemeProvider theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>appTheme<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>MyComponent name<span class=\"token operator\">=</span><span class=\"token string\">\"Luke Skywalker\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeProvider<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Notes</strong></p>\n<ul>\n<li>make sure you have a single copy of <code class=\"language-text\">@emotion/core</code> in your final Application bundle to enable Theming. This is done by properly managing <code class=\"language-text\">peerDependencies</code> (more on this later).</li>\n<li>see it working in action in the linked repo.</li>\n</ul>\n<h3 id=\"using-create-react-library\" style=\"position:relative;\">Using create-react-library<a href=\"#using-create-react-library\" aria-label=\"using create react library permalink\" class=\"header-anchor after\">#</a></h3>\n<p>We can achieve the same by using <a href=\"https://www.npmjs.com/package/create-react-library\">create-react-library</a>, the library\ncode is the same and we remove the need for manually configuring Webpack, the\noutput bundle is slightly different since <em>create-react-library</em>\nuses <a href=\"https://rollupjs.org/\">Rollup</a> instead of Webpack.</p>\n<p>Checkout the code <a href=\"https://github.com/franleplant/inline-react-package-example-crl\">here</a>, I am using the vanilla configurations that create-react-library\nprovides with one exception:</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span>  url(),\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>  url({limit: Infinity}),</span></code></pre></div>\n<p>This forces everything to be inlined no matter what is its size.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Congratulations reading this far!</p>\n<p>You now know how to share code between different consumers such as Applications and\nwhen to apply each of the studied solutions.</p>\n<p>If you have any questions let me know!</p>\n<hr>\n<h2 id=\"appendix-1-how-to-use-peer-dependencies\" style=\"position:relative;\">Appendix 1: How to use Peer Dependencies<a href=\"#appendix-1-how-to-use-peer-dependencies\" aria-label=\"appendix 1 how to use peer dependencies permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>TODO double check how we are handling externals</p>\n</blockquote>\n<p>As a <strong>Component Author</strong> you need to manage <strong>Peer Dependencies</strong> correctly to allow\n<strong>Component Consumers</strong> make the best possible final bundle avoiding duplication of dependencies\nbut also some libraries such as <code class=\"language-text\">React</code> and <code class=\"language-text\">Emotion</code> don’t work correctly if there are multiple versions\nof them running at the same time.</p>\n<h3 id=\"what-are-peer-dependencies\" style=\"position:relative;\">What are Peer Dependencies?<a href=\"#what-are-peer-dependencies\" aria-label=\"what are peer dependencies permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Every dependency that <em>might</em> or <em>should</em> be shared by multiple libraries used by a single <strong>Component Consumer</strong>\nshould be treated as <strong>Peer Dependencies</strong>.</p>\n<p>Examples of obvious Peer Dependencies are</p>\n<ul>\n<li><code class=\"language-text\">react</code>: use by lots of components, breaks if there are more than one copy of it running</li>\n<li><code class=\"language-text\">lodash</code>: used by lots of libraries and components</li>\n<li><code class=\"language-text\">redux</code></li>\n<li><code class=\"language-text\">@emotion/core</code>: Theming breaks if you have more than one copy at the same time. <a href=\"https://github.com/emotion-js/emotion/issues/1479\">ref</a></li>\n</ul>\n<h3 id=\"how-do-i-mark-a-dependency-as-a-peer-dependency\" style=\"position:relative;\">How do I mark a dependency as a Peer Dependency?<a href=\"#how-do-i-mark-a-dependency-as-a-peer-dependency\" aria-label=\"how do i mark a dependency as a peer dependency permalink\" class=\"header-anchor after\">#</a></h3>\n<p>In your <code class=\"language-text\">package.json</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// These are dependencies your lib expects to be present in your</span>\n<span class=\"token comment\">// Component Consumer's context (i.e. the bundle)</span>\n<span class=\"token string\">\"peerDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"~16.0.0\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Most of the time you will need your peer dependencies</span>\n<span class=\"token comment\">// to be installed when testing your library.</span>\n<span class=\"token string\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"~16.0.0\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Important</strong> make sure you are as wide as possible with the version ranges of your peer dependencies, this will\nallow your package, as a Component Author, to be used without frictions in more situations.</p>\n<p>In your <code class=\"language-text\">webpack.config.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// This tells webpack to not include these dependencies in the final bundle</span>\n<span class=\"token comment\">// since you expect them to be provided in the Component Consumer's context.</span>\nexternals<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"react\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"appendix-2-active-vs-passive-compilation\" style=\"position:relative;\">Appendix 2: Active vs Passive compilation<a href=\"#appendix-2-active-vs-passive-compilation\" aria-label=\"appendix 2 active vs passive compilation permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p><strong>TLDR: Do not use <em>Passively compiled</em> dependecies ever!</strong></p>\n</blockquote>\n<p>I have seen situations in which packages are distributed raw,\nwithout being compiled before being published, this means <strong>Component Authors</strong>\npackage and distribute the raw sources like Typescript, ES2054, JSX, CSS Modules, etc.,\nand rely on <strong>Component Consumers</strong>, like Applications, to compile them usually\nby configuring Webpack to also treat <code class=\"language-text\">node_modules/my-raw-dependency</code>\nas part of the Application source.</p>\n<p>This is what I call <strong>Passive compilation</strong> because <strong>Component Authors</strong>\ndelegate their package compilation to the <strong>Component Consumers</strong>, instead\nof <strong>Active compilation</strong> in which each package is distributed already compiled\nby its <strong>Component Author</strong>.</p>\n<p>Today you can go a long way with Webpack abstractions like\n<a href=\"https://create-react-app.dev/\">Create React App</a> and <a href=\"https://www.npmjs.com/package/create-react-library\">Create React Library</a>, but you need to\ndo things in a fairly standard way and <strong>Passive Compilation</strong> is not at all\na standard way of distributing code.</p>\n<p>Check what the team behind <a href=\"https://github.com/facebook/create-react-app/issues/5103#issuecomment-425459196\">Create React App has to say about it</a>.</p>\n<p>It wouldn’t surprise me if other standardized high level build tools take a similar stand for\nreasons we are going to talk about more later.</p>\n<p>In my experience Webpack configurations are something that most developers\ndo not know or do not want to touch so\n<strong>having these sorts of abstractions inside\nyour company will save you a lot of trouble and maintenance,\nwhich translates to less operation costs</strong>.\nThese Webpack abstractions have lots of smart people working on them and\npouring their past experiences in creating something that will cover\nlots of use cases you probably won’t ever think of, so you are getting even\nmore things for free than you anticipate.</p>\n<p>Additionally, having custom Webpack configurations creates a potential\nopportunity to tightly couple other parts of your system like configurations,\nServices URLs, CDNs, PORT assignment, etc. to your Webpack build and configuration\nwhich makes it potentially brittle to any tweaks since it might affect some\ntightly coupled relationship in some obscure place. Relying on standard Webpack abstractions\nprovides a very clear interface where you can pass configuration values and custom behaviors\neffectively reducing this coupling.</p>\n<p>Finally, and with a more of a “business” look, it is much more\nefficient and effective to rely on pre-made solutions for Application bundling and compilation.\nWebpack and the other bundlers are hard to configure exactly right and as a company you will\nneed to maintain and bug fix your hand made configurations if you do them yourself.\nIt is effectively one more source of bugs you will have to deal with,\nso rely as much as possible on third party open source solutions and for that\nyou <em>must</em> avoid <strong>Passive Compilation</strong>.</p>\n<h3 id=\"passive-compilation\" style=\"position:relative;\">Passive Compilation<a href=\"#passive-compilation\" aria-label=\"passive compilation permalink\" class=\"header-anchor after\">#</a></h3>\n<h4 id=\"as-component-authors-4\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-4\" aria-label=\"as component authors 4 permalink\" class=\"header-anchor after\">#</a></h4>\n<h5 id=\"advantages\" style=\"position:relative;\">Advantages<a href=\"#advantages\" aria-label=\"advantages permalink\" class=\"header-anchor after\">#</a></h5>\n<p>It is trivial to setup since you simply distribute your raw files.\nSome sort of an attempt at <strong>Active Compilation</strong> will be required\nif you want to unit test your library, but it could be a subset of the <em>real</em>\nconfiguration that <strong>Actively Compiling</strong> your library for distribution would require.</p>\n<p>It removes the need to think about distributing CSS because each <strong>Component Consumer</strong> (Applications)\nwill compile raw CSS modules or SASS or LESS into a single final bundle that will\ninclude your <strong>Passively Compiled</strong> dependency styles.</p>\n<p>Same goes for other assets such as fonts and images. Since Applications are treating\ndependencies as sources then all these things will be covered by whatever\nstrategy the Application’s Webpack configuration uses, like <code class=\"language-text\">file-loader</code>, etc.</p>\n<p>Providing a <strong>Theming</strong> API is also pretty simple as long as you have SASS or LESS\ncore variables that define your theme and from which the rest of the library’s\nstyles depend on and as long as the <strong>Component Consumers</strong> support these type of preprocessing.</p>\n<h5 id=\"disadvantages\" style=\"position:relative;\">Disadvantages<a href=\"#disadvantages\" aria-label=\"disadvantages permalink\" class=\"header-anchor after\">#</a></h5>\n<p>You must either specify or follow a specification of what Webpack loaders,\nloader configuration, CSS configuration, Babel configuration, etc. your library\nrequires in order for Apps to compile it successfully. You could also construct\nsome sort of Webpack composition hook but that can get really complicated really\nsoon without the proper care. An obvious problem with config composition is\nconflicts with a given loader configuration, such as Babel, where the App uses\ncertain configurations and the library uses others. In general I would say that\nthe library and the consumer App cannot have too different bundling configurations\nif they want to work properly together, which means of course <em>tight coupling</em>.</p>\n<p>You have less encouragement to create a library public API and\nsimply let <em>Component Consumers</em> use any of your library files\ndirectly i.e. <code class=\"language-text\">import something from 'A/src/some/deep/nested/file.js'</code>.</p>\n<p>This will make even harder to migrate your library to an <strong>Actively Compiled</strong>\nstrategy down the road because <em>Component Consumer</em> Apps will be tightly coupled\nto your library’s internal file structure and providing that same per-file API\nin Webpack is not trivial and has caveats (sharing code and such).</p>\n<p>By far, the <strong>biggest disadvantage</strong> with <strong>Passive compilation</strong> is that it will\n<strong>infect</strong> everything that it touches.\nIf you are creating a new package that is <strong>Actively compiled</strong>\nbut it uses some of the <strong>Passively compiled</strong> packages then BINGO,\nyou need to customize your package build to compile those <strong>passively compiled</strong>\npackages and you end up in a very similar situation than simply making\nyour new package <strong>Passively compiled</strong>. Which locks you down into this paradigm\nand all its flaws.</p>\n<p>I have been able to partially solve this situation by making those\n<strong>Passively compiled</strong> dependencies be <code class=\"language-text\">peerDependencies</code>, but you still need to\nhandle them somehow in a test environment (probably by mocking them entirely,\n<a href=\"https://jestjs.io/\">Jest</a> does make this fairly easy)\nand if you have any sort of playground or documentation page where\nyou display your component then BINGO again, you need to compile\n<strong>Passively compiled</strong> dependencies to make it work.</p>\n<p>If this seems crazy to you I can already tell you that I have\nexperienced this in my day to day Job and is super frustrating.</p>\n<h4 id=\"as-component-consumers-4\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-4\" aria-label=\"as component consumers 4 permalink\" class=\"header-anchor after\">#</a></h4>\n<h5 id=\"advantages-1\" style=\"position:relative;\">Advantages<a href=\"#advantages-1\" aria-label=\"advantages 1 permalink\" class=\"header-anchor after\">#</a></h5>\n<p>It is fairly easy to setup with some tweaks to the inclusion paths in your Webpack config.</p>\n<p><strong>Theming</strong> is easy because you just need to overwrite some SASS or LESS variables and your\nbuild system will do the rest.</p>\n<h5 id=\"disadvantages-1\" style=\"position:relative;\">Disadvantages<a href=\"#disadvantages-1\" aria-label=\"disadvantages 1 permalink\" class=\"header-anchor after\">#</a></h5>\n<p>You cannot use Webpack abstractions such as <a href=\"https://create-react-app.dev/\">Create React App</a>\nbecause you always need to customize the sources you include,\nand since this is a rather rare use case,\nmost abstractions won’t and probably should not provide this functionality.</p>\n<h3 id=\"active-compilation\" style=\"position:relative;\">Active Compilation<a href=\"#active-compilation\" aria-label=\"active compilation permalink\" class=\"header-anchor after\">#</a></h3>\n<h4 id=\"as-component-authors-5\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-5\" aria-label=\"as component authors 5 permalink\" class=\"header-anchor after\">#</a></h4>\n<p>You actually need to write a full Webpack configuration\nto generate the bundle, but it is really not that bad (more on this later).</p>\n<p>Alternatively, you can use already made solutions such as <a href=\"https://www.npmjs.com/package/create-react-library\">create-react-library</a> et al.</p>\n<p>You will need to make decisions about how to package and distribute your\ncode which <em>is</em> exactly the main point of this post.</p>\n<h4 id=\"as-component-consumers-5\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-5\" aria-label=\"as component consumers 5 permalink\" class=\"header-anchor after\">#</a></h4>\n<p>You don’t need to customize your Webpack config to use the library,\nthis results in simpler configuration. You can also use standard\npre-made solutions such as <a href=\"https://create-react-app.dev/\">create-react-app</a></p>\n<p><strong>Theming</strong> will depend exclusively on what the <em>Component Author</em>\nsets up to be the Theming API. If a Component Author use\nsomething like <strong>CSS-in-JS</strong> then the experience will be pretty good.\n<a href=\"https://material-ui.com/\">Material-UI React</a> uses this API.</p>\n<p>If the Component Author provides a build to compile custom Themes\nout of band (outside your Apps build system) then it will be less\noptimal in my opinion.\n<a href=\"https://ant.design/\">Ant Design</a> and <a href=\"https://react-bootstrap.github.io/\">React Bootstrap</a> use this API.</p>","excerpt":"Table of Contents Introduction: How to share React Components between Applications? To Inline or not to Inline Not-Inline Inline Theming…","fields":{"slug":"/package-react-components/","readingTime":{"text":"25 min read"}},"frontmatter":{"title":"How to share React Components between Applications via NPM","date":"January 21, 2020","description":"In this post we explore in detail how to share React Components which are typically made of a bundle of Javascript, CSS (styles), Images, etc. We explore how to package and bundle the code with Webpack so that it can be published and distributed via a public or private NPM repository and later consumed appropriately. We also analyze different theming strategies for larger Component Libraries and UI Frameworks. And finally we provide a recommended way of packaging your Components in a simple and very flexible way.","tags":["React","Javascript","Typescript","CSS","Webpack","NPM","code sharing","publishing"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},{"node":{"html":"<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Since we are using <a href=\"https://www.gatsbyjs.org/\">Gatsby</a> to build this site as a set of static files, there are some common functionalities that you might find in dynamic sites which you will naturally be missing. However, this does not mean they cannot be implemented in some way.</p>\n<p>As a way of testing the development of a small, simple feature and some Azure offerings, we decided to try to build a page view counter for our blog posts.</p>\n<h2 id=\"scope\" style=\"position:relative;\">Scope<a href=\"#scope\" aria-label=\"scope permalink\" class=\"header-anchor after\">#</a></h2>\n<p>The scope of this small experiment will be to build a small service that maintains the state of how many times a specific blog post (or in general, a page) was viewed. Since in our case we are building the site statically, we will be calling the service from the frontend.</p>\n<h2 id=\"tech-requirements\" style=\"position:relative;\">Tech requirements<a href=\"#tech-requirements\" aria-label=\"tech requirements permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Azure provides <a href=\"https://docs.microsoft.com/en-us/azure/architecture/guide/technology-choices/compute-overview\">multiple compute solutions</a>, each with its own use cases. Considering the scope, <a href=\"https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview\">Azure Functions</a> sounds like a good offering. Function apps are serverless execution contexts where we can run a piece of code (the Functions themselves) in a stateless way.</p>\n<p>Since this compute platform is stateless, it means we’ll need to have a separate way of storing how many times each page was visited. Most of the full-fledged DB offerings will probably be overkill for this, so using something like <a href=\"https://azure.microsoft.com/en-us/services/storage/tables/\">Azure Storage Tables</a> sounds like a good idea. The light, no-schema, and cheap service is good for key-value storage, which is exactly what we need.</p>\n<p>Considering the above, what we will be using is the following:</p>\n<ul>\n<li>An Azure account/subscription (the <a href=\"https://azure.microsoft.com/en-us/free/\">free one</a> will be more than enough).</li>\n<li>Azure Storage Account, to use the tables service.</li>\n<li>Azure Functions App, to deploy our function into.</li>\n<li>An IDE (for this, I will be using .NET Core C# on the free version of <a href=\"(https://azure.microsoft.com/downloads/)\">Visual Studio</a>, but there are <a href=\"https://docs.microsoft.com/en-us/azure/azure-functions/supported-languages\">several offerings</a> that Azure Functions support)</li>\n<li>The <a href=\"https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local#v2\">Core Tools</a> for Azure Functions. It comes with Visual Studio if you include the <strong>Azure development</strong> workload when installing it.</li>\n</ul>\n<h2 id=\"capacity\" style=\"position:relative;\">Capacity<a href=\"#capacity\" aria-label=\"capacity permalink\" class=\"header-anchor after\">#</a></h2>\n<p>These Azure services all have their own pricing plans, but as mentioned in the above section, we will be fine using the free subscription offering for the experiment. You can see which products are free and in which capacity <a href=\"https://azure.microsoft.com/en-us/free/search#new-products\">here</a>.</p>\n<p>You can see that this plan includes 1,000,000 function requests per month, which is a good amount in terms of capacity. You can upgrade later if needed, but in general, it’s a cheap plan and a good way to start.</p>\n<h2 id=\"building-the-service\" style=\"position:relative;\">Building the service<a href=\"#building-the-service\" aria-label=\"building the service permalink\" class=\"header-anchor after\">#</a></h2>\n<h3 id=\"overview\" style=\"position:relative;\">Overview<a href=\"#overview\" aria-label=\"overview permalink\" class=\"header-anchor after\">#</a></h3>\n<p>As a general guide, let’s review a brief overview of what we’ll accomplish and delve into the details as the post goes on:</p>\n<ol>\n<li>We need to create an Azure Function.</li>\n<li>As Azure Functions are stateless, we need to add a way to persist these counts. For this, we need to create an Storage Account on Azure and use the Table service to keep track of this.</li>\n<li>We’ll have to program the Azure Function that it responds to requests for page view counts (for a specific URL/post) and tracks this on Storage Tables.</li>\n<li>Lastly, we’ll have to deploy the solution.</li>\n</ol>\n<h3 id=\"using-azure-functions\" style=\"position:relative;\">Using Azure Functions<a href=\"#using-azure-functions\" aria-label=\"using azure functions permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Azure Functions is a way of executing code in a <a href=\"https://azure.microsoft.com/solutions/serverless/\">serverless</a> manner. In a way, it lets us only worry about the code that we want to execute instead of how the code is executed:</p>\n<blockquote>\n<p>Azure Functions is a solution for easily running small pieces of code, or “functions,” in the cloud. You can write just the code you need for the problem at hand, without worrying about a whole application or the infrastructure to run it. Functions can make development even more productive, and you can use your development language of choice, such as C#, Java, JavaScript, PowerShell, and Python. Pay only for the time your code runs and trust Azure to scale as needed.</p>\n</blockquote>\n<p>It’s similar to what AWS offers with Lambdas. Thinking about it in terms of abstractions, we can put Functions-as-a-Service a layer above Platform-as-a-service (which, in turn, finds itself above Infrastructure-as-a-Service).</p>\n<p>There are some things we need to define before writing code for our own function, but they will be explained as we go along with the creation of the project in Visual Studio.</p>\n<p>Note that you can also create the Azure Function before deploying any actual code into it on the Azure portal (or several other ways like PowerShell, Azure CLI, REST API, etc.), but it makes sense to abstract from that considering the fact that we know that the project templates that come with Visual Studio (or the core tools in general) handle everything we need to deploy our code correctly into our own Azure account.</p>\n<p>To start, we open Visual Studio and create a new project. In the Create a new project dialog box, search for functions, choose the Azure Functions template, and select Next. I’m creating the project with the name <em>PageViewCounter</em>.</p>\n<p>At this point, we need to set up our Function implementation. Let’s review the settings we need to set and what their concepts mean:</p>\n<ul>\n<li>There’s a drop-down that contains the technologies that will host our functions. As mentioned previously, we will use <em>Azure Functions v2 (.NET Core)</em>.</li>\n<li>Functions also provide automatic ways of triggering our code, some of which communicate with other Azure Services to call the function when something happens (Queues triggers, IoT Triggers, Blob Triggers, etc.). We’ll use the <a href=\"https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-http-webhook?tabs=csharp\"><strong>HTTP trigger</strong></a> as we want our function to trigger whenever we enter a page.</li>\n<li>Authorization level: Anonymous. We don’t need fancy ways of doing authentication for this so we’ll leave it at that for simplicity.</li>\n</ul>\n<p>After creating the project, we are received with boilerplate code that does some simple processing of a request; where if the HTTP request contains a name parameter, the response will be a greeting, and otherwise the request will fail with an error message:</p>\n<p><strong><code class=\"language-text\">Function1.cs</code></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">    <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">FunctionName</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"Function1\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">async</span> <span class=\"token return-type class-name\">Task<span class=\"token punctuation\">&lt;</span>IActionResult<span class=\"token punctuation\">></span></span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">HttpTrigger</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span>AuthorizationLevel<span class=\"token punctuation\">.</span>Anonymous<span class=\"token punctuation\">,</span> <span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span> Route <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token class-name\">HttpRequest</span> req<span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">ILogger</span> log<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">LogInformation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C# HTTP trigger function processed a request.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> name <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>Query<span class=\"token punctuation\">[</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> requestBody <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StreamReader</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ReadToEndAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">dynamic</span></span> data <span class=\"token operator\">=</span> JsonConvert<span class=\"token punctuation\">.</span><span class=\"token function\">DeserializeObject</span><span class=\"token punctuation\">(</span>requestBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        name <span class=\"token operator\">=</span> name <span class=\"token operator\">??</span> data<span class=\"token punctuation\">?.</span>name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> name <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span>\n            <span class=\"token punctuation\">?</span> <span class=\"token punctuation\">(</span>ActionResult<span class=\"token punctuation\">)</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">OkObjectResult</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Hello, </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">name</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">BadRequestObjectResult</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Please pass a name on the query string or in the request body\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let’s unpack some of the things we see here:</p>\n<ul>\n<li>The <em>[FunctionName(“Function1”)]</em> attribute tells the Azure Functions app what the name of our Function is.</li>\n<li><em>[HttpTrigger(AuthorizationLevel.Anonymous, “get”, “post”, Route = null)] HttpRequest req</em>: This attribute is used to define that this Function is triggered by HTTP and you can have it be triggered by this other things, as we reviewed. We are also telling it through a list of string params that the Function should respond to GETs and POSTs HTTP requests. You could change any of this at any point.</li>\n</ul>\n<p>There are some other files in the project that we’ll look into later.</p>\n<p>If we build and run the project, a console window opens up and gives us some information about our locally-hosted service:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Application started. Press Ctrl+C to shut down.\n\nHttp Functions:\n\n        Function1: <span class=\"token punctuation\">[</span>GET,POST<span class=\"token punctuation\">]</span> http://localhost:7071/api/Function1</code></pre></div>\n<p>If we enter that URL into a browser (or even make a request to it with <em>curl</em>) without a name parameter, it will ask us to pass a parameter name. If we do so (for instance, by entering <em><a href=\"http://localhost:7071/api/Function1?name=nacho\">http://localhost:7071/api/Function1?name=nacho</a></em>), it will say hello pertinently.</p>\n<p>We can go ahead and make our first changes to this. We should start by naming the function something more specific. For this we can change the [<em>FunctionName()</em>] attribute. I will name it <em>GetPageViewCount</em> (and, to accompany the function name, I’ll rename the function file to this as well). We would also like it to respond only to <strong>POST</strong> requests, so I will remove the <em>GET</em> parameter in the [<em>HttpTrigger()</em>] attribute. Lastly, we can change our code to return just “Hello!” as text for now. This is what it will look like:</p>\n<p><strong><code class=\"language-text\">GetPageViewCount.cs</code></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">FunctionName</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"GetPageViewCount\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">async</span> <span class=\"token return-type class-name\">Task<span class=\"token punctuation\">&lt;</span>IActionResult<span class=\"token punctuation\">></span></span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">HttpTrigger</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span>AuthorizationLevel<span class=\"token punctuation\">.</span>Anonymous<span class=\"token punctuation\">,</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span> Route <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token class-name\">HttpRequest</span> req<span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">ILogger</span> log<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> requestBody <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StreamReader</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ReadToEndAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">dynamic</span></span> data <span class=\"token operator\">=</span> JsonConvert<span class=\"token punctuation\">.</span><span class=\"token function\">DeserializeObject</span><span class=\"token punctuation\">(</span>requestBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>ActionResult<span class=\"token punctuation\">)</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">OkObjectResult</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>If we wanted, we could go ahead and publish our project by doing a right-click on the Project and selecting <strong>Publish</strong>. Here is another thing we need to define about our service: How the pricing will be performed. The easiest way, especially if we are using the free Azure account, is to use a Consumption plan, which will give us <strong>1 million</strong> free requests. There are some disadvantages compared to the other 2 plans (Premium and App Services):</p>\n<ul>\n<li>Premium hosting has nice to have features such as perpetual warm instances (as to avoid cold starts which will make our code start with a bit of latency). However, latency is not something we care about in this case.</li>\n<li>App Service hosting makes our code run on App Service VMs, which makes it optimal if you are using that service already.</li>\n</ul>\n<p>Lastly, when publishing to a consumption plan, it asks us for the following:</p>\n<ul>\n<li>Name: The name of the plan.</li>\n<li>Subscription: After authenticating with your account, your free sub will appear here.</li>\n<li>Resource group: Just a way to group resources in Azure. All resources need to be deployed into one. You will need to create a new one if you didn’t already</li>\n<li>Location: The datacenter in which you want your Function to run.</li>\n<li>Azure Storage: The plan needs to store metadata and for this, they use a storage account. You will need to create one.</li>\n</ul>\n<p>Notice that the last field is an Azure Storage Account. This is convenient for us because as we said, we will be using Storage tables and this saves us the creation of one. Let’s create the Storage Account and proceed with the publishing. A Storage Account name must be unique because it creates public endpoints through which you can access the service (e.g. <em><a href=\"https://your-storage-name.table.core.windows.net\">https://your-storage-name.table.core.windows.net</a></em>). You are charged by the data egress and ingress, so you can create as many as you want.</p>\n<p>You can also access the <a href=\"https://portal.azure.com/\">Azure Portal</a>, log in and see the resource group with the resources you just created!</p>\n<h3 id=\"using-azure-storage\" style=\"position:relative;\">Using Azure Storage<a href=\"#using-azure-storage\" aria-label=\"using azure storage permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Azure Storage encompasses many services such as Blobs, Tables, Queues, Files, etc. In our case, we mentioned we will use Tables because of the easy key-value storage. We can think of a page URL as the key, and the times it was counted as the value that we want to retrieve.</p>\n<p>At this point, we want to install the Azure Storage Tables NuGet package (or the equivalent for the language you want). We are actually going to use the <a href=\"https://docs.microsoft.com/en-us/azure/cosmos-db/tutorial-develop-table-dotnet#install-the-required-nuget-package\">Cosmos DB Tables API</a>, since it includes the API for accessing storage tables.\nLet’s add the reference to it:</p>\n<p><strong><code class=\"language-text\">GetPageViewCount.cs</code></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Azure<span class=\"token punctuation\">.</span>Cosmos<span class=\"token punctuation\">.</span>Table</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Since we already created our account, we can easily access the Tables service through our code. What we need for this is the following:</p>\n<ul>\n<li>The <strong>connection string</strong>: This is an authentication key that you can get <a href=\"https://docs.microsoft.com/en-us/azure/cosmos-db/tutorial-develop-table-dotnet#install-the-required-nuget-package\">from the portal</a>.</li>\n<li>A <strong>Value</strong> (view count) to store and retrieve in the tables through a <strong>Key</strong> (URL).</li>\n<li>Code that connects and access the tables through the API package that we installed.</li>\n</ul>\n<p>Let us review how tables store entities work.</p>\n<h3 id=\"table-entities\" style=\"position:relative;\">Table Entities<a href=\"#table-entities\" aria-label=\"table entities permalink\" class=\"header-anchor after\">#</a></h3>\n<p>The simple way to store entities is to create a class that inherits from <code class=\"language-text\">TableEntity</code>. What this means is that the class will need to have two Properties: A <code class=\"language-text\">PartitionKey</code> and a <code class=\"language-text\">RowKey</code> . Both keys, combined, form the <strong>Key</strong> through which we will <strong>uniquely identify our entity</strong>. However, separated they serve a different purpose:</p>\n<ul>\n<li>\n<p>The <code class=\"language-text\">PartitionKey</code> defines the partition in which the service will store the entity:</p>\n<blockquote>\n<p>Tables are partitioned to support load balancing across storage nodes. A table’s entities are organized by partition. A partition is a consecutive range of entities possessing the same partition key value. The partition key is a unique identifier for the partition within a given table, specified by the PartitionKey property.</p>\n</blockquote>\n</li>\n<li>The <code class=\"language-text\">RowKey</code> is a unique identifier for an entity within a given partition.</li>\n</ul>\n<p>Since the <code class=\"language-text\">PartitionKey</code> is used for load balancing, it’s important that it’s not hardcoded. For this, we can use the URL of the page in which we are counting the views. The <code class=\"language-text\">RowKey</code> can be hardcoded, because we are already changing the key through the use of the URL in the <code class=\"language-text\">PartitionKey</code>. Eventually we could have different <code class=\"language-text\">RowKey</code> for different scenarios, but for now it will stay as a hardcoded value. You can read more <a href=\"https://docs.microsoft.com/en-us/rest/api/storageservices/understanding-the-table-service-data-model\">here</a>.</p>\n<p>After that, the entity can have whichever fields we want. Since we are storing the values, this is how our class will look:</p>\n<p><strong><code class=\"language-text\">GetPageViewCount.cs</code></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">  <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewCount</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">TableEntity</span></span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">public</span> <span class=\"token function\">ViewCount</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> URL<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">//the partition key for load-balancing and identification</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>PartitionKey <span class=\"token operator\">=</span> URL<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// hardcoded for identification</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>RowKey <span class=\"token operator\">=</span> <span class=\"token string\">\"visits\"</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// the value we want to store</span>\n            Count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">int</span></span> Count <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token function\">ViewCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            Count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"changing-our-function-to-connect-to-storage\" style=\"position:relative;\">Changing our function to connect to Storage<a href=\"#changing-our-function-to-connect-to-storage\" aria-label=\"changing our function to connect to storage permalink\" class=\"header-anchor after\">#</a></h3>\n<p>We now have the entity that we want to store and retrieve, so we need to connect to Storage and do precisely that. Table entities are stored in Tables which are identified with a name, so we can choose it and connect to it through a <code class=\"language-text\">CloudTable</code> object. In general, the logic is as follows:</p>\n<ol>\n<li>Connect to the Storage Account through the connection string.</li>\n<li>Create a table client through which we do transactions (inserts, updates, etc.).</li>\n<li>Get the table through its name.</li>\n<li>Execute transactions on the table.</li>\n</ol>\n<p>Here are the first 3 steps in code:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">    <span class=\"token keyword\">const</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> tableName <span class=\"token operator\">=</span> <span class=\"token string\">\"viewcountertable\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> storageAccount <span class=\"token operator\">=</span> CloudStorageAccount<span class=\"token punctuation\">.</span><span class=\"token function\">Parse</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">yourStorageAccountConnectionString</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> tableClient <span class=\"token operator\">=</span> storageAccount<span class=\"token punctuation\">.</span><span class=\"token function\">CreateCloudTableClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">CloudTable</span> table <span class=\"token operator\">=</span> tableClient<span class=\"token punctuation\">.</span><span class=\"token function\">GetTableReference</span><span class=\"token punctuation\">(</span>tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// we can let our code create the table if needed</span>\n    <span class=\"token keyword\">await</span> table<span class=\"token punctuation\">.</span><span class=\"token function\">CreateIfNotExistsAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We can now do transactions to the table! Let’s get the URL parameter from the body first:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> requestBody <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StreamReader</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ReadToEndAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">dynamic</span></span> data <span class=\"token operator\">=</span> JsonConvert<span class=\"token punctuation\">.</span><span class=\"token function\">DeserializeObject</span><span class=\"token punctuation\">(</span>requestBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> pageViewURL <span class=\"token operator\">=</span> data<span class=\"token punctuation\">?.</span>URL<span class=\"token punctuation\">;</span></code></pre></div>\n<p>And now, we can use <code class=\"language-text\">URL</code> to create a <code class=\"language-text\">ViewCount</code> object that uses it as a key. The logic should be easy to follow but here’s a high-level overview:</p>\n<ol>\n<li>Try to retrieve the <code class=\"language-text\">ViewCount</code> object for the URL.</li>\n<li>If it doesn’t exist, create a new <code class=\"language-text\">ViewCount</code> object (with count 0 by default) for that URL.</li>\n<li>Increase the view count on that object by 1.</li>\n<li>Store the updated entity.</li>\n<li>Return the view count to the function caller.</li>\n</ol>\n<p>Here’s what the code looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">    <span class=\"token comment\">// try to retrieve count for the URL</span>\n     <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> retrievedResult <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span><span class=\"token function\">Execute</span><span class=\"token punctuation\">(</span>TableOperation<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Retrieve</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>ViewCount<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>pageViewURL<span class=\"token punctuation\">,</span> <span class=\"token string\">\"visits\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n     <span class=\"token comment\">// wait for the operation and get the result into a ViewCount object</span>\n     <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> pageViewCount <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ViewCount<span class=\"token punctuation\">)</span> retrievedResult<span class=\"token punctuation\">.</span>Result<span class=\"token punctuation\">;</span>\n\n     <span class=\"token comment\">// if the entity didn't exist, create a new one with count 0</span>\n     pageViewCount <span class=\"token operator\">=</span> pageViewCount <span class=\"token operator\">??</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ViewCount</span><span class=\"token punctuation\">(</span>pageViewURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n     <span class=\"token comment\">// augment the view count by one</span>\n     pageViewCount<span class=\"token punctuation\">.</span>Count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\n     <span class=\"token comment\">// insert or replace the entity with the new count</span>\n     table<span class=\"token punctuation\">.</span><span class=\"token function\">Execute</span><span class=\"token punctuation\">(</span>TableOperation<span class=\"token punctuation\">.</span><span class=\"token function\">InsertOrReplace</span><span class=\"token punctuation\">(</span>pageViewCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n     <span class=\"token comment\">// return the view count</span>\n     <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>ActionResult<span class=\"token punctuation\">)</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">OkObjectResult</span><span class=\"token punctuation\">(</span>pageViewCount<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Let’s also make sure we return an error code if we don’t give a “URL” identifier to the function before trying to retrieve an entity:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pageViewURL <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>ActionResult<span class=\"token punctuation\">)</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StatusCodeResult</span><span class=\"token punctuation\">(</span><span class=\"token number\">503</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>The function is now ready! Let’s make sure it works by running it locally and performing POST requests that have a “URL” parameter in the body.</p>\n<h3 id=\"deploying-and-implementation\" style=\"position:relative;\">Deploying and implementation<a href=\"#deploying-and-implementation\" aria-label=\"deploying and implementation permalink\" class=\"header-anchor after\">#</a></h3>\n<p>We are now ready to deploy the Azure Function. Something that you might want to make sure of, is that you do not usually want to keep any connection string in code, so we will be getting it through the <a href=\"https://docs.microsoft.com/en-us/azure/azure-functions/functions-how-to-use-azure-function-app-settings#settings\">App Settings</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">  <span class=\"token comment\">// we will have a StorageConnectionString field in the app settings (local.settings.json files) where we store the storage account connection string</span>\n  <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> storageAccountConnectionString <span class=\"token operator\">=</span> Environment<span class=\"token punctuation\">.</span><span class=\"token function\">GetEnvironmentVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"StorageConnectionString\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The App Settings can be changed in the Azure Portal at runtime.</p>\n<p>Lastly, you can implement this on any page by creating a small script that calls into this function and gets the result. It would look something like this if it were in Javascript:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span>\n  <span class=\"token string\">\"https://pageviewcounterblog.azurewebsites.net/api/GetViewCounter/\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">URL</span><span class=\"token operator\">:</span> <span class=\"token string\">\"this-blog-post-URL\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  method<span class=\"token operator\">:</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n  body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Success:\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Notice that this way, anyone that has access to the function endpoint can call into it. Securing the function goes beyond the scope of this post, especially because this is called in the frontend (whereas you would likely prefer to call this from the backend to authenticate properly and easily). However, something you can do pretty simply is to <a href=\"https://www.c-sharpcorner.com/article/handling-cors-in-azure-function/\">add CORS policies</a> to the function in order to have it be a little more restrictive.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Right now you should have a working Azure Function that connects to Azure Storage Table and stores the amount of times that a certain page was visited. And this was all for free (except if you exceed the million requests per month, but you can probably handle paying at that point)!</p>\n<p>This was meant to be a simple experiment that served as a good introduction to some Azure services, and to certain concepts related to computing in general. Plus, it shows a simple way in which you could extend your static sites through serverless computing.</p>\n<p>Feel free to review the code here: <a href=\"https://github.com/IgnacioAmigo/PageViewCounterBlog\">https://github.com/IgnacioAmigo/PageViewCounterBlog</a>.</p>","excerpt":"Introduction Since we are using Gatsby to build this site as a set of static files, there are some common functionalities that you might…","fields":{"slug":"/page-view-counter/","readingTime":{"text":"15 min read"}},"frontmatter":{"title":"Using Azure Functions to create a page view counter","date":"December 26, 2019","description":"We can extend static sites by creating a simple page view counter that is processed in a serverless manner, and for free. Microsoft Azure provides Functions as a flagship service to do this. Let's explore building it on Visual Studio.","tags":["azure functions","storage",".NET","cloud","serverless"],"author":{"id":"nacho","bio":"Software Engineer with a passion on system and software architecture. Other loves include music and video games (and their development).","twitter":"ignacioamigo","github":"https://github.com/IgnacioAmigo","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAB2HAAAdhwGP5fFlAAAEaklEQVQ4yw3SaVMTBxgH8P0UdahHmc50xmq1QMImm2vZzbnZK7vZIyQQQsJhGsCghDOEBDVRK6MiIHKJWpyhqKjFtoCEIyFcSUACxenY9qt0Z34vnplnnnn+L/6AQ6REkXH7AnzgDh5eM/Ufm6KHht4c2p1BOtO6jrS2PaUJravb1qHrq8prqwpJaxJsXZEAbjcn8oTXzdS6cGd1FR+I052vyL4kligY48eGWFYf3UH7tpHINtyb0YUz2vCmtietkXSngVisqz10NdYfbm6pdwqWKtHsFK2CaBcau11tQ/TdHDZwgt3OWRI5U3zPeGvPEM9Kg8RwKwtEY22xWKg30tHTHaQoBCf17mrmqr+m1oFV2uCqhmbuzhr9+D965F9q+B/bo8/Mg0PswQl2/zN+/xhgBY2rxsLYkTof53JROIkGfqqZnhoeHRmI9Fz1VJE8h/lvTbjj886uscbuh5HbQ5Hh18HpvGviCyA61d56xtfI6dCLFhxiGLQj5L8Rax8fG5yaehzuaYuGryWirb1dIQhhzLj4dHz0/dzztYWXd9+fADZWWe0xxhM9NxNdtXWMGVM11Itej4226nwCcSMS6o92BIMN9+5ESd5jZTzzr2aWfp9f/TA793EXIGkVxYAOl669o/Hh4M/hSKvoMDA84jCp9sbi9/tbEzc7g02+0LW6poC3qSWYXHy/sfxu6be57OYSgBEKKwmyAsTYy/wBbnBwoNbH6i2l5ReKE17RyZtbWyq9Hq7SQfq8HMdhv85MnhzuLC68OsqnAWelmWKkS6VdUNsFRUMj5fd71Vr1uTNFdjNy/vwFRK9geY2dMzMsSrOw6MCGHt1+Mzfz99EuUF/HW6xlUnKaVQiCyskrS0pL1GoYRfUmo1kBQiYTSjEqKZ3BDJI0TLOIldR6fY6HDxKAz8swNi3LKlkeImxyzFz+1amir8+clstBCFKXg0olWCZwsAUvtzEaAlcLTIWDw6RGCA4K4HiVIOpYWsPaIbsAgsrLJaUXi78tlslBpEKPYSZZ2SU7DTO0giCUOAFZLQqOgHkSFWx6AKdkHAe6pVbyMMPJIa28AlWfKz5broC0OgTRqSkC51ikkoIqKS1mKTdZZEZTiRa+XAH/CFBMGUHIBFov0EoML6VpWKODcYIkadpTW3u9rcNTJdotMt4oZw1lJFpiRS4RllLMClagMuDtu9ln02PTk6OjI/dcnmo5pEKM5tfz75aWl1/8MrOysvHi2eT1QHVfV1NfZ1PwirO5wem/4hIFc3NLDbB/sJfL7+b3c8d/FT4VPmE0+92FH968/fBk7InRrH80/KRQOMrntySFw+xmOnmwv51Krbx8+XR29gVwcJD/c/GPZPJjZmtzcmr84qXvT589fffewMTk+DfFp3ojkVwut7+/lU6t7O6kMpm1QiGXzW5++XJU2E8BmUxydXVxZ3tD2nE8W3SmqKbGEY12jYyO8iKfSCTW1j/u7qWknxsbK2vry1tb6wsLb7J7qZnnQ/8DVjLu7TBBpHoAAAAASUVORK5CYII=","aspectRatio":1.0582010582010581,"src":"/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/ee604/nacho-profile.png","srcSet":"/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/69585/nacho-profile.png 200w,\n/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/497c6/nacho-profile.png 400w,\n/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/ee604/nacho-profile.png 800w,\n/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/f3583/nacho-profile.png 1200w,\n/static/bc6d8411c8c9d3487dd85b3e4e1d3db4/756c3/nacho-profile.png 1396w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}}},{"node":{"html":"<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p>In this post we are going to examine how we created this, the <a href=\"https://nosleepjavascript.com\">nosleepjavascript.com</a>, blog\n(the one that you are currently reading) with Javascript and React, Gatsby as the core framework,\nGitHub Pages as a hosting solution and GitHub Actions to automatically deploy when pushing to a particular branch,\nwhich is a rudimentary CD or Continuous Delivery Solution.</p>\n<h2 id=\"prerequisites\" style=\"position:relative;\">Prerequisites<a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li><a href=\"https://nodejs.org/en/\">NodeJs</a> 12 (Erbium) or higher</li>\n<li>a text editor like <a href=\"https://www.vim.org/\">Vim</a> or an IDE like <a href=\"https://code.visualstudio.com/\">Visual Studio Code</a></li>\n</ul>\n<h2 id=\"bootstrapping-a-site-with-gatsby\" style=\"position:relative;\">Bootstrapping a site with Gatsby<a href=\"#bootstrapping-a-site-with-gatsby\" aria-label=\"bootstrapping a site with gatsby permalink\" class=\"header-anchor after\">#</a></h2>\n<h3 id=\"what-is-gatsby\" style=\"position:relative;\">What is Gatsby?<a href=\"#what-is-gatsby\" aria-label=\"what is gatsby permalink\" class=\"header-anchor after\">#</a></h3>\n<p>According to their <a href=\"https://www.gatsbyjs.org/\">website</a>:</p>\n<blockquote>\n<p>Gatsby is a free and open source framework based on React that helps developers build blazing fast websites and apps</p>\n</blockquote>\n<p>We wanted to do a simple Tech Blog without any fancy stuff and Blogs naturally\nare pretty much static sites (i.e. they only need a backend that serves js, css, images and html static files),\nso we looked for a static site generator.</p>\n<p>I had good experiences with <a href=\"https://jekyllrb.com/\">Jekyll</a> in the past,\nso it was the first option we considered but we wanted to inspect the\necosystem and see whether there were some other options available.</p>\n<p>Enter Gatsby: we have been hearing very good things about Gatsby.js so\nwe wanted to explore it.</p>\n<p>I usually check a couple of important aspects of open source software before\neven beginning exploring it and Gatsby checked all the boxes:</p>\n<ul>\n<li>excellent documentation</li>\n<li>active community</li>\n<li>wide solutions to common problems (starters, plugins, posts, etc)</li>\n<li>it is a very active project</li>\n</ul>\n<p>We performed some initial spikes and compared the time it took\nto create a somewhat complete Blog with Gatsby and Jekyll and both\ntook us about the same time: 15 minutes.</p>\n<p>A <em>complete</em> Blog in this context included the following capabilities:</p>\n<ul>\n<li>write posts in markdown</li>\n<li>out of the box Google Analytics integration</li>\n<li>out of the box SEO good practices (metas, titles, etc)</li>\n</ul>\n<p>We finally settled in favor of Gatsby because</p>\n<ul>\n<li>it uses modern and familiar technology: Javascript, React, GraphQL, etc</li>\n<li>the plugin and theme API is much better than Jekyll’s</li>\n<li>it seemed very powerful and we wanted to explore more of it in the future</li>\n</ul>\n<h3 id=\"why-gatsby\" style=\"position:relative;\">Why Gatsby?<a href=\"#why-gatsby\" aria-label=\"why gatsby permalink\" class=\"header-anchor after\">#</a></h3>\n<p>The things that we liked to most about Gatsby are</p>\n<ul>\n<li><strong>themes API</strong>: it is hierarchical and allows composition and easily switching in and out of different themes, contrary to Jekyll, that heavily couples the theme with the initial files skeleton and switching between themes is not at all trivial.</li>\n<li><strong>flexibility</strong>: one of things that amazed us and that we are currently exploring (you will probably hear more about this in future blog posts) is that Gatsby is not only for static websites, it is pretty flexible and you can even create full fledged apps with it (without runtime server side rendering and some other considerations).</li>\n<li><strong>development tools</strong>: the whole development workflow is very nicely polished and the GraphiQL explorer of the entire site’s data is a very nice quality of life improvement for developers.</li>\n</ul>\n<h2 id=\"install-gatsby\" style=\"position:relative;\">Install Gatsby<a href=\"#install-gatsby\" aria-label=\"install gatsby permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We used a Gatsby <em>starter</em> called <a href=\"https://www.gatsbyjs.org/starters/gatsbyjs/gatsby-starter-blog/\">gatsby-starter-blog</a>\nbut you might be interested in other starters that are <a href=\"https://www.gatsbyjs.org/starters/?v=2\">provided by the community</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Install Gatsby cli</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g gatsby-cli\n\n<span class=\"token comment\"># Create a new gatsby site using the starter-blog starter</span>\ngatsby new my-blog https://github.com/gatsbyjs/gatsby-starter-blog</code></pre></div>\n<p>Check the output to see how to run the app but at this point you have a working blog.</p>\n<p>These are the most relevant files:</p>\n<ul>\n<li><code class=\"language-text\">gatsby-config.js</code> to edit data about your site such as author, description, titles, etc</li>\n<li><code class=\"language-text\">gatsby-config.js</code> to add your Google Analytics ID</li>\n<li><code class=\"language-text\">content/name-of-the-post/index.md</code> to see how to write posts in Markdown</li>\n<li>add <code class=\"language-text\">import \"prismjs/themes/prism-tomorrow.css\"</code> to <code class=\"language-text\">gatsby-browser.js</code> to enable <strong>syntax highlighting</strong> of code blocks. This starter uses <a href=\"https://prismjs.com/\">prism.js</a> but it does not add the css theme by default. Check prism.js documentation to see other themes available.</li>\n</ul>\n<p>And you are done! Told you! It is super fast and easy.</p>\n<p>Useful links</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/docs/quick-start/\">https://www.gatsbyjs.org/docs/quick-start/</a></li>\n</ul>\n<h2 id=\"host-your-site-in-github-pages\" style=\"position:relative;\">Host your site in <a href=\"https://pages.github.com/\">GitHub Pages</a><a href=\"#host-your-site-in-github-pages\" aria-label=\"host your site in github pages permalink\" class=\"header-anchor after\">#</a></h2>\n<p>GitHub pages is a static page hosting solution, if you are a software developer\nthis hosting solution is pretty near to our daily roaming places so that is why we chose it.</p>\n<p>There are tons of alternatives but if you already host your page’s code in GitHub\nthen this will be pretty easy to setup.</p>\n<p>Follow the instructions on <a href=\"https://pages.github.com/\">the website</a> to enable GitHub pages.</p>\n<p>These are the extra steps we took for this blog.</p>\n<h3 id=\"1-make-code-classlanguage-textdevelopcode-your-default-branch-only-for-project-site\" style=\"position:relative;\">1 make <code class=\"language-text\">develop</code> your default branch (only for <em>project site</em>)<a href=\"#1-make-code-classlanguage-textdevelopcode-your-default-branch-only-for-project-site\" aria-label=\"1 make code classlanguage textdevelopcode your default branch only for project site permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Since this blog qualifies as a <em>project site</em> (per repo) instead of a <em>user or organization site</em>\nwe need to have the following repo branch configuration:</p>\n<ul>\n<li><code class=\"language-text\">develop</code>: where our Gatsby code lives</li>\n<li><code class=\"language-text\">master</code>: where our Gatsby-generated static files for our website are stored</li>\n</ul>\n<p>These generated static files will be the ones that GitHub pages will deploy and show.</p>\n<p>Keep in mind that you will be managing two code bases, one is your Gatsby site, the code that you will\nbe interacting with as a developer and then we have the generated static site code that will be the one\nthat we serve.\nThink of these two code bases as the source code and the compiled target code in traditional\ncompiled programming languages such as C/C++ or Rust.</p>\n<h3 id=\"2-adjust-the-code-classlanguage-textpackagejsoncode-deploy-script\" style=\"position:relative;\">2 Adjust the <code class=\"language-text\">package.json</code> deploy script<a href=\"#2-adjust-the-code-classlanguage-textpackagejsoncode-deploy-script\" aria-label=\"2 adjust the code classlanguage textpackagejsoncode deploy script permalink\" class=\"header-anchor after\">#</a></h3>\n<p>It should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby build --prefix-paths &amp;&amp; gh-pages -d public -b master\"</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">--prefix-paths</code> is only useful if you are going to use the default GitHub domain: <code class=\"language-text\">username.github.io/reponame</code>. Remove it if you are making your site accessible from some <code class=\"language-text\">domain.com</code></li>\n<li><code class=\"language-text\">gh-pages</code> is a helper node package that you need to install: <code class=\"language-text\">npm install --dev gh-pages</code></li>\n<li><code class=\"language-text\">-b master</code> specifies to <code class=\"language-text\">gh-pages</code> package that you want to deploy to the <code class=\"language-text\">master</code> branch</li>\n</ul>\n<h3 id=\"3-adjust-your-code-classlanguage-textpathprefixcode\" style=\"position:relative;\">3 Adjust your <code class=\"language-text\">pathPrefix</code><a href=\"#3-adjust-your-code-classlanguage-textpathprefixcode\" aria-label=\"3 adjust your code classlanguage textpathprefixcode permalink\" class=\"header-anchor after\">#</a></h3>\n<p>IMPORTANT! Only do this if you are using the default GitHub domain. If you are using a custom domain,\nlike <code class=\"language-text\">myblog.com</code> you should probably leave it unset, or if you want your blog to live in a custom path\nof your custom domain like <code class=\"language-text\">myblog.com/custompath</code> then adjust accordingly.</p>\n<p>Go to <code class=\"language-text\">gatsby-config.js</code> and set the top level property</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">pathPrefix<span class=\"token operator\">:</span> reponame<span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"4-deploy\" style=\"position:relative;\">4 deploy!<a href=\"#4-deploy\" aria-label=\"4 deploy permalink\" class=\"header-anchor after\">#</a></h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># make sure you commit and push your changes to develop</span>\n<span class=\"token function\">git</span> commit <span class=\"token punctuation\">..</span>.\n<span class=\"token function\">git</span> push origin develop\n\n<span class=\"token comment\"># deploy!</span>\n<span class=\"token function\">npm</span> run deploy</code></pre></div>\n<p>Now if you go to <code class=\"language-text\">username.github.io/reponame</code> you should be able to navigate your site!</p>\n<p>Congratulations! Your site is live!</p>\n<h2 id=\"optional-buy-a-domain-and-use-it\" style=\"position:relative;\">[optional] Buy a domain and use it<a href=\"#optional-buy-a-domain-and-use-it\" aria-label=\"optional buy a domain and use it permalink\" class=\"header-anchor after\">#</a></h2>\n<p>We used <code class=\"language-text\">GoDaddy</code> but we have no affiliations with them and there are plenty of\ndomain name providers. Choose the right one for you, buy your domain and then adjust DNS accordingly.</p>\n<h3 id=\"1-setup-your-dns\" style=\"position:relative;\">1 Setup your DNS<a href=\"#1-setup-your-dns\" aria-label=\"1 setup your dns permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Most of the domain providers will let you set up the DNS records for your site. We are going to use\nthat to redirect to your GitHub page, set up the following records in your DNS managing tool.</p>\n<p>Read the official <a href=\"https://help.github.com/en/github/working-with-github-pages/about-custom-domains-and-github-pages\">instructions</a>.</p>\n<p>But here is the gist:</p>\n<ul>\n<li><strong>for apex domain</strong>: create an 4 <code class=\"language-text\">A</code> records, each with one of these IPs</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token number\">185.199</span>.108.153\n<span class=\"token number\">185.199</span>.109.153\n<span class=\"token number\">185.199</span>.110.153\n<span class=\"token number\">185.199</span>.111.153</code></pre></div>\n<ul>\n<li><strong>for <code class=\"language-text\">www.</code></strong>: create a <code class=\"language-text\">CNAME</code> record with a key of <code class=\"language-text\">www</code> and a value of <code class=\"language-text\">username.github.io</code></li>\n</ul>\n<p>You may have both without a problem.</p>\n<h3 id=\"2-setup-you-cname-in-github\" style=\"position:relative;\">2 Setup you CNAME in GitHub<a href=\"#2-setup-you-cname-in-github\" aria-label=\"2 setup you cname in github permalink\" class=\"header-anchor after\">#</a></h3>\n<p>If you are using <code class=\"language-text\">npm run deploy</code> to deploy you app then go to your repo’s settings,\nscroll to the bottom and add the custom domain in the <strong>Custom Domain</strong> input.\nYou should add your naked or apex domain, without the <code class=\"language-text\">www</code>.</p>\n<p>If you are using GitHub actions (more on this later) then you need to add\nthis exact file to your source code in the <code class=\"language-text\">develop</code> branch,\nit should be named exactly <code class=\"language-text\">CNAME</code> and it should contain your domain as the only line of text.</p>\n<p>CNAME</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">myblog.com</code></pre></div>\n<p>Depending on your domain provider these changes in the DNS records might take\nfrom a couple of minutes to a couple of days (in our case it was pretty fast with GoDaddy).</p>\n<p>Checkout the <code class=\"language-text\">dig</code> linux/unix command to diagnose DNS updates (probably will do a blog post about this)</p>\n<h2 id=\"deploy-automatically-with-github-actions-cd\" style=\"position:relative;\">Deploy automatically with GitHub Actions (CD)<a href=\"#deploy-automatically-with-github-actions-cd\" aria-label=\"deploy automatically with github actions cd permalink\" class=\"header-anchor after\">#</a></h2>\n<p><a href=\"https://help.github.com/en/actions/automating-your-workflow-with-github-actions\">GitHub Actions</a> is an automation\nservice provided by GitHub with free tiers and quick access if you host your code in GitHub.\nYou may use other automation tools for this but the steps will definitely vary greatly.</p>\n<p>A bit of a glossary:</p>\n<ul>\n<li>actions: a list of steps to perform a reusable task, it accepts parameters (yes, the service is called “GitHub actions” and one of the unit of abstractions inside the service are also called “actions”).</li>\n<li>Workflow: an automation that will executed by GitHub when some event that you define happens (i.e. push to a branch). It will run a number of steps that might be actions or simple bash commands</li>\n</ul>\n<h3 id=\"1-create-a-workflow\" style=\"position:relative;\">1 Create a Workflow<a href=\"#1-create-a-workflow\" aria-label=\"1 create a workflow permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Create the Workflow file in your <code class=\"language-text\">develop</code> branch at <code class=\"language-text\">.github/workflows/deploy.yml</code>\nYou can call it whatever you like as long as it is inside that directory.</p>\n<p>Add this to the file contents</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Gatsby Publish\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> develop\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> enriikke/gatsby<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages<span class=\"token punctuation\">-</span>action@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">access-token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">deploy-branch</span><span class=\"token punctuation\">:</span> master</code></pre></div>\n<p>You may create this via the GitHub actions UI in your repo’s GitHub page.</p>\n<p>Notice we are using two actions, one is a standard action provided\nby GitHub to download the repo’s code in the\nautomation runner (think of it as a virtual machine) and\nthe other one <a href=\"https://github.com/enriikke/gatsby-gh-pages-action\"><code class=\"language-text\">gatsby-gh-pages</code></a> is a third party provided one.</p>\n<p>I inspected the code of the latter and it seemed OK but I always recommend checking third party\ncode before using it to avoid any potential security attacks.\nIn this case it is even more important because this action will have\naccess to an <code class=\"language-text\">ACCESS_TOKEN</code> that we will be creating in the next step\nand that gives the script access to push to your repo.</p>\n<p>TLDR: be careful to whom you give this sort of permissions to.</p>\n<p>Please note that if you are doing this step you must have added the CNAME file to your source\nas explained in the section above.</p>\n<h3 id=\"2-set-up-an-access-token\" style=\"position:relative;\">2 Set up an access token<a href=\"#2-set-up-an-access-token\" aria-label=\"2 set up an access token permalink\" class=\"header-anchor after\">#</a></h3>\n<p>You may have noticed this line in your Workflow:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">access-token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is telling GitHub actions to read a variable called <code class=\"language-text\">ACCESS_TOKEN</code> from your repo’s secrets\nand pass it as a parameter named <code class=\"language-text\">access-token</code> to the <code class=\"language-text\">enriikke/gatsby-gh-pages-action@v2</code> action.</p>\n<p>This will give the action permissions to push to your master branch to deploy your code.</p>\n<p>Follow the following instructions to set up your token. Please note that the name\nis important so be sure to name it <code class=\"language-text\">ACCESS_TOKEN</code> or if you want a different\nname make sure you change the name you use in your Workflow. This is just a variable,\nso treat it like so.</p>\n<ul>\n<li><a href=\"https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line\">create a token</a></li>\n<li><a href=\"https://help.github.com/en/actions/automating-your-workflow-with-github-actions/creating-and-using-encrypted-secrets#creating-encrypted-secrets\">use it in your Workflow</a></li>\n</ul>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>At this point you will have a proper Gatsby blog deployed to the cloud.</p>\n<p>Lets put a list of things you probably want to take care before you really\nconsider this blog production-ready.</p>\n<ul>\n<li>setup google analytics id to analyse traffic</li>\n<li>setup HTTPS for free via settings in your GitHub repo</li>\n<li>register your site in <a href=\"https://stackoverflow.com/questions/49073043/get-github-pages-site-found-in-google-search-results\">google search console</a> to improve SEO</li>\n<li>add proper meta data to improve your SEO</li>\n<li>generate real content to improve SEO</li>\n<li>start writing posts!</li>\n</ul>","excerpt":"Introduction In this post we are going to examine how we created this, the nosleepjavascript.com, blog\n(the one that you are currently…","fields":{"slug":"/gatsby-blog/","readingTime":{"text":"10 min read"}},"frontmatter":{"title":"Create a blog with Gatsby.js","date":"December 23, 2019","description":"In this post we are going to cover the steps we took to create the nosleepjavascript.com blog in simple, easy, steps using the latest front end technologies: Gatsby.js (JAMstack), NodeJs, React, GraphQL, Javascript, GitHub Pages and GitHub Actions","tags":["gatsbyjs","javascript","react"],"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}}]},"allAuthorYaml":{"nodes":[{"bio":"Software Engineer with a passion on system and software architecture. Other loves include music and video games (and their development).","id":"nacho","twitter":"ignacioamigo","github":"https://github.com/IgnacioAmigo"},{"bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","id":"franleplant","twitter":"franleplant","github":"https://github.com/franleplant"}]}},"pageContext":{}},"staticQueryHashes":["1000388668","1219926595","914163225"]}