{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/react-performance/","result":{"data":{"site":{"siteMetadata":{"title":"NoSleep Javascript Blog"}},"markdownRemark":{"id":"5f1ba60a-4b2f-5813-ae19-f3ad94f001e3","excerpt":"TLDR: the gist Measure performance! If you don‚Äôt measure it‚Äôs the same as doing nothing. You can optimize your React performance by improving what (ü§î) and‚Ä¶","html":"<h2 id=\"tldr-the-gist\" style=\"position:relative;\">TLDR: the gist<a href=\"#tldr-the-gist\" aria-label=\"tldr the gist permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>Measure performance! If you don‚Äôt measure it‚Äôs the same as doing nothing.</li>\n<li>You can optimize your React performance by improving <strong>what</strong> (ü§î) and <strong>which</strong> (üßô) components render.</li>\n<li>\n<p>üßô To improve <strong>which</strong> component renders you can use</p>\n<ul>\n<li><code class=\"language-text\">React.memo</code></li>\n<li><code class=\"language-text\">useCallback</code></li>\n<li><code class=\"language-text\">useMemo</code></li>\n<li>Make sure your props have stable references</li>\n<li>Virtualization</li>\n</ul>\n</li>\n<li>\n<p>ü§î To improve <strong>what</strong> components render you should</p>\n<ul>\n<li>identify the slow components</li>\n<li>simplify, use more efficient abstractions, make smaller trees, etc</li>\n</ul>\n</li>\n</ul>\n<p>If this got your attention read on:</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\">Table of Contents<a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#tldr-the-gist\">TLDR: the gist</a></li>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li>\n<p><a href=\"#io-performance-problems-in-react\">io performance problems in React</a></p>\n<ul>\n<li><a href=\"#potential-solutions\">Potential solutions</a></li>\n</ul>\n</li>\n<li><a href=\"#cpu-performance-problems-in-react\">CPU performance problems in React</a></li>\n<li><a href=\"#react-render-and-commit-phase\">React render and commit phase</a></li>\n<li>\n<p><a href=\"#measuring\">Measuring</a></p>\n<ul>\n<li><a href=\"#chrome-dev-tools-performance-tab\">Chrome dev tool‚Äôs Performance tab</a></li>\n<li><a href=\"#react-dev-tools-performance-tab\">React dev tool‚Äôs Performance tab</a></li>\n<li><a href=\"#measuring-1\">Measuring</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#general-solutions-to-cpu-bound-problems-in-react-applications\">General solutions to cpu-bound problems in React applications</a></p>\n<ul>\n<li><a href=\"#-improving-what-components-render\">ü§î Improving <em>what</em> components render</a></li>\n<li>\n<p><a href=\"#%F0%9F%A7%99-improving-which-components-render\">üßô Improving <em>which</em> components render</a></p>\n<ul>\n<li><a href=\"#virtualization\">Virtualization</a></li>\n<li>\n<p><a href=\"#props-optimization\">Props Optimization</a></p>\n<ul>\n<li><a href=\"#reactmemo\"><code class=\"language-text\">React.memo</code></a></li>\n<li><a href=\"#fake-prop-changes-usecallback\">Fake prop changes: <code class=\"language-text\">useCallback</code></a></li>\n<li><a href=\"#fake-prop-changes-usememo\">Fake prop changes: <code class=\"language-text\">useMemo</code></a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#summary\">Summary</a></p>\n<ul>\n<li><a href=\"#props-changed\">Props changed</a></li>\n<li><a href=\"#parent-rendered\">Parent rendered</a></li>\n<li><a href=\"#hooks-changed-state-context\">Hooks changed (state, context)</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#closing\">Closing</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"header-anchor after\">#</a></h2>\n<p>In general computer programs can be:</p>\n<ul>\n<li><strong>io-bound</strong>: spend most of their time making inputs and outputs</li>\n<li><strong>cpu-bound</strong>: spend most of their time making calculations</li>\n</ul>\n<p>And how do these translate into Front End apps and in particular React apps?</p>\n<h2 id=\"io-performance-problems-in-react\" style=\"position:relative;\">io performance problems in React<a href=\"#io-performance-problems-in-react\" aria-label=\"io performance problems in react permalink\" class=\"header-anchor after\">#</a></h2>\n<ul>\n<li>Browser apps can be <strong>io-bounded</strong> mostly in terms of asynchronous http calls.</li>\n<li>a poor management of these network requests can slow down your app</li>\n</ul>\n<h3 id=\"potential-solutions\" style=\"position:relative;\">Potential solutions<a href=\"#potential-solutions\" aria-label=\"potential solutions permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Although this will not be the focus of this post let‚Äôs quickly cover some\nimportant areas where solutions and improvements might be found for io-bound\nproblems:</p>\n<ul>\n<li>lazy load as much as you can.</li>\n<li>careful with the initial load of assets and also backend requests.</li>\n<li>reduce the amount of times you load highly static stuff (select options, configurations, etc)</li>\n<li>debounce the amount of times you make certain requests.</li>\n<li>parallelize request as much as possible via <code class=\"language-text\">Promise.all</code>.</li>\n<li>make your critical BE endpoints more efficient (i.e. by tweaking DB accesses and such).</li>\n</ul>\n<h2 id=\"cpu-performance-problems-in-react\" style=\"position:relative;\">CPU performance problems in React<a href=\"#cpu-performance-problems-in-react\" aria-label=\"cpu performance problems in react permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>This is going to be the main focus of this post.</p>\n</blockquote>\n<p>Before talking about performance we need to define it in a more concrete way:</p>\n<ul>\n<li>browser apps are <a href=\"https://stackoverflow.com/questions/30932870/why-doesnt-javascript-get-its-own-thread-in-common-browsers\">single thread</a> programs for the most part.</li>\n<li>scripting, i.e. Javascript, DOM rendering, event handling, etc; all run in the same thread.</li>\n<li>if a Javascript module is slow it can block the main thread.</li>\n<li>if the main thread is blocked then the UI will seem unresponsive (<strong>fps</strong> will drop).</li>\n<li>unresponsive UIs are one of the worst offenders in terms of <strong>User Experience</strong>.</li>\n</ul>\n<p>This all boils down to the concept of <code class=\"language-text\">fps</code> or <strong>Frames Per Second</strong>.\nResponsive UIs will deliver a minimum of 30 fps or more ideally 60 fps, this means\nthat every frame of your app, even the more demanding code paths, should compute in <strong>30 ms or less</strong>.</p>\n<blockquote>\n<p>If your Javascript is slow it might cause ‚Äúframes to be dropped‚Äù which means\ncomputing a frame in more than 30 ms.</p>\n</blockquote>\n<p>To fully understand how this applies to React we need to understand how React works\nand what React‚Äôs <strong>render and commit phase</strong> are but in short we can say that:</p>\n<blockquote>\n<p>If a React component update is triggered then the <strong>entire sub tree needs to be\nrendered in less than 30ms</strong>.</p>\n</blockquote>\n<p>This becomes specially problematic when you have complex and long component structures\nsuch as Tables, Trees and Lists and in which sometimes (for example the first time) you will\nneed to re render large parts of them.</p>\n<blockquote>\n<p><strong>Summary:</strong> we should figure out which expensive interactions are dropping frames,\nmeasure them to confirm and fix them.</p>\n</blockquote>\n<h2 id=\"react-render-and-commit-phase\" style=\"position:relative;\">React render and commit phase<a href=\"#react-render-and-commit-phase\" aria-label=\"react render and commit phase permalink\" class=\"header-anchor after\">#</a></h2>\n<p>React works (at a high level) in two phases</p>\n<p><strong>Render phase:</strong></p>\n<ul>\n<li>Happens when a component updates i.e. props or hooks changed.</li>\n<li>React traverses the component sub tree rendering each child and computing the virtual DOM (VDOM) sub tree.</li>\n<li>Only the ‚Äúdirty‚Äù sub tree needs to be recomputed i.e. the updated component parents might not need to be re rendered.</li>\n<li>This phase is proportional to the size of the sub tree being rendered.</li>\n<li>This phase is also proportional to how expensive it is to compute each child component.</li>\n<li>We can give React hints to make this process more efficient i.e. <code class=\"language-text\">React.memo</code>.</li>\n</ul>\n<p><strong>Commit phase:</strong></p>\n<ul>\n<li>The render phase outputs a new virtual DOM of the entire UI.</li>\n<li>In the commit phase Reacts compares the new tree with the previous one (VDOM diffing).</li>\n<li>React calculates the minimum DOM mutations needed to reflect the new VDOM tree.</li>\n<li>React mutates the DOM.</li>\n<li>Your UI is now updated.</li>\n<li>This phase is pretty efficient by default.</li>\n</ul>\n<p>This whole process needs to happen in less than 30 or 16 ms (30 fps and 60 fps respectively) for your UI to be considered\nresponsive, as you can see there‚Äôs a lot of work and that work is proportional to the size of your app.</p>\n<p>We will explore ways to make mostly the <strong>Render phase</strong> more efficient but first let‚Äôs discuss\nhow to measure and how to find out what are the slow parts of our app and how bad they are.</p>\n<h2 id=\"measuring\" style=\"position:relative;\">Measuring<a href=\"#measuring\" aria-label=\"measuring permalink\" class=\"header-anchor after\">#</a></h2>\n<p>In 2020 we have pretty solid tools for measuring browser side performance, these\nare the ones I use the most:</p>\n<ul>\n<li>Chrome dev tool‚Äôs Performance tab.</li>\n<li>React dev tool‚Äôs Performance tab.</li>\n</ul>\n<h3 id=\"chrome-dev-tools-performance-tab\" style=\"position:relative;\">Chrome dev tool‚Äôs Performance tab<a href=\"#chrome-dev-tools-performance-tab\" aria-label=\"chrome dev tools performance tab permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This is the most comprehensive tool, it is useful for any browser application,\nit measures frames per second, records stack traces, identifies slow / hot parts of your code,\nand much more. The main UI is the <a href=\"http://www.brendangregg.com/flamegraphs.html\">flame chart</a>.</p>\n<p>Here‚Äôs a <a href=\"https://reactjs.org/docs/optimizing-performance.html#profiling-components-with-the-chrome-performance-tab\">good doc</a>\nof Chrome‚Äôs Performance Tab applied to React.</p>\n<h3 id=\"react-dev-tools-performance-tab\" style=\"position:relative;\">React dev tool‚Äôs Performance tab<a href=\"#react-dev-tools-performance-tab\" aria-label=\"react dev tools performance tab permalink\" class=\"header-anchor after\">#</a></h3>\n<p>You need to install the <a href=\"https://reactjs.org/blog/2019/08/15/new-react-devtools.html\">React dev tool extension</a> in your browser.</p>\n<p>It specializes the information in the Chrome dev tool‚Äôs Performance tab to\nReact. You can see the different <strong>commit phases</strong> and the Javascript code that was run in its respective\n<strong>render phase</strong> through a <strong>flame chart</strong>.</p>\n<p>Through this tool you can easily find out:</p>\n<ul>\n<li>when a component re renders</li>\n<li>what props changed</li>\n<li>what hooks changed i.e. state, context, etc.</li>\n</ul>\n<p>Check the <a href=\"https://reactjs.org/blog/2018/09/10/introducing-the-react-profiler.html\">introductory post</a> for more information.</p>\n<h3 id=\"measuring-1\" style=\"position:relative;\">Measuring<a href=\"#measuring-1\" aria-label=\"measuring 1 permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This is the <strong>methodology</strong> I like to use when measuring front end applications:</p>\n<ul>\n<li><strong>identify the problem</strong>: identify page interactions that make the UI feel unresponsive.</li>\n<li><strong>create a hypothesis</strong>: optionally, we might have some ideas where the problem might be.</li>\n<li><strong>measure</strong>: verify the problem by measuring and looking at important metrics such as <strong>fps</strong>.</li>\n<li><strong>measure</strong>: identify problematic pieces of code, optionally: validate your hypothesis.</li>\n<li><strong>create a solution</strong>: apply a solution based off the previous steps</li>\n<li><strong>measure the solution</strong>: validate that the problem has been resolved or alleviated by looking at the important metrics.</li>\n</ul>\n<blockquote>\n<p>If you optimize something without measuring then you are practically doing nothing.</p>\n</blockquote>\n<p>There might be cases where the problem is super obvious and I won‚Äôt tell you that going straight\nto fixing it is naturally bad, but most of the problems are not obvious and measuring will be\ncornerstone of the performance improvement process.</p>\n<p>Additionally, if you measure you can later tell your users, stakeholders and more importantly your <strong>boss\nthat you have improved the performance of a given area of your app by x%</strong> which is always a good\nway of communicating upwards what we accomplish inside the rabbit hole.</p>\n<h2 id=\"general-solutions-to-cpu-bound-problems-in-react-applications\" style=\"position:relative;\">General solutions to cpu-bound problems in React applications<a href=\"#general-solutions-to-cpu-bound-problems-in-react-applications\" aria-label=\"general solutions to cpu bound problems in react applications permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Now that we have measured and identified the problematic areas let‚Äôs cover\npotential solutions.</p>\n<blockquote>\n<p>You can optimize your React performance by\nimproving <strong>what</strong> components render and\n<strong>which</strong> components render.</p>\n</blockquote>\n<h3 id=\"-improving-what-components-render\" style=\"position:relative;\">ü§î Improving <em>what</em> components render<a href=\"#-improving-what-components-render\" aria-label=\" improving what components render permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Identifying the slow parts of our React app will usually\npoint out to some particular components that are slow to render\n(or that have too many instances in a single page, more on this in the <strong>which</strong> section).</p>\n<p>There might be a number of reasons those components are slow, including:</p>\n<ul>\n<li>they do blocking calculations</li>\n<li>they render large trees</li>\n<li>they use expensive / non efficient libraries</li>\n</ul>\n<p>Most of these boil down to improving how fast your components render,\nsometimes critical components cannot rely on too complicated libraries\nand so you need to go back to basic and roll your own simpler implementation.</p>\n<p>I have experienced something like this when using <a href=\"https://formik.org/\">Formik</a> (which I love)\nor should I say abusing Formik on several cells of every single row of a complex table.</p>\n<p>You can go a long way making your components more efficient but eventually you will need\nto focus on <strong>which</strong> components render:</p>\n<h3 id=\"üßô-improving-which-components-render\" style=\"position:relative;\">üßô Improving <em>which</em> components render<a href=\"#%F0%9F%A7%99-improving-which-components-render\" aria-label=\"üßô improving which components render permalink\" class=\"header-anchor after\">#</a></h3>\n<p>There are two broad categories where we can improve this aspect:</p>\n<ul>\n<li>Virtualization</li>\n<li>Prop optimization</li>\n</ul>\n<h4 id=\"virtualization\" style=\"position:relative;\">Virtualization<a href=\"#virtualization\" aria-label=\"virtualization permalink\" class=\"header-anchor after\">#</a></h4>\n<p>It means <strong>only render what is visible in the viewport</strong>, i.e. only render the\ntable rows that the user can see or the list items the user can see.</p>\n<p>This is great because it can be applied to complex UIs without going through the <strong>what</strong> step,\nalthough I recommend it; and modern libraries tend to have decent support for virtualizing\nyour tables and lists. A good example of this is <a href=\"https://github.com/bvaughn/react-virtualized\">react-virtualized</a>.</p>\n<blockquote>\n<p>Virtualizing means that we <strong>reduce the amount of components React needs to render in a given frame</strong>.</p>\n</blockquote>\n<h4 id=\"props-optimization\" style=\"position:relative;\">Props Optimization<a href=\"#props-optimization\" aria-label=\"props optimization permalink\" class=\"header-anchor after\">#</a></h4>\n<p>React tries to make your components look like pure functions but still will try to render\nmore times than it should.</p>\n<h5 id=\"code-classlanguage-textreactmemocode\" style=\"position:relative;\"><code class=\"language-text\">React.memo</code><a href=\"#code-classlanguage-textreactmemocode\" aria-label=\"code classlanguage textreactmemocode permalink\" class=\"header-anchor after\">#</a></h5>\n<p>Most components in React can be <strong>memoized</strong>, which means that they do not have internal side effects\nor depend on any external side effects so that we can guarantee than <strong>with the same props the component\nwill return the same tree</strong> (hooks, state and context are still respected though).</p>\n<p>For that we can use <a href=\"https://reactjs.org/docs/react-api.html#reactmemo\">React.memo</a>.\nThis tells React to skip re rendering these memoized components if their\nprops didn‚Äôt change.</p>\n<h5 id=\"fake-prop-changes-code-classlanguage-textusecallbackcode\" style=\"position:relative;\">Fake prop changes: <code class=\"language-text\">useCallback</code><a href=\"#fake-prop-changes-code-classlanguage-textusecallbackcode\" aria-label=\"fake prop changes code classlanguage textusecallbackcode permalink\" class=\"header-anchor after\">#</a></h5>\n<p>Additionally we have the problem of <strong>fake prop changes</strong> which means that although\nthe content of a given prop didn‚Äôt change, the reference did. The most classic example\nof this is the event handler one:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>input onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onChange<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">onChange</code> callback, although semantically and content wise will be the same on every render, will be\nbe stored in a completely separate memory direction so React will detect it as different from the previous one.</p>\n<p>This is related to how <code class=\"language-text\">React.memo</code> does shallow comparison by default (although there‚Äôs no good way of\ndeeply comparing functions in Javascript AFAIK).</p>\n<p>An easy fix for this is to use <code class=\"language-text\">useCallback</code> which was designed exactly for this:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> onChange <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>input onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onChange<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5 id=\"fake-prop-changes-code-classlanguage-textusememocode\" style=\"position:relative;\">Fake prop changes: <code class=\"language-text\">useMemo</code><a href=\"#fake-prop-changes-code-classlanguage-textusememocode\" aria-label=\"fake prop changes code classlanguage textusememocode permalink\" class=\"header-anchor after\">#</a></h5>\n<p>A similar problem can rise when building complex data structures and not memoizing them\ncorrectly before passing them as props.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rows <span class=\"token operator\">=</span> data\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>bySearchCriteria<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span>bySortOrder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Table data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>rows<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This means that on every render we are re creating the <code class=\"language-text\">rows</code> array, and although\nthe content might not change, the shallow compare with the previous version will mark\nit as different. To solve this React provides <code class=\"language-text\">useMemo</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rows <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> data<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>bySearchCriteria<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span>bySortOrder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>deps<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Table data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>rows<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This will ensure rows are only recalculated when the dependencies change (most likely props or state).</p>\n<p>You can also customize the way <code class=\"language-text\">React.memo</code> compares current vs previous props but be aware that this\ncalculation should be fast since it is effectively part of the <strong>Render phase</strong> and you probably\ndon‚Äôt want to perform trivially nested deep comparisons on every render.</p>\n<h3 id=\"summary\" style=\"position:relative;\">Summary<a href=\"#summary\" aria-label=\"summary permalink\" class=\"header-anchor after\">#</a></h3>\n<p>The React profile is really good at telling you why a given component rendered out of\nthe three main options. Let‚Äôs cover each option and potential paths of improvements</p>\n<h4 id=\"props-changed\" style=\"position:relative;\">Props changed<a href=\"#props-changed\" aria-label=\"props changed permalink\" class=\"header-anchor after\">#</a></h4>\n<p>How it looks in the React dev tool:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 374px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43f3e9b7af652229f54cc30dd90a81de/52dba/propsChanged.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADCUlEQVQ4y6WS32tTdxTA718iQ9km6gZWRRDZ9GUw2JOlRWYRRNCKe9+DsgfxQdwP6hxjlDEs2tKt0bRWG02bYH8YU2vSm3tvYmaa/krSJO3Nz5smbbV+dm5qrXtwL3v4cL7nx/d8z/meo3zh6KZNV7ke0fk5HBI02gyVn0IBflSfCYH/5AeJuaYFueAf42DnDZTzXjfFQoEXU1PMJ5PMzs+RWVxkeaXGyss1amurwtp7qYp/ff0V8UKeI392onwzPkZMktx09HD5+6vcEnm9vZ2/E/NYr9fJSeL86soWa/8mJzZLHtbzJkfvO1HOuO5RrFaJpVKE43FiyQTh6WmmRJ/NZpnJZERm6nKL9NtzPJ1mwTTRJeZIZwdK67BHEi6TyOXIlEuki0UWKxbJfF5s5ltS0lJKvmahuIF9trHjzHIZI7fE0T4HyrkRL2m5MDQ2SrfTiefxGE91jcGREfzqJF23HQyOjtDvduPov8ujJ09ImEsUpdXCGyrSsiE5Pu/tQbk40MNyrUpagpLSSt4qkxHnklRhlgpkzCxW1SIrFdi2fKVMWeJXeU1BOslJV/YA49kUre1XUK4FvUzPTPPLb79y49ZNRv0+XINu2v/4nTt3++jq7qKvv5eJyQC99/px9DrpkDinVHv/4QPmFpKsSoUJc4FLjjaU7/7qwJSKJkMqWtjAP/GUcPQ5o77HGNEImqERkj19MRVDla8YfzZR9wXkO2ZlgKVlixVZnXhyjtYr36J83XIay7KIy4T9/nEMw0DTNBKJBLquo6pqXQ+HwwSDQaLRKKVSiVgsJnadSCTCjGyFrhvs3X8Y5eSps+RkwvZl+8LQ0BBuGUAoFCIg+vDwMB6PB5fLxcDAAIFAgIysi8/nw+v1ShH++mORyHP2HfwM5fiJU1QqlfqrdqVlWQEbW9+0bfo3ZV5WxY6xfUVZs1qtxqQaYu8BqfDThkMcazrBseaWDdnUsoHojc1vzmJvbN6S79ptmo6f5MuvGvl49z6Uj3Y1sG3HbrZt/z/s4oMPP2Hnnv38A1tXgPLnneP5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"props changed in react dev tool\"\n        title=\"props changed in react dev tool\"\n        src=\"/static/43f3e9b7af652229f54cc30dd90a81de/52dba/propsChanged.png\"\n        srcset=\"/static/43f3e9b7af652229f54cc30dd90a81de/12f09/propsChanged.png 148w,\n/static/43f3e9b7af652229f54cc30dd90a81de/e4a3f/propsChanged.png 295w,\n/static/43f3e9b7af652229f54cc30dd90a81de/52dba/propsChanged.png 374w\"\n        sizes=\"(max-width: 374px) 100vw, 374px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Did they really? Are they <code class=\"language-text\">fake prop changes</code>? Use <code class=\"language-text\">useCallback</code> and <code class=\"language-text\">useMemo</code>.</p>\n<h4 id=\"parent-rendered\" style=\"position:relative;\">Parent rendered<a href=\"#parent-rendered\" aria-label=\"parent rendered permalink\" class=\"header-anchor after\">#</a></h4>\n<p>How it looks in the React dev tool:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 468px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebb58cb61db4a6c158db12d038b954d3/90372/parentRendered.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACTklEQVQoz2WRS28SYRSG+TkmmphUIzv9DU2MG9SaWBN/hZvGhYkbF9YL2jbQiFxqoAQSLAFLGC7DZYACM9zvhXIZrhpdmNfzfQXbpIsn55w3Z86853ya1+Y3kLLfcBg5hFX0wB11wBFx4mvIBU/CBV/cjlj6AEfCF9gFG/b9B3AKVvgFI9yCGU7fHmr+F2gGtyDur0PzdluPVCoDKSEhGo4glUwREvLZHI5/HOPouxe5rIzRUMVitsB8OseMs+BxTtpk9gu///zFA90zGvjuIyKRMAxGI3Z2d2F3ODgutxsWqxVmsxkOqmu1GrrdLjqdDjqnp8QyUt1utzAZq3i0sckG6rFYLNDt9aCOxxgOhzzvdnsYjVRO7+wMzWYLjUYTjeZV6vU6VFXFww1yuP3+E+r090AgAEEQIEkSEokE0uk0fD4fRFHkzZPJ5D+svsxoNOKmdI83zweyVZLJJEqlErLZLCqVChRFQS6X41q73Uar1SKXTR7ZFgPGYMDp9/uYz+fnAz/od+D1emEwGODxeGCxWOCm+61uFwwGYbPZeG0ymRCPxzGbzbjT6XTKGY8n+HnhUE+3aSCTOUGhUODI5K5cLqNarUKWZULhukIwx+yBCsUi34Dp+Xyeu+Y31H/eI9t9hMNhWjuBcCjEX/0kk+HrR6NR7lIUo4jFRH5Tdo6Vzr5jt2cDnzx9Ds3Wy1f0Sg3k8jL9idwo5IRgrpjG82UtL/M85cqyb9VbKBSxfl8HzfWbWtzS3sPanbsUCYo8v1RfQXvRs3ZJv3bjNv4BK9jG8ma+sMUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"parent rendered in react dev tool\"\n        title=\"parent rendered in react dev tool\"\n        src=\"/static/ebb58cb61db4a6c158db12d038b954d3/90372/parentRendered.png\"\n        srcset=\"/static/ebb58cb61db4a6c158db12d038b954d3/12f09/parentRendered.png 148w,\n/static/ebb58cb61db4a6c158db12d038b954d3/e4a3f/parentRendered.png 295w,\n/static/ebb58cb61db4a6c158db12d038b954d3/90372/parentRendered.png 468w\"\n        sizes=\"(max-width: 468px) 100vw, 468px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Use <code class=\"language-text\">React.memo</code> to memoize your <em>pure</em> components.</p>\n<h4 id=\"hooks-changed-state-context\" style=\"position:relative;\">Hooks changed (state, context)<a href=\"#hooks-changed-state-context\" aria-label=\"hooks changed state context permalink\" class=\"header-anchor after\">#</a></h4>\n<p>How it looks in the React dev tool:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 349px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/58291fd55b3efef9880d05555b493555/e9bf8/hooksChanged.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADOUlEQVQ4yz2TSVNiZxSG7y+K6VV+Qf+KZJOqVCqbpJNlFtl0NmbXlUHjlATQFpBuZXKIKIiidjPY0opdoqAyc5mVUeTJ+W5MqDp1xu/lnPOeq3268Btfvp7ju9UFvnFbDHnmnRdt5plHtMfyaD/mHvXXElO5b6VWvVUYCkt78ucUzrMT9NsmpV6HskhObL3fJX/XotRtUxn0KLZvjVhBtKqpDQcUO3ekqzplqVcYCksbcy4RqpQJ7gZZeOXgpchGwG+Iw+ViMxhkdWvLEBVb928TODhgyeXk4ChG437A/WhEsFRAYWmfzE0QvE5zfnnBxOwMcxaz8XDeZmPZ68VitWJeXMS1vsYfFgu25dfYV5b5eXJSgPcptZq02m12rlIoLO0z6wSRzCW1ZoOySEUK8hWdUr1miC6x6m3rf7vcqBuiYjm9TPL6Cr1aIZpNobC0z1dmieZSNAQop5coyE70Zo267Kogq8hLLFPMG7lSvUq2XBRdodpq0JJdtvodBsN7Yrk0Ckt7OvOCvVSSxNkZDqeTZY8bX3CHd4lT1rZ87L45ZNb0lxH37+1il5Gdq14C+yGavS66NNIb9NlPX/B0+gXaR45F/PksHVlutl6n0mlT7XYoSqHevjMkp8aXEVXsv7zybx+G1ASs3e/jz2VQWNrHVjOhcgGbkPB8fJx5u529SIRfp6eZnJvFKWTMmEyYhJgd6faVx2PUvHQ4+GXqd5bcbg4ODwlKUwpLG5sRtmSxmXyOqIz5Nn5MTPSRyKGcxfnNNYnUJeF4nA9XaU6SSaKnJ4Tfxw2Wjz6cUZfOA3IpCkt74rQbI7dklItCnvNshqtyidN0ioKwmhUGE2JfSi5dKpIqFkgIsBq9BzSEkL6MHhAMhaWNmefYFvSbXJa3J+/lgH24/94wDncvGuHN8Tu8vk3DX5HxzTarjO0mJX9Qe9xlW76k7RvpULC0L6aek8inUb/BcMgDI4ajB9H/+uokhhIbid/t9egKAcruC4l9IaTb7xlvj5OnfDXzI9r3i+OYdhx4o35cYR+hmJtY3MVaeB1nZAtPeJNAbI21yAYu8b0RH4GjdSMWiXs4TngJiW/zmfnB/hP/AF6+rkYiwmm4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hooks changed in react dev tool\"\n        title=\"hooks changed in react dev tool\"\n        src=\"/static/58291fd55b3efef9880d05555b493555/e9bf8/hooksChanged.png\"\n        srcset=\"/static/58291fd55b3efef9880d05555b493555/12f09/hooksChanged.png 148w,\n/static/58291fd55b3efef9880d05555b493555/e4a3f/hooksChanged.png 295w,\n/static/58291fd55b3efef9880d05555b493555/e9bf8/hooksChanged.png 349w\"\n        sizes=\"(max-width: 349px) 100vw, 349px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Nothing too obvious to do here. Try to validate that the hook that\nchanged makes sense. Perhaps a bad context provider is faking out\nchanges the same way as <code class=\"language-text\">fake prop changes</code> might appear.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>By now you should feel pretty confident in your skills to identify and improve\nPerformance problems in React. Of course <em>theory</em> and <em>practice</em> are different beasts\nbut your problem wont be far away from the ones we‚Äôve covered, perhaps you will have to\ndeal with library updates, or components out of your control but that‚Äôs life!</p>\n<hr/>\n<p>Like the content? Consider subscribing, buying me a coffee or even becoming a Patreon below.</p>","fields":{"slug":"/react-performance/","readingTime":{"text":"11 min read"}},"frontmatter":{"title":"React is slow, what now?","date":"December 04, 2020","description":"We study React applications performance from the ground up, the processes involved, the tools to measure and identify slow parts, the important metrics to take in account, how these impact the UX and the various ways there are available to make applications super fast and smooth. Grab a cup of coffee and enjoy the ride.","tags":["React","Javascript","Typescript","props","state","chrome dev tools","react dev tools"],"seoFooter":null,"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},"pageContext":{"slug":"/react-performance/","previous":{"fields":{"slug":"/programming-principles/"},"frontmatter":{"title":"Secrets of a Tech Lead: Programming Principles"}},"next":{"fields":{"slug":"/ibridge/"},"frontmatter":{"title":"Breaking the iframe frontier: ibridge"}}}},"staticQueryHashes":["1000388668","1219926595","914163225"]}